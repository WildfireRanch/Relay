{"docstore/ref_doc_info": {"598b72d9-f264-4f02-b3aa-24d1fd9b6031": {"node_ids": ["0cb073d0-fdea-4c59-9897-7f0cfe9f51f1"], "metadata": {"tier": "global", "file_path": "/app/docs/generated/global_context.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "98404db9-bd1e-487b-997f-76ad3ddfaa79": {"node_ids": ["ba922478-c464-4307-aa48-1fe7f5d2c549"], "metadata": {"file_path": "/app/docs/imported/relay_code_update_250603.md", "file_name": "relay_code_update_250603.md", "file_size": 1982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "27fb9909-0534-4a06-9558-391d92cabdf4": {"node_ids": ["14070395-325e-44fb-8933-66ff70588334"], "metadata": {"file_path": "/app/docs/imported/relay_code_update_250605.md", "file_name": "relay_code_update_250605.md", "file_size": 2876, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "2a6f569b-cf6d-4556-8078-89439c8cb782": {"node_ids": ["5c56f360-d61e-49c7-92c9-4622f0f5bfa4"], "metadata": {"file_path": "/app/docs/imported/relay_code_update_250606.md", "file_name": "relay_code_update_250606.md", "file_size": 3248, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "42211b25-e433-45b8-b5b2-73af3be71490": {"node_ids": ["0069d529-d62a-4dd8-aaec-7abed1829aa7", "b967d457-ed28-42c7-b94a-eac1e32e9737"], "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "9e37187c-d69a-4bca-a449-548cf6e83d3e": {"node_ids": ["7210335d-9a6e-4181-8a2f-cd69dbb63e1f"], "metadata": {"file_path": "/app/docs/imported/test_placeholder.md", "file_name": "test_placeholder.md", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f": {"node_ids": ["e871829b-bcba-4c02-9188-e46291b288b9", "c90754db-5a0a-4d75-8d77-ae82273366a2", "5f0a2ae5-0ccc-4c7a-afce-12e5914fc335"], "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "90cc8f9d-7428-4c64-81a1-bc88127c8368": {"node_ids": ["7856fb89-25df-48da-8fe4-d97b626d9f2e"], "metadata": {"file_path": "/app/docs/imported/\ud83d\udd27_google_docs_sync_integration.md", "file_name": "\ud83d\udd27_google_docs_sync_integration.md", "file_size": 3065, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "e47a7785-15d1-4a22-a322-d14f914d3493": {"node_ids": ["fcab0e2e-81d6-4891-bdfe-f34ecc541fca"], "metadata": {"tier": "project_docs", "file_path": "/app/docs/readme.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "97b8c10f-445b-4001-88d0-1a1fab952df3": {"node_ids": ["ddb3ba24-c6e2-420b-be3b-7d30105f8c67"], "metadata": {"file_path": "/app/frontend/components.json", "file_name": "components.json", "file_type": "application/json", "file_size": 428, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "70a8dd68-ec93-4f0b-9e10-aa2122a427d5": {"node_ids": ["d19a0639-dfcd-4344-ae89-e324fd89eff3"], "metadata": {"file_path": "/app/frontend/next-env.d.ts", "file_name": "next-env.d.ts", "file_size": 211, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "60f448fc-35d2-4935-aa32-5130b542cb5b": {"node_ids": ["163c3a83-d4cb-4187-adaf-e6e31be16a3c"], "metadata": {"file_path": "/app/frontend/next.config.ts", "file_name": "next.config.ts", "file_size": 133, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d6d313a3-ec38-44a5-9b1a-e9d43a123c4b": {"node_ids": ["0bd14bab-5ff9-4792-92da-3d1e1f937de3"], "metadata": {"file_path": "/app/frontend/package.json", "file_name": "package.json", "file_type": "application/json", "file_size": 1627, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "937ffef8-60ba-48b8-9fd7-429f1022bbe5": {"node_ids": ["f11a1b5a-76a1-40c7-9a6d-165c3c7c820b"], "metadata": {"file_path": "/app/frontend/postcss.config.js", "file_name": "postcss.config.js", "file_type": "application/javascript", "file_size": 110, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "eb40f0e7-43e1-43aa-bc2f-b5a41c66240b": {"node_ids": ["6369ba28-de16-4386-8878-597c9112b4f3"], "metadata": {"file_path": "/app/frontend/src/app/action-queue/page.tsx", "file_name": "page.tsx", "file_size": 286, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c7e5b0eb-86bf-46b4-ac54-8a9f440cc091": {"node_ids": ["ac735090-6a24-45fb-8477-31a1039dab1d"], "metadata": {"file_path": "/app/frontend/src/app/api/docs/list/route.ts", "file_name": "route.ts", "file_size": 215, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "23132ac7-ea1d-4493-ab31-0cdb5fa28563": {"node_ids": ["aa6d2780-cf2f-4738-8f4d-70478b4b571d"], "metadata": {"file_path": "/app/frontend/src/app/api/docs/view/route.ts", "file_name": "route.ts", "file_size": 358, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c2708967-07ae-496d-a96a-73d352fec2e9": {"node_ids": ["c4904cf7-4873-49f1-99e4-da29bfdb7429"], "metadata": {"file_path": "/app/frontend/src/app/api/kb/search/route.ts", "file_name": "route.ts", "file_size": 389, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "006c4a7e-3fa4-4e51-9a35-2884e55838f7": {"node_ids": ["0333c725-2e3f-455a-975f-c9c902194c33"], "metadata": {"file_path": "/app/frontend/src/app/api/status/summary/route.ts", "file_name": "route.ts", "file_size": 220, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "bd95f59a-e4d6-4a80-aad5-a4fe8768719b": {"node_ids": ["dd7ef435-c30f-4e6e-ae35-51a74b34bbf5", "2ef8ab26-9154-4815-b552-4aea9b4827a1"], "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f4890c21-6889-4d02-ad81-221656141a06": {"node_ids": ["911cb623-9812-4dce-9024-495c6f8a96e0"], "metadata": {"file_path": "/app/frontend/src/app/audit/page.tsx", "file_name": "page.tsx", "file_size": 261, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "22c1b0ba-50d9-4cd2-822e-b6b51cb1b027": {"node_ids": ["68690144-0e7f-4b23-b0e4-58344b44af4f"], "metadata": {"file_path": "/app/frontend/src/app/codex/page.tsx", "file_name": "page.tsx", "file_size": 3861, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "cf2e2983-2991-4e70-8968-818b2b7db5f8": {"node_ids": ["d7048ed1-c644-4631-a2d8-def233197f93"], "metadata": {"file_path": "/app/frontend/src/app/control/page.tsx", "file_name": "page.tsx", "file_size": 893, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "1f1c0190-06ff-4179-8088-93423ec99c1e": {"node_ids": ["247a961f-811c-4041-a97e-02beb3c92e03"], "metadata": {"file_path": "/app/frontend/src/app/dashboard/page.tsx", "file_name": "page.tsx", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c3f5b707-7db2-4066-91f9-7256de024454": {"node_ids": ["01dc55cd-14b6-48fe-8957-ea14e721a848"], "metadata": {"file_path": "/app/frontend/src/app/docs/page.tsx", "file_name": "page.tsx", "file_size": 231, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "deee53c9-0121-4eff-b211-b0d93c663a27": {"node_ids": ["7fa12f32-a7ca-4792-84d4-daecd4981c0b"], "metadata": {"file_path": "/app/frontend/src/app/layout.tsx", "file_name": "layout.tsx", "file_size": 514, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f30acca8-76ed-4963-9fae-4562da85adc5": {"node_ids": ["1b9fdb91-aa77-408e-9f1e-47311812df7a"], "metadata": {"file_path": "/app/frontend/src/app/metricschart/page.tsx", "file_name": "page.tsx", "file_size": 271, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "789fe320-777b-4984-ba88-323eb0987f69": {"node_ids": ["abe5ee4a-581d-449b-b904-5aee59ab1aeb"], "metadata": {"file_path": "/app/frontend/src/app/page.tsx", "file_name": "page.tsx", "file_size": 1969, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "2aa6c552-d907-41a0-a876-3a4a92fd6b82": {"node_ids": ["dee2e32a-bdc4-4059-88ce-18b1073c3cd0"], "metadata": {"file_path": "/app/frontend/src/app/settings/page.tsx", "file_name": "page.tsx", "file_size": 353, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "59a30dbe-fe0d-464c-addc-e9401c67f211": {"node_ids": ["d929e17a-a853-49b5-b2c8-236abc0c95de"], "metadata": {"file_path": "/app/frontend/src/app/status/page.tsx", "file_name": "page.tsx", "file_size": 284, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "cbd3e275-dec4-4c69-b2bd-947dbaae36e5": {"node_ids": ["a9ca2aad-c06c-4a31-9e18-72494c78fcf0", "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c", "d851725f-3a9f-43d4-bbc8-67011b3d65b4", "27c6955e-1add-4106-95a3-6d73f0be21c1"], "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "76f9d856-249d-4bf9-a8be-88ccda517381": {"node_ids": ["169475b9-b84b-4b71-976d-0e4f25764e27"], "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatMessage.tsx", "file_name": "ChatMessage.tsx", "file_size": 894, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "b2e6dd37-609b-4514-8801-6ad9e3c464fd": {"node_ids": ["a88a66b7-6eef-42e4-b783-fd5630ce17f2"], "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatWindow.tsx", "file_name": "ChatWindow.tsx", "file_size": 1683, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "ed45e49e-84c9-4e0a-9334-42494eaa49b4": {"node_ids": ["7371b9b0-bfa0-43f2-889e-fc011e961fd6"], "metadata": {"file_path": "/app/frontend/src/components/AskAgent/InputBar.tsx", "file_name": "InputBar.tsx", "file_size": 1460, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "a29717d4-ebdc-4761-8ada-6a7dedf5cad1": {"node_ids": ["366f6908-45ef-493a-9783-e31fab422f30"], "metadata": {"file_path": "/app/frontend/src/components/AskAgent/hooks.ts", "file_name": "hooks.ts", "file_size": 3620, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "dcc942cc-2105-4a05-921d-75e91c655b86": {"node_ids": ["2d6fd3c5-60a6-4f3e-b33f-845d9b9e08c1", "ea4f0b75-0bca-48bd-9825-95627eb6d4a5"], "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c5f7e75c-55f5-4277-98aa-74eb69b3a143": {"node_ids": ["ef605c2c-fba0-4103-aa29-dbf5cac0673a", "d2784268-cae6-404f-bc18-0e971589b590", "22ed50f8-bfac-447a-8a55-1ecf47f1451e", "c078f711-8fa0-4bc4-a942-f73a125586ac", "b7abab8e-bcf6-4615-b3cc-4da8a84472d5"], "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "42752c63-cbe8-4f2c-b3e9-dc47a71c9cbe": {"node_ids": ["f497744a-84cd-4c7a-a381-f2115eb122bf"], "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexEditor.tsx", "file_name": "CodexEditor.tsx", "file_size": 842, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "fbde4216-4dc6-418c-ad99-bfdd2a9e4306": {"node_ids": ["16644408-df7b-4ca2-8c56-5a31ee5a60cb"], "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPatchView.tsx", "file_name": "CodexPatchView.tsx", "file_size": 1321, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "fd39eef8-3bbe-410d-a4aa-b462b6185f01": {"node_ids": ["bc089606-c7b0-4cf8-bbfe-b33584138e17"], "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPromptBar.tsx", "file_name": "CodexPromptBar.tsx", "file_size": 1423, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "03097629-6de1-41d7-80b3-8f63ec4b85ee": {"node_ids": ["d6b5ac67-7e22-499c-abec-6d6426fa0ce0"], "metadata": {"file_path": "/app/frontend/src/components/Codex/index.ts", "file_name": "index.ts", "file_size": 277, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "7677e1cc-8bfb-4841-9763-b65dc677f4ca": {"node_ids": ["08443eb7-dbcf-4482-80fd-ca80b3b3c6b6"], "metadata": {"file_path": "/app/frontend/src/components/Codex/page.tsx", "file_name": "page.tsx", "file_size": 2108, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "1ce7d98c-a264-4e79-978e-255958397231": {"node_ids": ["c28e4624-a0d4-4df7-ad73-72caeccc21b0", "702b1cb1-a863-4164-84ca-42fa7abffe4f"], "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d11682ae-4b7e-4449-93fa-15f00d301caa": {"node_ids": ["016288e2-5e2d-4d41-80bd-35972a6e3067", "1442fb0d-f021-4e20-a455-cd4e7bc50330", "0033a319-25c1-4402-aec8-0307db0e55e7"], "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "39673939-c4bd-45c9-9db3-a4e30dcaef1b": {"node_ids": ["47ceb626-b1ca-4aa0-b952-07b4e65d35fb"], "metadata": {"file_path": "/app/frontend/src/components/GmailOps/GmailOpsPanel.tsx", "file_name": "GmailOpsPanel.tsx", "file_size": 3509, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "a2d88b64-bca7-4247-874d-b49196eead01": {"node_ids": ["30cdd1db-99f2-4bed-ad09-de9f121ba7fc", "47ed4b8d-0954-4137-9093-33783865cfb7"], "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d577dd3c-0a2d-4cfa-bff0-d25056942f2e": {"node_ids": ["043eed59-c993-4088-a488-0861516b2ba9", "8d9f48a3-c889-447c-b779-58bf3b62be44", "0889d79a-915c-4865-81c9-47919a84d274", "ea561eb4-412b-4f79-a7b2-f51a36be09cd", "86a9e1ea-d77e-4c82-9b18-c481c054d9ed"], "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "9fd3af2e-409f-4652-be63-c1eca91f9475": {"node_ids": ["54ec9ec9-841e-4f44-b6d4-e8dd93db7159"], "metadata": {"file_path": "/app/frontend/src/components/MetricsCharts/MetricsCharts.tsx", "file_name": "MetricsCharts.tsx", "file_size": 902, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "2780754d-6ad3-4e5d-8796-460cdc823e17": {"node_ids": ["c7e21dbe-ccf3-410c-a581-8afa3159981d"], "metadata": {"file_path": "/app/frontend/src/components/SafeMarkdown.tsx", "file_name": "SafeMarkdown.tsx", "file_size": 3365, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "706c8232-7cde-492c-9bfa-07e3825ea4cc": {"node_ids": ["6006a86d-2ea2-4838-8727-4b864a0751c2", "a16c8553-54fd-440b-8215-4ade186ac58e"], "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "ebafa638-7ade-4f19-8960-d96a77b14225": {"node_ids": ["76d2aefc-f4a8-478f-b1db-ec8c91d2f67d"], "metadata": {"file_path": "/app/frontend/src/components/Sidebar/Sidebar.tsx", "file_name": "Sidebar.tsx", "file_size": 1570, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "8435d31e-cf88-4fad-9ca6-c1e674f99069": {"node_ids": ["8374feda-2359-40a5-9a75-37cfb09c2f01"], "metadata": {"file_path": "/app/frontend/src/components/StatusPanel.tsx", "file_name": "StatusPanel.tsx", "file_size": 4399, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "e887bd1b-a075-4c4d-bf43-ebe4fe0694c6": {"node_ids": ["1070213f-b90e-4096-9acd-19b578926990"], "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.stories.tsx", "file_name": "Dashboard.stories.tsx", "file_size": 152, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "b1f589d5-03a2-4e7a-9a72-5874ed82e3f3": {"node_ids": ["6848a3fa-c8e6-4d01-96c6-6005c28d53a1"], "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.tsx", "file_name": "Dashboard.tsx", "file_size": 3449, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c4a0e9c0-195f-4783-a7f9-538a0e8b86c5": {"node_ids": ["3eb78614-bd95-4d18-a308-aa1aa1a0a736"], "metadata": {"file_path": "/app/frontend/src/components/index.ts", "file_name": "index.ts", "file_size": 717, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "282b49cc-8e64-4ca9-a9f7-f03c7cc8ee8c": {"node_ids": ["b1dedcc3-0dd2-4028-a633-57aba9b33ebb"], "metadata": {"file_path": "/app/frontend/src/components/ui/AskAgent/AskAgent.tsx", "file_name": "AskAgent.tsx", "file_size": 1644, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "95a26b24-98f2-4312-b4bf-509f6561834c": {"node_ids": ["343d1e2e-43f4-4063-9c82-13ea47238a27"], "metadata": {"file_path": "/app/frontend/src/components/ui/badge.tsx", "file_name": "badge.tsx", "file_size": 882, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "816ee76c-ad91-461d-8e8e-f7844e8705a0": {"node_ids": ["99648ab2-897a-48c0-838f-65b84df95cf4"], "metadata": {"file_path": "/app/frontend/src/components/ui/button.tsx", "file_name": "button.tsx", "file_size": 2123, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "01faa84c-5693-40ef-93d9-9137f833d3d5": {"node_ids": ["47791dcf-be74-4f5d-8b82-6427624f3479"], "metadata": {"file_path": "/app/frontend/src/components/ui/card.tsx", "file_name": "card.tsx", "file_size": 1989, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "70dcc4b7-3f74-495d-afc2-8d6970803b30": {"node_ids": ["1dffc1eb-2c93-4993-8eb7-c080c71d3cdb"], "metadata": {"file_path": "/app/frontend/src/components/ui/input.tsx", "file_name": "input.tsx", "file_size": 967, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "9b5d1a87-8cfa-4eac-9f34-6b99835b9dbd": {"node_ids": ["c1db7728-6a92-4e13-a65c-212183b63c27"], "metadata": {"file_path": "/app/frontend/src/components/ui/label.tsx", "file_name": "label.tsx", "file_size": 611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "5cedd8b6-185c-4504-b9b8-0c5b4022e187": {"node_ids": ["26c470e5-4630-4347-a307-e73151db2567"], "metadata": {"file_path": "/app/frontend/src/components/ui/progress.tsx", "file_name": "progress.tsx", "file_size": 698, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f7bc13d9-48d0-45df-99b3-34123a4ff3fc": {"node_ids": ["49a8370e-030f-4b8f-a4fe-a891f0a0a6f2"], "metadata": {"file_path": "/app/frontend/src/components/ui/textarea.tsx", "file_name": "textarea.tsx", "file_size": 759, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c28fc02a-c386-43ff-ae78-208479f8d59b": {"node_ids": ["fe1bff42-bc46-4842-8124-165bdb5fc5d2"], "metadata": {"file_path": "/app/frontend/src/lib/api.ts", "file_name": "api.ts", "file_size": 278, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d86e90a0-519a-4c83-ad34-c383fe0cd8c1": {"node_ids": ["45f2b7f7-5051-4cdf-ae64-edbdb255b495"], "metadata": {"file_path": "/app/frontend/src/lib/toMDString.ts", "file_name": "toMDString.ts", "file_size": 422, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "a9a12e36-3853-41ee-af61-d7f8ded4d8c7": {"node_ids": ["cdbca185-3e63-467e-9afb-cb751799e1ed"], "metadata": {"file_path": "/app/frontend/src/lib/utils.ts", "file_name": "utils.ts", "file_size": 196, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c8e052b5-fdf0-461b-8a65-04c2ae17e8a5": {"node_ids": ["f3e66473-5f6f-40d5-ae68-9e2b8a16e5a0"], "metadata": {"file_path": "/app/frontend/src/types/react-syntax-highlighter.d.ts", "file_name": "react-syntax-highlighter.d.ts", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "08fe0554-6ffc-47ac-baa9-4eda73e97263": {"node_ids": ["2233adf4-5aa9-480a-81e0-860d3653bf8f", "8679f336-dea5-4980-b9f2-90a7e9e983c5"], "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "51fafe6d-a61a-40d4-a98f-95663f297bf6": {"node_ids": ["0d538ff8-c6e7-480e-9689-eebbba7c2f1d"], "metadata": {"file_path": "/app/frontend/tailwind.config.js", "file_name": "tailwind.config.js", "file_type": "application/javascript", "file_size": 907, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "12511bcf-39c2-4e3f-9798-0568e655fbf8": {"node_ids": ["13dd44bb-9093-490b-ab64-4d3c8c12b40b"], "metadata": {"file_path": "/app/frontend/tests/SafeMarkdown.test.tsx", "file_name": "SafeMarkdown.test.tsx", "file_size": 898, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "cdaf2771-af13-4881-8a3e-2014ae513861": {"node_ids": ["2ed4aecd-565e-4d45-ba58-79cc375aafac"], "metadata": {"file_path": "/app/frontend/tests/toMDString.test.ts", "file_name": "toMDString.test.ts", "file_size": 723, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "e1d74f3f-6392-4355-b807-6098794b2315": {"node_ids": ["de9a04e2-1561-422f-9e60-4f455e266d96"], "metadata": {"file_path": "/app/frontend/types/next-auth.d.ts", "file_name": "next-auth.d.ts", "file_size": 655, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "3b3698f9-b0f5-45cd-a16e-fb6d250fc55b": {"node_ids": ["3cb4d07d-ad2b-498a-beac-574df3aa995c"], "metadata": {"file_path": "/app/frontend/vitest.config.ts", "file_name": "vitest.config.ts", "file_size": 1230, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "40156584-b6be-4f30-a2b0-174c90060f04": {"node_ids": ["497f4876-c00f-4eec-b5bf-49e785f4d2f2"], "metadata": {"file_path": "/app/frontend/vitest.shims.d.ts", "file_name": "vitest.shims.d.ts", "file_size": 62, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "106921ef-d4ba-44ab-84dc-21ffb73e752e": {"node_ids": ["b2026e8b-b2b9-4bfa-bc7d-1d9256315e82"], "metadata": {"file_path": "/app/services/_init_.py", "file_name": "_init_.py", "file_type": "text/x-python", "file_size": 98, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "666a03f5-2130-4735-8080-4c155855da2f": {"node_ids": ["5a26d495-b97a-435d-8033-4e1fb2d0a652", "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09", "d43a0fec-8ce9-4587-9ecd-c91857aa48ee"], "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d7fc6d5b-aa0c-4da9-be5c-ca32e33e67b5": {"node_ids": ["c9eb9976-af7a-4846-bf66-e69db7692479"], "metadata": {"file_path": "/app/services/config.py", "file_name": "config.py", "file_type": "text/x-python", "file_size": 541, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "6abb1d86-2fdc-4a53-bcdf-690d30cf3a89": {"node_ids": ["653f46ce-a9c2-4580-b2dd-662c5038d3ba"], "metadata": {"file_path": "/app/services/context_engine.py", "file_name": "context_engine.py", "file_type": "text/x-python", "file_size": 864, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "cc24b8c4-4e5f-40b9-8718-08d2a4e6a915": {"node_ids": ["7ceb3846-0fd3-4af9-a1f4-491b26ecf33c", "20507cc0-ee01-4a70-99ae-c8a438a646d6"], "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "76c4eec5-d3af-4318-afba-f3509593d9ec": {"node_ids": ["f4340a8c-f585-4252-a04e-30b77b4291c4"], "metadata": {"file_path": "/app/services/delete_embeddings.py", "file_name": "delete_embeddings.py", "file_type": "text/x-python", "file_size": 2361, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "ffad7c87-206a-4b06-8aac-b38ef5776aee": {"node_ids": ["5d20c69a-bdf8-4335-a07f-39b7eb14ec64"], "metadata": {"file_path": "/app/services/docs_utils.py", "file_name": "docs_utils.py", "file_type": "text/x-python", "file_size": 4321, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f66b532c-3be9-4c19-b7d0-fea80573db7f": {"node_ids": ["93a4c2c4-ce1f-480f-85a5-b7b76a033568"], "metadata": {"file_path": "/app/services/env_checker.py", "file_name": "env_checker.py", "file_type": "text/x-python", "file_size": 1231, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "44fa8941-2814-4a01-aba5-3bb729e24ba4": {"node_ids": ["1f29d13a-3ed7-4fa3-baeb-1cf6dbcf0037"], "metadata": {"file_path": "/app/services/gmail.py", "file_name": "gmail.py", "file_type": "text/x-python", "file_size": 2867, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "e48d94ae-698a-442a-b50c-b5629a72998b": {"node_ids": ["927ffb71-8f64-4366-9524-c95a688463b0"], "metadata": {"file_path": "/app/services/google.py", "file_name": "google.py", "file_type": "text/x-python", "file_size": 1139, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "2e37c06f-f4ac-4626-932c-f52902861a1b": {"node_ids": ["7037f45c-377d-4478-b512-1fcc489785bb", "7c59b589-e944-4422-8273-95c823a2d419"], "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "1406e348-9f7f-494f-b2fc-35b495af11c8": {"node_ids": ["330a5aca-6fab-45db-8e96-fe08ffb54ad4"], "metadata": {"file_path": "/app/services/graph.py", "file_name": "graph.py", "file_type": "text/x-python", "file_size": 3089, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "98cbaf46-e65d-4ded-9dbe-e7ba4cfaea2a": {"node_ids": ["5075e2d5-0f28-4c8b-ba4d-eaf4337dee20", "3c8951e1-6c13-4ca2-b999-00a335659b69"], "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f341f9d2-cccc-4418-be3e-715ce653f572": {"node_ids": ["03920661-e957-49c6-ac0f-075c782f6fc9", "40baac40-67bf-4c4c-af08-77684fd07ebf", "42c018dd-b14a-4e90-9136-6f4f6762f4f3", "b441a16c-472b-4a38-beb4-27f4fa05c267", "3f349fe1-d202-467d-99f8-9ad0c0268c7a"], "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "12bdd9f2-588a-4e21-a184-65acc4d47f3f": {"node_ids": ["3ab9e8c4-ea50-4f43-a874-c4a8bb7a506d"], "metadata": {"file_path": "/app/services/logger.py", "file_name": "logger.py", "file_type": "text/x-python", "file_size": 546, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "c9baed79-0f26-4092-8771-51d378c03cb8": {"node_ids": ["86514c3d-113e-45ff-b4f6-30687d292e69"], "metadata": {"file_path": "/app/services/logs.py", "file_name": "logs.py", "file_type": "text/x-python", "file_size": 1046, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "33bc1432-895e-4b38-8ff5-ee973f054d87": {"node_ids": ["61baf95e-c397-484e-9f0c-455884354f16"], "metadata": {"file_path": "/app/services/memory.py", "file_name": "memory.py", "file_type": "text/x-python", "file_size": 2117, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "bae58ad2-2880-4d67-9488-d76274bad464": {"node_ids": ["20495967-655f-44e6-9788-37b9d2b0fbd4"], "metadata": {"file_path": "/app/services/mqtt_client.py", "file_name": "mqtt_client.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "7d280a23-188c-412d-b437-ac1b5d09ccd8": {"node_ids": ["7dd24142-5da5-4484-a631-4d3e99c62030"], "metadata": {"file_path": "/app/services/neo4j_driver.py", "file_name": "neo4j_driver.py", "file_type": "text/x-python", "file_size": 1645, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "88bc859b-b1d1-4b68-878b-ccb01526aec6": {"node_ids": ["fba52ff1-4be3-44ea-882d-815672630141"], "metadata": {"file_path": "/app/services/queue.py", "file_name": "queue.py", "file_type": "text/x-python", "file_size": 169, "creation_date": "2025-07-03", "last_modified_date": "2025-07-03", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "17c0e145-b5de-4dbf-a8ee-50aeb558d73b": {"node_ids": ["0b044b21-2c48-49ac-8aef-17658e597613"], "metadata": {"file_path": "/app/services/semantic_retriever.py", "file_name": "semantic_retriever.py", "file_type": "text/x-python", "file_size": 1407, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "af68bc4c-397f-4d64-ab7d-753d5849ae64": {"node_ids": ["90a434ee-5092-4034-8e70-cb137ee8bc62"], "metadata": {"file_path": "/app/services/settings.py", "file_name": "settings.py", "file_type": "text/x-python", "file_size": 793, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "08b0e869-a678-49a1-b282-20fe1ddedcec": {"node_ids": ["a540590d-9d02-4cd2-a88e-8b337e7b63f3"], "metadata": {"file_path": "/app/services/summarize_memory.py", "file_name": "summarize_memory.py", "file_type": "text/x-python", "file_size": 818, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d96b136e-e43f-4fff-8e5c-6bba157490f5": {"node_ids": ["92e45e3b-d9fd-4289-b577-599725645e33"], "metadata": {"file_path": "/app/routes/__init__.py", "file_name": "__init__.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "f2742e92-9158-4420-a66b-2c08750cfba1": {"node_ids": ["ecd2b3a5-f09c-4cf3-a9ed-3541f0174271", "f0a4b430-aa27-4a38-9b3e-ba516b92fa8b"], "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "fa52c786-85e6-4bb6-b7d1-5498ae83d1a9": {"node_ids": ["062dc2a4-0e0a-4290-80e0-dfe373f2a8c6"], "metadata": {"file_path": "/app/routes/admin_routes.py", "file_name": "admin_routes.py", "file_type": "text/x-python", "file_size": 750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "4a83839a-9059-492f-8c60-ccfb1ae9299b": {"node_ids": ["c2e899a1-0bc9-49ec-9c9d-398353902c66", "b302a712-c712-450d-8cd6-8405470eaa34"], "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "40432b16-fe92-46c1-a567-cb1db71c4d14": {"node_ids": ["9327dfbd-06ea-4b6e-aba7-aff8be456ffa"], "metadata": {"file_path": "/app/routes/codex.py", "file_name": "codex.py", "file_type": "text/x-python", "file_size": 1956, "creation_date": "2025-06-28", "last_modified_date": "2025-06-28", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "280aae5f-b5cc-40a6-b9c8-bbe5f7509270": {"node_ids": ["724d6454-0836-4f11-ab8f-a96b2d1034dc"], "metadata": {"file_path": "/app/routes/context.py", "file_name": "context.py", "file_type": "text/x-python", "file_size": 2115, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "bcb67366-2d90-47cc-bd80-403b935eb6b5": {"node_ids": ["62c55c5d-a9fa-456f-b2f7-b715d137a63d", "7c782813-3d9c-4df0-8ba9-1eec36b8269c", "a853f26b-c78c-40c2-91c5-0e8f6c8d1e33"], "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "20b4382e-d50c-4f54-977c-dde0ee629bae": {"node_ids": ["8573d8a2-b198-4cd8-bdcb-b1ec44259c0f"], "metadata": {"file_path": "/app/routes/debug.py", "file_name": "debug.py", "file_type": "text/x-python", "file_size": 342, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "531abf6c-f685-4f51-8c28-a48630083160": {"node_ids": ["8804bd55-fae3-44da-b336-f1f0684ffbec", "051ca004-6c72-410c-94bb-a8502e257461"], "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "beec6e45-03d9-422a-b9e8-591664a84ef6": {"node_ids": ["2761fa9c-b7d5-4502-8021-d1886618163b"], "metadata": {"file_path": "/app/routes/embeddings.py", "file_name": "embeddings.py", "file_type": "text/x-python", "file_size": 1611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "62080a23-55e5-4007-8ba3-804b5febe82a": {"node_ids": ["85c434e3-68f8-4378-b119-ed19417d8b5a"], "metadata": {"file_path": "/app/routes/index.py", "file_name": "index.py", "file_type": "text/x-python", "file_size": 1283, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "ef86fc01-fc73-49f7-9b28-d0d8fa54f118": {"node_ids": ["3c435b54-0749-4fef-abed-61500319042a"], "metadata": {"file_path": "/app/routes/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 3005, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "ebc8cc62-aef3-4460-beeb-7875f0919dfd": {"node_ids": ["6c1ce8b0-9fee-42ad-abb9-b97c6199620b"], "metadata": {"file_path": "/app/routes/logs_sessions.py", "file_name": "logs_sessions.py", "file_type": "text/x-python", "file_size": 774, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "8fa949b2-11de-46a4-bc82-bbd32324b15b": {"node_ids": ["9d82735c-b851-46ec-b40c-b7028fe7a17e"], "metadata": {"file_path": "/app/routes/mcp.py", "file_name": "mcp.py", "file_type": "text/x-python", "file_size": 2007, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "3f4d1ab6-983e-4683-9a76-18330c0342d4": {"node_ids": ["882d5fdc-a69a-45b1-a7f4-8056cefd0550", "b780e410-efe2-4ae3-8468-bc2299406311"], "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "d060b8aa-6d77-49d2-bc97-176d87213302": {"node_ids": ["427813df-0929-4f66-9bae-0fb44434dbc5"], "metadata": {"file_path": "/app/routes/search.py", "file_name": "search.py", "file_type": "text/x-python", "file_size": 2750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "1be88766-e23e-4620-b5e3-ef4059bfba74": {"node_ids": ["32f98581-7c8b-46af-9380-c6265d6f9ec1"], "metadata": {"file_path": "/app/routes/status.py", "file_name": "status.py", "file_type": "text/x-python", "file_size": 3986, "creation_date": "2025-06-29", "last_modified_date": "2025-06-29", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "fe2de9a6-ce0f-4a48-88d5-7795f2454971": {"node_ids": ["ea91a378-acd2-4f5f-af14-658b92f375bb"], "metadata": {"file_path": "/app/routes/status_code.py", "file_name": "status_code.py", "file_type": "text/x-python", "file_size": 1548, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}, "24b63639-e6e3-47b2-8072-905605638093": {"node_ids": ["5a7d4598-6e9d-4dc9-a0d0-2538bfe16670"], "metadata": {"file_path": "/app/routes/webhook.py", "file_name": "webhook.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}}}, "docstore/data": {"0cb073d0-fdea-4c59-9897-7f0cfe9f51f1": {"__data__": {"id_": "0cb073d0-fdea-4c59-9897-7f0cfe9f51f1", "embedding": null, "metadata": {"tier": "global", "file_path": "/app/docs/generated/global_context.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "598b72d9-f264-4f02-b3aa-24d1fd9b6031", "node_type": "4", "metadata": {"tier": "global", "file_path": "/app/docs/generated/global_context.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "bb4936be6050104a33d53add0f76744b1db0d2e0e1bab0ea76ad9d3dc570cac0", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# Global Project Context\n\nRelay uses this file as a sample manual context. Replace this text with your own project notes.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 121, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ba922478-c464-4307-aa48-1fe7f5d2c549": {"__data__": {"id_": "ba922478-c464-4307-aa48-1fe7f5d2c549", "embedding": null, "metadata": {"file_path": "/app/docs/imported/relay_code_update_250603.md", "file_name": "relay_code_update_250603.md", "file_size": 1982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "98404db9-bd1e-487b-997f-76ad3ddfaa79", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/relay_code_update_250603.md", "file_name": "relay_code_update_250603.md", "file_size": 1982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "472e3f4776e41cf2f11c1d55075bb5d380075c4e140c4ce5b83a47450cd43a31", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\u2705 Relay Project Summary \u2013 Status as of Commit\n\ud83d\ude80 Frontend (Next.js + React)\npage.tsx\nServes as the homepage\u000b\nIncludes:\u000b\nAskAgent \u2013 GPT-powered interaction module\u000b\nSearchPanel \u2013 semantic search into synced docs\u000b\nLink to /docs route with DocsViewer\u000b\nSearchPanel.tsx\nPOSTs to /api/kb/search\u000b\nDisplays top-k semantic matches with:\u000b\ntitle\u000b\nsnippet\u000b\nsimilarity score\u000b\nDocsViewer.tsx\nFetches file list from /api/docs/list\u000b\nLoads content from /api/docs/view?path=...\u000b\nClean 2-panel layout for viewing Markdown files\u000b\nScrollable, responsive, and client-friendly\u000b\n\ud83e\udde0 Backend (FastAPI + LangChain)\nCore Routes\n/kb/search\nAccepts { query: string, k: int }\u000b\nReturns top-k cosine similarity matches from kb.sqlite3\u000b\n/docs/list, /docs/view\nLists and returns content of .md or .txt files in /docs\u000b\n/docs/sync\\_google\nTriggers sync from Google Drive \u2192 Markdown files under /docs/imported\u000b\n/check/env\\_keys\nScans services/ for os.getenv(...) calls\u000b\nVerifies existence in .env\u000b\nFlags missing, unused, or stale keys\u000b\n\ud83d\udcc1 Backend Modules\nservices/kb.py\nEmbeds .md docs using OpenAIEmbeddings\u000b\nStores chunks + vectors + metadata in SQLite\u000b\nUses cosine similarity to power semantic search\u000b\nStores title, last\\_updated, and embedding for each chunk\u000b\nservices/settings.py\nCentralized config loader\u000b\nCalls load\\_dotenv() at startup\u000b\nProvides assert\\_env(...) for safe env enforcement\u000b\nservices/google\\_docs\\_sync.py\nAuths with Google via OAuth\u000b\nLocates your Command\\_Center folder\u000b\nPulls .gdoc content \u2192 Markdown\u000b\nSaves to docs/imported/\\*.md\u000b\nRebuilt from scratch after Codespace reset\u000b\n\ud83e\udde0 AI Readiness\nLangChain + OpenAI fully integrated\u000b\ntext-embedding-3-small model powering embeddings\u000b\nGPT-4o agent available via /ask route\u000b\nModular structure ready for more agents or chain workflows\u000b\n\ud83e\udde9 Final Touches Before Commit\nAll code saved and updated\u000b\nFixed missing file (google\\_docs\\_sync.py)\u000b\nFully documented .env structure and validation\u000b\nReact panels: Search + DocsViewer operational", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1954, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "14070395-325e-44fb-8933-66ff70588334": {"__data__": {"id_": "14070395-325e-44fb-8933-66ff70588334", "embedding": null, "metadata": {"file_path": "/app/docs/imported/relay_code_update_250605.md", "file_name": "relay_code_update_250605.md", "file_size": 2876, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "27fb9909-0534-4a06-9558-391d92cabdf4", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/relay_code_update_250605.md", "file_name": "relay_code_update_250605.md", "file_size": 2876, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8f63b07fa691e9e52af4a4d1b27bb52c5e9ae4036ae17d2bb451b0797d0131d7", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\u2705 Relay Project Summary \u2013 Updated (As of Today)\n\ud83d\ude80 Frontend (Next.js + React)\npage.tsx\n\u2705 GET /api/docs/list \u2192 returns `{ \"files\": [...] }`\n\ud83d\udd01 /docs/sync\\_google is deprecated \u2014 replaced by `/docs/sync` (returns `{ \"synced_docs\": [...] }`)\nAskAgent.tsx\n\u2705 Sends GET requests to /ask (CORS-safe, no preflight)\u000b\n\u2705 Displays GPT-4o output with loading state\u000b\n\u2705 Stripped headers to eliminate CORS preflight errors\u000b\n\u2705 Uses process.env.NEXT\\_PUBLIC\\_RELAY\\_KEY for dev logs only\u000b\nSearchPanel.tsx\n\u2705 POST /api/kb/search\u000b\n\u2705 Displays top-k semantic matches from FastAPI:\u000b\nTitle\u000b\nSnippet\u000b\nSimilarity score\u000b\n\u2705 Type-safe with KBResult\u000b\n\u2705 Includes enter key trigger and loading spinner\u000b\nDocsViewer.tsx\n\u2705 GET /api/docs/list\u000b\n\u2705 GET /api/docs/view?path=...\u000b\n\u2705 Two-panel native layout (left = file list, right = scrollable viewer)\u000b\n\u2705 Pulls from /docs/imported/ and /docs/generated/\u000b\n\ud83e\udde0 Backend (FastAPI + LangChain)\nCore Routes\n\ud83d\udd01 /docs/sync\\_google is deprecated \u2014 replaced by /docs/sync with better logging\n\ud83d\udcc1 Backend Modules\nservices/kb.py\n\u2705 Embeds docs using text-embedding-3-small\u000b\n\u2705 SQLite stores: path, chunks, cosine sim metadata\u000b\n\u2705 KB result scoring used in /api/kb/search\u000b\nservices/settings.py\n\u2705 .env loaded early via load\\_dotenv()\u000b\n\u2705 assert\\_env() enforces critical keys (OPENAI\\_API\\_KEY, etc.)\u000b\nservices/google\\_docs\\_sync.py\n\u2705 Uses run\\_console() for CLI OAuth\u000b\n\u2705 Pulls .gdoc from Command\\_Center/\u000b\n\u2705 Converts to Markdown, saved to /docs/imported/\\*.md\u000b\n\u26a0\ufe0f Requires token.json (manual upload to Railway)\u000b\nservices/agent.py\n\u2705 Handles GPT query routing, context building\u000b\n\u2705 read\\_source\\_files() now honors RELAY\\_PROJECT\\_ROOT \u2705\u000b\n\u2705 Logs missing folders, loads code/doc context dynamically\u000b\n\u2705 Queues patch suggestions via /control/queue\\_action\u000b\n\u2705 GPT answers: human-like, citation-aware, can trigger actions\u000b\n\ud83e\udde0 AI Integration\n\u2705 GPT-4o for natural language responses, summaries, patch generation\u000b\n\u2705 LangChain + OpenAI embeddings for search\u000b\n\u2705 .env includes:\u000b\nOPENAI\\_API\\_KEY\u000b\nAPI\\_KEY\u000b\nRELAY\\_PROJECT\\_ROOT=/app \u2705\u000b\n\ud83e\udde9 Project Infrastructure & Reliability\n\u2705 FastAPI runs on port 8080\u000b\n\u2705 CORS fully configured (wildfire + localhost + vercel) \u2705\u000b\n\u2705 /ask OPTIONS issue solved (wildcard + no custom headers) \u2705\u000b\n\u2705 All doc folders created at boot (/docs/imported, /docs/generated)\u000b\n\u2705 Canvas patch system live (tracked in Vercel + Railway)\u000b\n\u2705 .env.example documents required keys\u000b\n\u2705 API keys now redacted in logs\u000b\n\ud83d\udd27 Remaining TODOs\nAdd same env-root logic to read\\_docs() function\u000b\nReinstate X-API-Key support securely (via Vercel backend proxy or signed tokens)\u000b\nEnable patch approval UI in control panel\u000b\nOptionally add /status/version route for deploy traceability\u000b\nLet me know if you\u2019d like this saved to /docs/generated/relay\\_status.md or queued to /control/queue\\_action.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2756, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5c56f360-d61e-49c7-92c9-4622f0f5bfa4": {"__data__": {"id_": "5c56f360-d61e-49c7-92c9-4622f0f5bfa4", "embedding": null, "metadata": {"file_path": "/app/docs/imported/relay_code_update_250606.md", "file_name": "relay_code_update_250606.md", "file_size": 3248, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "2a6f569b-cf6d-4556-8078-89439c8cb782", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/relay_code_update_250606.md", "file_name": "relay_code_update_250606.md", "file_size": 3248, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "82a3a2edf94c3f12f4f5447d9a9d79ee99c34a25c5c31c543742b0e599b5da56", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Relay Command Center \u2013 Version 1\nOverview\nRelay Command Center is a modular, full-stack AI-enabled backend and frontend platform designed to control, synchronize, and observe your solar-powered infrastructure, miner operations, and external documents via GPT-based interactions and automation.\nThis document summarizes Version 1 (V1) of the system, covering all features implemented across the project folder, including backend API, frontend controls, OAuth integration, and document synchronization logic.\n\u2705 Backend (FastAPI)\nCore API Endpoints\nGET / \u2013 Health check endpoint\nPOST /ask \u2013 GPT-4-powered agent Q&A endpoint (Relay Agent)\nPOST /control/queue\\_action \u2013 Allows the agent to propose and queue actions\nGET /status/summary \u2013 Provides system health/status insights\nPOST /docs/sync\\_google \u2013 Syncs Google Docs from COMMAND\\_CENTER folder and converts them to Markdown\nGET /docs/list \u2013 Lists all imported Markdown files\nGET /docs/view?path=... \u2013 Returns contents of a specific document\nGET /debug/env \u2013 Diagnostic endpoint to verify environment variable loading (like GOOGLE\\_CREDS\\_JSON)\nOAuth Flow\nGET /google/auth \u2013 Launches Google OAuth using credentials in GOOGLE\\_CREDS\\_JSON\nGET /google/callback \u2013 Finalizes OAuth and writes token.json to frontend/sync/token.json\nInfrastructure\nAuto-creates required folders (docs/imported, docs/generated)\nModular routing structure with ask, status, control, docs, oauth, debug\nCORS-enabled for frontend origins:\nhttps://relay.wildfireranch.us\nhttps://status.wildfireranch.us\nhttp://localhost:3000\n\u2705 Google Docs Sync\nEnvironment Variables\nGOOGLE\\_CREDS\\_JSON \u2013 base64-encoded client\\_secret.json\nGOOGLE\\_TOKEN\\_JSON \u2013 base64-encoded token.json after successful auth (optional, used for persistent access)\nSync Logic\nUses google-auth, googleapiclient, and markdownify\nPulls files from folder: COMMAND\\_CENTER in Google Drive\nConverts content to Markdown\nSaves as .md files in docs/imported\nToken-based auth is triggered automatically unless token.json is missing or invalid (then triggers browser flow)\n\u2705 Frontend (Next.js + React)\nDocs Viewer UI\nDisplays document list and contents\nTwo-panel layout: sidebar (doc list) and content viewer\nScrollable and responsive\nSync Button\n\ud83d\udd04 Sync Google Docs button in the UI\nTriggers POST to /docs/sync\\_google\nRefreshes doc list after completion\nHandles sync status and error feedback inline\n\ud83e\udde0 Intelligence\nGPT-backed agent available via /ask\nSupports knowledge base lookups across synced Markdown docs\nPreloaded with GOOGLE\\_CREDS\\_JSON and OPENAI\\_API\\_KEY\nSmart routing, debug logging, and error feedback\n\ud83e\uddea Developer Support\n.env-ready variable structure (with base64-encoded credentials)\n.env.local used for frontend local overrides (e.g. NEXT\\_PUBLIC\\_RELAY\\_KEY)\nSupports local testing and live Railway/Vercel deployment\n\ud83d\ude80 Deployment Targets\nBackend (FastAPI): Railway \u2013 https://relay.wildfireranch.us\nFrontend (Next.js): Vercel \u2013 https://status.wildfireranch.us\n\ud83c\udfc1 Version 1 Milestone Complete\nNext steps (future versions): frontend action queue, miner controls, agent decision visualizer, and token bootstrap tool.\nVersion: Relay Command Center V1\u000bDate: 2025-06-06\u000bLead: Bret Westwood\u000bBuilt with Echo \ud83d\udcac", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3194, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0069d529-d62a-4dd8-aaec-7abed1829aa7": {"__data__": {"id_": "0069d529-d62a-4dd8-aaec-7abed1829aa7", "embedding": null, "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "42211b25-e433-45b8-b5b2-73af3be71490", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3544441cffe8515a116c80beee7a9b5f442be2f988f01f4b2df5ae1b3474b997", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b967d457-ed28-42c7-b94a-eac1e32e9737", "node_type": "1", "metadata": {}, "hash": "c512d0f3779c22b4ee2d8b96642942cead582c6265c707b036872dd5310dc031", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "to newcomer\nJun 6\nWildfireRanch/Relay\nArchive\nShare\nExplain the codebase to a newcomer. What is the general structure, what are the important things to know, and what are some pointers for things to learn next?\nCopy\nRepository Overview\nThis project hosts \u201cRelay,\u201d a small FastAPI backend with a Next.js/React frontend. The repository structure is straightforward:\n/main.py \u2013 FastAPI application entry\n/routes/ \u2013 REST endpoints\n/services/ \u2013 Core backend logic\n/frontend/ \u2013 Next.js frontend\n/docs/ \u2013 Generated/Imported docs\n/data/ & /logs/ \u2013 Action queue and logging files\n/tests/ \u2013 (mostly empty) test placeholders\nBackend\nmain.py initializes FastAPI, loads environment variables, configures CORS and mounts the route modules:\n9 from dotenv import load\\_dotenv\n10 load\\_dotenv()\n...\n35 app.add\\_middleware(\n...\n49 app.include\\_router(ask.router)\n50 app.include\\_router(status.router)\n51 app.include\\_router(control.router)\n52 app.include\\_router(docs.router)\n53 app.include\\_router(oauth.router)\nServices\nservices/agent.py\nImplements the OpenAI-powered assistant. It determines if code/doc context is needed, can auto-generate docs, and queues new files through /control/queue\\_action.\nKey logic includes the system prompt and context gathering helpers:\n15 SYSTEM\\_PROMPT = \"\"\"\nYou are Relay...\n...\n30 def needs\\_code\\_context(query: str) -> bool:\n...\n41 async def answer(user_id: str, query: str, context: Optional[str] = None, stream: bool = False):\n...\n85 async def generate\\_doc\\_for\\_path(rel\\_path: str) -> str:\n...\n136 def read\\_source\\_files(roots=[\"services\"], exts=[\".py\", \".tsx\", \".ts\"]):\n...\n166 def read\\_docs(root=\"docs\", exts=[\".md\", \".txt\"]):\nservices/google\\_docs\\_sync.py\nHandles Google OAuth, downloads docs from a specified Drive folder, converts them to Markdown, and saves them under docs/imported:\n1 # File: services/google\\_docs\\_sync.py\n...\n31 def get\\_google\\_service():\n...\n138 def sync\\_google\\_docs() -> list:\n...\n152 if enabled:\n153 sync\\_google\\_docs()\nservices/kb.py\nEmbeds markdown docs into a SQLite-based vector database using LangChain to enable semantic search:\n11 DOCS\\_DIR = ROOT / \"docs\"\n...\n35 def embed\\_docs():\n...\n53 def cosine\\_similarity(v1, v2):\n...\n58 def search(query, k=4):\nOther helpers include logging (services/logs.py) and environment validation (services/settings.py).\nRoutes\nFastAPI endpoints live in routes/. Examples:\nroutes/ask.py \u2013 exposes /ask for user questions and /test\\_openai for verifying OpenAI access.\nroutes/control.py \u2013 provides endpoints for writing files, queuing actions, approving queued actions, and retrieving logs:\n14 def auth(key: str = Header(..., alias=\"X-API-Key\")):\n...\n45 @router.post(\"/write\\_file\")\n...\n69 @router.post(\"/queue\\_action\")\n...\n94 @router.post(\"/approve\\_action\")\n...\n134 @router.get(\"/list\\_log\")\nroutes/docs.py \u2013 manages document syncing and knowledge-base refreshing:\n31 @router.post(\"/update\\_context\")\n...\n58 @router.post(\"/sync\\_google\")\n63 @router.post(\"/sync\")\n74 @router.post(\"/refresh\\_kb\")\n85 @router.post(\"/full\\_sync\")\n98 @router.get(\"/list\")\n109 @router.get(\"/view\")\nFrontend\nThe frontend/ folder contains a Next.js app. The home page (src/app/page.tsx) links to Docs, Control, and Status pages and embeds several React components:\n3 import AskAgent from \"@/components/AskAgent/AskAgent\"\n...\n10 \n...\n23 \n...\n29 \n33 \nKey components include:\nAskAgent \u2013 simple form that queries /ask.\nActionQueuePanel \u2013 lists and approves queued actions by hitting /control/\\* endpoints.\nDocsViewer \u2013 displays Markdown files and allows manual Google Docs sync.\nSearchPanel \u2013 calls the /kb/search API.\nThe frontend also has minimal API routes under src/app/api/ that forward requests to the backend, allowing the Next.js app to act as a thin UI over the FastAPI service.\nData and Logging\nQueued actions are stored in data/pending\\_actions.json, and executed actions are logged to logs/actions.log. Basic session logs are written via services/logs.py. The docs directory (docs/) contains imported or generated documentation used by the knowledge base.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4042, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b967d457-ed28-42c7-b94a-eac1e32e9737": {"__data__": {"id_": "b967d457-ed28-42c7-b94a-eac1e32e9737", "embedding": null, "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "42211b25-e433-45b8-b5b2-73af3be71490", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3544441cffe8515a116c80beee7a9b5f442be2f988f01f4b2df5ae1b3474b997", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "0069d529-d62a-4dd8-aaec-7abed1829aa7", "node_type": "1", "metadata": {"file_path": "/app/docs/imported/repository_overview_250606.md", "file_name": "repository_overview_250606.md", "file_size": 7775, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "62bb2b989e467c3c7520f32f6eeaabfc74117ebc8f590680db51fe84df786bc3", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "The home page (src/app/page.tsx) links to Docs, Control, and Status pages and embeds several React components:\n3 import AskAgent from \"@/components/AskAgent/AskAgent\"\n...\n10 \n...\n23 \n...\n29 \n33 \nKey components include:\nAskAgent \u2013 simple form that queries /ask.\nActionQueuePanel \u2013 lists and approves queued actions by hitting /control/\\* endpoints.\nDocsViewer \u2013 displays Markdown files and allows manual Google Docs sync.\nSearchPanel \u2013 calls the /kb/search API.\nThe frontend also has minimal API routes under src/app/api/ that forward requests to the backend, allowing the Next.js app to act as a thin UI over the FastAPI service.\nData and Logging\nQueued actions are stored in data/pending\\_actions.json, and executed actions are logged to logs/actions.log. Basic session logs are written via services/logs.py. The docs directory (docs/) contains imported or generated documentation used by the knowledge base.\nGetting Started / Next Steps\nEnvironment Setup \u2013 ensure .env contains OPENAI\\_API\\_KEY, GOOGLE\\_CREDS\\_JSON, optional GOOGLE\\_TOKEN\\_JSON, and API\\_KEY. main.py loads these via dotenv on startup.\nRunning Locally \u2013 start the backend (python main.py or uvicorn main:app) and the frontend (npm run dev within frontend/).\nDocs Sync and KB \u2013 explore services/google\\_docs\\_sync.py and the /docs routes to understand how Google Docs are pulled and embedded.\nAgent Logic \u2013 services/agent.py is central to how the assistant gathers context and answers questions; studying its helper functions is useful for extending functionality.\nTesting \u2013 the tests/ directory contains placeholders. Adding real tests (for routes, sync logic, etc.) would be a logical area for improvement.\nOverall, the project integrates OpenAI, Google Drive, and a simple knowledge base to provide a conversational assistant with access to synced documentation and the ability to queue file changes. The Next.js frontend offers a small dashboard for user interaction. Future work might include fleshing out tests, expanding route functionality, or enhancing the frontend.\ncan you put this in a pasteable document\nCopy\nBelow is a pasteable Markdown document summarizing the repository structure, components, and suggested next steps:\nRelay Repository Overview\nThis project contains a small FastAPI backend paired with a Next.js/React frontend. The layout is straightforward:\n/main.py \u2013 FastAPI application entry point\n/routes/ \u2013 REST API endpoints\n/services/ \u2013 Core backend logic\n/frontend/ \u2013 Next.js frontend\n/docs/ \u2013 Generated/imported documentation\n/data/ & /logs/ \u2013 Queued actions and logs\n/tests/ \u2013 Mostly empty placeholders\nBackend\nmain.py initializes FastAPI, loads environment variables, configures CORS, and registers route modules.\nKey Service Modules\nservices/agent.py \u2013 Implements the OpenAI\u2011powered assistant. Handles context gathering, question answering, and documentation generation.\nservices/google\\_docs\\_sync.py \u2013 Syncs documentation from a Google Drive folder and stores Markdown files under docs/imported.\nservices/kb.py \u2013 Embeds Markdown docs into a SQLite vector database for semantic search.\nOther helper modules manage logging and environment validation.\nRoutes\nroutes/ask.py \u2013 /ask endpoint and an OpenAI test route.\nroutes/control.py \u2013 Endpoints for writing files, queuing/approving actions, and retrieving logs.\nroutes/docs.py \u2013 Manages document syncing and knowledge-base refreshing.\nFrontend\nLocated in frontend/, the Next.js app serves a dashboard with components to interact with the backend:\nAskAgent \u2013 Form for querying /ask.\nActionQueuePanel \u2013 Approve queued actions via /control/\\*.\nDocsViewer \u2013 Display Markdown docs and sync with Google Docs.\nSearchPanel \u2013 Query the knowledge base.\nData and Logging\ndata/pending\\_actions.json \u2013 Stores queued actions.\nlogs/actions.log \u2013 Logs executed actions.\ndocs/ \u2013 Contains imported/generated docs used by the knowledge base.\nGetting Started\nEnvironment Variables \u2013 Ensure .env includes OPENAI\\_API\\_KEY, GOOGLE\\_CREDS\\_JSON, optional GOOGLE\\_TOKEN\\_JSON, and API\\_KEY.\nRun Locally \u2013 Start the backend (python main.py or uvicorn main:app) and the frontend (npm run dev inside frontend/).\nDocs & KB \u2013 Study services/google\\_docs\\_sync.py and the /docs routes to see how documentation is synced and indexed.\nAgent Logic \u2013 Review services/agent.py to understand how context is gathered and responses are generated.\nTesting \u2013 The tests/ directory is mostly empty. Adding real tests for routes and sync logic is a natural improvement.\nThis text can be copied directly into any document or note-taking tool.", "mimetype": "text/plain", "start_char_idx": 3133, "end_char_idx": 7681, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7210335d-9a6e-4181-8a2f-cd69dbb63e1f": {"__data__": {"id_": "7210335d-9a6e-4181-8a2f-cd69dbb63e1f", "embedding": null, "metadata": {"file_path": "/app/docs/imported/test_placeholder.md", "file_name": "test_placeholder.md", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "9e37187c-d69a-4bca-a449-548cf6e83d3e", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/test_placeholder.md", "file_name": "test_placeholder.md", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "06ba61189402c7d0012e21dcd45d2b36fba21f590dc8b9052051b60c67f1e9ca", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 0, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "e871829b-bcba-4c02-9188-e46291b288b9": {"__data__": {"id_": "e871829b-bcba-4c02-9188-e46291b288b9", "embedding": null, "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "eb00ea9e820ba49d4153dfd5f5cd50c40a6bbe3c2d7ef93e8ae9f7823e1845e8", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "c90754db-5a0a-4d75-8d77-ae82273366a2", "node_type": "1", "metadata": {}, "hash": "b298ec73cfc8ec3f9d302c8f927345d8cd813f2c9719f85cab75cc872e0d97fc", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "1. Functionality\nConversational AI Agent (/ask): Leverages GPT\u20114o to handle free\u2011form queries, cite sources, and suggest code patches based on context.\nSemantic Knowledge Base (/kb/search): Performs vector similarity searches over imported Markdown docs (Google\u2011synced or generated) using SQLite + LangChain embeddings.\nGoogle Docs Sync (/docs/sync): OAuth2\u2011powered flow that imports designated Drive documents into docs/imported, converting them to Markdown and refreshing the KB.\nDocumentation Browser (/docs/list, /docs/view): Lists available docs and serves their content for in\u2011app viewing.\nAction Queue & Patch Approval (/control/queue\\_action, /control/approve\\_action): Stages file writes or code modifications for developer review before applying changes.\nEnvironment Validator (/check/env\\_keys): Validates required environment variables at startup, preventing misconfigurations.\nDashboard UI: Next.js/React interface with panels:\nAskAgent \u2013 Chat interface for AI queries\nSearchPanel \u2013 KB lookup by keyword\nDocsViewer \u2013 Two\u2011pane Markdown viewer with sync trigger\nActionQueuePanel \u2013 Pending patches list and one\u2011click approval\n2. How to Use\nPrerequisites: Node.js, Python 3.12+, uvicorn, npm, and valid Google OAuth credentials.\nEnvironment Setup\u000bcp .env.example .env\n# Populate with:\n# OPENAI\\_API\\_KEY, API\\_KEY, GOOGLE\\_CREDS\\_JSON, (optional) GOOGLE\\_TOKEN\\_JSON\nInstall & Launch Services\u000b# Backend\npip install -r requirements.txt\nuvicorn main:app --reload --port 8080\n# Frontend\ncd frontend\nnpm install\nnpm run dev # runs on port 3000\nSync Documentation\nIn browser, go to http://localhost:8080/docs/sync\nAuthenticate via Google (first run)\nConfirm import: Markdown files appear under docs/imported.\nInteract\nAskAgent: Ask questions in Dashboard, view citations and suggestions.\nSearchPanel: Search KB for context or troubleshooting docs.\nDocsViewer: Navigate synced docs; click \u201cSync\u201d to refresh.\nActionQueuePanel: Review queued patches, click \u201cApprove\u201d to apply.\nDirect API Calls\u000bGET /ask?query=Your+question\nPOST /api/kb/search { query: string, k: number }\nPOST /control/queue\\_action { patch details }\nPOST /control/approve\\_action { action\\_id }\nPOST /docs/sync\nGET /docs/list\nGET /docs/view?path=imported/YourDoc.md\n3. Technical Details\nProject Structure\n/ # Root\n\u251c\u2500 main.py # FastAPI startup & route registration\n\u251c\u2500 routes/\n\u2502 \u251c\u2500 ask.py # /ask endpoint logic\n\u2502 \u251c\u2500 control.py # queue\\_action, approve\\_action\n\u2502 \u251c\u2500 docs.py # sync, list, view routes\n\u2502 \u2514\u2500 check.py # /check/env\\_keys\n\u251c\u2500 services/\n\u2502 \u251c\u2500 agent.py # GPT prompt composition & context loader\n\u2502 \u251c\u2500 kb.py # embedding & search utils\n\u2502 \u251c\u2500 google\\_docs\\_sync.py # OAuth flow & Drive MD conversion\n\u2502 \u2514\u2500 settings.py # Env var schema & loader\n\u251c\u2500 docs/\n\u2502 \u251c\u2500 imported/ # Google\u2011sync Markdown files\n\u2502 \u2514\u2500 generated/ # AI\u2011generated summaries\n\u251c\u2500 data/\n\u2502 \u2514\u2500 pending\\_actions.json # Queued patch state\n\u251c\u2500 logs/\n\u2502 \u2514\u2500 actions.log # Patch application history\n\u251c\u2500 frontend/\n\u2502 \u251c\u2500 src/app/page.tsx # Main Dashboard layout\n\u2502 \u251c\u2500 components/\n\u2502 \u2502 \u251c\u2500 AskAgent.tsx\n\u2502 \u2502 \u251c\u2500 SearchPanel.tsx\n\u2502 \u2502 \u251c\u2500 DocsViewer.tsx\n\u2502 \u2502 \u2514\u2500 ActionQueuePanel.tsx\n\u2502 \u2514\u2500 api/ # Next.js API proxy (optional)\n\u2514\u2500 tests/ # Unit/integration test stubs\nKey Code Highlights\nSYSTEM\\_PROMPT in services/agent.py: Central AI persona & context roles.\nContext Loaders: agent.read\\_source\\_files() reads code snippets; agent.read\\_docs() pulls Markdown docs.\nEmbeddings: kb.embed\\_doc() & kb.search() use OpenAI's embedding model, cache in SQLite DB.\nOAuth2 Flow: google\\_docs\\_sync.py uses InstalledAppFlow for local webserver auth, token persistence.\nPatch Workflow: data/pending\\_actions.json stores staged patch diffs; control.py applies approved diffs to disk.\n4.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3674, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c90754db-5a0a-4d75-8d77-ae82273366a2": {"__data__": {"id_": "c90754db-5a0a-4d75-8d77-ae82273366a2", "embedding": null, "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "eb00ea9e820ba49d4153dfd5f5cd50c40a6bbe3c2d7ef93e8ae9f7823e1845e8", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "e871829b-bcba-4c02-9188-e46291b288b9", "node_type": "1", "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "84c1662e795142316e244c5621cd5a618464c70d10d684da4e39cf5c5bb7acaa", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "5f0a2ae5-0ccc-4c7a-afce-12e5914fc335", "node_type": "1", "metadata": {}, "hash": "3f7b84fec6e34c374f9d424c32c61d147f3c6859f20b5c02b79f482361e1f48c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Context Loaders: agent.read\\_source\\_files() reads code snippets; agent.read\\_docs() pulls Markdown docs.\nEmbeddings: kb.embed\\_doc() & kb.search() use OpenAI's embedding model, cache in SQLite DB.\nOAuth2 Flow: google\\_docs\\_sync.py uses InstalledAppFlow for local webserver auth, token persistence.\nPatch Workflow: data/pending\\_actions.json stores staged patch diffs; control.py applies approved diffs to disk.\n4. Actual Routes & Descriptions\nThese endpoints are loaded from current code:\nGET / \u2014 Sanity check (uptime, load balancer) (main.py)\nGET /ask \u2014 AI query interface (routes/ask.py)\nGET /check/env\\_keys \u2014 Env var validation (routes/check.py)\nPOST /docs/sync \u2014 Trigger Google Docs import (routes/docs.py)\nGET /docs/list \u2014 List available docs (routes/docs.py)\nGET /docs/view \u2014 Serve markdown content (routes/docs.py)\nPOST /control/queue\\_action \u2014 Stage file/patch write (routes/control.py)\nPOST /control/approve\\_action \u2014 Approve and apply staged action (routes/control.py)\nPOST /api/kb/search \u2014 Semantic search payload (routes/kb.py)\n5. Impact & Metrics (Placeholders)\nGoogle Docs Imported: \\_\\_ docs\nMarkdown Files: \\_\\_ files in docs/imported\nAPI Hits: /ask \\_\\_ calls, KB search \\_\\_ calls\nPatches Queued/Applied: \\_\\_ / \\_\\_\nAvg. Latency: /ask \\_\\_ ms, /api/kb/search \\_\\_ ms\nOnboarding Time: Setup from zero to running in \\_\\_ minutes\nFill in with real telemetry to quantify v1 success.\nEnd of Release Notes & Documentation for v1.\nV1 Relay Command Center \u2013 Release Notes & Documentation\n1. Functionality\nConversational AI Agent (/ask): Leverages GPT\u20114o to handle free\u2011form queries, cite sources, and suggest code patches based on context.\nSemantic Knowledge Base (/kb/search): Performs vector similarity searches over imported Markdown docs (Google\u2011synced or generated) using SQLite + LangChain embeddings.\nGoogle Docs Sync (/docs/sync): OAuth2\u2011powered flow that imports designated Drive documents into docs/imported, converting them to Markdown and refreshing the KB.\nDocumentation Browser (/docs/list, /docs/view): Lists available docs and serves their content for in\u2011app viewing.\nAction Queue & Patch Approval (/control/queue\\_action, /control/approve\\_action): Stages file writes or code modifications for developer review before applying changes.\nEnvironment Validator (/check/env\\_keys): Validates required environment variables at startup, preventing misconfigurations.\nDashboard UI: Next.js/React interface with panels:\nAskAgent \u2013 Chat interface for AI queries\nSearchPanel \u2013 KB lookup by keyword\nDocsViewer \u2013 Two\u2011pane Markdown viewer with sync trigger\nActionQueuePanel \u2013 Pending patches list and one\u2011click approval\n2. How to Use\nPrerequisites: Node.js, Python 3.12+, uvicorn, npm, and valid Google OAuth credentials.\nEnvironment Setup\ncp .env.example .env\n# Populate with:\n# OPENAI\\_API\\_KEY, API\\_KEY, GOOGLE\\_CREDS\\_JSON, (optional) GOOGLE\\_TOKEN\\_JSON\nInstall & Launch Services\n# Backend\npip install -r requirements.txt\nuvicorn main:app --reload --port 8080\n# Frontend\ncd frontend\nnpm install\nnpm run dev # runs on port 3000\nSync Documentation\nIn browser, go to http://localhost:8080/docs/sync\nAuthenticate via Google (first run)\nConfirm import: Markdown files appear under docs/imported.\nInteract\nAskAgent: Ask questions in Dashboard, view citations and suggestions.\nSearchPanel: Search KB for context or troubleshooting docs.\nDocsViewer: Navigate synced docs; click \u201cSync\u201d to refresh.\nActionQueuePanel: Review queued patches, click \u201cApprove\u201d to apply.\nDirect API Calls\nGET /ask?query=Your+question\nPOST /api/kb/search { query: string, k: number }\nPOST /control/queue\\_action { patch details }\nPOST /control/approve\\_action { action\\_id }\nPOST /docs/sync\nGET /docs/list\nGET /docs/view?path=imported/YourDoc.md\n3.", "mimetype": "text/plain", "start_char_idx": 3259, "end_char_idx": 6998, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5f0a2ae5-0ccc-4c7a-afce-12e5914fc335": {"__data__": {"id_": "5f0a2ae5-0ccc-4c7a-afce-12e5914fc335", "embedding": null, "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "eb00ea9e820ba49d4153dfd5f5cd50c40a6bbe3c2d7ef93e8ae9f7823e1845e8", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "c90754db-5a0a-4d75-8d77-ae82273366a2", "node_type": "1", "metadata": {"file_path": "/app/docs/imported/v1_documentation_250606.md", "file_name": "v1_documentation_250606.md", "file_size": 9879, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "830d39fdabb1327f4e9f7533f49df8e02212eb865df37a1d5322eeb63246c427", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Interact\nAskAgent: Ask questions in Dashboard, view citations and suggestions.\nSearchPanel: Search KB for context or troubleshooting docs.\nDocsViewer: Navigate synced docs; click \u201cSync\u201d to refresh.\nActionQueuePanel: Review queued patches, click \u201cApprove\u201d to apply.\nDirect API Calls\nGET /ask?query=Your+question\nPOST /api/kb/search { query: string, k: number }\nPOST /control/queue\\_action { patch details }\nPOST /control/approve\\_action { action\\_id }\nPOST /docs/sync\nGET /docs/list\nGET /docs/view?path=imported/YourDoc.md\n3. Technical Details\nProject Structure\n/ # Root\n\u251c\u2500 main.py # FastAPI startup & route registration\n\u251c\u2500 routes/\n\u2502 \u251c\u2500 ask.py # /ask endpoint logic\n\u2502 \u251c\u2500 control.py # queue\\_action, approve\\_action\n\u2502 \u251c\u2500 docs.py # sync, list, view routes\n\u2502 \u2514\u2500 check.py # /check/env\\_keys\n\u251c\u2500 services/\n\u2502 \u251c\u2500 agent.py # GPT prompt composition & context loader\n\u2502 \u251c\u2500 kb.py # embedding & search utils\n\u2502 \u251c\u2500 google\\_docs\\_sync.py # OAuth flow & Drive MD conversion\n\u2502 \u2514\u2500 settings.py # Env var schema & loader\n\u251c\u2500 docs/\n\u2502 \u251c\u2500 imported/ # Google\u2011sync Markdown files\n\u2502 \u2514\u2500 generated/ # AI\u2011generated summaries\n\u251c\u2500 data/\n\u2502 \u2514\u2500 pending\\_actions.json # Queued patch state\n\u251c\u2500 logs/\n\u2502 \u2514\u2500 actions.log # Patch application history\n\u251c\u2500 frontend/\n\u2502 \u251c\u2500 src/app/page.tsx # Main Dashboard layout\n\u2502 \u251c\u2500 components/\n\u2502 \u2502 \u251c\u2500 AskAgent.tsx\n\u2502 \u2502 \u251c\u2500 SearchPanel.tsx\n\u2502 \u2502 \u251c\u2500 DocsViewer.tsx\n\u2502 \u2502 \u2514\u2500 ActionQueuePanel.tsx\n\u2502 \u2514\u2500 api/ # Next.js API proxy (optional)\n\u2514\u2500 tests/ # Unit/integration test stubs\nKey Code Highlights\nSYSTEM\\_PROMPT in services/agent.py: Central AI persona & context roles.\nContext Loaders: agent.read\\_source\\_files() reads code snippets; agent.read\\_docs() pulls Markdown docs.\nEmbeddings: kb.embed\\_doc() & kb.search() use OpenAI's embedding model, cache in SQLite DB.\nOAuth2 Flow: google\\_docs\\_sync.py uses InstalledAppFlow for local webserver auth, token persistence.\nPatch Workflow: data/pending\\_actions.json stores staged patch diffs; control.py applies approved diffs to disk.\n4. Actual Routes & Descriptions\nThese endpoints are loaded from current code:\nGET / \u2014 Sanity check (uptime, load balancer) (main.py)\nGET /ask \u2014 AI query interface (routes/ask.py)\nGET /check/env\\_keys \u2014 Env var validation (routes/check.py)\nPOST /docs/sync \u2014 Trigger Google Docs import (routes/docs.py)\nGET /docs/list \u2014 List available docs (routes/docs.py)\nGET /docs/view \u2014 Serve markdown content (routes/docs.py)\nPOST /control/queue\\_action \u2014 Stage file/patch write (routes/control.py)\nPOST /control/approve\\_action \u2014 Approve and apply staged action (routes/control.py)\nPOST /api/kb/search \u2014 Semantic search payload (routes/kb.py)\n5. Impact & Metrics (Placeholders)\nGoogle Docs Imported: \\_\\_ docs\nMarkdown Files: \\_\\_ files in docs/imported\nAPI Hits: /ask \\_\\_ calls, KB search \\_\\_ calls\nPatches Queued/Applied: \\_\\_ / \\_\\_\nAvg. Latency: /ask \\_\\_ ms, /api/kb/search \\_\\_ ms\nOnboarding Time: Setup from zero to running in \\_\\_ minutes\nFill in with real telemetry to quantify v1 success.\nEnd of Release Notes & Documentation for v1.", "mimetype": "text/plain", "start_char_idx": 6474, "end_char_idx": 9465, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7856fb89-25df-48da-8fe4-d97b626d9f2e": {"__data__": {"id_": "7856fb89-25df-48da-8fe4-d97b626d9f2e", "embedding": null, "metadata": {"file_path": "/app/docs/imported/\ud83d\udd27_google_docs_sync_integration.md", "file_name": "\ud83d\udd27_google_docs_sync_integration.md", "file_size": 3065, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "90cc8f9d-7428-4c64-81a1-bc88127c8368", "node_type": "4", "metadata": {"file_path": "/app/docs/imported/\ud83d\udd27_google_docs_sync_integration.md", "file_name": "\ud83d\udd27_google_docs_sync_integration.md", "file_size": 3065, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "project_docs", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e2d28997286211596022db75d7e0bca5653a97071ae86907bb7d44ab672f497a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\ud83d\udd27 Google Docs Sync Integration\nPurpose: To synchronize Google Docs from a specific folder in Google Drive into your local application, converting them into Markdown files for further processing.\nKey Components:\nEnvironment Variables:\u000b\nGOOGLE\\_CREDS\\_JSON: Base64-encoded Google OAuth 2.0 credentials JSON.\u000b\nGOOGLE\\_TOKEN\\_JSON: Base64-encoded token JSON obtained after user authorization.\u000b\nFile Paths:\u000b\nCREDENTIALS\\_PATH: Path to store decoded credentials (/tmp/credentials.json).\u000b\nTOKEN\\_PATH: Path to store decoded token (frontend/sync/token.json).\u000b\nIMPORT\\_PATH: Directory to store imported Markdown files (docs/imported).\u000b\nFolder Configuration:\u000b\nCOMMAND\\_CENTER\\_FOLDER\\_NAME: Name of the folder in Google Drive to sync (COMMAND\\_CENTER).\u000b\nWorkflow:\nCredential Handling:\u000b\nCheck if CREDENTIALS\\_PATH exists. If not, decode GOOGLE\\_CREDS\\_JSON and write to this path.\u000b\nCheck if TOKEN\\_PATH exists. If not, decode GOOGLE\\_TOKEN\\_JSON (if available) and write to this path.\u000b\nAuthentication:\u000b\nIf TOKEN\\_PATH exists, load credentials from it.\u000b\nIf credentials are invalid or don't exist:\u000b\nInitiate OAuth flow using InstalledAppFlow.from\\_client\\_secrets\\_file.\u000b\nRun local server to obtain user authorization and generate new token.\u000b\nSave new token to TOKEN\\_PATH.\u000b\nGoogle Drive Interaction:\u000b\nBuild drive\\_service and docs\\_service using authenticated credentials.\u000b\nLocate the folder ID for COMMAND\\_CENTER\\_FOLDER\\_NAME.\u000b\nRetrieve all Google Docs within this folder.\u000b\nFor each document:\u000b\nFetch content using docs\\_service.\u000b\nConvert content to Markdown using markdownify.\u000b\nSave the Markdown file to IMPORT\\_PATH.\u000b\n\ud83d\udee0\ufe0f Error Handling and Debugging\nCommon Issues Encountered:\nMissing Environment Variables:\u000b\nError: \u274c Missing GOOGLE\\_CREDS\\_JSON in environment variables\u000b\nSolution: Ensure that GOOGLE\\_CREDS\\_JSON is correctly set in your environment.\u000b\nSyntax Errors:\u000b\nError: SyntaxError: 'return' outside function\u000b\nCause: Incorrect indentation or misplaced return statement.\u000b\nSolution: Ensure that all code blocks are properly indented and that return statements are within function scopes.\u000b\nAttribute Errors:\u000b\nError: AttributeError: 'InstalledAppFlow' object has no attribute 'run\\_console'\u000b\nCause: Incorrect method used for initiating OAuth flow.\u000b\nSolution: Use run\\_local\\_server(port=0) instead of run\\_console() for local development.\u000b\nOAuth Redirect URI Mismatch:\u000b\nError: Error 400: redirect\\_uri\\_mismatch\u000b\nCause: The redirect URI used in the application doesn't match any of the authorized redirect URIs in the Google Cloud Console.\u000b\nSolution:\u000b\nNavigate to Google Cloud Console Credentials page.\u000b\nSelect your OAuth 2.0 Client ID.\u000b\nIn the \"Authorized redirect URIs\" section, add the exact redirect URI used by your application (e.g., http://localhost:8080/).\u000b\nSave the changes.\u000b\n\ud83d\udd04 Full Sync Process\nEndpoint: POST /docs/full\\_sync\nFunctionality:\nInitiates the Google Docs synchronization process.\u000b\nEmbeds the synchronized Markdown documents into the knowledge base.\u000b\nLogs the synchronization activity for auditing and tracking purposes.serverfault.com", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3051, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "fcab0e2e-81d6-4891-bdfe-f34ecc541fca": {"__data__": {"id_": "fcab0e2e-81d6-4891-bdfe-f34ecc541fca", "embedding": null, "metadata": {"tier": "project_docs", "file_path": "/app/docs/readme.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "e47a7785-15d1-4a22-a322-d14f914d3493", "node_type": "4", "metadata": {"tier": "project_docs", "file_path": "/app/docs/readme.md", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "ca677559f9e5f4b87ee783f490f77050ee7cd0e783350758701e5cb98e7ff668", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 0, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ddb3ba24-c6e2-420b-be3b-7d30105f8c67": {"__data__": {"id_": "ddb3ba24-c6e2-420b-be3b-7d30105f8c67", "embedding": null, "metadata": {"file_path": "/app/frontend/components.json", "file_name": "components.json", "file_type": "application/json", "file_size": 428, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "97b8c10f-445b-4001-88d0-1a1fab952df3", "node_type": "4", "metadata": {"file_path": "/app/frontend/components.json", "file_name": "components.json", "file_type": "application/json", "file_size": 428, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8deaa4600665de21f537f9f20a5e809f96e5973eee55f839ab03097c81ef978e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "{\n  \"$schema\": \"https://ui.shadcn.com/schema.json\",\n  \"style\": \"new-york\",\n  \"rsc\": true,\n  \"tsx\": true,\n  \"tailwind\": {\n    \"config\": \"\",\n    \"css\": \"src/app/globals.css\",\n    \"baseColor\": \"slate\",\n    \"cssVariables\": true,\n    \"prefix\": \"\"\n  },\n  \"aliases\": {\n    \"components\": \"@/components\",\n    \"utils\": \"@/lib/utils\",\n    \"ui\": \"@/components/ui\",\n    \"lib\": \"@/lib\",\n    \"hooks\": \"@/hooks\"\n  },\n  \"iconLibrary\": \"lucide\"\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 428, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d19a0639-dfcd-4344-ae89-e324fd89eff3": {"__data__": {"id_": "d19a0639-dfcd-4344-ae89-e324fd89eff3", "embedding": null, "metadata": {"file_path": "/app/frontend/next-env.d.ts", "file_name": "next-env.d.ts", "file_size": 211, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "70a8dd68-ec93-4f0b-9e10-aa2122a427d5", "node_type": "4", "metadata": {"file_path": "/app/frontend/next-env.d.ts", "file_name": "next-env.d.ts", "file_size": 211, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7105f9519a8c5c2e542b63fd4ad0a670d347c444e30b02abae9e62d478c7f39a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 210, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "163c3a83-d4cb-4187-adaf-e6e31be16a3c": {"__data__": {"id_": "163c3a83-d4cb-4187-adaf-e6e31be16a3c", "embedding": null, "metadata": {"file_path": "/app/frontend/next.config.ts", "file_name": "next.config.ts", "file_size": 133, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "60f448fc-35d2-4935-aa32-5130b542cb5b", "node_type": "4", "metadata": {"file_path": "/app/frontend/next.config.ts", "file_name": "next.config.ts", "file_size": 133, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "f45c2cc2a53d18f1c76061de5830af2fc56a7f3fba8dee90a84d02078b00215d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  /* config options here */\n};\n\nexport default nextConfig;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 132, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0bd14bab-5ff9-4792-92da-3d1e1f937de3": {"__data__": {"id_": "0bd14bab-5ff9-4792-92da-3d1e1f937de3", "embedding": null, "metadata": {"file_path": "/app/frontend/package.json", "file_name": "package.json", "file_type": "application/json", "file_size": 1627, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d6d313a3-ec38-44a5-9b1a-e9d43a123c4b", "node_type": "4", "metadata": {"file_path": "/app/frontend/package.json", "file_name": "package.json", "file_type": "application/json", "file_size": 1627, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "ea700676b5be91027141bb2ff1cebd105aa5f9a070e82db1190b9ba541c597e5", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "{\n  \"name\": \"frontend\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n\n  \"scripts\": {\n    \"dev\": \"next dev --turbopack\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\",\n    \"storybook\": \"storybook dev -p 6006\",\n    \"build-storybook\": \"storybook build\"\n  },\n\n  \"dependencies\": {\n    \"@radix-ui/react-label\": \"^2.1.7\",\n    \"@radix-ui/react-slot\": \"^1.2.3\",\n\n    \"class-variance-authority\": \"^0.7.1\",\n    \"clsx\": \"^2.1.1\",\n    \"tailwind-merge\": \"^3.3.0\",\n\n    \"framer-motion\": \"^12.16.0\",\n    \"lucide-react\": \"^0.511.0\",\n\n    \"next\": \"15.3.3\",\n    \"next-auth\": \"^4.24.11\",\n    \"next-themes\": \"^0.4.6\",\n\n    \"react\": \"^19.0.0\",\n    \"react-dom\": \"^19.0.0\",\n\n    \"react-markdown\": \"^10.1.0\",\n    \"react-syntax-highlighter\": \"^15.6.1\",\n\n    \"recharts\": \"^2.15.3\"\n  },\n\n  \"devDependencies\": {\n    \"@chromatic-com/storybook\": \"^4.0.0\",\n    \"@eslint/eslintrc\": \"^3\",\n\n    \"@storybook/addon-a11y\": \"^9.0.6\",\n    \"@storybook/addon-docs\": \"^9.0.6\",\n    \"@storybook/addon-onboarding\": \"^9.0.6\",\n    \"@storybook/addon-vitest\": \"^9.0.6\",\n    \"@storybook/nextjs-vite\": \"^9.0.6\",\n    \"storybook\": \"^9.0.6\",\n    \"eslint-plugin-storybook\": \"^9.0.6\",\n\n    \"eslint\": \"^9\",\n    \"eslint-config-next\": \"15.3.3\",\n\n    \"tailwindcss\": \"^4.1.8\",\n    \"@tailwindcss/postcss\": \"^4.1.8\",\n    \"@tailwindcss/typography\": \"^0.5.11\",\n    \"autoprefixer\": \"^10.4.21\",\n\n    \"@types/node\": \"^20\",\n    \"@types/react\": \"^19\",\n    \"@types/react-dom\": \"^19\",\n\n    \"playwright\": \"^1.52.0\",\n    \"vitest\": \"^3.2.3\",\n    \"@vitest/browser\": \"^3.2.3\",\n    \"@vitest/coverage-v8\": \"^3.2.3\",\n\n    \"tw-animate-css\": \"^1.3.3\",\n\n    \"typescript\": \"^5\"\n  }\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1626, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "f11a1b5a-76a1-40c7-9a6d-165c3c7c820b": {"__data__": {"id_": "f11a1b5a-76a1-40c7-9a6d-165c3c7c820b", "embedding": null, "metadata": {"file_path": "/app/frontend/postcss.config.js", "file_name": "postcss.config.js", "file_type": "application/javascript", "file_size": 110, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "937ffef8-60ba-48b8-9fd7-429f1022bbe5", "node_type": "4", "metadata": {"file_path": "/app/frontend/postcss.config.js", "file_name": "postcss.config.js", "file_type": "application/javascript", "file_size": 110, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "18232ecc9cb80c090d0809299da1725f53cf2e8eced8b1b66449e6165fcce6cc", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// frontend/postcss.config.js\nmodule.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {}\n  }\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 109, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6369ba28-de16-4386-8878-597c9112b4f3": {"__data__": {"id_": "6369ba28-de16-4386-8878-597c9112b4f3", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/action-queue/page.tsx", "file_name": "page.tsx", "file_size": 286, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "eb40f0e7-43e1-43aa-bc2f-b5a41c66240b", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/action-queue/page.tsx", "file_name": "page.tsx", "file_size": 286, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9e0df877f36756756957174a156a3df15f4243b4636ecf88df1e6b3c4e1a5a2b", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"use client\";\nimport ActionQueuePanel from \"@/components/ActionQueue/ActionQueuePanel\";\n\nexport default function ActionQueuePage() {\n  return (\n    <main className=\"p-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">\ud83d\udccb Action Queue</h1>\n      <ActionQueuePanel />\n    </main>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 282, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ac735090-6a24-45fb-8477-31a1039dab1d": {"__data__": {"id_": "ac735090-6a24-45fb-8477-31a1039dab1d", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/api/docs/list/route.ts", "file_name": "route.ts", "file_size": 215, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c7e5b0eb-86bf-46b4-ac54-8a9f440cc091", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/api/docs/list/route.ts", "file_name": "route.ts", "file_size": 215, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3c84a9d2f24c575a6df13328f1654727231bc6076d468c1e06e4d811fcf2fbc7", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/docs/list`)\n  const data = await res.json()\n  return NextResponse.json(data)\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 214, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "aa6d2780-cf2f-4738-8f4d-70478b4b571d": {"__data__": {"id_": "aa6d2780-cf2f-4738-8f4d-70478b4b571d", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/api/docs/view/route.ts", "file_name": "route.ts", "file_size": 358, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "23132ac7-ea1d-4493-ab31-0cdb5fa28563", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/api/docs/view/route.ts", "file_name": "route.ts", "file_size": 358, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "182d98a79d68cba31cf03b9c54af71e59bb8dcbc00daf66fe78ae256e2883e12", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(req: NextRequest) {\n  const url = new URL(req.url)\n  const path = url.searchParams.get(\"path\")\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/docs/view?path=${encodeURIComponent(path || \"\")}`)\n  const data = await res.json()\n  return NextResponse.json(data)\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 357, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c4904cf7-4873-49f1-99e4-da29bfdb7429": {"__data__": {"id_": "c4904cf7-4873-49f1-99e4-da29bfdb7429", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/api/kb/search/route.ts", "file_name": "route.ts", "file_size": 389, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c2708967-07ae-496d-a96a-73d352fec2e9", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/api/kb/search/route.ts", "file_name": "route.ts", "file_size": 389, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "68880430ba23ba0887e41550863725cc8363475e16ba5bfb3e552c6958aa2a8a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json()\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/kb/search`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(body),\n  })\n  const data = await res.json()\n  return NextResponse.json(data)\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 388, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0333c725-2e3f-455a-975f-c9c902194c33": {"__data__": {"id_": "0333c725-2e3f-455a-975f-c9c902194c33", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/api/status/summary/route.ts", "file_name": "route.ts", "file_size": 220, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "006c4a7e-3fa4-4e51-9a35-2884e55838f7", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/api/status/summary/route.ts", "file_name": "route.ts", "file_size": 220, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c48fdaccbbc556655466282dddc12ab7c0d105031712dd799444ae63b0dabc98", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/status/summary`)\n  const data = await res.json()\n  return NextResponse.json(data)\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 219, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "dd7ef435-c30f-4e6e-ae35-51a74b34bbf5": {"__data__": {"id_": "dd7ef435-c30f-4e6e-ae35-51a74b34bbf5", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bd95f59a-e4d6-4a80-aad5-a4fe8768719b", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "31fdee8405a0d3f13fd2a96e702c1c71f9b47a2da2002ebb75b1fbfdddbd87fb", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "2ef8ab26-9154-4815-b552-4aea9b4827a1", "node_type": "1", "metadata": {}, "hash": "e2f97991b7cb06ad5baae8a871329c590df3e965f71cc63853a50021a7a76e4a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/app/ask/page.tsx\n// Purpose: Ask Echo \u2014 bulletproof LLM chat interface with markdown rendering, local history, and safe input handling\n\n\"use client\";\n\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { API_ROOT } from \"@/lib/api\";\n\n// Message type\ntype Message = {\n  role: \"user\" | \"assistant\";\n  content: string;\n  context?: string;\n};\n\nconst USER_ID = \"bret-demo\";\nconst STORAGE_KEY = `echo-chat-history-${USER_ID}`;\nconst INPUT_KEY = `echo-chat-input-${USER_ID}`;\n\n// Type guard for stored messages\nfunction isMessage(val: unknown): val is Message {\n  return (\n    typeof val === \"object\" &&\n    val !== null &&\n    (val as Message).role &&\n    typeof (val as Message).content === \"string\" &&\n    ((val as Message).role === \"user\" || (val as Message).role === \"assistant\")\n  );\n}\n\n// Normalize unknown array into safe Message[]\nfunction normalizeMessages(arr: unknown[]): Message[] {\n  return Array.isArray(arr)\n    ? arr\n        .filter(isMessage)\n        .map((msg) => ({\n          role: msg.role,\n          content: String(msg.content),\n          ...(typeof msg.context === \"string\" && { context: msg.context }),\n        }))\n    : [];\n}\n\n// Markdown stringifier (bulletproof)\nfunction toMDString(val: unknown): string {\n  if (val == null) return \"_(no content)_\";\n  if (typeof val === \"string\") return val;\n  if (Array.isArray(val)) return val.map(toMDString).join(\"\\n\\n\");\n  try {\n    return \"```json\\n\" + JSON.stringify(val, null, 2) + \"\\n```\";\n  } catch {\n    return String(val);\n  }\n}\n\nexport default function AskPage() {\n  const [messages, setMessages] = useState<Message[]>(() => {\n    if (typeof window !== \"undefined\") {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      if (raw) {\n        try {\n          return normalizeMessages(JSON.parse(raw));\n        } catch {\n          return [];\n        }\n      }\n    }\n    return [];\n  });\n\n  const [input, setInput] = useState<string>(\"\");\n  const [loading, setLoading] = useState(false);\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  // Load cached input on mount\n  useEffect(() => {\n    const cached = localStorage.getItem(INPUT_KEY);\n    if (cached) setInput(cached);\n  }, []);\n\n  // Persist messages + scroll to bottom\n  useEffect(() => {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Persist input while typing\n  useEffect(() => {\n    localStorage.setItem(INPUT_KEY, input);\n  }, [input]);\n\n  const sendMessage = useCallback(async (e?: React.FormEvent): Promise<void> => {\n    if (e) e.preventDefault();\n    if (!input.trim() || loading) return;\n\n    const userMessage = input;\n    setMessages((msgs) => [\n      ...msgs,\n      { role: \"user\", content: toMDString(userMessage) },\n    ]);\n    setLoading(true);\n    setInput(\"\");\n\n    try {\n      const res = await fetch(`${API_ROOT}/mcp/run`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-User-Id\": USER_ID,\n        },\n        body: JSON.stringify({\n          query: userMessage,\n          role: \"planner\",\n          debug: true,\n        }),\n      });\n\n      const data = await res.json();\n      const result = data?.result || data;\n\n      const content =\n        result?.plan?.objective ||\n        result?.plan?.recommendation ||\n        result?.recommendation ||\n        result?.response ||\n        data?.response ||\n        \"[no answer]\";\n\n      setMessages((msgs) => [\n        ...msgs,\n        { role: \"assistant\", content: toMDString(content) },\n      ]);\n    } catch (err) {\n      console.error(\"\u26a0\ufe0f Fetch error:\", err);\n      setMessages((msgs) => [\n        ...msgs,\n        {\n          role: \"assistant\",\n          content: toMDString(\"[error] Unable to get response.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3863, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2ef8ab26-9154-4815-b552-4aea9b4827a1": {"__data__": {"id_": "2ef8ab26-9154-4815-b552-4aea9b4827a1", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bd95f59a-e4d6-4a80-aad5-a4fe8768719b", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "31fdee8405a0d3f13fd2a96e702c1c71f9b47a2da2002ebb75b1fbfdddbd87fb", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "dd7ef435-c30f-4e6e-ae35-51a74b34bbf5", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/app/ask/page.tsx", "file_name": "page.tsx", "file_size": 5898, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d9d527304d67d9c4678f4bd4ef0cf4d07e7078560195cf24efded7876ae5c4d6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"),\n        },\n      ]);\n    }\n\n    setLoading(false);\n  }, [input, loading]);\n\n  const renderedMessages = messages.map((msg, i) => {\n    if (typeof msg.content !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof msg.content, msg.content);\n    }\n    return (\n      <div\n        key={i}\n        className={\n          msg.role === \"user\"\n            ? \"text-right text-blue-700\"\n            : \"text-left text-green-700\"\n        }\n      >\n        <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n          <SafeMarkdown>{msg.content}</SafeMarkdown>\n        </div>\n      </div>\n    );\n  });\n\n  return (\n    <div className=\"w-full max-w-2xl mx-auto min-h-screen flex flex-col\">\n      <h1 className=\"text-3xl font-bold my-4\">Ask Echo</h1>\n      <div className=\"flex-1 space-y-2 overflow-y-auto border rounded-xl p-4 bg-muted\">\n        {renderedMessages}\n\n        {loading && (\n          <div className=\"text-left text-green-600 italic\">Thinking\u2026</div>\n        )}\n        <div ref={bottomRef} />\n      </div>\n      <form\n        onSubmit={sendMessage}\n        className=\"flex items-center gap-2 mt-4\"\n        autoComplete=\"off\"\n      >\n        <input\n          type=\"text\"\n          className=\"flex-1 rounded border px-3 py-2\"\n          placeholder=\"Type your question\u2026\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          disabled={loading}\n          name=\"echo-message\"\n          id=\"echo-message\"\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" && !e.shiftKey) {\n              e.preventDefault();\n              sendMessage();\n            }\n          }}\n        />\n        <button\n          type=\"submit\"\n          className=\"bg-blue-600 text-white rounded px-4 py-2\"\n          disabled={loading || !input.trim()}\n        >\n          {loading ? \"Sending\u2026\" : \"Send\"}\n        </button>\n      </form>\n      <div className=\"text-xs text-gray-400 text-center mt-2\">\n        API root: <span className=\"font-mono\">{API_ROOT}</span>\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 3863, "end_char_idx": 5885, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "911cb623-9812-4dce-9024-495c6f8a96e0": {"__data__": {"id_": "911cb623-9812-4dce-9024-495c6f8a96e0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/audit/page.tsx", "file_name": "page.tsx", "file_size": 261, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f4890c21-6889-4d02-ad81-221656141a06", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/audit/page.tsx", "file_name": "page.tsx", "file_size": 261, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "715fea89828fec60107f9b76d2b3424dfe7dfbc8f5e61c58ba3c773445587186", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"use client\";\nimport AuditPanel from \"@/components/AuditPanel/AuditPanel\";\n\nexport default function AuditPage() {\n  return (\n    <main className=\"p-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">\ud83d\udee1\ufe0f Audit Log</h1>\n      <AuditPanel />\n    </main>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 255, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "68690144-0e7f-4b23-b0e4-58344b44af4f": {"__data__": {"id_": "68690144-0e7f-4b23-b0e4-58344b44af4f", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/codex/page.tsx", "file_name": "page.tsx", "file_size": 3861, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "22c1b0ba-50d9-4cd2-822e-b6b51cb1b027", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/codex/page.tsx", "file_name": "page.tsx", "file_size": 3861, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d14cd45a503ab1d2055d7f3d3e33ad23ba9b3fda445139ca145d02def812f9d3", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/app/codex/page.tsx\n// Purpose: Codex agent page with robust markdown/code output; status and patch display is bulletproofed.\n\n\"use client\";\n\nimport React, { useState } from \"react\";\nimport { CodexEditor, CodexPromptBar, CodexPatchView } from \"@/components/Codex\";\nimport { Button } from \"@/components/ui/button\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\n// Helper replaced by shared utility\n\nconst CodexPage: React.FC = () => {\n  const [code, setCode] = useState<string>(\"\");\n  const [prompt, setPrompt] = useState<string>(\"\");\n  const [streamingPatch, setStreamingPatch] = useState<string>(\"\");\n  const [parsedPatch, setParsedPatch] = useState<{\n    file: string;\n    patch: string;\n    reason: string;\n  } | null>(null);\n  const [status, setStatus] = useState<string>(\"\");\n\n  const handleSubmit = async (): Promise<void> => {\n    setStreamingPatch(\"\u23f3 Working...\");\n    setParsedPatch(null);\n\n    try {\n      const res = await fetch(`${API_ROOT}/ask/codex_stream`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ question: prompt, context: code }),\n      });\n\n      const reader = res.body?.getReader();\n      const decoder = new TextDecoder();\n      let patch = \"\";\n\n      while (true) {\n        const { value, done } = await reader!.read();\n        if (done) break;\n        patch += decoder.decode(value, { stream: true });\n        setStreamingPatch(patch);\n      }\n\n      const fileMatch = patch.match(/File:\\s*(.*)/);\n      const reasonMatch = patch.match(/Reason:\\s*([\\s\\S]*)/);\n      const patchStart = patch.indexOf(\"Patch:\");\n      const reasonStart = patch.indexOf(\"Reason:\");\n\n      const extracted = {\n        file: fileMatch?.[1]?.trim() || \"\",\n        patch: patchStart !== -1 && reasonStart !== -1 ? patch.slice(patchStart + 6, reasonStart).trim() : \"\",\n        reason: reasonMatch?.[1]?.trim() || \"\"\n      };\n\n      if (extracted.file && extracted.patch) setParsedPatch(extracted);\n    } catch (err) {\n      setStreamingPatch(\"\u274c Error while generating patch: \" + String(err));\n    }\n  };\n\n  const applyPatch = async (): Promise<void> => {\n    if (!parsedPatch) return;\n    setStatus(toMDString(\"\u23f3 Applying patch...\"));\n\n    try {\n      const res = await fetch(`${API_ROOT}/codex/apply_patch`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          target_file: parsedPatch.file,\n          patch: parsedPatch.patch,\n          reason: parsedPatch.reason\n        })\n      });\n\n      if (res.ok) {\n        setStatus(toMDString(\"\u2705 Patch applied successfully.\"));\n      } else {\n        const err = await res.text();\n        setStatus(toMDString(\"\u274c Failed to apply patch: \" + err));\n      }\n    } catch (err) {\n      setStatus(toMDString(\"\u274c Patch request failed: \" + String(err)));\n    }\n  };\n\n  if (typeof status !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof status, status);\n  }\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      <h1 className=\"text-2xl font-bold\">\ud83e\udde0 Codex \u2014 Code Editing Agent</h1>\n\n      <CodexEditor code={code} setCode={setCode} />\n      <CodexPromptBar prompt={prompt} setPrompt={setPrompt} onSubmit={handleSubmit} />\n      <CodexPatchView patch={streamingPatch} />\n\n      {parsedPatch && (\n        <div className=\"space-y-2\">\n          <Button onClick={applyPatch}>\u2705 Approve & Apply Patch</Button>\n          {status && (\n            <div className=\"text-sm text-muted-foreground\">\n              <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                <SafeMarkdown>{toMDString(status)}</SafeMarkdown>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CodexPage;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3841, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d7048ed1-c644-4631-a2d8-def233197f93": {"__data__": {"id_": "d7048ed1-c644-4631-a2d8-def233197f93", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/control/page.tsx", "file_name": "page.tsx", "file_size": 893, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cf2e2983-2991-4e70-8968-818b2b7db5f8", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/control/page.tsx", "file_name": "page.tsx", "file_size": 893, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1e2ff795513f2ec2918eb80ae48f1807c32d01cb3139f22093e1be526de34647", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/app/control/page.tsx\n// Purpose: Admin control dashboard with patch queue, logs, and memory panels\n\nimport ActionQueuePanel from \"@/components/ActionQueue/ActionQueuePanel\";\nimport LogsPanel from \"@/components/LogsPanel/LogsPanel\";\nimport MemoryPanel from \"@/components/MemoryPanel\";\n\nexport default function ControlPage() {\n  return (\n    <main className=\"p-6 space-y-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">\ud83e\udde0 Relay Control Center</h1>\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-2\">\ud83d\udcdd Pending Actions</h2>\n        <ActionQueuePanel />\n      </section>\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-2\">\ud83d\udcc4 Execution Logs</h2>\n        <LogsPanel />\n      </section>\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-2\">\ud83e\uddec Memory Log</h2>\n        <MemoryPanel />\n      </section>\n    </main>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 880, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "247a961f-811c-4041-a97e-02beb3c92e03": {"__data__": {"id_": "247a961f-811c-4041-a97e-02beb3c92e03", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/dashboard/page.tsx", "file_name": "page.tsx", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "1f1c0190-06ff-4179-8088-93423ec99c1e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/dashboard/page.tsx", "file_name": "page.tsx", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "976da54a781b387fea1659afa7cabe325236efcf1786ee82111ad47acd74a88e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/app/dashboard/page.tsx\n\nimport Dashboard from \"@/components/dashboard/Dashboard\";\n\nexport default function DashboardPage() {\n  return <Dashboard />;\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 172, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "01dc55cd-14b6-48fe-8957-ea14e721a848": {"__data__": {"id_": "01dc55cd-14b6-48fe-8957-ea14e721a848", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/docs/page.tsx", "file_name": "page.tsx", "file_size": 231, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c3f5b707-7db2-4066-91f9-7256de024454", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/docs/page.tsx", "file_name": "page.tsx", "file_size": 231, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "648afd645c5c08878934af37b8850432ef28534fca55a711f0036ba8ce4e3777", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/app/docs/page.tsx\n// Purpose: Route-level page that renders the full DocsViewer\n\n'use client'\n\nimport DocsViewer from '@/components/DocsViewer/DocsViewer'\n\nexport default function DocsPage() {\n  return <DocsViewer />\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 231, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7fa12f32-a7ca-4792-84d4-daecd4981c0b": {"__data__": {"id_": "7fa12f32-a7ca-4792-84d4-daecd4981c0b", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/layout.tsx", "file_name": "layout.tsx", "file_size": 514, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "deee53c9-0121-4eff-b211-b0d93c663a27", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/layout.tsx", "file_name": "layout.tsx", "file_size": 514, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "04713f37dc7002d146c520e12d960e283058ea3fbc5b72ca4d14838e99339991", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import './globals.css';\nimport { ReactNode } from 'react';\nimport Sidebar from '@/components/Sidebar/Sidebar';\n\nexport default function RootLayout({ children }: { children: ReactNode }) {\n  return (\n    <html lang=\"en\">\n      <body className=\"min-h-screen font-sans bg-background text-foreground\">\n        <div className=\"flex h-screen\">\n          <Sidebar />\n          <main className=\"flex-1 overflow-auto p-6 bg-gray-50\">\n            {children}\n          </main>\n        </div>\n      </body>\n    </html>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 513, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "1b9fdb91-aa77-408e-9f1e-47311812df7a": {"__data__": {"id_": "1b9fdb91-aa77-408e-9f1e-47311812df7a", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/metricschart/page.tsx", "file_name": "page.tsx", "file_size": 271, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f30acca8-76ed-4963-9fae-4562da85adc5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/metricschart/page.tsx", "file_name": "page.tsx", "file_size": 271, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7357049f7fd981ab4d5ad9994ddf22e61516bc41388f7d8cb7e641969e92bf5f", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "'use client'\n\nimport MetricsChart from '@/components/MetricsCharts/MetricsCharts'\n\nexport default function MetricsChartPage() {\n  return (\n    <main className=\"p-6 space-y-6\">\n      <h1 className=\"text-2xl font-bold\">Metrics</h1>\n      <MetricsChart />\n    </main>\n  )\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 270, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "abe5ee4a-581d-449b-b904-5aee59ab1aeb": {"__data__": {"id_": "abe5ee4a-581d-449b-b904-5aee59ab1aeb", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/page.tsx", "file_name": "page.tsx", "file_size": 1969, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "789fe320-777b-4984-ba88-323eb0987f69", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/page.tsx", "file_name": "page.tsx", "file_size": 1969, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "65ea93a074390eccbee6a3a10b4f9705cf0e1fd02b7c0ff49e407a10db1bc004", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/app/page.tsx\n// Purpose: Wildfire Ranch Command Center UI (Puck-free)\n\n'use client'\n\nimport Image from 'next/image'\n\nexport default function HomePage() {\n  const statusColors = ['red', 'green', 'orange', 'green']\n\n  return (\n    <main className=\"flex-1 grid grid-cols-4 grid-rows-2 gap-4 p-4 bg-gray-50\">\n      {/* Top Left Panel */}\n      <div className=\"col-span-3 row-span-1 bg-white rounded-xl shadow p-4\">\n        <h3 className=\"font-semibold mb-2\">Top Left Panel</h3>\n        <p>Content goes here\u2026</p>\n      </div>\n\n      {/* Agent Status */}\n      <div className=\"col-span-1 row-span-1 bg-white rounded-xl shadow p-4\">\n        <h4 className=\"font-bold flex items-center gap-2 mb-2\">\n          <Image src=\"/PlannerCop.png\" alt=\"agent\" width={20} height={20} />\n          Agent Status\n        </h4>\n        <ul className=\"text-sm space-y-1\">\n          {statusColors.map((color, i) => (\n            <li key={i} className=\"flex items-center gap-2\">\n              <span className={`w-3 h-3 rounded-full bg-${color}-500`} />\n              Service {i + 1}\n            </li>\n          ))}\n        </ul>\n      </div>\n\n      {/* Bottom Left Panel */}\n      <div className=\"col-span-3 row-span-1 bg-white rounded-xl shadow p-4\">\n        <h3 className=\"font-semibold mb-2\">Bottom Left Panel</h3>\n        <p>More content here\u2026</p>\n      </div>\n\n      {/* Shack Status */}\n      <div className=\"col-span-1 row-span-1 bg-white rounded-xl shadow p-4\">\n        <h4 className=\"font-bold flex items-center gap-2 mb-2\">\n          <Image src=\"/WildfireMang.png\" alt=\"shack\" width={20} height={20} />\n          Shack Status\n        </h4>\n        <ul className=\"text-sm space-y-1\">\n          {statusColors.map((color, i) => (\n            <li key={i} className=\"flex items-center gap-2\">\n              <span className={`w-3 h-3 rounded-full bg-${color}-500`} />\n              Service {i + 1}\n            </li>\n          ))}\n        </ul>\n      </div>\n    </main>\n  )\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1964, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "dee2e32a-bdc4-4059-88ce-18b1073c3cd0": {"__data__": {"id_": "dee2e32a-bdc4-4059-88ce-18b1073c3cd0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/settings/page.tsx", "file_name": "page.tsx", "file_size": 353, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "2aa6c552-d907-41a0-a876-3a4a92fd6b82", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/settings/page.tsx", "file_name": "page.tsx", "file_size": 353, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9359103b6adbad936782c2c024a9538634637e16a2530beadde633381d9f0646", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/app/settings/page.tsx\n\nexport default function SettingsPage() {\n  return (\n    <main className=\"p-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">\u2699\ufe0f Settings</h1>\n      <p className=\"text-muted-foreground\">Configure your Relay experience here.</p>\n      {/* Add settings forms, toggles, API keys, etc. */}\n    </main>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 348, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d929e17a-a853-49b5-b2c8-236abc0c95de": {"__data__": {"id_": "d929e17a-a853-49b5-b2c8-236abc0c95de", "embedding": null, "metadata": {"file_path": "/app/frontend/src/app/status/page.tsx", "file_name": "page.tsx", "file_size": 284, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "59a30dbe-fe0d-464c-addc-e9401c67f211", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/app/status/page.tsx", "file_name": "page.tsx", "file_size": 284, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "0b7dea6cda9f3645cc16c25085f96558ff91f83df245340ea4b7a15dfdb07f86", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/app/status/page.tsx\n\nimport StatusPanel from \"@/components/StatusPanel\";\n\nexport default function StatusPage() {\n  return (\n    <main className=\"p-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">\ud83d\udcca System Status</h1>\n      <StatusPanel />\n    </main>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 280, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "a9ca2aad-c06c-4a31-9e18-72494c78fcf0": {"__data__": {"id_": "a9ca2aad-c06c-4a31-9e18-72494c78fcf0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "429fbc9954ddb2d60495e6488060c425d86938aad85b305e639e47a3bce5a3fe", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c", "node_type": "1", "metadata": {}, "hash": "fa741834527ccf3b6307651c6d4d239e15838bfa37341b0b529b3c9d29cd44c6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/ActionQueuePanel.tsx\n// Purpose: Superpanel for agent patch/action queue with approve/deny, context diff, and deep audit.\n//          All rationale, diff, content, and context fields are rendered with SafeMarkdown for bulletproof safety.\n\n\"use client\";\n\nimport { useEffect, useState, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\ntype ActionStatus = \"pending\" | \"approved\" | \"denied\";\n\ntype HistoryEntry = {\n  timestamp: string;\n  status: ActionStatus;\n  user?: string;\n  comment?: string;\n};\n\ntype Action = {\n  id: string;\n  timestamp: string;\n  status: ActionStatus;\n  action: {\n    type: string;\n    path?: string;\n    content?: string;\n    diff?: string;\n    context?: string;\n    rationale?: string;\n  };\n  history?: HistoryEntry[];\n};\n\n\nexport default function ActionQueuePanel() {\n  const [actions, setActions] = useState<Action[]>([]);\n  const [processing, setProcessing] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [showContext, setShowContext] = useState<{ [id: string]: boolean }>({});\n  const [showHistory, setShowHistory] = useState<{ [id: string]: boolean }>({});\n  const [comment, setComment] = useState<{ [id: string]: string }>({});\n  const [compareContextId, setCompareContextId] = useState<string | null>(null);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n\n  const API_KEY = process.env.NEXT_PUBLIC_API_KEY || \"\";\n  const USER_ID = \"bret\";\n\n  const fetchQueue = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`${API_ROOT}/control/list_queue`, {\n        headers: {\n          \"X-API-Key\": API_KEY,\n          \"X-User-Id\": USER_ID\n        }\n      });\n      if (!res.ok) throw new Error(\"Bad response\");\n      const data = await res.json();\n      const mapped = (data.actions || []).map((a: Action) => ({\n        ...a,\n        action: {\n          ...a.action,\n          rationale: toMDString(a.action?.rationale),\n          diff: toMDString(a.action?.diff),\n          context: toMDString(a.action?.context),\n          content: toMDString(a.action?.content)\n        },\n        history: Array.isArray(a.history)\n          ? a.history.map(h => ({\n              ...h,\n              comment: toMDString(h.comment)\n            }))\n          : a.history\n      }));\n      setActions(mapped);\n    } catch (err) {\n      console.error(\"Queue fetch failed\", err);\n      setError(\"Failed to fetch action queue.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2859, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c": {"__data__": {"id_": "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "429fbc9954ddb2d60495e6488060c425d86938aad85b305e639e47a3bce5a3fe", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "a9ca2aad-c06c-4a31-9e18-72494c78fcf0", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "fd854ea1ce13393acfa2ac56ca6bfd1e6fca38a1cac589fb2b04881c179d013c", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "d851725f-3a9f-43d4-bbc8-67011b3d65b4", "node_type": "1", "metadata": {}, "hash": "51cdb2a56bdfa9b0fbe3ae28ce2ed81e46d64ce3a6b266bd42872bd9d631d0e3", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "a.history.map(h => ({\n              ...h,\n              comment: toMDString(h.comment)\n            }))\n          : a.history\n      }));\n      setActions(mapped);\n    } catch (err) {\n      console.error(\"Queue fetch failed\", err);\n      setError(\"Failed to fetch action queue.\");\n    }\n    setLoading(false);\n  }, [API_KEY, USER_ID]);\n\n  const updateStatus = async (id: string, action: \"approve\" | \"deny\") => {\n    setProcessing(id + action);\n    try {\n      const res = await fetch(`${API_ROOT}/control/${action}_action`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-API-Key\": API_KEY,\n          \"X-User-Id\": USER_ID\n        },\n        body: JSON.stringify({ id, comment: comment[id] || \"\" })\n      });\n      if (!res.ok) throw new Error(`${action} failed`);\n      await fetchQueue();\n      setComment((prev) => ({ ...prev, [id]: \"\" }));\n    } catch (err) {\n      console.error(`Action ${action} failed`, err);\n      setError(`Failed to ${action} action.`);\n    }\n    setProcessing(null);\n  };\n\n  useEffect(() => {\n    fetchQueue();\n    if (!autoRefresh) return;\n    const interval = setInterval(fetchQueue, 15000);\n    return () => clearInterval(interval);\n  }, [fetchQueue, autoRefresh]);\n\n  const getActionById = (id: string) => actions.find(a => a.id === id);\n\n  for (const a of actions) {\n    if (a.action.rationale && typeof a.action.rationale !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof a.action.rationale, a.action.rationale);\n    }\n    if (a.action.diff && typeof a.action.diff !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof a.action.diff, a.action.diff);\n    }\n    if (typeof a.action.content !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof a.action.content, a.action.content);\n    }\n    if (a.action.context && typeof a.action.context !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof a.action.context, a.action.context);\n    }\n    if (Array.isArray(a.history)) {\n      for (const h of a.history) {\n        if (h.comment && typeof h.comment !== \"string\") {\n          console.log(\"DEBUG 418:\", typeof h.comment, h.comment);\n        }\n      }\n    }\n  }\n\n  if (error) return <p className=\"text-red-500\">{error}</p>;\n  if (loading) return <p className=\"text-muted-foreground\">Loading queue...</p>;\n  if (!actions.length) return <p className=\"text-muted-foreground\">No actions in queue.</p>;\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex gap-2 mb-4 items-center\">\n        <Button variant={autoRefresh ? \"default\" : \"outline\"} onClick={() => setAutoRefresh(!autoRefresh)}>\n          {autoRefresh ? \"Auto-Refresh ON\" : \"Auto-Refresh OFF\"}\n        </Button>\n        <span className=\"text-xs text-gray-400\">Queue updates every 15s</span>\n      </div>\n      {actions.map((a) => (\n        <Card key={a.id}>\n          <CardContent className=\"p-4 space-y-2\">\n            <div className=\"flex items-center gap-2 text-sm font-mono text-muted-foreground\">\n              #{a.id.slice(0, 8)} \u2022 {a.timestamp}\n              <Badge variant={\n                a.status === \"approved\" ? \"success\" :\n                a.status === \"denied\" ? \"destructive\" : \"secondary\"\n              }>\n                {a.status}\n              </Badge>\n            </div>\n\n            <div className=\"text-sm\">\n              <strong>Type:</strong> {a.action.type}\n              {a.action.path && <span className=\"ml-2\"><strong>Path:</strong> {a.action.path}</span>}\n            </div>\n\n            {a.action.rationale && (\n              <div className=\"text-xs text-blue-800 mt-1 italic\">\n                <strong>Why?</strong>{\" \"}\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{toMDString(a.action.rationale)}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            {a.action.diff ?", "mimetype": "text/plain", "start_char_idx": 2584, "end_char_idx": 6450, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d851725f-3a9f-43d4-bbc8-67011b3d65b4": {"__data__": {"id_": "d851725f-3a9f-43d4-bbc8-67011b3d65b4", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "429fbc9954ddb2d60495e6488060c425d86938aad85b305e639e47a3bce5a3fe", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "a6a45bfd62a136ebca83eb6766d56c39b0b4d2415e45651a10552adc47e23d9e", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "27c6955e-1add-4106-95a3-6d73f0be21c1", "node_type": "1", "metadata": {}, "hash": "bf12b638bb8fdc9f1c48e18bfaf33884ce294fc999841b19a8c22fb56cd9a77c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"success\" :\n                a.status === \"denied\" ? \"destructive\" : \"secondary\"\n              }>\n                {a.status}\n              </Badge>\n            </div>\n\n            <div className=\"text-sm\">\n              <strong>Type:</strong> {a.action.type}\n              {a.action.path && <span className=\"ml-2\"><strong>Path:</strong> {a.action.path}</span>}\n            </div>\n\n            {a.action.rationale && (\n              <div className=\"text-xs text-blue-800 mt-1 italic\">\n                <strong>Why?</strong>{\" \"}\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{toMDString(a.action.rationale)}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            {a.action.diff ? (\n              <details>\n                <summary className=\"cursor-pointer text-xs text-blue-700\">View Diff</summary>\n                <div className=\"bg-muted p-2 rounded text-xs overflow-auto whitespace-pre-wrap\">\n                  <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                    <SafeMarkdown>{toMDString(a.action.diff)}</SafeMarkdown>\n                  </div>\n                </div>\n              </details>\n            ) : (\n              <div className=\"bg-muted p-2 rounded text-sm overflow-auto whitespace-pre-wrap\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{toMDString(a.action.content?.slice(0, 500) || \"No content\")}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            {a.action.context && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"my-2\"\n                onClick={() => setShowContext(prev => ({ ...prev, [a.id]: !prev[a.id] }))}\n              >\n                {showContext[a.id] ? \"Hide Agent Context\" : \"Show Agent Context\"}\n              </Button>\n            )}\n\n            {showContext[a.id] && a.action.context && (\n              <div className=\"bg-gray-100 p-2 rounded text-xs max-h-32 overflow-auto mt-2\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{toMDString(a.action.context)}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            {/* Context diff compare */}\n            <div className=\"mt-2\">\n              <label className=\"text-xs mr-2\">Compare context to:</label>\n              <select\n                className=\"border rounded px-1 py-0.5 text-xs\"\n                value={compareContextId === a.id ? \"\" : compareContextId || \"\"}\n                onChange={e => setCompareContextId(e.target.value || null)}\n              >\n                <option value=\"\">Select previous action\u2026</option>\n                {actions.filter(other => other.id !== a.id && other.action.context).map(other => (\n                  <option key={other.id} value={other.id}>\n                    #{other.id.slice(0, 8)} {other.action.type}\n                  </option>\n                ))}\n              </select>\n              {compareContextId && getActionById(compareContextId) && a.action.context && (\n                <details>\n                  <summary className=\"cursor-pointer text-xs text-blue-700 mt-1\">Show Context Diff</summary>\n                  <div className=\"bg-yellow-100 p-2 rounded text-xs overflow-auto whitespace-pre-wrap\">\n                    <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                      <SafeMarkdown>\n                        {toMDString(\n                          diffContext(a.action.context, getActionById(compareContextId)?.action.context || \"\")\n                        )}\n                      </SafeMarkdown>\n                    </div>\n                  </div>\n                </details>\n              )}\n            </div>\n\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"my-2\"\n              onClick={() => setShowHistory(prev => ({ ...prev, [a.id]: !prev[a.id] }))}\n            >\n              {showHistory[a.id] ?", "mimetype": "text/plain", "start_char_idx": 5673, "end_char_idx": 9809, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "27c6955e-1add-4106-95a3-6d73f0be21c1": {"__data__": {"id_": "27c6955e-1add-4106-95a3-6d73f0be21c1", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "429fbc9954ddb2d60495e6488060c425d86938aad85b305e639e47a3bce5a3fe", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "d851725f-3a9f-43d4-bbc8-67011b3d65b4", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/ActionQueue/ActionQueuePanel.tsx", "file_name": "ActionQueuePanel.tsx", "file_size": 12602, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "43f6a6b2b2152267ea476ce4731bb675a18d515787b8ec7d1142da61b92dcdce", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"Hide History\" : \"Show History\"}\n            </Button>\n\n            {showHistory[a.id] && Array.isArray(a.history) && (\n              <ul className=\"bg-gray-50 p-2 rounded text-xs mt-1 max-h-32 overflow-auto border\">\n                {a.history.map((h, i) => (\n                  <li key={i}>\n                    <span className=\"font-mono\">{h.timestamp}</span> \u2022 <Badge>{h.status}</Badge>\n                    {h.user && <span className=\"ml-2 text-blue-700\">{h.user}</span>}\n                    {h.comment && (\n                      <span className=\"ml-2 italic\">\n                        <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                          <SafeMarkdown>{toMDString(h.comment)}</SafeMarkdown>\n                        </div>\n                      </span>\n                    )}\n                  </li>\n                ))}\n              </ul>\n            )}\n\n            {a.status === \"pending\" && (\n              <form className=\"flex flex-col gap-2 mt-2\" onSubmit={e => e.preventDefault()}>\n                <Textarea\n                  id={`comment-${a.id}`}\n                  name={`comment-${a.id}`}\n                  placeholder=\"Optional comment (why approve/deny?)\"\n                  value={comment[a.id] || \"\"}\n                  onChange={e =>\n                    setComment(prev => ({ ...prev, [a.id]: e.target.value }))\n                  }\n                  className=\"text-xs\"\n                  rows={2}\n                />\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"default\"\n                    onClick={() => updateStatus(a.id, \"approve\")}\n                    disabled={processing === a.id + \"approve\"}\n                    type=\"button\"\n                  >\n                    {processing === a.id + \"approve\" ? \"Approving...\" : \"Approve\"}\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    onClick={() => updateStatus(a.id, \"deny\")}\n                    disabled={processing === a.id + \"deny\"}\n                    type=\"button\"\n                  >\n                    {processing === a.id + \"deny\" ? \"Denying...\" : \"Deny\"}\n                  </Button>\n                </div>\n              </form>\n            )}\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n\n  // Simple line diff for context comparison\n  function diffContext(ctx1: string, ctx2: string): string {\n    const lines1 = new Set((ctx1 || \"\").split(\"\\n\"));\n    const lines2 = new Set((ctx2 || \"\").split(\"\\n\"));\n    let out = \"\";\n    for (const l of lines1) {\n      if (!lines2.has(l)) out += `+ ${l}\\n`;\n    }\n    for (const l of lines2) {\n      if (!lines1.has(l)) out += `- ${l}\\n`;\n    }\n    return out || \"No differences.\";\n  }\n}", "mimetype": "text/plain", "start_char_idx": 9810, "end_char_idx": 12595, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "169475b9-b84b-4b71-976d-0e4f25764e27": {"__data__": {"id_": "169475b9-b84b-4b71-976d-0e4f25764e27", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatMessage.tsx", "file_name": "ChatMessage.tsx", "file_size": 894, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "76f9d856-249d-4bf9-a8be-88ccda517381", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatMessage.tsx", "file_name": "ChatMessage.tsx", "file_size": 894, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "f816e6bc00ca48ab53e3b576297769cfc8512b6dab02830da18a92c4bf517692", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/AskAgent/ChatMessage.tsx\n// Purpose: Renders a single chat message, always string-coercing content for SafeMarkdown.\n\nimport React from \"react\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\"; // Use the shared safe renderer\nimport { toMDString } from \"@/lib/toMDString\";\n\ntype Props = {\n  role: \"user\" | \"assistant\";\n  content: unknown; // Accept anything, always coerce to string for safety\n};\n\n\nexport default function ChatMessage({ role, content }: Props) {\n  const alignClass =\n    role === \"user\" ? \"text-right text-blue-700\" : \"text-left text-green-700\";\n\n  if (typeof content !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof content, content);\n  }\n\n  return (\n    <div className={alignClass}>\n      <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n        <SafeMarkdown>{toMDString(content)}</SafeMarkdown>\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 893, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "a88a66b7-6eef-42e4-b783-fd5630ce17f2": {"__data__": {"id_": "a88a66b7-6eef-42e4-b783-fd5630ce17f2", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatWindow.tsx", "file_name": "ChatWindow.tsx", "file_size": 1683, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "b2e6dd37-609b-4514-8801-6ad9e3c464fd", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/ChatWindow.tsx", "file_name": "ChatWindow.tsx", "file_size": 1683, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "143891bbe6272b8481b4173cdcf978ba519e87c3779fa807fb0f5a3340e4b8d9", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/AskEcho/ChatWindow.tsx\n// Purpose: Chat window for Ask Echo UI using /mcp/run pipeline\n// Updated: 2025-07-01\n\n\"use client\";\n\nimport ChatMessage from \"./ChatMessage\";\nimport InputBar from \"./InputBar\";\nimport { useAskEcho } from \"./useAskEcho\";\nimport { toMDString } from \"@/lib/toMDString\";\n\nexport default function ChatWindow() {\n  // Unified chat state and actions from the custom hook\n  const {\n    input,\n    setInput,\n    messages,\n    sendMessage,\n    loading,\n    bottomRef,\n  } = useAskEcho();\n\n  const renderedMessages = messages.map((msg, i) => {\n    if (typeof msg.content !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof msg.content, msg.content);\n    }\n    return (\n      <>\n        <ChatMessage key={i} role={msg.role} content={toMDString(msg.content)} />\n      </>\n    );\n  });\n\n  return (\n    <div className=\"w-full max-w-2xl mx-auto min-h-screen flex flex-col\">\n      {/* Header */}\n      <h1 className=\"text-3xl font-bold my-4\">Ask Echo</h1>\n\n      {/* Message List */}\n      <div className=\"flex-1 space-y-2 overflow-y-auto border rounded-xl p-4 bg-muted\">\n        {renderedMessages}\n        {loading && (\n          <div className=\"text-left text-green-700 animate-pulse\">\n            Echo is thinking\u2026\n          </div>\n        )}\n        <div ref={bottomRef} />\n      </div>\n\n      {/* Input Bar */}\n      <InputBar\n        value={input}\n        onChange={setInput}\n        onSend={sendMessage}\n        loading={loading}\n      />\n\n      {/* Keyboard shortcut hint */}\n      <div className=\"text-xs text-gray-400 text-center mt-2\">\n        Tip: Press <code>Enter</code> to send. Shift+Enter for newline.\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1680, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7371b9b0-bfa0-43f2-889e-fc011e961fd6": {"__data__": {"id_": "7371b9b0-bfa0-43f2-889e-fc011e961fd6", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/InputBar.tsx", "file_name": "InputBar.tsx", "file_size": 1460, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "ed45e49e-84c9-4e0a-9334-42494eaa49b4", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/InputBar.tsx", "file_name": "InputBar.tsx", "file_size": 1460, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8d6e4eceb5b015a7773e880afd6c02774ad84d221aee6048fe5df5878cdb6bf5", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/AskAgent/InputBar.tsx\n// Purpose: Text input + send button for AskAgent chat UI\n// Updated: 2025-06-30\n\nimport React from \"react\";\n\ntype Props = {\n  value: string;                 // Input value (controlled)\n  onChange: (val: string) => void; // Handle text changes\n  onSend: () => void;              // Called to send message\n  loading: boolean;                // Loading state (disables input/button)\n};\n\nconst InputBar: React.FC<Props> = ({ value, onChange, onSend, loading }) => {\n  return (\n    <form\n      className=\"flex items-center gap-2 mt-4\"\n      autoComplete=\"off\"\n      onSubmit={(e) => {\n        e.preventDefault();\n        if (!loading && value.trim()) onSend();\n      }}\n    >\n      <input\n        type=\"text\"\n        className=\"flex-1 rounded border px-3 py-2\"\n        placeholder=\"Type your question\u2026\"\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        disabled={loading}\n        name=\"echo-message\"\n        id=\"echo-message\"\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\" && !e.shiftKey && value.trim() && !loading) {\n            e.preventDefault();\n            onSend();\n          }\n        }}\n        autoFocus\n      />\n      <button\n        type=\"submit\"\n        className=\"bg-blue-600 text-white rounded px-4 py-2\"\n        disabled={loading || !value.trim()}\n      >\n        {loading ? \"Sending\u2026\" : \"Send\"}\n      </button>\n    </form>\n  );\n};\n\nexport default InputBar;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1455, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "366f6908-45ef-493a-9783-e31fab422f30": {"__data__": {"id_": "366f6908-45ef-493a-9783-e31fab422f30", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/hooks.ts", "file_name": "hooks.ts", "file_size": 3620, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "a29717d4-ebdc-4761-8ada-6a7dedf5cad1", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/hooks.ts", "file_name": "hooks.ts", "file_size": 3620, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "4155ae1f75a18546de7115b837722d2ae2db3167ed6669295771dd59da79c675", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/AskAgent/hooks.ts\n// Purpose: Reusable React hook for AskAgent chat\u2014now wired to /mcp/run for agent/critic orchestration\n//          Ensures ALL message fields for markdown rendering are always strings (prevents React #418).\n// Updated: 2025-07-01\n\nimport { useState } from \"react\";\nimport { API_ROOT } from \"@/lib/api\";\nimport { toMDString } from \"@/lib/toMDString\";\n\n// Message interface for chat history\nexport interface Message {\n  user: string;   // User's input\n  agent: string;  // Agent's reply (ALWAYS stringified)\n  context?: string; // (ALWAYS stringified if present)\n  action?: { type: string; payload: unknown };\n  id?: string;\n  status?: \"pending\" | \"approved\" | \"denied\";\n}\n\n\n// Main hook for agent chat\nexport function useAskAgent(userId: string) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  // Send user query to backend, add both user and agent messages\n  const sendQuery = async (\n    query: string,\n    files: string[] = [],\n    topics: string[] = [],\n    role: string = \"planner\", // Optionally allow agent selection\n    debug: boolean = true,\n    scrollToBottom?: () => void\n  ) => {\n    if (!query.trim()) return;\n\n    // Add user message\n    setMessages((prev) => [...prev, { user: toMDString(query), agent: \"\" }]);\n    setLoading(true);\n\n    try {\n      // Build payload for unified MCP endpoint\n      const payload = {\n        query,\n        files,\n        topics,\n        role,\n        debug,\n      };\n\n      const res = await fetch(`${API_ROOT}/mcp/run`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-User-Id\": userId,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      const data = await res.json();\n      const result = data?.result || data;\n\n      // Coerce all markdown-displayed fields to strings for safety\n      setMessages((prev) => [\n        ...prev.slice(0, -1),\n        {\n          user: query,\n          agent: toMDString(\n            result?.plan?.objective ||\n            result?.plan?.recommendation ||\n            result?.recommendation ||\n            result?.response ||\n            data?.response ||\n            \"[no answer]\"\n          ),\n          context: toMDString(result?.context || data?.context),\n          action: result?.action,\n          id: result?.id,\n          status: result?.id ? \"pending\" : undefined,\n        },\n      ]);\n\n      scrollToBottom?.();\n    } catch {\n      setMessages((prev) => [\n        ...prev.slice(0, -1),\n        { user: toMDString(query), agent: toMDString(\"Error contacting Relay.\") },\n      ]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Approve/deny an agent-generated action, update status in message array\n  const updateActionStatus = async (\n    id: string,\n    action: \"approve\" | \"deny\",\n    idx: number\n  ) => {\n    try {\n      await fetch(`${API_ROOT}/control/${action}_action`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-User-Id\": userId,\n        },\n        body: JSON.stringify({ id, comment: \"inline approval\" }),\n      });\n\n      setMessages((prev) => {\n        const updated = [...prev];\n        if (updated[idx]) {\n          updated[idx] = {\n            ...updated[idx],\n            status: action === \"approve\" ? \"approved\" : \"denied\",\n          };\n        }\n        return updated;\n      });\n    } catch {\n      alert(\"Error approving/denying action.\");\n    }\n  };\n\n  return {\n    messages,\n    setMessages,\n    sendQuery,\n    updateActionStatus,\n    loading,\n  };\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3617, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2d6fd3c5-60a6-4f3e-b33f-845d9b9e08c1": {"__data__": {"id_": "2d6fd3c5-60a6-4f3e-b33f-845d9b9e08c1", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "dcc942cc-2105-4a05-921d-75e91c655b86", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e479d3a2ee47c47509781544049054f0d2d70d44a98a896304ea66eb89fc48fe", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "ea4f0b75-0bca-48bd-9825-95627eb6d4a5", "node_type": "1", "metadata": {}, "hash": "24e30d32b3369372e48cc5155bf8f95557849ba98d3107d4737b4eba50c9c925", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/AskAgent/useAskEcho.ts\n// Purpose: Custom React hook for agent chat, POSTing to /mcp/run for full agent/critic orchestration\n// Updated: 2025-06-30\n\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { API_ROOT } from \"@/lib/api\";\nimport { toMDString } from \"@/lib/toMDString\";\n\n// Message type for chat history\nexport type Message = {\n  role: \"user\" | \"assistant\";\n  content: string;\n  context?: string;\n  action?: { type: string; payload: unknown };\n  id?: string;\n  status?: \"pending\" | \"approved\" | \"denied\";\n};\n\n// Set a test user ID; in production, wire this to user/session context\nconst USER_ID = \"bret-demo\";\nconst STORAGE_KEY = `echo-chat-history-${USER_ID}`;\n\nexport function useAskEcho() {\n  // Chat state and UI controls\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [files, setFiles] = useState(\"\");      // Comma-separated string in UI\n  const [topics, setTopics] = useState(\"\");    // Comma-separated string in UI\n  const [role, setRole] = useState(\"planner\"); // Agent role, can be \"planner\", \"codex\", etc.\n  const [showContext, setShowContext] = useState<Record<number, boolean>>({});\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  // Load chat history from localStorage on mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      if (raw) {\n        try {\n          const parsed = JSON.parse(raw);\n          if (Array.isArray(parsed)) {\n            setMessages(\n             parsed\n  .filter(\n    (m: unknown): m is { role?: unknown; content?: unknown; context?: unknown } =>\n      typeof m === \"object\" &&\n      m !== null &&\n      \"content\" in m\n  )\n  .map((m) => ({\n    role:\n      m.role === \"user\" || m.role === \"assistant\"\n        ? m.role\n        : \"assistant\", // Fallback if missing\n    content: toMDString(m.content),\n    ...(typeof m.context === \"string\" && { context: toMDString(m.context) }),\n  }))\n\n            );\n          }\n        } catch {\n          setMessages([]);\n        }\n      }\n    }\n  }, []);\n\n  // Save chat history and scroll to bottom on message update\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));\n    }\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Toggle expanded context view for a message\n  const toggleContext = useCallback((index: number) => {\n    setShowContext((prev) => ({ ...prev, [index]: !prev[index] }));\n  }, []);\n\n  // Approve or deny an agent-suggested action (e.g., code patch)\n  const updateActionStatus = useCallback(\n    async (id: string, action: \"approve\" | \"deny\", idx: number) => {\n      try {\n        await fetch(`${API_ROOT}/control/${action}_action`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-User-Id\": USER_ID,\n          },\n          body: JSON.stringify({ id, comment: \"inline approval\" }),\n        });\n\n        setMessages((prev) => {\n          const updated = [...prev];\n          if (updated[idx]) {\n            updated[idx] = {\n              ...updated[idx],\n              status: action === \"approve\" ? \"approved\" : \"denied\",\n            };\n          }\n          return updated;\n        });\n      } catch {\n        alert(\"Error approving/denying action.\");\n      }\n    },\n    []\n  );\n\n  // Send user input to the backend (MCP entrypoint), add both user and agent messages\n  const sendMessage = useCallback(async () => {\n    if (!input.trim() || loading) return;\n\n    const userMessage = input;\n    setMessages((msgs) => [...msgs, { role: \"user\", content: toMDString(userMessage) }]);\n    setInput(\"\");\n    setLoading(true);\n\n    try {\n      // Prepare the payload, parsing files/topics as arrays, include selected agent role\n      const payload = {\n        query: userMessage, // could also use \"question\", but \"query\" is unified\n        files: files ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4056, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ea4f0b75-0bca-48bd-9825-95627eb6d4a5": {"__data__": {"id_": "ea4f0b75-0bca-48bd-9825-95627eb6d4a5", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "dcc942cc-2105-4a05-921d-75e91c655b86", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e479d3a2ee47c47509781544049054f0d2d70d44a98a896304ea66eb89fc48fe", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "2d6fd3c5-60a6-4f3e-b33f-845d9b9e08c1", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/AskAgent/useAskEcho.ts", "file_name": "useAskEcho.ts", "file_size": 5907, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "99c4f647e9d8cdd6ec5ed6f977c0be9bfdd6ad775fec73f2cfe5a4ccc5259bb1", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"approved\" : \"denied\",\n            };\n          }\n          return updated;\n        });\n      } catch {\n        alert(\"Error approving/denying action.\");\n      }\n    },\n    []\n  );\n\n  // Send user input to the backend (MCP entrypoint), add both user and agent messages\n  const sendMessage = useCallback(async () => {\n    if (!input.trim() || loading) return;\n\n    const userMessage = input;\n    setMessages((msgs) => [...msgs, { role: \"user\", content: toMDString(userMessage) }]);\n    setInput(\"\");\n    setLoading(true);\n\n    try {\n      // Prepare the payload, parsing files/topics as arrays, include selected agent role\n      const payload = {\n        query: userMessage, // could also use \"question\", but \"query\" is unified\n        files: files ? files.split(\",\").map((f) => f.trim()).filter(Boolean) : [],\n        topics: topics ? topics.split(\",\").map((t) => t.trim()).filter(Boolean) : [],\n        role,        // \"planner\", \"codex\", etc. (add a UI selector for more roles)\n        debug: true, // always enable debug for richer agent responses\n      };\n\n      const res = await fetch(`${API_ROOT}/mcp/run`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-User-Id\": USER_ID,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      const data = await res.json();\n\n      // Compose assistant's reply (try multiple possible keys)\n      const result = data?.result || data;\n        // Helper: always coerce to string for SafeMarkdown\n\n      setMessages((msgs) => [\n        ...msgs,\n        {\n          role: \"assistant\",\n          content:\n            toMDString(\n              result?.plan?.objective ||\n              result?.plan?.recommendation ||\n              result?.recommendation ||\n              result?.response ||\n              data?.response ||\n              \"[no answer]\"\n            ),\n          context: toMDString(result?.context || data?.context),\n          action: result?.action,\n          id: result?.id,\n          status: result?.id ? \"pending\" : undefined,\n        },\n      ]);\n\n    } catch {\n      setMessages((msgs) => [\n        ...msgs,\n        { role: \"assistant\", content: toMDString(\"[error] Unable to get response.\") },\n      ]);\n    }\n\n    setLoading(false);\n  }, [input, loading, files, topics, role]);\n\n  return {\n    input,\n    setInput,\n    messages,\n    sendMessage,\n    loading,\n    bottomRef,\n    files,\n    setFiles,\n    topics,\n    setTopics,\n    role,\n    setRole, // Expose role setter so UI can allow agent role selection\n    showContext,\n    toggleContext,\n    updateActionStatus,\n  };\n}", "mimetype": "text/plain", "start_char_idx": 3307, "end_char_idx": 5906, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ef605c2c-fba0-4103-aa29-dbf5cac0673a": {"__data__": {"id_": "ef605c2c-fba0-4103-aa29-dbf5cac0673a", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "442df71dbf79300159750ab15180b85975a29f89d2985dc2284fb156ecd06ff5", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "d2784268-cae6-404f-bc18-0e971589b590", "node_type": "1", "metadata": {}, "hash": "0d705ede0fe6d92a9519553655597b6502a80630092da532d401082a3b150f2c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/AuditPanel.tsx\n// Purpose: Unified agent audit dashboard with drilldown into agent actions/patches and related context.\n//          All comments, context, rationales, and diffs now render via SafeMarkdown for clarity and security.\n\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\n\n// Bulletproof Markdown stringifier for all content/comments/diffs/rationales/etc.\nfunction toMDString(val: unknown): string {\n  if (val == null) return \"\";\n  if (typeof val === \"string\") return val;\n  if (Array.isArray(val)) return val.map(toMDString).join(\"\\n\\n\");\n  try {\n    return \"```json\\n\" + JSON.stringify(val, null, 2) + \"\\n```\";\n  } catch {\n    return String(val);\n  }\n}\n\n\n// === Types ===\ntype LogEntry = {\n  id: string;\n  type?: string;\n  path?: string;\n  timestamp: string;\n  status: string;\n  user?: string;\n  comment?: string;\n  result?: unknown;\n};\ntype ActionDetail = {\n  id: string;\n  action: {\n    context?: string;\n    rationale?: string;\n    diff?: string;\n  };\n  history?: {\n    timestamp: string;\n    status: string;\n    user?: string;\n    comment?: string;\n  }[];\n};\n\nexport default function AuditPanel() {\n  const [logs, setLogs] = useState<LogEntry[]>([]);\n  const [filter, setFilter] = useState<{ user?: string; type?: string; status?: string }>({});\n  const [search, setSearch] = useState(\"\");\n  const [exporting, setExporting] = useState(false);\n  const [selected, setSelected] = useState<LogEntry | null>(null);\n  const [relatedAction, setRelatedAction] = useState<ActionDetail | null>(null);\n\n  // === Fetch audit logs from backend ===\n  async function fetchLog() {\n    try {\n      const res = await fetch(`${API_ROOT}/control/list_log`, {\n        headers: { \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" }\n      });\n      if (!res.ok) throw new Error(\"Bad response\");\n      const data = await res.json();\n      const mapped = (data.log || []).map((l: LogEntry) => ({\n        ...l,\n        comment: toMDString(l.comment),\n        result: toMDString(l.result)\n      }));\n      setLogs(mapped);\n    } catch (err) {\n      console.error(\"[AuditPanel] Failed to fetch logs:\", err);\n      setLogs([]);\n    }\n  }\n\n  // === Fetch related queue action by id ===\n  async function fetchRelated(id: string) {\n    try {\n      const res = await fetch(`${API_ROOT}/control/list_queue`, {\n        headers: { \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" }\n      });\n      if (!res.ok) throw new Error(\"Bad response\");\n      const data = await res.json();\n      const action: ActionDetail | undefined = (data.actions as ActionDetail[] | undefined)?.find(a => a.id === id);\n      const mapped = action\n        ? {\n            ...action,\n            action: {\n              ...action.action,\n              context: toMDString(action.action?.context),\n              rationale: toMDString(action.action?.rationale),\n              diff: toMDString(action.action?.diff)\n            },\n            history: Array.isArray(action.history)\n              ? action.history.map(h => ({\n                  ...h,\n                  comment: toMDString(h.comment)\n                }))\n              : action.history\n          }\n        : null;\n      setRelatedAction(mapped);\n    } catch (err) {\n      console.error(\"[AuditPanel] Failed to fetch related action:\", err);\n      setRelatedAction(null);\n    }\n  }\n\n  useEffect(() => {\n    fetchLog();\n    const interval = setInterval(fetchLog, 15000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // === Filtered/search results ===\n  const filtered = logs.filter(entry =>\n    (!filter.user || entry.user === filter.user) &&\n    (!filter.type || entry.type === filter.type) &&\n    (!filter.status || entry.status === filter.status) &&\n    (search.trim() === \"\" ||\n      (entry.comment?.toLowerCase().includes(search.toLowerCase()) ?? false) ||\n      (entry.type?.toLowerCase().includes(search.toLowerCase()) ?? false) ||\n      (entry.path?.toLowerCase().includes(search.toLowerCase()) ??", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4162, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d2784268-cae6-404f-bc18-0e971589b590": {"__data__": {"id_": "d2784268-cae6-404f-bc18-0e971589b590", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "442df71dbf79300159750ab15180b85975a29f89d2985dc2284fb156ecd06ff5", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "ef605c2c-fba0-4103-aa29-dbf5cac0673a", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1beee190792631d3e1dfa81c6017f4520a5173cb9d761b601945912aeacaba44", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "22ed50f8-bfac-447a-8a55-1ecf47f1451e", "node_type": "1", "metadata": {}, "hash": "c56c2ad2f9b8153f6bad5218482a9a374f64486b8886f687b0fe1a5c0861eba8", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "? false) ||\n      (entry.type?.toLowerCase().includes(search.toLowerCase()) ?? false) ||\n      (entry.path?.toLowerCase().includes(search.toLowerCase()) ?? false) ||\n      (entry.id?.toLowerCase().includes(search.toLowerCase()) ?? false))\n  );\n\n  // === Export as JSON/CSV ===\n  function exportLog(format: \"json\" | \"csv\") {\n    setExporting(true);\n    let blob;\n    if (format === \"json\") {\n      blob = new Blob([JSON.stringify(filtered, null, 2)], { type: \"application/json\" });\n    } else {\n      const header = [\"id\", \"type\", \"path\", \"timestamp\", \"status\", \"user\", \"comment\"];\n      const csv = [\n        header.join(\",\"),\n        ...filtered.map(l => header.map(k => `\"${(l as Record<string, string | undefined>)[k] ?? \"\"}\"`).join(\",\"))\n      ].join(\"\\n\");\n      blob = new Blob([csv], { type: \"text/csv\" });\n    }\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `relay_audit_log.${format}`;\n    a.click();\n    setTimeout(() => {\n      setExporting(false);\n      URL.revokeObjectURL(url);\n    }, 1000);\n  }\n\n  // === UI ===\n  const rows = filtered.map((entry, i) => {\n    if (entry.comment && typeof entry.comment !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof entry.comment, entry.comment);\n    }\n    return (\n      <tr\n        key={i}\n        className=\"border-t border-gray-300 cursor-pointer hover:bg-blue-50\"\n        onClick={() => {\n          setSelected(entry);\n          fetchRelated(entry.id);\n        }}\n      >\n        <td className=\"px-2 py-1\">{entry.timestamp}</td>\n        <td className=\"px-2 py-1\">\n          <Badge\n            variant={\n              entry.status === \"approved\"\n                ? \"success\"\n                : entry.status === \"denied\"\n                ? \"destructive\"\n                : entry.status === \"pending\"\n                ? \"secondary\"\n                : \"default\"\n            }\n          >\n            {entry.status}\n          </Badge>\n        </td>\n        <td className=\"px-2 py-1\">{entry.user || \"\"}</td>\n        <td className=\"px-2 py-1\">{entry.type || \"\"}</td>\n        <td className=\"px-2 py-1 font-mono\">{entry.path || \"\"}</td>\n        <td className=\"px-2 py-1 font-mono\">{entry.id.slice(0, 8)}</td>\n        <td className=\"px-2 py-1\">\n          {entry.comment ?", "mimetype": "text/plain", "start_char_idx": 4007, "end_char_idx": 6298, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "22ed50f8-bfac-447a-8a55-1ecf47f1451e": {"__data__": {"id_": "22ed50f8-bfac-447a-8a55-1ecf47f1451e", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "442df71dbf79300159750ab15180b85975a29f89d2985dc2284fb156ecd06ff5", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "d2784268-cae6-404f-bc18-0e971589b590", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "cb95432170d6a5f58b03a437e4429c36757a86b4e0950fdda49bdb96418414ac", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "c078f711-8fa0-4bc4-a942-f73a125586ac", "node_type": "1", "metadata": {}, "hash": "d72abc6a3db9762afe8e4b39b32e575453efb92e2ae131e123408c84a4477def", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"success\"\n                : entry.status === \"denied\"\n                ? \"destructive\"\n                : entry.status === \"pending\"\n                ? \"secondary\"\n                : \"default\"\n            }\n          >\n            {entry.status}\n          </Badge>\n        </td>\n        <td className=\"px-2 py-1\">{entry.user || \"\"}</td>\n        <td className=\"px-2 py-1\">{entry.type || \"\"}</td>\n        <td className=\"px-2 py-1 font-mono\">{entry.path || \"\"}</td>\n        <td className=\"px-2 py-1 font-mono\">{entry.id.slice(0, 8)}</td>\n        <td className=\"px-2 py-1\">\n          {entry.comment ? (\n            <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n              <SafeMarkdown>{entry.comment}</SafeMarkdown>\n            </div>\n          ) : (\n            \"\"\n          )}\n        </td>\n      </tr>\n    );\n  });\n\n  if (selected && typeof selected.comment !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof selected.comment, selected.comment);\n  }\n  if (relatedAction?.action?.context && typeof relatedAction.action.context !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof relatedAction.action.context, relatedAction.action.context);\n  }\n  if (relatedAction?.action?.rationale && typeof relatedAction.action.rationale !== \"string\") {\n    console.log(\n      \"DEBUG 418:\",\n      typeof relatedAction.action.rationale,\n      relatedAction.action.rationale\n    );\n  }\n  if (relatedAction?.action?.diff && typeof relatedAction.action.diff !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof relatedAction.action.diff, relatedAction.action.diff);\n  }\n  if (relatedAction?.history) {\n    for (const h of relatedAction.history) {\n      if (h.comment && typeof h.comment !== \"string\") {\n        console.log(\"DEBUG 418:\", typeof h.comment, h.comment);\n      }\n    }\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-8\">\n      <h2 className=\"font-bold text-xl mb-6\">\ud83d\udee1\ufe0f Audit Log & Operator Panel</h2>\n      <div className=\"flex gap-2 mb-4 items-end\">\n        <input\n          placeholder=\"\ud83d\udd0e Search user/type/path/comment/ID\"\n          className=\"border rounded px-2 py-1 w-60 text-sm\"\n          value={search}\n          onChange={e => setSearch(e.target.value)}\n        />\n        <input\n          placeholder=\"Filter user\"\n          className=\"border rounded px-2 py-1 text-xs\"\n          value={filter.user || \"\"}\n          onChange={e => setFilter(f => ({ ...f, user: e.target.value }))}\n        />\n        <input\n          placeholder=\"Filter type\"\n          className=\"border rounded px-2 py-1 text-xs\"\n          value={filter.type || \"\"}\n          onChange={e => setFilter(f => ({ ...f, type: e.target.value }))}\n        />\n        <select\n          className=\"border rounded px-2 py-1 text-xs\"\n          value={filter.status || \"\"}\n          onChange={e => setFilter(f => ({ ...f, status: e.target.value }))}\n        >\n          <option value=\"\">Status</option>\n          <option value=\"approved\">approved</option>\n          <option value=\"denied\">denied</option>\n          <option value=\"executed\">executed</option>\n          <option value=\"pending\">pending</option>\n        </select>\n        <Button onClick={() => fetchLog()} className=\"ml-2\">Refresh</Button>\n        <Button\n          variant=\"outline\"\n          disabled={exporting}\n          onClick={() => exportLog(\"json\")}\n        >\n          Export JSON\n        </Button>\n        <Button\n          variant=\"outline\"\n          disabled={exporting}\n          onClick={() => exportLog(\"csv\")}\n        >\n          Export CSV\n        </Button>\n      </div>\n      <div className=\"bg-gray-100 rounded-md p-2 max-h-[60vh] overflow-auto text-xs\">\n        {filtered.length === 0 && (\n          <div className=\"text-muted-foreground text-center py-8\">\n            No log entries match the filters.", "mimetype": "text/plain", "start_char_idx": 5706, "end_char_idx": 9483, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c078f711-8fa0-4bc4-a942-f73a125586ac": {"__data__": {"id_": "c078f711-8fa0-4bc4-a942-f73a125586ac", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "442df71dbf79300159750ab15180b85975a29f89d2985dc2284fb156ecd06ff5", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "22ed50f8-bfac-447a-8a55-1ecf47f1451e", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b31e2138b6414f4c6e9b9b8a54865adcc7f73377a6af868e794d3d5c79d82ad3", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b7abab8e-bcf6-4615-b3cc-4da8a84472d5", "node_type": "1", "metadata": {}, "hash": "8ae553d866a8640cf9c3e25353e62ed6aee5bd5099d52700cfdac3338b52f327", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "</div>\n        )}\n        <table className=\"w-full\">\n          <thead>\n            <tr className=\"font-semibold text-gray-700 bg-gray-200\">\n              <th className=\"px-2 py-1 text-left\">Time</th>\n              <th className=\"px-2 py-1 text-left\">Status</th>\n              <th className=\"px-2 py-1 text-left\">User</th>\n              <th className=\"px-2 py-1 text-left\">Type</th>\n              <th className=\"px-2 py-1 text-left\">Path</th>\n              <th className=\"px-2 py-1 text-left\">ID</th>\n              <th className=\"px-2 py-1 text-left\">Comment</th>\n            </tr>\n          </thead>\n          <tbody>{rows}</tbody>\n        </table>\n      </div>\n      <div className=\"text-xs text-gray-400 mt-3\">\n        Tip: Click any row for full drilldown: context, rationale, diff, timeline, and more.\n      </div>\n\n      {/* === Per-action Modal Drilldown === */}\n      {selected && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black/30 z-50\">\n          <div className=\"bg-white p-6 rounded shadow-lg w-full max-w-xl relative\">\n            <button className=\"absolute top-2 right-3 text-xl\" onClick={() => { setSelected(null); setRelatedAction(null); }}>&times;</button>\n            <h3 className=\"font-bold mb-2\">Action Detail (#{selected.id.slice(0, 8)})</h3>\n            <div className=\"mb-2 text-xs\">\n              <strong>Status:</strong>{\" \"}\n              <Badge variant={\n                selected.status === \"approved\" ? \"success\" :\n                selected.status === \"denied\" ? \"destructive\" : \"secondary\"\n              }>\n                {selected.status}\n              </Badge><br />\n              <strong>User:</strong> {selected.user}<br />\n              <strong>Type:</strong> {selected.type}<br />\n              <strong>Path:</strong> {selected.path}<br />\n              <strong>Comment:</strong>{\" \"}\n              {selected.comment ?", "mimetype": "text/plain", "start_char_idx": 9494, "end_char_idx": 11381, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b7abab8e-bcf6-4615-b3cc-4da8a84472d5": {"__data__": {"id_": "b7abab8e-bcf6-4615-b3cc-4da8a84472d5", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "442df71dbf79300159750ab15180b85975a29f89d2985dc2284fb156ecd06ff5", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "c078f711-8fa0-4bc4-a942-f73a125586ac", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/AuditPanel/AuditPanel.tsx", "file_name": "AuditPanel.tsx", "file_size": 14146, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "fa174d57ca4ce1b135c32fb8855eb0a5725dfb523f9344b21fc7d304c357740b", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"success\" :\n                selected.status === \"denied\" ? \"destructive\" : \"secondary\"\n              }>\n                {selected.status}\n              </Badge><br />\n              <strong>User:</strong> {selected.user}<br />\n              <strong>Type:</strong> {selected.type}<br />\n              <strong>Path:</strong> {selected.path}<br />\n              <strong>Comment:</strong>{\" \"}\n              {selected.comment ? (\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{selected.comment}</SafeMarkdown>\n                </div>\n              ) : \"\"}\n              <br />\n              <strong>Timestamp:</strong> {selected.timestamp}\n            </div>\n            {relatedAction?.action?.context && (\n              <details>\n                <summary className=\"cursor-pointer text-blue-700 mb-2\">View Agent Context</summary>\n                <div className=\"bg-gray-50 p-2 rounded text-xs max-h-40 overflow-auto whitespace-pre-wrap\">\n                  <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                    <SafeMarkdown>{relatedAction.action.context}</SafeMarkdown>\n                  </div>\n                </div>\n              </details>\n            )}\n            {relatedAction?.action?.rationale && (\n              <div className=\"text-xs italic mb-2\">\n                <strong>Agent rationale:</strong>{\" \"}\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{relatedAction.action.rationale}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n            {relatedAction?.action?.diff && (\n              <details>\n                <summary className=\"cursor-pointer text-blue-700 mb-2\">View Diff</summary>\n                <div className=\"bg-yellow-50 p-2 rounded text-xs max-h-40 overflow-auto whitespace-pre-wrap\">\n                  <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                    <SafeMarkdown>{relatedAction.action.diff}</SafeMarkdown>\n                  </div>\n                </div>\n              </details>\n            )}\n            {relatedAction?.history && (\n              <div>\n                <h4 className=\"font-semibold mt-2 mb-1 text-sm\">Timeline</h4>\n                <ul className=\"bg-gray-100 p-2 rounded text-xs max-h-32 overflow-auto border\">\n                  {relatedAction.history.map((h, i) => (\n                    <li key={i}>\n                      <span className=\"font-mono\">{h.timestamp}</span> \u2022 <Badge>{h.status}</Badge>\n                      {h.user && <span className=\"ml-2 text-blue-700\">{h.user}</span>}\n                      {h.comment && (\n                        <span className=\"ml-2 italic\">\n                          <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                            <SafeMarkdown>{h.comment}</SafeMarkdown>\n                          </div>\n                        </span>\n                      )}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 10959, "end_char_idx": 14135, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "f497744a-84cd-4c7a-a381-f2115eb122bf": {"__data__": {"id_": "f497744a-84cd-4c7a-a381-f2115eb122bf", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexEditor.tsx", "file_name": "CodexEditor.tsx", "file_size": 842, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "42752c63-cbe8-4f2c-b3e9-dc47a71c9cbe", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexEditor.tsx", "file_name": "CodexEditor.tsx", "file_size": 842, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "996e42097ba24db50ba550bf124c8ed3672ebb4a5bff5ad38157cab6ca7558d2", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/Codex/CodexEditor.tsx\n// Purpose: Simple text/code editor for Codex agent\n// Updated: 2025-06-30\n\nimport { Dispatch, SetStateAction } from \"react\";\n\nexport interface Props {\n  code: string; // Source code being edited\n  setCode: Dispatch<SetStateAction<string>>; // Update function\n}\n\nexport default function CodexEditor({ code, setCode }: Props) {\n  return (\n    <div>\n      <label htmlFor=\"codex-editor\" className=\"block text-sm font-medium mb-1\">\n        Source Code\n      </label>\n      <textarea\n        id=\"codex-editor\"\n        value={code}\n        onChange={(e) => setCode(e.target.value)}\n        className=\"w-full h-48 p-2 border rounded font-mono resize-y\"\n        spellCheck={false}\n        placeholder=\"Paste or type your code here\u2026\"\n        aria-label=\"Code input for Codex\"\n      />\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 839, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "16644408-df7b-4ca2-8c56-5a31ee5a60cb": {"__data__": {"id_": "16644408-df7b-4ca2-8c56-5a31ee5a60cb", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPatchView.tsx", "file_name": "CodexPatchView.tsx", "file_size": 1321, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "fbde4216-4dc6-418c-ad99-bfdd2a9e4306", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPatchView.tsx", "file_name": "CodexPatchView.tsx", "file_size": 1321, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "80ba57f3240180692914cddf0f6b2c486e7e95c7a8f446ffc3f8ebda0f7152f6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/Codex/CodexPatchView.tsx\n// Purpose: Displays the generated code patch/result from the Codex agent.\n//          All Markdown/code rendering MUST go through SafeMarkdown.\n// Updated: 2025-07-01\n\n\"use client\";\n\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\n\ninterface Props {\n  patch: string;\n  loading?: boolean; // Optionally show loading state (prop-driven)\n}\n\nexport default function CodexPatchView({ patch, loading = false }: Props) {\n  if (typeof patch !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof patch, patch);\n  }\n  return (\n    <div className=\"mt-4\">\n      <label htmlFor=\"codex-patch\" className=\"block text-sm font-medium mb-1\">\n        Generated Patch\n      </label>\n      <div\n        id=\"codex-patch\"\n        className=\"w-full max-h-[500px] overflow-auto bg-black text-green-400 p-4 rounded text-sm whitespace-pre-wrap\"\n        aria-busy={loading}\n      >\n        {/* DO NOT render markdown/code any other way\u2014SafeMarkdown only */}\n        {loading ? (\n          \"\u23f3 Codex is generating your patch...\"\n        ) : patch?.trim() ? (\n          <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n            <SafeMarkdown>{patch}</SafeMarkdown>\n          </div>\n        ) : (\n          \"No patch yet.\"\n        )}\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1316, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "bc089606-c7b0-4cf8-bbfe-b33584138e17": {"__data__": {"id_": "bc089606-c7b0-4cf8-bbfe-b33584138e17", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPromptBar.tsx", "file_name": "CodexPromptBar.tsx", "file_size": 1423, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "fd39eef8-3bbe-410d-a4aa-b462b6185f01", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Codex/CodexPromptBar.tsx", "file_name": "CodexPromptBar.tsx", "file_size": 1423, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8fd285e924de23ba920324f4b14497fd177fa8748f214ff326018fc9161277ed", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/Codex/CodexPromptBar.tsx\n// Purpose: Prompt input bar for Codex code editing agent\n// Updated: 2025-06-30\n\n\"use client\";\n\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface Props {\n  prompt: string;                 // Prompt/instruction for the code agent\n  setPrompt: (val: string) => void; // Handler to update prompt in parent state\n  onSubmit: () => void;           // Handler called when user submits\n  loading?: boolean;              // Show loading state, disable input (prop-driven)\n}\n\nexport default function CodexPromptBar({ prompt, setPrompt, onSubmit, loading = false }: Props) {\n  // Handle Enter key to submit (unless Shift is held for multi-line, if ever needed)\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey && prompt.trim() && !loading) {\n      e.preventDefault();\n      onSubmit();\n    }\n  };\n\n  return (\n    <div className=\"flex items-center gap-4\">\n      <Input\n        value={prompt}\n        onChange={(e) => setPrompt(e.target.value)}\n        onKeyDown={handleKeyDown}\n        placeholder=\"What should Codex do? (e.g., Add docstrings)\"\n        className=\"flex-1\"\n        disabled={loading}\n      />\n      <Button onClick={onSubmit} disabled={loading || !prompt.trim()}>\n        {loading ? \"Running...\" : \"Run\"}\n      </Button>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1422, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d6b5ac67-7e22-499c-abec-6d6426fa0ce0": {"__data__": {"id_": "d6b5ac67-7e22-499c-abec-6d6426fa0ce0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Codex/index.ts", "file_name": "index.ts", "file_size": 277, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "03097629-6de1-41d7-80b3-8f63ec4b85ee", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Codex/index.ts", "file_name": "index.ts", "file_size": 277, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e67af72a9bd3375dc6ae69b8b14257241d2cb0eef7fabc2c4201aa9d9738d8c0", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/Codex/index.ts\n// Purpose: Barrel exports for Codex components\n\nexport { default as CodexEditor } from \"./CodexEditor\";\nexport { default as CodexPromptBar } from \"./CodexPromptBar\";\nexport { default as CodexPatchView } from \"./CodexPatchView\";", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 276, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "08443eb7-dbcf-4482-80fd-ca80b3b3c6b6": {"__data__": {"id_": "08443eb7-dbcf-4482-80fd-ca80b3b3c6b6", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Codex/page.tsx", "file_name": "page.tsx", "file_size": 2108, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "7677e1cc-8bfb-4841-9763-b65dc677f4ca", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Codex/page.tsx", "file_name": "page.tsx", "file_size": 2108, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "be6f1bde7374be12a52e62351a3d9896f664942e0bf4f8517feccf6e797c7f09", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/Codex/CodexPage.tsx\n// Purpose: UI for Codex agent with code editor, prompt bar, and streaming patch view\n// Updated: 2025-06-30\n\n\"use client\";\n\nimport { CodexEditor, CodexPromptBar, CodexPatchView } from \"@/components/Codex\";\nimport { useState } from \"react\";\nimport { API_ROOT } from \"@/lib/api\";\n\nexport default function CodexPage() {\n  const [code, setCode] = useState(\"\");           // User's source code\n  const [prompt, setPrompt] = useState(\"\");       // Editing instruction (prompt)\n  const [streamingPatch, setStreamingPatch] = useState(\"\"); // Live code patch output\n  const [loading, setLoading] = useState(false);  // Loading state for UX\n\n  // Handler for submitting the edit prompt to the Codex agent\n  const handleSubmit = async () => {\n    if (!prompt.trim() || !code.trim() || loading) return;\n\n    setStreamingPatch(\"\u23f3 Working...\");\n    setLoading(true);\n\n    try {\n      const res = await fetch(`${API_ROOT}/ask/codex_stream`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ question: prompt, context: code }),\n      });\n\n      const reader = res.body?.getReader();\n      const decoder = new TextDecoder();\n      let patch = \"\";\n\n      while (reader) {\n        const { value, done } = await reader.read();\n        if (done) break;\n        patch += decoder.decode(value, { stream: true });\n        setStreamingPatch(patch);\n      }\n    } catch {\n      setStreamingPatch(\"\u274c Error streaming patch from Codex agent.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      <h1 className=\"text-2xl font-bold\">\ud83e\udde0 Codex \u2014 Code Editing Agent</h1>\n      {/* Code input area */}\n      <CodexEditor code={code} setCode={setCode} />\n\n      {/* Prompt bar for edit instructions */}\n      <CodexPromptBar\n        prompt={prompt}\n        setPrompt={setPrompt}\n        onSubmit={handleSubmit}\n        loading={loading}\n      />\n\n      {/* Patch/result area */}\n      <CodexPatchView patch={streamingPatch} loading={loading} />\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2098, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c28e4624-a0d4-4df7-ad73-72caeccc21b0": {"__data__": {"id_": "c28e4624-a0d4-4df7-ad73-72caeccc21b0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "1ce7d98c-a264-4e79-978e-255958397231", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "deef0e3f48c4859508d90905a6aa92bc346e588746c746c2f088abc10b98ec91", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "702b1cb1-a863-4164-84ca-42fa7abffe4f", "node_type": "1", "metadata": {}, "hash": "8348f415bde548b00a8639a40d4b25066ca39bef8b4dbc7f98e5f23b7ceb5d23", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/DocsSyncPanel.tsx\n// Purpose: UI panel for syncing, refreshing, and reindexing knowledge base docs. \n//          All status and result messages are rendered with SafeMarkdown for rich, safe output.\n\n\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\nexport default function DocsSyncPanel() {\n  const [status, setStatus] = useState<string | null>(null);\n  const [files, setFiles] = useState<string[]>([]);\n  const [loading, setLoading] = useState<boolean>(false);\n\n  // New state for reindex button\n  const [reindexStatus, setReindexStatus] = useState<string | null>(null);\n  const [reindexLoading, setReindexLoading] = useState<boolean>(false);\n\n  /**\n   * Trigger a sync operation at the given endpoint and handle results.\n   * @param endpoint 'sync', 'refresh_kb', or 'full_sync'\n   */\n  const triggerSync = async (endpoint: string) => {\n    if (!API_ROOT) {\n      setStatus(toMDString(\"\u274c API URL not configured\"));\n      return;\n    }\n    setStatus(toMDString(\"\u23f3 Running...\"));\n    setFiles([]);\n    setLoading(true);\n    try {\n      const res = await fetch(`${API_ROOT}/docs/${endpoint}`, { method: \"POST\" });\n      if (!res.ok) {\n        throw new Error(`Request failed: ${res.status}`);\n      }\n      const data = await res.json();\n      if (Array.isArray(data.synced_docs)) {\n        setFiles(data.synced_docs);\n        setStatus(toMDString(`\u2705 Synced ${data.synced_docs.length} docs.`));\n      } else if (data.message) {\n        setStatus(toMDString(`\u2705 ${data.message}`));\n      } else {\n        setStatus(toMDString(\"\u2705 Operation completed.\"));\n      }\n    } catch (err) {\n      console.error(\"DocsSync error:\", err);\n      setStatus(toMDString(\"\u274c Failed to sync. See console for details.\"));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // --- NEW: Trigger a KB reindex (admin only) ---\n  const triggerReindex = async () => {\n    if (!API_ROOT) {\n      setReindexStatus(toMDString(\"\u274c API URL not configured\"));\n      return;\n    }\n    setReindexStatus(toMDString(\"\u23f3 Reindexing...\"));\n    setReindexLoading(true);\n    try {\n      const res = await fetch(`${API_ROOT}/admin/trigger_reindex`, {\n        method: \"POST\",\n        headers: {\n          // If you use a static admin API key for local, include it here\n          // For production, secure this!\n          \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\",\n        },\n      });\n      const data = await res.json();\n      if (res.ok) {\n        setReindexStatus(toMDString(`\u2705 ${data.message || \"Reindex complete.\"}`));\n      } else {\n        setReindexStatus(toMDString(`\u274c ${data.detail || \"Reindex failed.\"}`));\n      }\n    } catch (err) {\n      console.error(\"Reindex error:\", err);\n      setReindexStatus(toMDString(\"\u274c Failed to reindex. See console for details.\"));\n    } finally {\n      setReindexLoading(false);\n    }\n  };\n\n  if (typeof status !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof status, status);\n  }\n  if (typeof reindexStatus !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof reindexStatus, reindexStatus);\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold\">\ud83e\udde0 Sync & Refresh Docs</h2>\n      <div className=\"flex flex-wrap gap-2\">\n        <Button onClick={() => triggerSync(\"sync\")} disabled={loading}>\n          {loading ? \"\u23f3 Syncing...\" : \"\ud83d\udd04 Sync Google Docs\"}\n        </Button>\n        <Button onClick={() => triggerSync(\"refresh_kb\")} disabled={loading}>\n          {loading ? \"\u23f3 Refreshing...\" : \"\ud83e\udde0 Refresh KB\"}\n        </Button>\n        <Button onClick={() => triggerSync(\"full_sync\")} disabled={loading}>\n          {loading ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3778, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "702b1cb1-a863-4164-84ca-42fa7abffe4f": {"__data__": {"id_": "702b1cb1-a863-4164-84ca-42fa7abffe4f", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "1ce7d98c-a264-4e79-978e-255958397231", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "deef0e3f48c4859508d90905a6aa92bc346e588746c746c2f088abc10b98ec91", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "c28e4624-a0d4-4df7-ad73-72caeccc21b0", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/DocsSyncPanel.tsx", "file_name": "DocsSyncPanel.tsx", "file_size": 5158, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "6c7a9c09e50a3ec0cac90df9df7fce70e44b03b8fea32e4c0475e098a882aafc", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"\u23f3 Syncing...\" : \"\ud83d\udd04 Sync Google Docs\"}\n        </Button>\n        <Button onClick={() => triggerSync(\"refresh_kb\")} disabled={loading}>\n          {loading ? \"\u23f3 Refreshing...\" : \"\ud83e\udde0 Refresh KB\"}\n        </Button>\n        <Button onClick={() => triggerSync(\"full_sync\")} disabled={loading}>\n          {loading ? \"\u23f3 Working...\" : \"\ud83d\ude80 Full Sync\"}\n        </Button>\n      </div>\n\n      {/* Status messages rendered as markdown */}\n      {status && (\n        <div className=\"mt-2 text-sm text-muted-foreground\">\n          <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n            <SafeMarkdown>{status}</SafeMarkdown>\n          </div>\n        </div>\n      )}\n\n      {files.length > 0 && (\n        <ul className=\"mt-2 list-disc list-inside\">\n          {files.map((f) => (\n            <li key={f} className=\"text-sm\">{f}</li>\n          ))}\n        </ul>\n      )}\n\n      {/* Divider */}\n      <hr className=\"my-4\" />\n\n      {/* Reindex Button */}\n      <div>\n        <h3 className=\"text-base font-medium mb-2\">Admin: Reindex KB</h3>\n        <Button\n          onClick={triggerReindex}\n          disabled={reindexLoading}\n          variant=\"destructive\"\n          className=\"mb-2\"\n        >\n          {reindexLoading ? \"\u23f3 Reindexing...\" : \"\ud83d\udee0\ufe0f Reindex Now\"}\n        </Button>\n        {reindexStatus && (\n          <div className={`mt-1 text-sm ${reindexStatus.startsWith(\"\u2705\") ? \"text-green-600\" : \"text-red-500\"}`}>\n            <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n              <SafeMarkdown>{reindexStatus}</SafeMarkdown>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 3471, "end_char_idx": 5108, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "016288e2-5e2d-4d41-80bd-35972a6e3067": {"__data__": {"id_": "016288e2-5e2d-4d41-80bd-35972a6e3067", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d11682ae-4b7e-4449-93fa-15f00d301caa", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1af88e648f5ba3b52bbba2ddb91c2c844e1abdcceb651c72f2d1fcd4634ec24f", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "1442fb0d-f021-4e20-a455-cd4e7bc50330", "node_type": "1", "metadata": {}, "hash": "63e7876707afe439daa1522cd23f0de76dc771e33a82805a4888fcf0f8e573d7", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/DocsViewer.tsx\n// Purpose: Browse, manage, and debug semantic context docs with tier-aware metadata.\n//          Renders all doc/snippet/context output via SafeMarkdown for safety/uniformity.\n\n\"use client\";\n\nimport { API_ROOT } from \"@/lib/api\";\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\n\n// --- Types for KB docs and semantic search ---\ntype KBMeta = {\n  path: string;\n  doc_id?: string;\n  tier?: string;\n  source?: string;\n  last_modified?: string;\n};\n\ntype KBHit = {\n  file?: string;\n  snippet: string;\n  score?: number;\n  type?: string;\n  line?: number;\n};\n\nconst apiUrl = API_ROOT || \"\";\n\n// --- Main DocsViewer Component ---\nexport default function DocsViewer() {\n  const [tab, setTab] = useState<\"docs\" | \"search\" | \"context\">(\"docs\");\n  const [docs, setDocs] = useState<KBMeta[]>([]);\n  const [activeDoc, setActiveDoc] = useState<string | null>(null);\n  const [content, setContent] = useState<string>(\"\");\n\n  const [search, setSearch] = useState(\"\");\n  const [hits, setHits] = useState<KBHit[]>([]);\n  const [selectedHit, setSelectedHit] = useState<number | null>(null);\n  const [searchLoading, setSearchLoading] = useState(false);\n\n  const [ctxQuestion, setCtxQuestion] = useState(\"\");\n  const [ctxLoading, setCtxLoading] = useState(false);\n  const [ctxResult, setCtxResult] = useState<string>(\"\");\n\n  useEffect(() => {\n    if (tab === \"docs\") loadDocs();\n  }, [tab]);\n\n  useEffect(() => {\n    if (activeDoc) loadContent(activeDoc);\n    else setContent(\"\");\n  }, [activeDoc]);\n\n  async function loadDocs() {\n    try {\n      const res = await fetch(`${apiUrl}/docs/list`);\n      const data = await res.json();\n      setDocs(data.files || []);\n    } catch {\n      setDocs([]);\n    }\n  }\n\n  async function loadContent(path: string) {\n    try {\n      const res = await fetch(`${apiUrl}/docs/view?path=${encodeURIComponent(path)}`);\n      const data = await res.json();\n      setContent(data.content || \"\");\n    } catch {\n      setContent(\"Failed to load doc.\");\n    }\n  }\n\n  async function doSearch(e?: React.FormEvent) {\n    if (e) e.preventDefault();\n    setSearchLoading(true);\n    setHits([]);\n    setSelectedHit(null);\n    try {\n      const res = await fetch(`${apiUrl}/kb/search?query=${encodeURIComponent(search)}`);\n      const data = await res.json();\n      setHits(data.results || []);\n    } catch {\n      setHits([]);\n    }\n    setSearchLoading(false);\n  }\n\n  async function fetchContextForPrompt(e?: React.FormEvent) {\n    if (e) e.preventDefault();\n    if (!ctxQuestion) return;\n    setCtxLoading(true);\n    setCtxResult(\"\");\n    try {\n      const res = await fetch(`${apiUrl}/ask?question=${encodeURIComponent(ctxQuestion)}&debug=true`);\n      const data = await res.json();\n      setCtxResult(data.context || \"No context returned.\");\n    } catch {\n      setCtxResult(\"Failed to fetch context window.\");\n    }\n    setCtxLoading(false);\n  }\n\n  if (typeof content !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof content, content);\n  }\n  for (const hit of hits) {\n    if (typeof hit.snippet !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof hit.snippet, hit.snippet);\n    }\n  }\n  if (ctxResult && typeof ctxResult !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof ctxResult, ctxResult);\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto py-6\">\n      <div className=\"flex gap-4 mb-4\">\n        <Button variant={tab === \"docs\" ? \"default\" : \"outline\"} onClick={() => setTab(\"docs\")}>\ud83d\udcdd Docs</Button>\n        <Button variant={tab === \"search\" ? \"default\" : \"outline\"} onClick={() => setTab(\"search\")}>\ud83d\udd0d Semantic Search</Button>\n        <Button variant={tab === \"context\" ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3739, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "1442fb0d-f021-4e20-a455-cd4e7bc50330": {"__data__": {"id_": "1442fb0d-f021-4e20-a455-cd4e7bc50330", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d11682ae-4b7e-4449-93fa-15f00d301caa", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1af88e648f5ba3b52bbba2ddb91c2c844e1abdcceb651c72f2d1fcd4634ec24f", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "016288e2-5e2d-4d41-80bd-35972a6e3067", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "a33e44dd33ad5060b91ff716cb74b4e70a1ff933ab90545fb19b67c1d883da45", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "0033a319-25c1-4402-aec8-0307db0e55e7", "node_type": "1", "metadata": {}, "hash": "0a9c3d89e2f70e07a6ee363990c8c7df204a1564641ffe71a83710da1c3add3d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"default\" : \"outline\"} onClick={() => setTab(\"docs\")}>\ud83d\udcdd Docs</Button>\n        <Button variant={tab === \"search\" ? \"default\" : \"outline\"} onClick={() => setTab(\"search\")}>\ud83d\udd0d Semantic Search</Button>\n        <Button variant={tab === \"context\" ? \"default\" : \"outline\"} onClick={() => setTab(\"context\")}>\ud83e\udde0 Agent Context</Button>\n      </div>\n\n      {tab === \"docs\" && (\n        <div className=\"grid grid-cols-1 md:grid-cols-6 gap-6\">\n          <div className=\"space-y-4 col-span-1 md:col-span-1\">\n            <div>\n              <div className=\"font-semibold mb-2\">Knowledge Base Files</div>\n              <ul className=\"space-y-1 text-xs max-h-80 overflow-y-auto\">\n                {docs.map((doc) => (\n                  <li key={doc.path}>\n                    <button\n                      className={`w-full text-left py-1 px-2 rounded hover:bg-accent/40 ${activeDoc === doc.path ? \"bg-accent/30 font-bold\" : \"\"}`}\n                      onClick={() => setActiveDoc(doc.path)}\n                    >\n                      {doc.path}\n                      {doc.tier && <span className=\"ml-2 text-emerald-600 font-semibold\">[{doc.tier}]</span>}\n                      {doc.source && <span className=\"ml-1 text-xs text-gray-400\">({doc.source})</span>}\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          </div>\n          <div className=\"col-span-5\">\n            <h2 className=\"font-semibold mb-2\">{activeDoc || \"Select a document\"}</h2>\n            <div className=\"h-[400px] overflow-auto border rounded-md p-4 whitespace-pre-wrap text-sm bg-background\">\n              {content ? (\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{content}</SafeMarkdown>\n                </div>\n              ) : (\n                \"Select a document to view its content.\"\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {tab === \"search\" && (\n        <div className=\"grid grid-cols-1 md:grid-cols-6 gap-6\">\n          <div className=\"space-y-4 col-span-1\">\n            <form className=\"flex gap-2 mb-2\" onSubmit={doSearch}>\n              <input\n                className=\"border px-2 py-1 rounded w-full\"\n                placeholder=\"Search docs/knowledge base\u2026\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n              />\n              <Button type=\"submit\" size=\"sm\" disabled={searchLoading}>\n                {searchLoading ? \"\u2026\" : \"Search\"}\n              </Button>\n            </form>\n            <ul className=\"space-y-1 text-xs max-h-72 overflow-y-auto\">\n              {hits.map((hit, i) => (\n                <li key={i}>\n                  <button\n                    className={`w-full text-left py-1 px-2 rounded hover:bg-accent/30 ${selectedHit === i ? \"bg-accent/40 font-bold\" : \"\"}`}\n                    onClick={() => setSelectedHit(i)}\n                  >\n                    {hit.file || \"Semantic Snippet\"}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          </div>\n          <div className=\"col-span-5\">\n            {selectedHit !== null && hits[selectedHit] ? (\n              <div>\n                <div className=\"font-bold mb-2\">{hits[selectedHit].file || \"Semantic Snippet\"}</div>\n                <div className=\"bg-gray-100 p-3 rounded max-h-[70vh] overflow-y-auto whitespace-pre-wrap text-xs\">\n                  <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                    <SafeMarkdown>{hits[selectedHit].snippet}</SafeMarkdown>\n                  </div>\n                </div>\n                <div className=\"text-xs text-gray-500 mt-2\">\n                  Score: {hits[selectedHit].score?.toFixed(2) || \"N/A\"} | Type: {hits[selectedHit].type || \"?\"}\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-gray-500 text-center pt-10\">\n                {searchLoading ? \"Searching\u2026\" : \"Select a semantic hit to preview context.\"}", "mimetype": "text/plain", "start_char_idx": 3498, "end_char_idx": 7552, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0033a319-25c1-4402-aec8-0307db0e55e7": {"__data__": {"id_": "0033a319-25c1-4402-aec8-0307db0e55e7", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d11682ae-4b7e-4449-93fa-15f00d301caa", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1af88e648f5ba3b52bbba2ddb91c2c844e1abdcceb651c72f2d1fcd4634ec24f", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "1442fb0d-f021-4e20-a455-cd4e7bc50330", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/DocsViewer/DocsViewer.tsx", "file_name": "DocsViewer.tsx", "file_size": 8731, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b7431c71986367787c0f3c945ca43fa5b5f24a331860091849444850dfb1a085", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "(\n              <div>\n                <div className=\"font-bold mb-2\">{hits[selectedHit].file || \"Semantic Snippet\"}</div>\n                <div className=\"bg-gray-100 p-3 rounded max-h-[70vh] overflow-y-auto whitespace-pre-wrap text-xs\">\n                  <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                    <SafeMarkdown>{hits[selectedHit].snippet}</SafeMarkdown>\n                  </div>\n                </div>\n                <div className=\"text-xs text-gray-500 mt-2\">\n                  Score: {hits[selectedHit].score?.toFixed(2) || \"N/A\"} | Type: {hits[selectedHit].type || \"?\"}\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-gray-500 text-center pt-10\">\n                {searchLoading ? \"Searching\u2026\" : \"Select a semantic hit to preview context.\"}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {tab === \"context\" && (\n        <div className=\"max-w-2xl mx-auto mt-8\">\n          <form className=\"flex gap-2 mb-4\" onSubmit={fetchContextForPrompt}>\n            <input\n              className=\"border px-2 py-1 rounded w-full\"\n              placeholder=\"Type a user/agent prompt\u2026\"\n              value={ctxQuestion}\n              onChange={(e) => setCtxQuestion(e.target.value)}\n            />\n            <Button type=\"submit\" disabled={ctxLoading}>\n              {ctxLoading ? \"\u2026\" : \"Show Context\"}\n            </Button>\n          </form>\n          <div className=\"h-[400px] overflow-auto border rounded-md p-4 whitespace-pre-wrap text-xs bg-gray-50\">\n            {ctxLoading\n              ? \"Fetching context\u2026\"\n              : ctxResult\n              ? (\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{ctxResult}</SafeMarkdown>\n                </div>\n              )\n              : \"Enter a prompt to see what context the agent would use.\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 6713, "end_char_idx": 8709, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "47ceb626-b1ca-4aa0-b952-07b4e65d35fb": {"__data__": {"id_": "47ceb626-b1ca-4aa0-b952-07b4e65d35fb", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/GmailOps/GmailOpsPanel.tsx", "file_name": "GmailOpsPanel.tsx", "file_size": 3509, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "39673939-c4bd-45c9-9db3-a4e30dcaef1b", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/GmailOps/GmailOpsPanel.tsx", "file_name": "GmailOpsPanel.tsx", "file_size": 3509, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1c1350fb09484e42e0edcfda372d0d58cc528bfe5d38145f3fda2c826c61d06c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/GmailOps/GmailOpsPanel.tsx\n// Purpose: Panel to send and view emails, now with SafeMarkdown rendering for messages and snippets.\n\n\"use client\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\n// Explicitly type the Email shape\ntype Email = {\n  from: string;\n  subject: string;\n  date: string;\n  snippet: string;\n};\n\nexport default function GmailOpsPanel() {\n  const [to, setTo] = useState(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [body, setBody] = useState(\"\");\n  const [msg, setMsg] = useState<string | null>(null);\n  const [emails, setEmails] = useState<Email[]>([]);\n\n  async function send() {\n    const res = await fetch(`${API_ROOT}/control/send_email`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" },\n      body: JSON.stringify({ to_email: to, subject, body })\n    });\n    const data = await res.json();\n    setMsg(\n      toMDString(\n        data.status === \"sent\" ? \"Email sent!\" : `Failed: ${data.detail}`\n      )\n    );\n  }\n\n  async function list() {\n    const res = await fetch(`${API_ROOT}/control/list_email`, {\n      headers: { \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" }\n    });\n    const data = await res.json();\n    const mapped = Array.isArray(data.emails)\n      ? (data.emails as Email[]).map((em) => ({\n          ...em,\n          snippet: toMDString(em.snippet),\n        }))\n      : [];\n    setEmails(mapped);\n  }\n\n  if (msg && typeof msg !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof msg, msg);\n  }\n  for (const em of emails) {\n    if (typeof em.snippet !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof em.snippet, em.snippet);\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto my-8 space-y-4\">\n      <div>\n        <h3 className=\"font-bold mb-2\">Send Email</h3>\n        <input className=\"border rounded px-2 py-1 w-full mb-1\" placeholder=\"To Email\" value={to} onChange={e => setTo(e.target.value)} />\n        <input className=\"border rounded px-2 py-1 w-full mb-1\" placeholder=\"Subject\" value={subject} onChange={e => setSubject(e.target.value)} />\n        <textarea className=\"border rounded px-2 py-1 w-full mb-2\" placeholder=\"Body\" rows={4} value={body} onChange={e => setBody(e.target.value)} />\n        <Button onClick={send}>Send Email</Button>\n        {msg && (\n          <div className=\"text-xs mt-2\">\n            <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n              <SafeMarkdown>{msg}</SafeMarkdown>\n            </div>\n          </div>\n        )}\n      </div>\n      <div>\n        <h3 className=\"font-bold mb-2\">List Recent Emails</h3>\n        <Button onClick={list}>Refresh Inbox</Button>\n        <ul className=\"mt-2 space-y-1\">\n          {emails.map((em, i) => (\n            <li key={i} className=\"bg-gray-100 rounded p-2 text-xs\">\n              <div><strong>From:</strong> {em.from}</div>\n              <div><strong>Subject:</strong> {em.subject}</div>\n              <div><strong>Date:</strong> {em.date}</div>\n              <div className=\"text-gray-500\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{em.snippet}</SafeMarkdown>\n                </div>\n              </div>\n            </li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3508, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "30cdd1db-99f2-4bed-ad09-de9f121ba7fc": {"__data__": {"id_": "30cdd1db-99f2-4bed-ad09-de9f121ba7fc", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "a2d88b64-bca7-4247-874d-b49196eead01", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "aec6e01a34f5e9b9693dde7aab872c80a725625b8bc5b1c06336f7c79a0be487", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "47ed4b8d-0954-4137-9093-33783865cfb7", "node_type": "1", "metadata": {}, "hash": "e03ef81bd11c02f7729a3f21d0d2d5b9803b74e144285c8114dbe15cc3f3ff96", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/LogsPanel.tsx\n// Purpose: Displays the system action log with results, file paths, timestamps, auto-refresh, action-type filtering, text-based search, and JSON/CSV download.\n//          Result output is rendered with SafeMarkdown when string; otherwise, pretty JSON.\n\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { API_ROOT } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\ninterface LogEntry {\n  id: string;\n  timestamp: string;\n  type: string;\n  path?: string;\n  status: string;\n  result?: unknown; // Can be string (markdown), object, or null\n}\n\nexport default function LogsPanel() {\n  const [log, setLog] = useState<LogEntry[]>([]);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [filterType, setFilterType] = useState<string>(\"\");\n  const [searchText, setSearchText] = useState<string>(\"\");\n\n  async function fetchLog() {\n    const res = await fetch(`${API_ROOT}/control/list_log`, {\n      headers: {\n        \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\"\n      }\n    });\n    const data = await res.json();\n    const mapped = (data.log || []).map((entry: LogEntry) => ({\n      ...entry,\n      result: toMDString(entry.result)\n    }));\n    setLog(mapped);\n  }\n\n  function downloadJSON() {\n    const blob = new Blob([JSON.stringify(filteredLog, null, 2)], { type: \"application/json\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"relay_log.json\";\n    link.click();\n    URL.revokeObjectURL(url);\n  }\n\n  function downloadCSV() {\n    const headers = [\"id\", \"timestamp\", \"type\", \"path\", \"status\"];\n    const csvRows = [headers.join(\",\")];\n    filteredLog.forEach(entry => {\n      const row = [\n        entry.id,\n        entry.timestamp,\n        entry.type,\n        entry.path || \"\",\n        entry.status\n      ].map(field => `\"${String(field).replace(/\"/g, '\"\"')}\"`);\n      csvRows.push(row.join(\",\"));\n    });\n    const csvContent = csvRows.join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"relay_log.csv\";\n    link.click();\n    URL.revokeObjectURL(url);\n  }\n\n  useEffect(() => {\n    fetchLog();\n    if (!autoRefresh) return;\n    const interval = setInterval(fetchLog, 15000);\n    return () => clearInterval(interval);\n  }, [autoRefresh]);\n\n  const uniqueTypes = Array.from(new Set(log.map(l => l.type))).sort();\n  const filteredLog = log.filter(entry => {\n    const matchType = !filterType || entry.type === filterType;\n    const matchSearch = !searchText || JSON.stringify(entry).toLowerCase().includes(searchText.toLowerCase());\n    return matchType && matchSearch;\n  });\n\n  if (!filteredLog.length)\n    return (\n      <p className=\"text-muted-foreground\">\n        No log entries{filterType ? ` of type '${filterType}'` : \"\"} found.\n      </p>\n    );\n\n  for (const entry of filteredLog) {\n    if (entry.result && typeof entry.result !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof entry.result, entry.result);\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Controls */}\n      <div className=\"flex flex-wrap gap-4 mb-4 items-center\">\n        <Button variant={autoRefresh ? \"default\" : \"outline\"} onClick={() => setAutoRefresh(!autoRefresh)}>\n          {autoRefresh ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3591, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "47ed4b8d-0954-4137-9093-33783865cfb7": {"__data__": {"id_": "47ed4b8d-0954-4137-9093-33783865cfb7", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "a2d88b64-bca7-4247-874d-b49196eead01", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "aec6e01a34f5e9b9693dde7aab872c80a725625b8bc5b1c06336f7c79a0be487", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "30cdd1db-99f2-4bed-ad09-de9f121ba7fc", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/LogsPanel/LogsPanel.tsx", "file_name": "LogsPanel.tsx", "file_size": 5877, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "34cdaedad5cda829d7abe9e2f83d682a846b3e9b3dd02ce56d8a08039e75f6bb", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "` of type '${filterType}'` : \"\"} found.\n      </p>\n    );\n\n  for (const entry of filteredLog) {\n    if (entry.result && typeof entry.result !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof entry.result, entry.result);\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Controls */}\n      <div className=\"flex flex-wrap gap-4 mb-4 items-center\">\n        <Button variant={autoRefresh ? \"default\" : \"outline\"} onClick={() => setAutoRefresh(!autoRefresh)}>\n          {autoRefresh ? \"Auto-Refresh ON\" : \"Auto-Refresh OFF\"}\n        </Button>\n        <div className=\"text-sm text-gray-500\">Log updates every 15s</div>\n        <select\n          className=\"border rounded px-2 py-1 text-sm\"\n          value={filterType}\n          onChange={e => setFilterType(e.target.value)}\n        >\n          <option value=\"\">All Types</option>\n          {uniqueTypes.map(type => (\n            <option key={type} value={type}>{type}</option>\n          ))}\n        </select>\n        <input\n          type=\"text\"\n          placeholder=\"Search logs...\"\n          value={searchText}\n          onChange={e => setSearchText(e.target.value)}\n          className=\"border rounded px-2 py-1 text-sm w-60\"\n        />\n        <Button onClick={downloadJSON} variant=\"secondary\">\n          Download JSON\n        </Button>\n        <Button onClick={downloadCSV} variant=\"outline\">\n          Export CSV\n        </Button>\n      </div>\n\n      {/* Log entries */}\n      {filteredLog.map((entry) => (\n        <Card key={entry.id}>\n          <CardContent className=\"p-4 space-y-2\">\n            <div className=\"text-sm font-mono text-muted-foreground\">\n              #{entry.id.slice(0, 8)} \u2022 {entry.timestamp}\n            </div>\n            <div className=\"text-sm\">\n              <strong>Type:</strong> {entry.type}\n              {entry.path && (\n                <span className=\"ml-2\"><strong>Path:</strong> {entry.path}</span>\n              )}\n              <span className=\"ml-2\"><strong>Status:</strong> {entry.status}</span>\n            </div>\n            {/* If the result is a markdown string, render as markdown.\n                Otherwise, pretty-print as JSON. */}\n            {typeof entry.result === \"string\" ? (\n              <div className=\"bg-muted p-2 rounded text-sm overflow-auto whitespace-pre-wrap\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{entry.result}</SafeMarkdown>\n                </div>\n              </div>\n            ) : entry.result ? (\n              <pre className=\"bg-muted p-2 rounded text-sm overflow-auto whitespace-pre-wrap\">\n                {JSON.stringify(entry.result, null, 2)}\n              </pre>\n            ) : null}\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 3095, "end_char_idx": 5874, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "043eed59-c993-4088-a488-0861516b2ba9": {"__data__": {"id_": "043eed59-c993-4088-a488-0861516b2ba9", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b65a49867c45641b38010d7502ca8452a33ef79e46a5179b16ca2a6d3b856656", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "8d9f48a3-c889-447c-b779-58bf3b62be44", "node_type": "1", "metadata": {}, "hash": "22e9239df320bfd134ddccbf5e7dec143159ce88280e672b61ca9299ae777335", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/MemoryPanel.tsx\n// Purpose: Robust, scalable, tier-aware memory inspector with pagination, user filtering, tag/save, date filtering, and replay support.\n//          Now supports Markdown/code in summary, agent response, and context modals via SafeMarkdown.\n\n\"use client\"\n\nimport { useEffect, useMemo, useState } from \"react\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { API_ROOT } from \"@/lib/api\"\nimport SafeMarkdown from \"@/components/SafeMarkdown\"\nimport { toMDString } from \"@/lib/toMDString\"\n\ninterface ContextSource {\n  type: string\n  title?: string\n  path?: string\n  tier?: string\n  score?: number\n  doc_id?: string\n}\n\ninterface MemoryEntry {\n  timestamp: string\n  user: string\n  query: string\n  topics?: string[]\n  files?: string[]\n  summary?: string\n  context_length?: number\n  used_global_context?: boolean\n  context_files?: string[]\n  files_used?: ContextSource[]\n  agent_response?: string\n  prompt_length?: number\n  response_length?: number\n  fallback?: boolean\n  tags?: string[]\n  saved?: boolean\n}\n\nconst isNonEmptyArray = <T,>(arr?: T[] | null): arr is T[] => Array.isArray(arr) && arr.length > 0\n\nexport default function MemoryPanel() {\n  const [memory, setMemory] = useState<MemoryEntry[]>([])\n  const [search, setSearch] = useState(\"\")\n  const [filterUser, setFilterUser] = useState(\"\")\n  const [filterGlobal, setFilterGlobal] = useState<\"any\" | \"with\" | \"without\">(\"any\")\n  const [filterDays, setFilterDays] = useState(7)\n  const [fetchInfo, setFetchInfo] = useState({\n    status: \"idle\",\n    time: 0,\n    error: undefined as string | undefined,\n  })\n  const [modalContext, setModalContext] = useState<{ path: string; content: string } | null>(null)\n\n  const [currentPage, setCurrentPage] = useState(1)\n  const pageSize = 10\n\n  useEffect(() => {\n    fetchMemory()\n  }, [])\n\n  async function fetchMemory() {\n    const start = Date.now()\n    setFetchInfo({ status: \"loading\", time: 0, error: undefined })\n\n    try {\n      const res = await fetch(`${API_ROOT}/logs/sessions/all`, {\n        headers: { \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" },\n      })\n      if (!res.ok) throw new Error(`Status ${res.status}`)\n      const data = await res.json()\n      const mapped = (data.entries || []).map((m: unknown) => {\n        const entry = m as Partial<MemoryEntry>\n        return {\n          ...entry,\n          summary: toMDString(entry.summary),\n          agent_response: toMDString(entry.agent_response),\n        }\n      })\n      setMemory(mapped)\n      setFetchInfo({ status: \"success\", time: Date.now() - start, error: \"\" })\n    } catch (e: unknown) {\n      const errorMsg = e instanceof Error ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2724, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "8d9f48a3-c889-447c-b779-58bf3b62be44": {"__data__": {"id_": "8d9f48a3-c889-447c-b779-58bf3b62be44", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b65a49867c45641b38010d7502ca8452a33ef79e46a5179b16ca2a6d3b856656", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "043eed59-c993-4088-a488-0861516b2ba9", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7d87d5651640fbd6d1e6c383fbb515ecfa0748655aac5ed963a5fc62e1abe7a6", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "0889d79a-915c-4865-81c9-47919a84d274", "node_type": "1", "metadata": {}, "hash": "dafe6d5c45c52f4f18659c30ea6f68530eb5079353feae41a8df26732475a72c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "e.message : String(e)\n      setFetchInfo({ status: \"error\", time: Date.now() - start, error: errorMsg })\n      setMemory([])\n    }\n  }\n\n  async function fetchContextFile(path: string) {\n    try {\n      const res = await fetch(`${API_ROOT}/files/context?path=${encodeURIComponent(path)}`, {\n        headers: { \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\" },\n      })\n      if (!res.ok) throw new Error(`Status ${res.status}`)\n      const content = await res.text()\n      setModalContext({ path, content })\n    } catch (e) {\n      setModalContext({ path, content: `Failed to fetch: ${e}` })\n    }\n  }\n\n  function toggleSave(index: number) {\n    setMemory(prev => {\n      const clone = [...prev]\n      clone[index].saved = !clone[index].saved\n      return clone\n    })\n  }\n\n  function toggleTag(index: number, tag: string) {\n    setMemory(prev => {\n      const clone = [...prev]\n      const tags = new Set(clone[index].tags || [])\n      if (tags.has(tag)) {\n        tags.delete(tag)\n      } else {\n        tags.add(tag)\n      }\n      clone[index].tags = Array.from(tags)\n      return clone\n    })\n  }\n\n  const users = useMemo(() => Array.from(new Set(memory.map(m => m.user))).sort(), [memory])\n\n  const filtered = useMemo(() => {\n    const now = Date.now()\n    const cutoff = now - filterDays * 24 * 60 * 60 * 1000\n\n    return memory\n      .filter(m => {\n        const matchUser = !filterUser || m.user === filterUser\n        const matchSearch = !search || JSON.stringify(m).toLowerCase().includes(search.toLowerCase())\n        const matchGlobal =\n          filterGlobal === \"any\"\n            ? true\n            : filterGlobal === \"with\"\n            ? !!m.used_global_context\n            : !m.used_global_context\n        const matchTime = new Date(m.timestamp).getTime() >= cutoff\n        return matchUser && matchSearch && matchGlobal && matchTime\n      })\n      .sort((a, b) => {\n        const tierScore = (tier?: string) => (tier === \"global\" ? 3 : tier === \"project\" ? 2 : tier === \"code\" ? 1 : 0)\n        const maxTier = (files?: ContextSource[]) => Math.max(...(files || []).map(f => tierScore(f.tier)), 0)\n        return maxTier(b.files_used) - maxTier(a.files_used)\n      })\n  }, [memory, search, filterUser, filterGlobal, filterDays])\n\n  const paginated = useMemo(() => {\n    const start = (currentPage - 1) * pageSize\n    return filtered.slice(start, start + pageSize)\n  }, [filtered, currentPage])\n\n  function replayQuery(query: string) {\n    window.open(`/ask?question=${encodeURIComponent(query)}`, \"_blank\")\n  }\n\n  for (const m of paginated) {\n    if (m.summary && typeof m.summary !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof m.summary, m.summary)\n    }\n    if (m.agent_response && typeof m.agent_response !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof m.agent_response, m.agent_response)\n    }\n  }\n  if (modalContext && typeof modalContext.content !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof modalContext.content, modalContext.content)\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-wrap gap-4 text-xs text-gray-500 mb-2 items-center\">\n        <span>Fetch: <b>{fetchInfo.status}</b>{fetchInfo.time ?", "mimetype": "text/plain", "start_char_idx": 2725, "end_char_idx": 5904, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0889d79a-915c-4865-81c9-47919a84d274": {"__data__": {"id_": "0889d79a-915c-4865-81c9-47919a84d274", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b65a49867c45641b38010d7502ca8452a33ef79e46a5179b16ca2a6d3b856656", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "8d9f48a3-c889-447c-b779-58bf3b62be44", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9fac35914165bca76c0153b6b701d9611224a4beafd8d81d05bd97ad0c8c6c82", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "ea561eb4-412b-4f79-a7b2-f51a36be09cd", "node_type": "1", "metadata": {}, "hash": "3b06cdd63bb18eae281bfb45d566cb3c357730a99df311dc90b3b18b434c855a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "` (${fetchInfo.time}ms)` : \"\"}</span>\n        <span>Total: <b>{memory.length}</b></span>\n        <span>Filtered: <b>{filtered.length}</b></span>\n        <span>Users: <b>{users.length}</b></span>\n        <span>Global: <b>{filtered.filter(m => m.used_global_context).length}</b></span>\n        <Button onClick={fetchMemory} variant=\"outline\">Refresh</Button>\n      </div>\n\n      <div className=\"flex gap-2 mb-4\">\n        <select className=\"border rounded px-2 py-1 text-sm\" value={filterUser} onChange={e => setFilterUser(e.target.value)}>\n          <option value=\"\">All Users</option>\n          {users.map(u => <option key={u} value={u}>{u}</option>)}\n        </select>\n        <select\n          className=\"border rounded px-2 py-1 text-sm\"\n          value={filterGlobal}\n          onChange={e =>\n            setFilterGlobal(\n              e.target.value as \"any\" | \"with\" | \"without\"\n            )\n          }\n        >\n          <option value=\"any\">All Context</option>\n          <option value=\"with\">With Global</option>\n          <option value=\"without\">Without Global</option>\n        </select>\n        <input\n          className=\"border rounded px-2 py-1 text-sm w-64\"\n          placeholder=\"Search memory...\"\n          value={search}\n          onChange={e => setSearch(e.target.value)}\n        />\n        <select\n          className=\"border rounded px-2 py-1 text-sm\"\n          value={filterDays}\n          onChange={e => setFilterDays(parseInt(e.target.value))}\n        >\n          {[1, 7, 14, 30, 90].map(days => (\n            <option key={days} value={days}>Last {days} days</option>\n          ))}\n        </select>\n      </div>\n\n      {paginated.map((m, i) => (\n        <Card key={i}>\n          <CardContent className=\"p-4 space-y-2\">\n            <div className=\"text-sm font-mono text-muted-foreground\">\n              {new Date(m.timestamp).toLocaleString()} \u2022 {m.user}\n            </div>\n            <div className=\"text-sm font-semibold\">Query:</div>\n            <div className=\"text-sm\">{m.query}</div>\n\n            {isNonEmptyArray(m.topics) && <div className=\"text-xs\">Topics: {m.topics.join(\", \")}</div>}\n            {isNonEmptyArray(m.files) && <div className=\"text-xs\">Files: {m.files.join(\", \")}</div>}\n\n            {isNonEmptyArray(m.context_files) && (\n              <div className=\"text-xs text-blue-800\">\n                <strong>Context Files:</strong> {m.context_files.map((cf, idx) => (\n                  <span key={cf}>\n                    <a className=\"underline cursor-pointer\" onClick={() => fetchContextFile(cf)}>{cf}</a>\n                    {idx < m.context_files!.length - 1 ? \", \" : \"\"}\n                  </span>\n                ))}\n              </div>\n            )}\n\n            {isNonEmptyArray(m.files_used) && (\n              <div className=\"text-xs text-purple-700\">\n                <strong>Injected:</strong>{\" \"}\n                {m.files_used.map((f, idx) => (\n                  <span key={idx}>\n                    <span className=\"underline cursor-pointer\" onClick={() => f.path && fetchContextFile(f.path)}>\n                      {f.path || f.title || f.doc_id || f.type}\n                    </span>\n                    {f.tier && <span className=\"ml-1 text-gray-500\">[{f.tier}]</span>}\n                    {idx < m.files_used!.length - 1 ?", "mimetype": "text/plain", "start_char_idx": 5905, "end_char_idx": 9191, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ea561eb4-412b-4f79-a7b2-f51a36be09cd": {"__data__": {"id_": "ea561eb4-412b-4f79-a7b2-f51a36be09cd", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b65a49867c45641b38010d7502ca8452a33ef79e46a5179b16ca2a6d3b856656", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "0889d79a-915c-4865-81c9-47919a84d274", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e5e5d2fae5ccf541b958fe1304a227aeed7ac19fa5b1978d13a0f5a1cc45ca74", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "86a9e1ea-d77e-4c82-9b18-c481c054d9ed", "node_type": "1", "metadata": {}, "hash": "34ec20c5588c65005965f320bfb579099551c82d3c898f38893bdaff31fa04c5", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\", \" : \"\"}\n                  </span>\n                ))}\n              </div>\n            )}\n\n            {isNonEmptyArray(m.files_used) && (\n              <div className=\"text-xs text-purple-700\">\n                <strong>Injected:</strong>{\" \"}\n                {m.files_used.map((f, idx) => (\n                  <span key={idx}>\n                    <span className=\"underline cursor-pointer\" onClick={() => f.path && fetchContextFile(f.path)}>\n                      {f.path || f.title || f.doc_id || f.type}\n                    </span>\n                    {f.tier && <span className=\"ml-1 text-gray-500\">[{f.tier}]</span>}\n                    {idx < m.files_used!.length - 1 ? \", \" : \"\"}\n                  </span>\n                ))}\n              </div>\n            )}\n\n            <div className=\"text-xs text-gray-600\">\n              {typeof m.context_length === \"number\" && <>Context Length: {m.context_length} chars<br /></>}\n              {typeof m.prompt_length === \"number\" && <>Prompt: {m.prompt_length}, Response: {m.response_length}</>}\n            </div>\n\n            {m.used_global_context && (\n              <span className=\"inline-block px-2 py-1 text-xs bg-green-100 text-green-700 rounded\">Global context</span>\n            )}\n            {m.fallback && (\n              <span className=\"inline-block px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded\">Fallback</span>\n            )}\n\n            {Array.isArray(m.tags) && m.tags.length > 0 && (\n              <div className=\"text-xs text-blue-600\">\n                <strong>Tags:</strong> {m.tags.join(\", \")}\n              </div>\n            )}\n\n            {/* Markdown/code for memory summary */}\n            {typeof m.summary === \"string\" && !!m.summary.trim() && (\n              <div className=\"bg-muted p-2 rounded text-xs whitespace-pre-wrap\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{m.summary}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            {/* Markdown/code for agent response */}\n            {typeof m.agent_response === \"string\" && !!m.agent_response.trim() && (\n              <div className=\"bg-muted p-2 rounded text-xs whitespace-pre-wrap mt-2\">\n                <strong>Agent Response:</strong>\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{m.agent_response}</SafeMarkdown>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-2 flex-wrap text-xs mt-2\">\n              {[\"important\", \"bug\", \"training\", \"review\"].map(tag => (\n                <Button\n                  key={tag}\n                  variant={m.tags?.includes(tag) ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => toggleTag(i, tag)}\n                >\n                  {tag}\n                </Button>\n              ))}\n              <Button\n                variant={m.saved ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => toggleSave(i)}\n              >\n                {m.saved ?", "mimetype": "text/plain", "start_char_idx": 8515, "end_char_idx": 11640, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "86a9e1ea-d77e-4c82-9b18-c481c054d9ed": {"__data__": {"id_": "86a9e1ea-d77e-4c82-9b18-c481c054d9ed", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b65a49867c45641b38010d7502ca8452a33ef79e46a5179b16ca2a6d3b856656", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "ea561eb4-412b-4f79-a7b2-f51a36be09cd", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/MemoryPanel.tsx", "file_name": "MemoryPanel.tsx", "file_size": 13812, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "080a37222f2d4abe20ffb1e4147036738351f32e3e47ce14429b74a37d362b14", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => toggleTag(i, tag)}\n                >\n                  {tag}\n                </Button>\n              ))}\n              <Button\n                variant={m.saved ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => toggleSave(i)}\n              >\n                {m.saved ? \"\ud83d\udcbe Saved\" : \"Save\"}\n              </Button>\n              <Button size=\"sm\" variant=\"ghost\" onClick={() => replayQuery(m.query)}>\n                \ud83d\udd01 Replay\n              </Button>\n            </div>\n\n            <details className=\"mt-2\">\n              <summary className=\"cursor-pointer text-xs text-blue-700\">Debug: Raw Entry</summary>\n              <pre className=\"bg-gray-100 p-2 rounded text-xs overflow-auto\">{JSON.stringify(m, null, 2)}</pre>\n            </details>\n          </CardContent>\n        </Card>\n      ))}\n\n      {/* Pagination controls */}\n      {filtered.length > pageSize && (\n        <div className=\"flex gap-2 justify-center mt-4\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n            disabled={currentPage === 1}\n          >\n            \u2b05 Prev\n          </Button>\n          <span className=\"text-xs flex items-center\">Page {currentPage} / {Math.ceil(filtered.length / pageSize)}</span>\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => setCurrentPage(p => p + 1)}\n            disabled={currentPage * pageSize >= filtered.length}\n          >\n            Next \u27a1\n          </Button>\n        </div>\n      )}\n\n      {/* Modal viewer for context file contents (markdown/code-friendly) */}\n      {modalContext && (\n        <div className=\"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-40\">\n          <div className=\"bg-white rounded shadow-lg max-w-2xl w-full p-6 relative\">\n            <div className=\"text-sm mb-2 font-bold\">Context File: <code>{modalContext.path}</code></div>\n            <div className=\"bg-gray-100 p-4 rounded max-h-[400px] overflow-auto text-xs\">\n              <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                <SafeMarkdown>{modalContext.content}</SafeMarkdown>\n              </div>\n            </div>\n            <Button variant=\"secondary\" onClick={() => setModalContext(null)} className=\"absolute top-2 right-2\">\n              Close\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}", "mimetype": "text/plain", "start_char_idx": 11257, "end_char_idx": 13799, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "54ec9ec9-841e-4f44-b6d4-e8dd93db7159": {"__data__": {"id_": "54ec9ec9-841e-4f44-b6d4-e8dd93db7159", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/MetricsCharts/MetricsCharts.tsx", "file_name": "MetricsCharts.tsx", "file_size": 902, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "9fd3af2e-409f-4652-be63-c1eca91f9475", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/MetricsCharts/MetricsCharts.tsx", "file_name": "MetricsCharts.tsx", "file_size": 902, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3a6b08568393dc1b098c3479498d3776f59b93b5a99205b949201f5abd7d3505", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/MetricsChart.tsx\n\n'use client'\n\nimport { Card } from '../ui/card' \n\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n} from 'recharts'\n\nconst sampleData = [\n  { name: 'Mon', value: 400 },\n  { name: 'Tue', value: 300 },\n  { name: 'Wed', value: 500 },\n  { name: 'Thu', value: 200 },\n  { name: 'Fri', value: 650 },\n]\n\nexport default function MetricsChart() {\n  return (\n    <Card className=\"p-6\">\n      <h3 className=\"font-semibold text-lg mb-2\">Metrics Over Time</h3>\n      <ResponsiveContainer width=\"100%\" height={200}>\n        <LineChart data={sampleData}>\n          <XAxis dataKey=\"name\" />\n          <YAxis />\n          <Tooltip />\n          <Line\n            type=\"monotone\"\n            dataKey=\"value\"\n            stroke=\"#4F46E5\"\n            strokeWidth={2}\n          />\n        </LineChart>\n      </ResponsiveContainer>\n    </Card>\n  )\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 901, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c7e21dbe-ccf3-410c-a581-8afa3159981d": {"__data__": {"id_": "c7e21dbe-ccf3-410c-a581-8afa3159981d", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/SafeMarkdown.tsx", "file_name": "SafeMarkdown.tsx", "file_size": 3365, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "2780754d-6ad3-4e5d-8796-460cdc823e17", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/SafeMarkdown.tsx", "file_name": "SafeMarkdown.tsx", "file_size": 3365, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "30c28f3e12c7661f6ec03476ea14fd64a8ec17eb86eecfe6f6546a4b96707762", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/SafeMarkdown.tsx\n// Purpose: Bulletproof, consistent, and safe Markdown rendering for all app content.\n//          Hardened against XSS, raw HTML, and rendering bugs. All code blocks are syntax-highlighted (Prism).\n//          This is the ONLY allowed way to render Markdown in the app.\n\nimport React from \"react\";\nimport ReactMarkdown, { Components } from \"react-markdown\";\nimport { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport { vscDarkPlus } from \"react-syntax-highlighter/dist/esm/styles/prism\";\n\n// Props for the SafeMarkdown component\ntype SafeMarkdownProps = {\n  /** Markdown text to render (always a string) */\n  children: string;\n  /** Optional CSS className for wrapper */\n  className?: string;\n};\n\n// Custom Markdown renderer for code blocks (uses Prism for highlighting)\nconst markdownComponents: Components = {\n  code(props) {\n    const { inline, className, children, ...rest } = props as {\n      inline?: boolean;\n      className?: string;\n      children: React.ReactNode;\n    };\n    const match = /language-(\\w+)/.exec(className || \"\");\n    const content = String(children).replace(/\\n$/, \"\");\n\n    if (!inline && match) {\n      return (\n        <SyntaxHighlighter\n          style={vscDarkPlus}\n          language={match[1]}\n          PreTag=\"div\"\n          {...rest}\n        >\n          {content}\n        </SyntaxHighlighter>\n      );\n    }\n\n    return (\n      <code {...(className ? { className } : {})} {...rest}>\n        {content}\n      </code>\n    );\n  },\n  // You can expand here for tables, images, links if needed\n};\n\nexport default function SafeMarkdown({ children, className }: SafeMarkdownProps) {\n  // Dev-only: Warn if a non-string slips through (should never happen in production)\n  if (typeof children !== \"string\" && process.env.NODE_ENV !== \"production\") {\n    console.warn(\n      \"[SafeMarkdown] Expected children to be a string, got:\",\n      typeof children,\n      children\n    );\n  }\n\n  // Always coerce to string for React safety\n  const strChildren =\n    typeof children === \"string\" ? children : children ? String(children) : \"\";\n\n  // Debug: Log if somehow a non-string is still about to render (for final #418 hunting)\n  if (typeof strChildren !== \"string\") {\n    // eslint-disable-next-line no-console\n    console.error(\"SAFE-MARKDOWN-418-DEBUG\", typeof strChildren, strChildren);\n  }\n\n  // Ultra-safe: Escape anything that looks like raw HTML before markdown parsing\n  // (belt-and-suspenders, since skipHtml & disallowedElements are also set)\n  const likelyRawHtml = /<\\s*[a-zA-Z]+[^>]*>/.test(strChildren);\n  const safeChildren = likelyRawHtml\n    ? strChildren.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n    : strChildren;\n\n  return (\n    <ReactMarkdown\n      components={markdownComponents}\n      // SECURITY: Never allow any HTML passthrough from markdown\n      skipHtml={true}\n      disallowedElements={[\"html\", \"head\", \"body\", \"style\", \"script\", \"iframe\"]}\n      {...(className ? { className } : {})}\n    >\n      {safeChildren}\n    </ReactMarkdown>\n  );\n}\n\n/**\n * Usage:\n * <SafeMarkdown>{markdownString}</SafeMarkdown>\n *\n * - NEVER use ReactMarkdown directly in any other file.\n * - All markdown content (LLM, docs, search, context, etc) MUST be rendered via SafeMarkdown.\n * - Always ensure children is a string (coerce using toMDString or similar as needed).\n */", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3364, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6006a86d-2ea2-4838-8727-4b864a0751c2": {"__data__": {"id_": "6006a86d-2ea2-4838-8727-4b864a0751c2", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "706c8232-7cde-492c-9bfa-07e3825ea4cc", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "60e5eb667c37f27aad2a852fad35211da9ca8859d578254a2c69bc0590565a1f", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "a16c8553-54fd-440b-8215-4ade186ac58e", "node_type": "1", "metadata": {}, "hash": "a05b37f20f3dd04a8475dbcffad33196c334c135e0edbe6df5612813d74f13d0", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: frontend/src/components/SearchPanel.tsx\n// Purpose: Robust, debounced UI panel for semantic KB search (GET /kb/search).\n//          Now renders result snippets with SafeMarkdown for readable markdown/code.\n// Notes: 2025\u201107\u201101 \u2013 All features preserved; only result snippet rendering is upgraded.\n\n\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { API_ROOT, API_KEY } from \"@/lib/api\";\nimport SafeMarkdown from \"@/components/SafeMarkdown\";\nimport { toMDString } from \"@/lib/toMDString\";\n\nexport type KBResult = {\n  path: string;\n  title: string;\n  snippet: string;\n  updated: string;\n  similarity: number;\n};\n\nconst DEBOUNCE_MS = 400;\nconst TOP_K = 5;\n\nexport default function SearchPanel() {\n  const [query, setQuery] = useState<string>(\"\");\n  const [results, setResults] = useState<KBResult[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const controllerRef = useRef<AbortController | null>(null);\n  const debounceRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const clearDebounce = () => {\n    if (debounceRef.current) {\n      clearTimeout(debounceRef.current);\n    }\n  };\n\n  // Core fetch logic\n  const fetchResults = async (q: string) => {\n    if (!API_ROOT) {\n      setError(\"API URL not configured\");\n      return;\n    }\n    if (!API_KEY) {\n      setError(\"API key missing\");\n      return;\n    }\n\n    setError(null);\n    setLoading(true);\n\n    controllerRef.current?.abort();\n    const controller = new AbortController();\n    controllerRef.current = controller;\n\n    try {\n      const url = new URL(\"/kb/search\", API_ROOT);\n      url.searchParams.set(\"query\", q);\n      url.searchParams.set(\"k\", String(TOP_K));\n\n      const res = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: {\n          \"x-api-key\": API_KEY,\n          Accept: \"application/json\",\n        },\n        signal: controller.signal,\n      });\n\n      if (res.status === 401 || res.status === 403) {\n        throw new Error(\"Unauthorized \u2013 check API key / login\");\n      }\n      if (!res.ok) {\n        throw new Error(`HTTP ${res.status}`);\n      }\n\n      const data: KBResult[] = await res.json();\n      const mapped = data.map((r) => ({\n        ...r,\n        snippet: toMDString(r.snippet),\n      }));\n      setResults(mapped);\n    } catch (err) {\n      if (err instanceof DOMException && err.name === \"AbortError\") {\n        return; // request was cancelled\n      }\n      console.error(\"KB search error\", err);\n      setError((err as Error).message ?? \"Search failed\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Debounce typing\n  useEffect(() => {\n    if (!query.trim()) {\n      setResults([]);\n      setError(null);\n      return;\n    }\n\n    clearDebounce();\n    debounceRef.current = setTimeout(() => fetchResults(query.trim()), DEBOUNCE_MS);\n\n    return () => {\n      clearDebounce();\n    };\n  }, [query]);\n\n  const onSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    clearDebounce();\n    fetchResults(query.trim());\n  };\n\n  for (const r of results) {\n    if (typeof r.snippet !== \"string\") {\n      console.log(\"DEBUG 418:\", typeof r.snippet, r.snippet);\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\" aria-busy={loading}>\n      <form onSubmit={onSubmit} className=\"flex gap-2\">\n        <label htmlFor=\"kb-query\" className=\"sr-only\">\n          Search knowledge base\n        </label>\n        <Input\n          id=\"kb-query\"\n          placeholder=\"Ask a question\u2026\"\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n        />\n        <Button type=\"submit\" disabled={loading}>\n          {loading ? \"\u23f3\" : \"Search\"}\n        </Button>\n      </form>\n\n      {error ?", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3832, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "a16c8553-54fd-440b-8215-4ade186ac58e": {"__data__": {"id_": "a16c8553-54fd-440b-8215-4ade186ac58e", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "706c8232-7cde-492c-9bfa-07e3825ea4cc", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "60e5eb667c37f27aad2a852fad35211da9ca8859d578254a2c69bc0590565a1f", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "6006a86d-2ea2-4838-8727-4b864a0751c2", "node_type": "1", "metadata": {"file_path": "/app/frontend/src/components/SearchPanel.tsx", "file_name": "SearchPanel.tsx", "file_size": 4672, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "24c42b302ce84d2b69ebc7ee203761c8b0fe8426b3264e982fc66fc8bbdd4d5e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"\u23f3\" : \"Search\"}\n        </Button>\n      </form>\n\n      {error ? <p className=\"text-sm text-red-500\">{error}</p> : null}\n\n      {results.length > 0 && (\n        <div className=\"space-y-2\">\n          {results.map((r, i) => (\n            <article key={i} className=\"border rounded p-4 text-sm space-y-1\">\n              <header className=\"text-muted-foreground\">\n                <strong>{r.title}</strong> ({r.similarity.toFixed(2)})\n              </header>\n              <div className=\"mb-1\">\n                <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n                  <SafeMarkdown>{r.snippet}</SafeMarkdown>\n                </div>\n              </div>\n              <footer className=\"text-xs text-muted-foreground\">\n                Updated: {r.updated || \"\u2014\"}\n              </footer>\n            </article>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 3769, "end_char_idx": 4657, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "76d2aefc-f4a8-478f-b1db-ec8c91d2f67d": {"__data__": {"id_": "76d2aefc-f4a8-478f-b1db-ec8c91d2f67d", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/Sidebar/Sidebar.tsx", "file_name": "Sidebar.tsx", "file_size": 1570, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "ebafa638-7ade-4f19-8960-d96a77b14225", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/Sidebar/Sidebar.tsx", "file_name": "Sidebar.tsx", "file_size": 1570, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "66126a4639a5235606313846ef35f25ae805aca80c1c5b4d76e506d1a2a1ba69", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/Sidebar/Sidebar.tsx\n\"use client\";\n\nconsole.log(\"Sidebar mounted\");\n\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\n\nconst links = [\n  { href: \"/ask\", label: \"Ask Echo\", icon: \"/Hoody.png\" },\n  { href: \"/codex\", label: \"Codex\", icon: \"/PlannerCop.png\" },\n  { href: \"/docs\", label: \"Docs\", icon: \"/PigTails.png\" },\n  { href: \"/control\", label: \"Control\", icon: \"/Echo.png\" },\n  { href: \"/planner\", label: \"Planner\", icon: \"/ballcap beard.png\" },\n  { href: \"/email\", label: \"Email\", icon: \"/blackbeard earing.png\" },\n  { href: \"/critic\", label: \"Critic\", icon: \"/beanie and smoke.png\" },\n  { href: \"/janitor\", label: \"Janitor\", icon: \"/sunglass shadow.png\" },\n];\n\nexport default function Sidebar() {\n  const pathname = usePathname();\n\n  return (\n    <aside className=\"w-48 bg-white border-r p-3 space-y-2\">\n      <h2 className=\"text-lg font-bold flex items-center gap-2\">\n        <Image src=\"/WildfireMang.png\" alt=\"logo\" width={24} height={24} />\n        Wildfire Ranch\n      </h2>\n      <nav className=\"mt-4 space-y-2 text-sm\">\n        {links.map(({ href, label, icon }) => (\n          <Link\n            key={href}\n            href={href}\n            className={`flex items-center gap-2 px-2 py-1 rounded hover:bg-gray-100 ${\n              pathname === href ? \"bg-blue-100 font-semibold\" : \"\"\n            }`}\n          >\n            <Image src={icon} alt={label} width={24} height={24} />\n            <span>{label}</span>\n          </Link>\n        ))}\n      </nav>\n    </aside>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1569, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "8374feda-2359-40a5-9a75-37cfb09c2f01": {"__data__": {"id_": "8374feda-2359-40a5-9a75-37cfb09c2f01", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/StatusPanel.tsx", "file_name": "StatusPanel.tsx", "file_size": 4399, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "8435d31e-cf88-4fad-9ca6-c1e674f99069", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/StatusPanel.tsx", "file_name": "StatusPanel.tsx", "file_size": 4399, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "37fdf8241faf7d99cfefba7c793968ba27387f82371aca2bfd44090bc29e5d1c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/StatusPanel.tsx\n// Directory: frontend/src/components\n// Purpose: Display Relay service status and embed a UI panel for Google Docs sync and KB/context awareness\n\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport DocsSyncPanel from \"@/components/DocsSyncPanel\";\nimport { API_ROOT } from \"@/lib/api\";\n\ninterface StatusSummary {\n  version?: { git_commit?: string };\n  paths?: {\n    base_path?: string;\n    resolved_paths?: Record<string, boolean>;\n  };\n}\n\ninterface ContextFile {\n  path: string;\n  size_bytes: number;\n  last_modified: string;\n}\n\ninterface ContextStatus {\n  context_files: ContextFile[];\n  global_context_used: string;\n  global_context_manual_last_updated: string;\n  global_context_auto_last_updated: string;\n}\n\nexport default function StatusPanel() {\n  const [status, setStatus] = useState<StatusSummary | null>(null);\n  const [context, setContext] = useState<ContextStatus | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState<boolean>(true);\n\n  useEffect(() => {\n    async function fetchStatus() {\n      if (!API_ROOT) {\n        setError(\"API URL not configured.\");\n        setLoading(false);\n        return;\n      }\n      try {\n        const [statusRes, contextRes] = await Promise.all([\n          fetch(`${API_ROOT}/status/summary`),\n          fetch(`${API_ROOT}/status/context`),\n        ]);\n        if (!statusRes.ok || !contextRes.ok)\n          throw new Error(\"Failed to fetch one or more endpoints\");\n        const statusData: StatusSummary = await statusRes.json();\n        const contextData: ContextStatus = await contextRes.json();\n        setStatus(statusData);\n        setContext(contextData);\n      } catch (err) {\n        console.error(\"Status fetch error:\", err);\n        setError(\"Failed to load status.\");\n      } finally {\n        setLoading(false);\n      }\n    }\n    fetchStatus();\n  }, []);\n\n  if (loading) return <p className=\"text-sm text-muted-foreground\">Loading service status\u2026</p>;\n  if (error) return <p className=\"text-sm text-red-500\">{error}</p>;\n  if (!status) return <p className=\"text-sm\">No status data available.</p>;\n\n  return (\n    <>\n      <Card className=\"mt-6\">\n        <CardContent className=\"p-4 space-y-3\">\n          <h2 className=\"text-xl font-bold\">\ud83d\udcca Relay Service Status</h2>\n          <div><strong>Version:</strong> {status.version?.git_commit || \"unknown\"}</div>\n          <div><strong>Base Path:</strong> {status.paths?.base_path || \"\u2014\"}</div>\n          <div>\n            <strong>Docs Folder Health:</strong>\n            <ul className=\"list-disc ml-6\">\n              {Object.entries(status.paths?.resolved_paths || {}).map(\n                ([pathKey, ok]) => (\n                  <li key={pathKey} className=\"text-sm\">\n                    {pathKey}: {ok ? \"\u2705 OK\" : \"\u274c Missing\"}\n                  </li>\n                )\n              )}\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n\n      {context && (\n        <Card className=\"mt-6\">\n          <CardContent className=\"p-4 space-y-3\">\n            <h2 className=\"text-xl font-bold\">\ud83e\udde0 Context Awareness</h2>\n            <div><strong>Context Strategy:</strong> {context.global_context_used === \"manual\" ? \"\ud83d\udcdd Manual\" : context.global_context_used === \"auto\" ? \"\ud83e\udd16 Auto-generated\" : \"None\"}</div>\n            <div><strong>Last Manual Update:</strong> {context.global_context_manual_last_updated}</div>\n            <div><strong>Last Auto Update:</strong> {context.global_context_auto_last_updated}</div>\n            <div>\n              <strong>Active Context Files:</strong>\n              <ul className=\"list-disc ml-6\">\n                {context.context_files.map((file) => (\n                  <li key={file.path} className=\"text-sm\">\n                    {file.path}{\" \"}\n                    <span className=\"text-xs text-gray-500\">\n                      ({Math.round(file.size_bytes / 1024)} KB,\n                      {\" \"}\n                      {new Date(file.last_modified).toLocaleString()})\n                    </span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Embed DocsSyncPanel below status */}\n      <div className=\"mt-6\">\n        <DocsSyncPanel />\n      </div>\n    </>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4378, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "1070213f-b90e-4096-9acd-19b578926990": {"__data__": {"id_": "1070213f-b90e-4096-9acd-19b578926990", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.stories.tsx", "file_name": "Dashboard.stories.tsx", "file_size": 152, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "e887bd1b-a075-4c4d-bf43-ebe4fe0694c6", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.stories.tsx", "file_name": "Dashboard.stories.tsx", "file_size": 152, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d32524bad45f50b78fa39f21d8ca1bc327051d05d308ec0d4e3d60d5674ca623", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import Dashboard from \"./Dashboard\";\nexport default {\n  title: \"Dashboard/Main\",\n  component: Dashboard,\n};\nexport const Default = () => <Dashboard />;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 151, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6848a3fa-c8e6-4d01-96c6-6005c28d53a1": {"__data__": {"id_": "6848a3fa-c8e6-4d01-96c6-6005c28d53a1", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.tsx", "file_name": "Dashboard.tsx", "file_size": 3449, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "b1f589d5-03a2-4e7a-9a72-5874ed82e3f3", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/dashboard/Dashboard.tsx", "file_name": "Dashboard.tsx", "file_size": 3449, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "700fddc8b77b845f832692dc2dd308ddd558d57a9e2b2434a7689f807aeaeadd", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: DashboardWizard.tsx\n// Directory: frontend/src/components/dashboard\n// Purpose: Multi-step, animated setup wizard for Command Center dashboard onboarding.\n//   - Built with shadcn/ui components for consistent styling\n//   - Uses Framer Motion for smooth step transitions\n//   - Easy to customize steps/fields for your infra/ops flows\n\n\"use client\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { AnimatePresence, motion } from \"framer-motion\";\n\n// ---- Wizard step definitions ----\n// Each step defines a title and content (could use form logic, API calls, etc)\nconst steps = [\n  {\n    title: \"Connect Infrastructure\",\n    content: (\n      <>\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          Connect your infrastructure to begin tracking data.\n        </p>\n        <Input placeholder=\"Enter node endpoint or IP\" />\n      </>\n    ),\n  },\n  {\n    title: \"Add Notification Channel\",\n    content: (\n      <>\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          Add email or webhook to get alerts on events.\n        </p>\n        <Input placeholder=\"Email or webhook URL\" />\n      </>\n    ),\n  },\n  {\n    title: \"Finish Setup\",\n    content: (\n      <>\n        <p className=\"mb-4 text-sm text-muted-foreground\">\n          You\u2019re ready! Start using the Command Center.\n        </p>\n        <ul className=\"list-disc text-xs pl-5 text-muted-foreground\">\n          <li>Monitor live data</li>\n          <li>Configure automations</li>\n          <li>Access analytics & reports</li>\n        </ul>\n      </>\n    ),\n  },\n];\n\nexport default function DashboardWizard() {\n  // ---- State: Current wizard step ----\n  const [step, setStep] = useState(0);\n\n  // ---- Step navigation handlers ----\n  const next = () => setStep((s) => Math.min(s + 1, steps.length - 1));\n  const prev = () => setStep((s) => Math.max(s - 1, 0));\n\n  return (\n    <Card className=\"max-w-md mx-auto shadow-2xl\">\n      <CardHeader>\n        <CardTitle>\n          Setup Wizard\n          <span className=\"ml-2 text-xs font-normal text-muted-foreground\">\n            Step {step + 1} of {steps.length}\n          </span>\n        </CardTitle>\n        {/* Progress bar shows % complete */}\n        <Progress value={((step + 1) / steps.length) * 100} className=\"h-2 mt-4\" />\n      </CardHeader>\n      <CardContent>\n        {/* Animated transition between steps */}\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={step}\n            initial={{ opacity: 0, x: 24 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -24 }}\n            transition={{ duration: 0.25 }}\n            className=\"min-h-[110px]\"\n          >\n            <h3 className=\"font-semibold mb-2\">{steps[step].title}</h3>\n            {steps[step].content}\n          </motion.div>\n        </AnimatePresence>\n        {/* Navigation buttons */}\n        <div className=\"flex justify-between mt-6\">\n          <Button variant=\"secondary\" onClick={prev} disabled={step === 0}>\n            Back\n          </Button>\n          <Button onClick={next} disabled={step === steps.length - 1}>\n            {step === steps.length - 1 ? \"Done\" : \"Next\"}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3446, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3eb78614-bd95-4d18-a308-aa1aa1a0a736": {"__data__": {"id_": "3eb78614-bd95-4d18-a308-aa1aa1a0a736", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/index.ts", "file_name": "index.ts", "file_size": 717, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c4a0e9c0-195f-4783-a7f9-538a0e8b86c5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/index.ts", "file_name": "index.ts", "file_size": 717, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7e78e786c6fed1fe93feffd1fee3fa81e79c54b093fcb953bc3d50cb5abf22d4", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/index.ts\n\nexport { default as AskEcho } from \"./AskAgent/ChatWindow\";\nexport { default as ActionQueuePanel } from \"./ActionQueue/ActionQueuePanel\";\nexport { default as AuditPanel } from \"./AuditPanel/AuditPanel\";\nexport { default as DocsViewer } from \"./DocsViewer/DocsViewer\";\nexport { default as DocsSyncPanel } from \"./DocsSyncPanel\";\nexport { default as GmailOpsPanel } from \"./GmailOps/GmailOpsPanel\";\nexport { default as LogsPanel } from \"./LogsPanel/LogsPanel\";\nexport { default as MemoryPanel } from \"./MemoryPanel\";\nexport { default as SearchPanel } from \"./SearchPanel\";\nexport { default as StatusPanel } from \"./StatusPanel\";\nexport { default as Sidebar } from \"./Sidebar/Sidebar\";", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 716, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b1dedcc3-0dd2-4028-a633-57aba9b33ebb": {"__data__": {"id_": "b1dedcc3-0dd2-4028-a633-57aba9b33ebb", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/AskAgent/AskAgent.tsx", "file_name": "AskAgent.tsx", "file_size": 1644, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "282b49cc-8e64-4ca9-a9f7-f03c7cc8ee8c", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/AskAgent/AskAgent.tsx", "file_name": "AskAgent.tsx", "file_size": 1644, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "13aba73fff0708d369fae385335a7c4feae254332ca21389af5bbdfe99668b41", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/components/ui/AskAgent/AskAgent.tsx\n\n\"use client\"\n\nimport { useState } from \"react\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Button } from \"@/components/ui/button\"\nimport SafeMarkdown from \"@/components/SafeMarkdown\"\n\nexport default function AskAgent() {\n  const [query, setQuery] = useState(\"\")\n  const [response, setResponse] = useState<string | null>(null)\n  const [loading, setLoading] = useState(false)\n\n  async function sendQuery() {\n    if (!query) return\n    setLoading(true)\n    setResponse(null)\n\n    const res = await fetch(\"https://relay.wildfireranch.us/ask?q=\" + encodeURIComponent(query), {\n      headers: {\n        \"X-API-Key\": process.env.NEXT_PUBLIC_API_KEY || \"\"\n      }\n    })\n\n    const data = await res.json()\n    setResponse(\n      data.answer ||\n      data.function_call?.arguments ||\n      \"No answer.\"\n    )\n    setLoading(false)\n  }\n\n  if (response && typeof response !== \"string\") {\n    console.log(\"DEBUG 418:\", typeof response, response)\n  }\n\n  return (\n    <div className=\"max-w-xl space-y-4\">\n      <Textarea\n        placeholder=\"Ask Echo something...\"\n        value={query}\n        onChange={(e) => setQuery(e.target.value)}\n        disabled={loading}\n      />\n      <Button onClick={sendQuery} disabled={loading || !query}>\n        {loading ? \"Thinking...\" : \"Ask Echo\"}\n      </Button>\n      {response && (\n        <div className=\"bg-muted p-4 rounded text-sm whitespace-pre-wrap border\">\n          <div className=\"prose prose-neutral dark:prose-invert max-w-none\">\n            <SafeMarkdown>{response}</SafeMarkdown>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1643, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "343d1e2e-43f4-4063-9c82-13ea47238a27": {"__data__": {"id_": "343d1e2e-43f4-4063-9c82-13ea47238a27", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/badge.tsx", "file_name": "badge.tsx", "file_size": 882, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "95a26b24-98f2-4312-b4bf-509f6561834c", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/badge.tsx", "file_name": "badge.tsx", "file_size": 882, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "28bcc26f7cd56ff304c3c9239e2189b0fe59bc5eed9a0829f7f21fc0c6fd4ea2", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: components/ui/badge.tsx\n// Simple, styleable Badge component for statuses/labels\n\nimport React from \"react\";\nimport clsx from \"clsx\";\n\ntype BadgeVariant = \"default\" | \"success\" | \"destructive\" | \"secondary\";\n\nconst variantStyles: Record<BadgeVariant, string> = {\n  default: \"bg-gray-200 text-gray-700\",\n  success: \"bg-green-100 text-green-800 border border-green-300\",\n  destructive: \"bg-red-100 text-red-800 border border-red-300\",\n  secondary: \"bg-blue-100 text-blue-800 border border-blue-300\",\n};\n\nexport const Badge: React.FC<{\n  children: React.ReactNode;\n  variant?: BadgeVariant;\n  className?: string;\n}> = ({ children, variant = \"default\", className = \"\" }) => (\n  <span\n    className={clsx(\n      \"inline-block rounded px-2 py-0.5 text-xs font-semibold\",\n      variantStyles[variant],\n      className\n    )}\n  >\n    {children}\n  </span>\n);\n\nexport default Badge;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 881, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "99648ab2-897a-48c0-838f-65b84df95cf4": {"__data__": {"id_": "99648ab2-897a-48c0-838f-65b84df95cf4", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/button.tsx", "file_name": "button.tsx", "file_size": 2123, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "816ee76c-ad91-461d-8e8e-f7844e8705a0", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/button.tsx", "file_name": "button.tsx", "file_size": 2123, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "5acae26d4f3e5cee68ccb274e89c6200ea6cfba0b2cee1e5b762ccb1c82dcc56", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2122, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "47791dcf-be74-4f5d-8b82-6427624f3479": {"__data__": {"id_": "47791dcf-be74-4f5d-8b82-6427624f3479", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/card.tsx", "file_name": "card.tsx", "file_size": 1989, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "01faa84c-5693-40ef-93d9-9137f833d3d5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/card.tsx", "file_name": "card.tsx", "file_size": 1989, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "84e71bf0fb3a2b49d04640f559ebb1a50c064a602ea59cb4da242ef6bb1272e3", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1988, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "1dffc1eb-2c93-4993-8eb7-c080c71d3cdb": {"__data__": {"id_": "1dffc1eb-2c93-4993-8eb7-c080c71d3cdb", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/input.tsx", "file_name": "input.tsx", "file_size": 967, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "70dcc4b7-3f74-495d-afc2-8d6970803b30", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/input.tsx", "file_name": "input.tsx", "file_size": 967, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7d85e478a9fad7278724f9b110075e07db2e3817a938ea0be01ce3b18147bf8c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 966, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c1db7728-6a92-4e13-a65c-212183b63c27": {"__data__": {"id_": "c1db7728-6a92-4e13-a65c-212183b63c27", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/label.tsx", "file_name": "label.tsx", "file_size": 611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "9b5d1a87-8cfa-4eac-9f34-6b99835b9dbd", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/label.tsx", "file_name": "label.tsx", "file_size": 611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "662434cbf256230ee4aaf33648d833dd6dd89b024a80addc48580de1c47ea422", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 610, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "26c470e5-4630-4347-a307-e73151db2567": {"__data__": {"id_": "26c470e5-4630-4347-a307-e73151db2567", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/progress.tsx", "file_name": "progress.tsx", "file_size": 698, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "5cedd8b6-185c-4504-b9b8-0c5b4022e187", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/progress.tsx", "file_name": "progress.tsx", "file_size": 698, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9ea20f55c6d7bc14e15617ee94315dea84bd0587530774159fe79bc402c8734c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: progress.tsx\n// Directory: frontend/components/ui\n// Purpose: shadcn/ui Progress bar component\n\n\"use client\";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst Progress = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value?: number }\n>(({ className, value, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"relative h-2 w-full overflow-hidden rounded-full bg-secondary\", className)}\n    {...props}\n  >\n    <div\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value ?? 0)}%)` }}\n    />\n  </div>\n));\nProgress.displayName = \"Progress\";\n\nexport { Progress };", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 697, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "49a8370e-030f-4b8f-a4fe-a891f0a0a6f2": {"__data__": {"id_": "49a8370e-030f-4b8f-a4fe-a891f0a0a6f2", "embedding": null, "metadata": {"file_path": "/app/frontend/src/components/ui/textarea.tsx", "file_name": "textarea.tsx", "file_size": 759, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f7bc13d9-48d0-45df-99b3-34123a4ff3fc", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/components/ui/textarea.tsx", "file_name": "textarea.tsx", "file_size": 759, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8e30eb2d01f06f413d8cdcd8d582e60d7b8db2705c1dea8692d343c9d56da20d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Textarea({ className, ...props }: React.ComponentProps<\"textarea\">) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        \"border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 758, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "fe1bff42-bc46-4842-8124-165bdb5fc5d2": {"__data__": {"id_": "fe1bff42-bc46-4842-8124-165bdb5fc5d2", "embedding": null, "metadata": {"file_path": "/app/frontend/src/lib/api.ts", "file_name": "api.ts", "file_size": 278, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c28fc02a-c386-43ff-ae78-208479f8d59b", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/lib/api.ts", "file_name": "api.ts", "file_size": 278, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "f0a51f6adaa15357dc7a558b99cce49a4c5634412f71692bd165c95bc28d6e16", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: lib/api.ts\n// Directory: frontend/src/lib\n// Purpose: Single source of truth for backend API config\n\nexport const API_ROOT =\n  process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\";\n\nexport const API_KEY =\n  process.env.NEXT_PUBLIC_API_KEY ?? \"\";  // \u2190 new line", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 275, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "45f2b7f7-5051-4cdf-ae64-edbdb255b495": {"__data__": {"id_": "45f2b7f7-5051-4cdf-ae64-edbdb255b495", "embedding": null, "metadata": {"file_path": "/app/frontend/src/lib/toMDString.ts", "file_name": "toMDString.ts", "file_size": 422, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d86e90a0-519a-4c83-ad34-c383fe0cd8c1", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/lib/toMDString.ts", "file_name": "toMDString.ts", "file_size": 422, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "2fd784610d377b370b49fed694caa851ba78cce062f5238df3ed5e0d6a547410", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "export function toMDString(val: unknown): string {\n  if (val == null) return \"\";\n  if (typeof val === \"string\") return val;\n  if (Array.isArray(val)) {\n    return val.map((v) => toMDString(v)).join(\"\\n\\n\");\n  }\n  if (typeof val === \"object\") {\n    try {\n      return \"```json\\n\" + JSON.stringify(val, null, 2) + \"\\n```\";\n    } catch {\n      return String(val);\n    }\n  }\n  return String(val);\n}\nexport default toMDString;", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 421, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "cdbca185-3e63-467e-9afb-cb751799e1ed": {"__data__": {"id_": "cdbca185-3e63-467e-9afb-cb751799e1ed", "embedding": null, "metadata": {"file_path": "/app/frontend/src/lib/utils.ts", "file_name": "utils.ts", "file_size": 196, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "a9a12e36-3853-41ee-af61-d7f8ded4d8c7", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/lib/utils.ts", "file_name": "utils.ts", "file_size": 196, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "bdf8cbfa9e05a8fa5659b0393ed7ac0a84ba93514692113b784cfb0cf72bfe76", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// File: src/lib/utils.ts\n\nimport { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 195, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "f3e66473-5f6f-40d5-ae68-9e2b8a16e5a0": {"__data__": {"id_": "f3e66473-5f6f-40d5-ae68-9e2b8a16e5a0", "embedding": null, "metadata": {"file_path": "/app/frontend/src/types/react-syntax-highlighter.d.ts", "file_name": "react-syntax-highlighter.d.ts", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c8e052b5-fdf0-461b-8a65-04c2ae17e8a5", "node_type": "4", "metadata": {"file_path": "/app/frontend/src/types/react-syntax-highlighter.d.ts", "file_name": "react-syntax-highlighter.d.ts", "file_size": 173, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "6f04d84ba8fefaff226f19dfc97514c8553900d4e31fe183d8a4d3afbe9f3821", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "declare module \"react-syntax-highlighter\";\ndeclare module \"react-syntax-highlighter/dist/esm/styles/prism\";\ndeclare module \"react-syntax-highlighter/dist/cjs/styles/prism\";", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 172, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2233adf4-5aa9-480a-81e0-860d3653bf8f": {"__data__": {"id_": "2233adf4-5aa9-480a-81e0-860d3653bf8f", "embedding": null, "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "08fe0554-6ffc-47ac-baa9-4eda73e97263", "node_type": "4", "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7c0a1e7d9f39e5480ab169586e62e29506e7f103ced6ef6aeba6649c6f01cd51", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "8679f336-dea5-4980-b9f2-90a7e9e983c5", "node_type": "1", "metadata": {}, "hash": "15051342d77f5fd3fd6ce596c5f41c76bf0ef9dbe7acbd19e354a47580e5554f", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/google_docs_sync.py\n# Purpose: Google Docs sync for COMMAND_CENTER folder \u2192 local /docs/imported\n# Directory Structure:\n# - GOOGLE_CREDS_JSON is decoded at runtime into /tmp/credentials.json\n# - GOOGLE_TOKEN_JSON is decoded (if present) into frontend/sync/token.json\n# - Synced .md files are saved into docs/imported/\n# - OAuth flow is launched only if token is missing or invalid\n\nimport os\nimport json\nimport base64\nfrom pathlib import Path\nfrom google.oauth2.credentials import Credentials\nfrom google_auth_oauthlib.flow import InstalledAppFlow\nfrom googleapiclient.discovery import build\nfrom googleapiclient.errors import HttpError\nfrom markdownify import markdownify as md\nfrom google.auth.transport.requests import Request\n\n# === Config ===\nSCOPES = [\n    \"https://www.googleapis.com/auth/drive.readonly\",\n    \"https://www.googleapis.com/auth/documents.readonly\"\n]\nCREDENTIALS_PATH = Path(\"/tmp/credentials.json\")\nTOKEN_PATH = Path(\"frontend/sync/token.json\")\nIMPORT_PATH = Path(\"docs/imported\")\nCOMMAND_CENTER_FOLDER_NAME = \"COMMAND_CENTER\"\nIMPORT_PATH.mkdir(parents=True, exist_ok=True)\n\n# === Auth ===\ndef get_google_service():\n    creds = None\n\n    # Decode credentials from env at runtime only\n    if not CREDENTIALS_PATH.exists():\n        if os.getenv(\"ENV\") == \"local\":\n            local_path = Path(\"frontend/sync/credentials.json\")\n            print(\"\ud83d\udd27 Using local credentials.json from frontend/sync/\")\n            if not local_path.exists():\n                raise FileNotFoundError(\"\u274c Local credentials.json not found at frontend/sync/\")\n            CREDENTIALS_PATH.write_text(local_path.read_text())\n        else:\n            raw = os.getenv(\"GOOGLE_CREDS_JSON\")\n            print(\"\ud83e\uddea Length of GOOGLE_CREDS_JSON:\", len(raw) if raw else \"Not Found\")\n            if not raw:\n                raise FileNotFoundError(\"\u274c Missing GOOGLE_CREDS_JSON in environment variables\")\n            decoded = base64.b64decode(raw.encode()).decode()\n            CREDENTIALS_PATH.write_text(decoded)\n            print(f\"\u2705 credentials.json written to: {CREDENTIALS_PATH}\")\n\n    # Decode token from env at runtime only (optional bootstrap)\n    if not TOKEN_PATH.exists():\n        token_raw = os.getenv(\"GOOGLE_TOKEN_JSON\")\n        print(\"\ud83e\uddea GOOGLE_TOKEN_JSON found:\", bool(token_raw))\n        if token_raw:\n            TOKEN_PATH.write_text(base64.b64decode(token_raw).decode())\n            print(f\"\u2705 token.json written to: {TOKEN_PATH}\")\n\n    # Load token if available\n    if TOKEN_PATH.exists():\n        creds = Credentials.from_authorized_user_file(TOKEN_PATH, SCOPES)\n\n    # If token missing or expired, launch interactive auth flow\n    if not creds or not creds.valid:\n        if creds and creds.expired and creds.refresh_token:\n            creds.refresh(Request())\n        else:\n            flow = InstalledAppFlow.from_client_secrets_file(str(CREDENTIALS_PATH), SCOPES)\n            print(\"\ud83c\udf10 Launching OAuth flow on dynamic localhost port...\")\n            creds = flow.run_local_server(port=0)\n        # Save new token\n        with open(TOKEN_PATH, 'w') as token:\n            token.write(creds.to_json())\n\n    # Build API clients\n    drive_service = build('drive', 'v3', credentials=creds)\n    docs_service = build('docs', 'v1', credentials=creds)\n    return drive_service, docs_service\n\n# === Google Docs Operations ===\ndef find_folder_id(drive_service, folder_name):\n    results = drive_service.files().list(\n        q=f\"mimeType='application/vnd.google-apps.folder' and name='{folder_name}'\",\n        spaces='drive',\n        fields=\"files(id, name)\",\n    ).execute()\n    folders = results.get('files', [])\n    return folders[0]['id'] if folders else None\n\ndef get_docs_in_folder(drive_service, folder_id):\n    query = f\"'{folder_id}' in parents and mimeType='application/vnd.google-apps.document'\"\n    results = drive_service.files().list(q=query, fields=\"files(id, name)\").execute()\n    return results.get('files', [])\n\ndef fetch_and_save_doc(docs_service, file):\n    doc = docs_service.documents().get(documentId=file['id']).execute()\n    title = file['name'].replace(\" \", \"_\").lower()\n    content = doc.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4129, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "8679f336-dea5-4980-b9f2-90a7e9e983c5": {"__data__": {"id_": "8679f336-dea5-4980-b9f2-90a7e9e983c5", "embedding": null, "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "08fe0554-6ffc-47ac-baa9-4eda73e97263", "node_type": "4", "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7c0a1e7d9f39e5480ab169586e62e29506e7f103ced6ef6aeba6649c6f01cd51", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "2233adf4-5aa9-480a-81e0-860d3653bf8f", "node_type": "1", "metadata": {"file_path": "/app/frontend/sync/sync_google_docs.py", "file_name": "sync_google_docs.py", "file_type": "text/x-python", "file_size": 4982, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "f43038bde8ab31a99e37644ed2a320483bfc4ac50c42f9a19426c2b704c4d5fe", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "folder_name):\n    results = drive_service.files().list(\n        q=f\"mimeType='application/vnd.google-apps.folder' and name='{folder_name}'\",\n        spaces='drive',\n        fields=\"files(id, name)\",\n    ).execute()\n    folders = results.get('files', [])\n    return folders[0]['id'] if folders else None\n\ndef get_docs_in_folder(drive_service, folder_id):\n    query = f\"'{folder_id}' in parents and mimeType='application/vnd.google-apps.document'\"\n    results = drive_service.files().list(q=query, fields=\"files(id, name)\").execute()\n    return results.get('files', [])\n\ndef fetch_and_save_doc(docs_service, file):\n    doc = docs_service.documents().get(documentId=file['id']).execute()\n    title = file['name'].replace(\" \", \"_\").lower()\n    content = doc.get(\"body\", {}).get(\"content\", [])\n    html = \"\"\n    for element in content:\n        if 'paragraph' in element:\n            for el in element['paragraph'].get('elements', []):\n                html += el.get('textRun', {}).get('content', '')\n            html += \"\\n\"\n    markdown = md(html)\n    out_path = IMPORT_PATH / f\"{title}.md\"\n    out_path.write_text(markdown, encoding='utf-8')\n    return out_path.name\n\n# === Main Sync Function ===\ndef sync_google_docs():\n    drive_service, docs_service = get_google_service()\n    folder_id = find_folder_id(drive_service, COMMAND_CENTER_FOLDER_NAME)\n    if not folder_id:\n        raise RuntimeError(f\"Folder '{COMMAND_CENTER_FOLDER_NAME}' not found in Google Drive\")\n    files = get_docs_in_folder(drive_service, folder_id)\n    return [fetch_and_save_doc(docs_service, f) for f in files]", "mimetype": "text/plain", "start_char_idx": 3375, "end_char_idx": 4959, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0d538ff8-c6e7-480e-9689-eebbba7c2f1d": {"__data__": {"id_": "0d538ff8-c6e7-480e-9689-eebbba7c2f1d", "embedding": null, "metadata": {"file_path": "/app/frontend/tailwind.config.js", "file_name": "tailwind.config.js", "file_type": "application/javascript", "file_size": 907, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "51fafe6d-a61a-40d4-a98f-95663f297bf6", "node_type": "4", "metadata": {"file_path": "/app/frontend/tailwind.config.js", "file_name": "tailwind.config.js", "file_type": "application/javascript", "file_size": 907, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "23ef324d1501af468d0b825314f9096827e8ae1f72c68d3d7bcbe8e941fb56a4", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    './app/**/*.{js,ts,jsx,tsx,mdx}',\n    './components/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/app/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/components/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/layouts/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/**/*.mdx'\n  ],\n  theme: {\n    extend: {\n      fontFamily: {\n        sans: ['var(--font-geist-sans)', 'ui-sans-serif', 'system-ui'],\n        mono: ['var(--font-geist-mono)', 'ui-monospace', 'SFMono-Regular']\n      },\n      borderRadius: {\n        sm: 'calc(var(--radius) - 4px)',\n        md: 'calc(var(--radius) - 2px)',\n        lg: 'var(--radius)',\n        xl: 'calc(var(--radius) + 4px)'\n      },\n      colors: {\n        border: 'var(--border)'\n        // You can add more: e.g., background, foreground, etc.\n      }\n    }\n  },\n  darkMode: 'class',\n  plugins: [require('@tailwindcss/typography')]\n};", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 907, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "13dd44bb-9093-490b-ab64-4d3c8c12b40b": {"__data__": {"id_": "13dd44bb-9093-490b-ab64-4d3c8c12b40b", "embedding": null, "metadata": {"file_path": "/app/frontend/tests/SafeMarkdown.test.tsx", "file_name": "SafeMarkdown.test.tsx", "file_size": 898, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "12511bcf-39c2-4e3f-9798-0568e655fbf8", "node_type": "4", "metadata": {"file_path": "/app/frontend/tests/SafeMarkdown.test.tsx", "file_name": "SafeMarkdown.test.tsx", "file_size": 898, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1f8dcc2a9dd1a1d705c14dc23aa4bfb65317dc62480c7ed78af5486657033d03", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { describe, it, expect, vi } from 'vitest';\nimport React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport SafeMarkdown from '../src/components/SafeMarkdown';\n\ndescribe('SafeMarkdown', () => {\n  it('renders markdown strings without warning', () => {\n    const warn = vi.spyOn(console, 'warn').mockImplementation(() => {});\n    const html = renderToStaticMarkup(<SafeMarkdown>**bold**</SafeMarkdown>);\n    expect(html).toContain('<strong>bold</strong>');\n    expect(warn).not.toHaveBeenCalled();\n    warn.mockRestore();\n  });\n\n  it('warns when non-string is provided', () => {\n    const warn = vi.spyOn(console, 'warn').mockImplementation(() => {});\n    const html = renderToStaticMarkup(\n      <SafeMarkdown>{123 as unknown as string}</SafeMarkdown>\n    );\n    expect(html).toContain('123');\n    expect(warn).toHaveBeenCalled();\n    warn.mockRestore();\n  });\n});", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 897, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2ed4aecd-565e-4d45-ba58-79cc375aafac": {"__data__": {"id_": "2ed4aecd-565e-4d45-ba58-79cc375aafac", "embedding": null, "metadata": {"file_path": "/app/frontend/tests/toMDString.test.ts", "file_name": "toMDString.test.ts", "file_size": 723, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cdaf2771-af13-4881-8a3e-2014ae513861", "node_type": "4", "metadata": {"file_path": "/app/frontend/tests/toMDString.test.ts", "file_name": "toMDString.test.ts", "file_size": 723, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "fa0977d6510c6fc19450e131fc65e6cd3fc5a605dc4add6be304fba75066f204", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import { describe, it, expect } from 'vitest';\nimport toMDString from '../src/lib/toMDString';\n\ndescribe('toMDString', () => {\n  it('converts primitives to strings', () => {\n    expect(toMDString('hello')).toBe('hello');\n    expect(toMDString(42)).toBe('42');\n    expect(toMDString(true)).toBe('true');\n    expect(toMDString(null)).toBe('');\n    expect(toMDString(undefined)).toBe('');\n  });\n\n  it('joins arrays with blank lines', () => {\n    expect(toMDString(['a', 1, false])).toBe('a\\n\\n1\\n\\nfalse');\n  });\n\n  it('formats objects as fenced JSON', () => {\n    const obj = { a: 1, b: 'two' };\n    const expected = '```json\\n' + JSON.stringify(obj, null, 2) + '\\n```';\n    expect(toMDString(obj)).toBe(expected);\n  });\n});", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 722, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "de9a04e2-1561-422f-9e60-4f455e266d96": {"__data__": {"id_": "de9a04e2-1561-422f-9e60-4f455e266d96", "embedding": null, "metadata": {"file_path": "/app/frontend/types/next-auth.d.ts", "file_name": "next-auth.d.ts", "file_size": 655, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "e1d74f3f-6392-4355-b807-6098794b2315", "node_type": "4", "metadata": {"file_path": "/app/frontend/types/next-auth.d.ts", "file_name": "next-auth.d.ts", "file_size": 655, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "0f599c34efa91b164cc9ede8fb0aeabe1d178b8a521ddd6c2ea0cadb40598f28", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "// /types/next-auth.d.ts\nimport NextAuth, { DefaultSession, DefaultUser, Profile as DefaultProfile } from \"next-auth\";\n\ndeclare module \"next-auth\" {\n  interface Profile extends DefaultProfile {\n    hd?: string; // Add hosted domain for Google SSO\n    picture?: string; // Add picture if you want it\n  }\n  interface Session {\n    user?: {\n      name?: string | null;\n      email?: string | null;\n      image?: string | null;\n      hd?: string | null;     // Add this line\n      picture?: string | null; // If you want it\n    };\n    accessToken?: string;\n  }\n  interface User extends DefaultUser {\n    hd?: string | null;\n    picture?: string | null;\n  }\n}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 654, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3cb4d07d-ad2b-498a-beac-574df3aa995c": {"__data__": {"id_": "3cb4d07d-ad2b-498a-beac-574df3aa995c", "embedding": null, "metadata": {"file_path": "/app/frontend/vitest.config.ts", "file_name": "vitest.config.ts", "file_size": 1230, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3b3698f9-b0f5-45cd-a16e-fb6d250fc55b", "node_type": "4", "metadata": {"file_path": "/app/frontend/vitest.config.ts", "file_name": "vitest.config.ts", "file_size": 1230, "creation_date": "2025-07-01", "last_modified_date": "2025-07-01", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "36b50ee75617e4b4c2b28beb0122a4e82ce69cad01c83a7706f7bde9e6bed101", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import path from 'node:path';\nimport { fileURLToPath } from 'node:url';\n\nimport { defineConfig } from 'vitest/config';\n\nimport { storybookTest } from '@storybook/addon-vitest/vitest-plugin';\n\nconst dirname =\n  typeof __dirname !== 'undefined' ? __dirname : path.dirname(fileURLToPath(import.meta.url));\n\n// More info at: https://storybook.js.org/docs/next/writing-tests/integrations/vitest-addon\nexport default defineConfig({\n  test: {\n    workspace: [\n      {\n        extends: true,\n        plugins: [\n          // The plugin will run tests for the stories defined in your Storybook config\n          // See options at: https://storybook.js.org/docs/next/writing-tests/integrations/vitest-addon#storybooktest\n          storybookTest({ configDir: path.join(dirname, '.storybook') }),\n        ],\n        test: {\n          name: 'storybook',\n          browser: {\n        enabled: true,\n        headless: true,\n        provider: 'playwright',\n        instances: [{ browser: 'chromium' }]\n      },\n          setupFiles: ['.storybook/vitest.setup.ts'],\n        },\n      },\n      {\n        extends: true,\n        test: {\n          name: 'unit',\n          include: ['tests/**/*.{test,spec}.{ts,tsx}'],\n        },\n      },\n    ],\n  },\n});", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1229, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "497f4876-c00f-4eec-b5bf-49e785f4d2f2": {"__data__": {"id_": "497f4876-c00f-4eec-b5bf-49e785f4d2f2", "embedding": null, "metadata": {"file_path": "/app/frontend/vitest.shims.d.ts", "file_name": "vitest.shims.d.ts", "file_size": 62, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "40156584-b6be-4f30-a2b0-174c90060f04", "node_type": "4", "metadata": {"file_path": "/app/frontend/vitest.shims.d.ts", "file_name": "vitest.shims.d.ts", "file_size": 62, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "a6730ed113a4a18bc77d1e3e85303c7718af0cf5a5acc6738cbb8f542abf2249", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "/// <reference types=\"@vitest/browser/providers/playwright\" />", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 62, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b2026e8b-b2b9-4bfa-bc7d-1d9256315e82": {"__data__": {"id_": "b2026e8b-b2b9-4bfa-bc7d-1d9256315e82", "embedding": null, "metadata": {"file_path": "/app/services/_init_.py", "file_name": "_init_.py", "file_type": "text/x-python", "file_size": 98, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "106921ef-d4ba-44ab-84dc-21ffb73e752e", "node_type": "4", "metadata": {"file_path": "/app/services/_init_.py", "file_name": "_init_.py", "file_type": "text/x-python", "file_size": 98, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3b4f5abb9bd25c6587e24d88b0103a9820c7c093f8b3bee2dde4d7dce8014b1d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: __init__.py\n# Directory: services/\n# Purpose: Marks this as a package for Python imports.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 97, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5a26d495-b97a-435d-8033-4e1fb2d0a652": {"__data__": {"id_": "5a26d495-b97a-435d-8033-4e1fb2d0a652", "embedding": null, "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "666a03f5-2130-4735-8080-4c155855da2f", "node_type": "4", "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9f210fc11ec9cc4474dc22449e2a178b55bede47b0e2f9ce6c86f96168bd2fa1", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09", "node_type": "1", "metadata": {}, "hash": "13ed1efb51426d9698fb7ab2b676ecf6e855a79aca15cdd1e1cbeb9c876f61a0", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: agent.py\r\n# Directory: services/\r\n# Purpose: Main Relay agent logic\u2014per-user, multi-turn, reflection, tools, OpenAI, and docgen\r\n\r\nimport os\r\nimport re\r\nimport json\r\nfrom pathlib import Path\r\nfrom typing import List, Dict, Any, Optional, AsyncGenerator\nfrom openai import AsyncOpenAI\nimport services.kb as kb\nimport httpx\nfrom services.context_engine import ContextEngine\nfrom utils.openai_client import create_openai_client\n\r\n# === Initialize OpenAI client ===\nclient = create_openai_client()\n\r\n# === Railway control endpoint for queueing actions/docs ===\nRAILWAY_KEY = os.getenv(\"API_KEY\")\nRAILWAY_URL = os.getenv(\"RAILWAY_URL\", \"https://relay.wildfireranch.us/control/queue_action\")\n\n# Optional reflection flag\nREFLECT_ENV = os.getenv(\"ENABLE_REFLECT_AND_PLAN\", \"false\").lower() in (\"1\", \"true\", \"yes\")\n\r\n# === System prompt to define Relay's identity and context awareness ===\r\nSYSTEM_PROMPT = \"\"\"\r\nYou are Relay, the intelligent assistant for Bret's WildfireRanch pursuits including the solar shack project (solar powered bitcoin mining) and developing a business plan for a utility scale solar farm.\r\nYou have access to:\r\n\r\n- Python source code in /services/\r\n- React and Next.js components in /frontend/src/app/ and /frontend/src/components/\r\n- FastAPI routes in /routes/\r\n- A local knowledge base in /docs/\r\n\r\nUse file paths in citations when helpful (e.g. src/components/LogsPanel/LogsPanel.tsx).\r\nIf the user asks about code, structure, or documentation, include relevant context.\r\nYou can generate and queue new documentation entries by calling /control/queue_action.\r\n\"\"\"\r\n\r\n# === Helper: detect requests to autogenerate docs ===\r\ndef wants_docgen(query: str) -> Optional[str]:\r\n    match = re.search(r\"(?:generate|create|make).*doc.*for ([\\w/\\\\.]+\\.\\w+)\", query.lower())\r\n    return match.group(1).strip() if match else None\r\n\r\n# === In-memory store for multi-turn history (per user) ===\r\nconversation_history: Dict[str, List[Dict[str, Any]]] = {}\r\n\r\n# === Tool dispatchers ===\r\nasync def search_docs(query: str, user_id: str) -> Dict[str, Any]:\r\n    hits = kb.search(query, user_id=user_id, k=5) if 'user_id' in kb.search.__code__.co_varnames else kb.search(query, k=5)\r\n    return {\"matches\": hits}\r\n\r\nasync def run_code_review(path: str) -> Dict[str, Any]:\r\n    base = Path(__file__).resolve().parents[1]\r\n    target = base / path\r\n    if not target.exists() or not target.is_file():\r\n        return {\"issues\": [{\"path\": path, \"error\": \"File not found\"}]}  \r\n    content = target.read_text()\r\n    return {\"issues\": [{\"path\": path, \"summary\": f\"File loaded, {len(content)} characters\"}]}  \r\n\r\n# === Reflection & plan generation ===\r\nasync def reflect_and_plan(user_id: str, query: str) -> Dict[str, Any]:\r\n    messages = [\r\n        {\"role\": \"system\", \"content\": SYSTEM_PROMPT},\r\n        {\"role\": \"assistant\", \"content\": f\"Previous context:\\n{kb.get_recent_summaries(user_id)}\" if hasattr(kb, \"get_recent_summaries\") else \"\"},\r\n        {\"role\": \"user\", \"content\": f\"Reflect on this query for planning: {query}\"},\r\n    ]\r\n    response = await client.chat.completions.create(\r\n        model=\"gpt-4o\",\r\n        messages=messages,\r\n        temperature=0.0,\r\n        stream=False\r\n    )\r\n    try:\r\n        return json.loads(response.choices[0].message.content)\r\n    except json.JSONDecodeError:\r\n        return {\"plan\": []}\r\n\r\n# === Main answer function supporting multi-turn, tools, and reflection ===\r\nasync def answer(\n    user_id: str,\n    query: str,\n    context: Optional[str] = None,\n    stream: bool = False,\n    reflect: Optional[bool] = None,\n) -> Any:\n    \"\"\"Main agent entry point.\n\n    Parameters\n    ----------\n    user_id: str\n        Unique user identifier used for history and KB.\n    query: str\n        Raw user question.\n    context: Optional[str]\n        Pre-built context window. If not supplied the ContextEngine will\n        generate one from the user's query.\n    stream: bool\n        If ``True`` yield tokens as they are produced by OpenAI.  Otherwise\n        return the complete assistant message as a string.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4052, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09": {"__data__": {"id_": "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09", "embedding": null, "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "666a03f5-2130-4735-8080-4c155855da2f", "node_type": "4", "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9f210fc11ec9cc4474dc22449e2a178b55bede47b0e2f9ce6c86f96168bd2fa1", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "5a26d495-b97a-435d-8033-4e1fb2d0a652", "node_type": "1", "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "2b1fe0a45b1debae0e509cb909ed9d8f12830215be8e37ea31dfd061f58dfd37", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "d43a0fec-8ce9-4587-9ecd-c91857aa48ee", "node_type": "1", "metadata": {}, "hash": "ac968d87f6337a724eb94f545672e67ffdc77b2a39f4ec65316b6f6f0675b098", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Parameters\n    ----------\n    user_id: str\n        Unique user identifier used for history and KB.\n    query: str\n        Raw user question.\n    context: Optional[str]\n        Pre-built context window. If not supplied the ContextEngine will\n        generate one from the user's query.\n    stream: bool\n        If ``True`` yield tokens as they are produced by OpenAI.  Otherwise\n        return the complete assistant message as a string.\n    reflect: Optional[bool]\n        If ``True`` run ``reflect_and_plan`` before answering. Defaults to\n        ``ENABLE_REFLECT_AND_PLAN`` environment variable when ``None``.\n    \"\"\"\n\n    print(f\"[agent] Incoming query from {user_id}: {query}\")\n\n    # --- Check for doc generation ---\n    target_path = wants_docgen(query)\n    if target_path:\n        return await generate_doc_for_path(target_path)\n\n    # --- Build context if not provided ---\n    if context is None:\n        engine = ContextEngine(user_id=user_id)\n        context = engine.build_context(query)\n    print(f\"[agent] Built context length: {len(context)} chars\")\n\r\n    # --- Reflection & planning (optional) ---\n    use_reflection = reflect if reflect is not None else REFLECT_ENV\n    if use_reflection:\n        plan = await reflect_and_plan(user_id, query)\n        print(f\"[agent] Reflection plan: {plan}\")\n    else:\n        plan = {\"plan\": []}\n\r\n    # --- Update conversation history ---\r\n    history = conversation_history.setdefault(user_id, [])\r\n    history.append({\"role\": \"user\", \"content\": query})\r\n    \r\n    # --- Compose messages with history and plan ---\r\n    messages: List[Dict[str, Any]] = [\r\n        {\"role\": \"system\", \"content\": SYSTEM_PROMPT},\r\n        {\"role\": \"system\", \"content\": f\"Context:\\n{context}\"},\r\n        {\"role\": \"assistant\", \"content\": f\"Plan: {json.dumps(plan)}\"},\r\n    ] + history\r\n\r\n    try:\n        response = await client.chat.completions.create(\n            model=\"gpt-4o\",\n            messages=messages,\n            stream=stream,\n            temperature=0.3,\n            functions=[\n                {\n                    \"name\": \"search_docs\",\n                    \"description\": \"Search the local /docs/ for keywords\",\n                    \"parameters\": {\"type\": \"object\", \"properties\": {\"query\": {\"type\":\"string\"}, \"user_id\": {\"type\":\"string\"}}, \"required\":[\"query\",\"user_id\"]}\n                },\r\n                {\r\n                    \"name\": \"run_code_review\",\r\n                    \"description\": \"Run static analysis on a source file path\",\r\n                    \"parameters\": {\"type\":\"object\",\"properties\":{\"path\":{\"type\":\"string\"}},\"required\":[\"path\"]}\r\n                }\r\n            ],\r\n            function_call=\"auto\"\r\n        )\r\n        if stream:\n            async def gen() -> AsyncGenerator[str, None]:\n                collected: List[str] = []\n                async for chunk in response:\n                    delta = chunk.choices[0].delta\n                    if delta and delta.content:\n                        collected.append(delta.content)\n                        yield delta.content\n                history.append({\"role\": \"assistant\", \"content\": \"\".join(collected)})\n\n            return gen()\n        else:\n            message = response.choices[0].message\n            if hasattr(message, \"function_call\") and message.function_call:\n                fname = message.function_call.name\n                fargs = json.loads(message.function_call.arguments)\n                if fname == \"search_docs\":\n                    result = await search_docs(**fargs)\n                elif fname == \"run_code_review\":\n                    result = await run_code_review(**fargs)\n                else:\n                    result = {\"error\": f\"Unknown function: {fname}\"}\n                return json.dumps(result)\n            else:\n                history.append({\"role\": \"assistant\", \"content\": message.content})\n                return message.content\n\r\n    except Exception as e:\r\n        print(\"\u274c OpenAI call failed:\", str(e))\r\n        return f\"[error] OpenAI call failed. {str(e)}\"\r\n\r\n# === Generate and queue documentation for a specific source file ===\r\nasync def generate_doc_for_path(rel_path: str) -> str:\r\n    base = Path(__file__).resolve().parents[1]\r\n    full_path = base / rel_path\r\n\r\n    if not full_path.exists():\r\n        return f\"[error] File not found: {rel_path}\"\r\n\r\n    content = full_path.read_text()\r\n    prompt = f\"\"\"\r\nYou are a helpful documentation bot. Read the following source file and write a useful Markdown documentation entry about what it is, what it does, and how it's used. Keep it concise and developer-friendly.", "mimetype": "text/plain", "start_char_idx": 3616, "end_char_idx": 8204, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "d43a0fec-8ce9-4587-9ecd-c91857aa48ee": {"__data__": {"id_": "d43a0fec-8ce9-4587-9ecd-c91857aa48ee", "embedding": null, "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "666a03f5-2130-4735-8080-4c155855da2f", "node_type": "4", "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9f210fc11ec9cc4474dc22449e2a178b55bede47b0e2f9ce6c86f96168bd2fa1", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09", "node_type": "1", "metadata": {"file_path": "/app/services/agent.py", "file_name": "agent.py", "file_type": "text/x-python", "file_size": 9196, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "fbc055ede759add1a34aa0a0585ca5be18530ce81fbd37329bb33993bcc9d942", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "{str(e)}\"\r\n\r\n# === Generate and queue documentation for a specific source file ===\r\nasync def generate_doc_for_path(rel_path: str) -> str:\r\n    base = Path(__file__).resolve().parents[1]\r\n    full_path = base / rel_path\r\n\r\n    if not full_path.exists():\r\n        return f\"[error] File not found: {rel_path}\"\r\n\r\n    content = full_path.read_text()\r\n    prompt = f\"\"\"\r\nYou are a helpful documentation bot. Read the following source file and write a useful Markdown documentation entry about what it is, what it does, and how it's used. Keep it concise and developer-friendly.\r\n\r\nFile: {rel_path}\r\n{content[:3000]}\r\n\"\"\"\r\n\r\n    response = await client.chat.completions.create(\r\n        model=\"gpt-4o\",\r\n        messages=[\r\n            {\"role\": \"system\", \"content\": SYSTEM_PROMPT},\r\n            {\"role\": \"user\", \"content\": prompt},\r\n        ],\r\n        stream=False,\r\n        temperature=0.3,\r\n    )\r\n\r\n    doc_markdown = response.choices[0].message.content\r\n    doc_path = f\"docs/generated/{rel_path.replace('/', '_').replace('.', '-')}.md\"\r\n\r\n    payload = {\r\n        \"type\": \"write_file\",\r\n        \"path\": doc_path,\r\n        \"content\": doc_markdown\r\n    }\r\n\r\n    async with httpx.AsyncClient() as http_client:\r\n        res = await http_client.post(\r\n            RAILWAY_URL,\r\n            headers={\"X-API-Key\": RAILWAY_KEY},\r\n            json=payload\r\n        )\r\n        if res.status_code == 200:\r\n            return f\"\u2705 Documentation queued to: {doc_path}\"\r\n        else:\r\n            return f\"\u274c Failed to queue documentation: {res.status_code} {res.text}\"", "mimetype": "text/plain", "start_char_idx": 7631, "end_char_idx": 9186, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c9eb9976-af7a-4846-bf66-e69db7692479": {"__data__": {"id_": "c9eb9976-af7a-4846-bf66-e69db7692479", "embedding": null, "metadata": {"file_path": "/app/services/config.py", "file_name": "config.py", "file_type": "text/x-python", "file_size": 541, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d7fc6d5b-aa0c-4da9-be5c-ca32e33e67b5", "node_type": "4", "metadata": {"file_path": "/app/services/config.py", "file_name": "config.py", "file_type": "text/x-python", "file_size": 541, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b1cb7289a6b3b78e95788843f624478cec9315c572f57fba4d55664833c7713d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "import os\nfrom pathlib import Path\n\n# Use current working directory as fallback\nDEFAULT_PROJECT_ROOT = Path.cwd()\n\nENV_NAME = os.getenv(\"ENV\", \"dev\")\nMODEL_NAME = (\n    os.getenv(\"KB_EMBED_MODEL\")\n    or os.getenv(\"OPENAI_EMBED_MODEL\")\n    or \"text-embedding-3-large\"\n)\n\n# Safer defaults: allow override, but don't break in test/dev\nINDEX_ROOT = Path(os.getenv(\"INDEX_ROOT\", str(DEFAULT_PROJECT_ROOT / \"index\" / ENV_NAME)))\nINDEX_DIR = Path(os.getenv(\"INDEX_DIR\", str(INDEX_ROOT / MODEL_NAME)))\n\nINDEX_DIR.mkdir(parents=True, exist_ok=True)", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 540, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "653f46ce-a9c2-4580-b2dd-662c5038d3ba": {"__data__": {"id_": "653f46ce-a9c2-4580-b2dd-662c5038d3ba", "embedding": null, "metadata": {"file_path": "/app/services/context_engine.py", "file_name": "context_engine.py", "file_type": "text/x-python", "file_size": 864, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "6abb1d86-2fdc-4a53-bcdf-690d30cf3a89", "node_type": "4", "metadata": {"file_path": "/app/services/context_engine.py", "file_name": "context_engine.py", "file_type": "text/x-python", "file_size": 864, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "46881be9f3fb95fe68d45ca9c2987e59ac5cf4abc4bff68ba06b0252fd3cd6ef", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/context_engine.py\n# Purpose: Drop-in ContextEngine class for all context operations (build, clear cache, etc.)\n\nfrom services.context_injector import build_context\n\nclass ContextEngine:\n    \"\"\"\n    Facade for agent context building, cache clearing, and future extensions.\n    Call anywhere as ContextEngine.build(...) or ContextEngine.clear_cache().\n    \"\"\"\n\n    @staticmethod\n    async def build(\n        query: str, \n        files: list[str], \n        topics: list[str] = [], \n        debug: bool = False\n    ):\n        \"\"\"\n        Build multi-source context for agent prompts.\n        \"\"\"\n        return await build_context(query, files, topics, debug)\n\n    @staticmethod\n    def clear_cache():\n        \"\"\"\n        Placeholder for clearing context/semantic/graph/global caches.\n        Expand as needed for production.\n        \"\"\"\n        pass", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 863, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7ceb3846-0fd3-4af9-a1f4-491b26ecf33c": {"__data__": {"id_": "7ceb3846-0fd3-4af9-a1f4-491b26ecf33c", "embedding": null, "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cc24b8c4-4e5f-40b9-8718-08d2a4e6a915", "node_type": "4", "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9f297f602ee9a7e864ad9b359ad8929e1cde5350f284b15cc02a9a64ab425c19", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "20507cc0-ee01-4a70-99ae-c8a438a646d6", "node_type": "1", "metadata": {}, "hash": "4c366a55829db5786484fa1dd8fe2a31eaeac9e9f9d92c216e0b6b38017edd69", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/context_injector.py\n# Purpose: Build optimal multi-source context blocks for agent prompts (code, docs, external topics, global context, knowledge base, and graph memory), \n#           leveraging LlamaIndex for semantic search and aggressive filtering.\n# Updated: 2025-07-02\n\nimport os\nfrom pathlib import Path\nfrom typing import List, Dict, Any, Union\n\nfrom services.semantic_retriever import get_semantic_context      # LlamaIndex semantic search\nfrom services.kb import query_index                              # Legacy KB (for optional hybrid)\nfrom services.graph import summarize_recent_context              # Graph-based memory (optional)\nfrom services.summarize_memory import summarize_memory_entry     # For summarizing recent memory, optional\n\n# === Section limits/config ===\nMAX_PROJECT_SUMMARY_CHARS = 2000\nMAX_SEMANTIC_CONTEXT_CHARS = 6000\nMAX_GRAPH_MEMORY_CHARS = 1500\nMAX_EXTERNAL_CONTEXT_CHARS = 1500\nMAX_GLOBAL_CONTEXT_CHARS = 2000\n\ndef safe_truncate(text: str, max_chars: int) -> str:\n    \"\"\"Truncates text safely, appends ellipsis if needed.\"\"\"\n    if not text: return \"\"\n    if len(text) <= max_chars: return text\n    return text[:max_chars] + \"\\n...[truncated]\"\n\n# === Load Project Summary ===\ndef load_summary(summary_file: str = \"./docs/PROJECT_SUMMARY.md\") -> str:\n    \"\"\"Loads and safely truncates the project summary file.\"\"\"\n    if os.path.exists(summary_file):\n        with open(summary_file, \"r\", encoding=\"utf-8\") as f:\n            return safe_truncate(f.read(), MAX_PROJECT_SUMMARY_CHARS)\n    return \"Project summary not available.\"\n\n# === Load Global Context ===\ndef load_global_context(path: str = \"./docs/generated/global_context.md\") -> str:\n    \"\"\"Loads and safely truncates global project context file.\"\"\"\n    if Path(path).exists():\n        with open(path, \"r\", encoding=\"utf-8\") as f:\n            return safe_truncate(f.read(), MAX_GLOBAL_CONTEXT_CHARS)\n    return \"Global project context not available.\"\n\n# === Load Markdown snippets from /context/<topic>.md files ===\ndef load_context(topics: List[str], base_dir: str = \"./context/\") -> str:\n    \"\"\"Loads and concatenates markdown for each requested topic.\"\"\"\n    chunks = []\n    for topic in topics:\n        path = Path(base_dir) / f\"{topic}.md\"\n        if path.exists():\n            with open(path, \"r\", encoding=\"utf-8\") as f:\n                content = f.read()\n                chunks.append(f\"\\n# {topic.title()}\\n{safe_truncate(content, MAX_EXTERNAL_CONTEXT_CHARS)}\")\n    return \"\\n\".join(chunks) if chunks else \"No external context available.\"\n\n# === Recent Memory Summaries (optional, using your summarizer) ===\nasync def build_recent_memory_summaries(entries: List[Dict[str, str]], max_entries: int = 5) -> str:\n    \"\"\"Summarizes recent user/agent memory entries.\"\"\"\n    if not entries: return \"No recent memory summaries.\"\n    summaries = []\n    for e in entries[-max_entries:]:\n        try:\n            summary = await summarize_memory_entry(e.get(\"question\", \"\"), e.get(\"response\", \"\"), e.get(\"context\", \"\"))\n            summaries.append(f\"- {summary}\")\n        except Exception as ex:\n            summaries.append(f\"- [Summary failed: {str(ex)}]\")\n    return \"\\n\".join(summaries)\n\n# === MAIN CONTEXT BUILDER ===\nasync def build_context(\n    query: str,\n    files: List[str] = [],\n    topics: List[str] = [],\n    debug: bool = False,\n    top_k_semantic: int = 6,\n    memory_entries: List[Dict[str, str]] = None,  # Optionally pass recent memory\n) -> Union[str, Dict[str, Any]]:\n    \"\"\"\n    Builds a multi-layered markdown context block for agent prompts:\n      - Project summary\n      - LlamaIndex-powered semantic retrieval (best chunks from code/docs)\n      - External project context (topics)\n      - Global context\n      - (Optionally) summarized graph memory\n      - (Optionally) recent memory summaries\n\n    Returns full context string, or dict with metadata if debug=True.\n    \"\"\"\n    files_used: List[Dict[str, Any]] = []\n\n    # === 1. Project Summary ===\n    project_summary = load_summary()\n    if \"not available\" not in project_summary:\n        files_used.append({\"type\": \"summary\", \"source\": \"docs/PROJECT_SUMMARY.md\"})\n\n    # === 2.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4163, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "20507cc0-ee01-4a70-99ae-c8a438a646d6": {"__data__": {"id_": "20507cc0-ee01-4a70-99ae-c8a438a646d6", "embedding": null, "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "cc24b8c4-4e5f-40b9-8718-08d2a4e6a915", "node_type": "4", "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9f297f602ee9a7e864ad9b359ad8929e1cde5350f284b15cc02a9a64ab425c19", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "7ceb3846-0fd3-4af9-a1f4-491b26ecf33c", "node_type": "1", "metadata": {"file_path": "/app/services/context_injector.py", "file_name": "context_injector.py", "file_type": "text/x-python", "file_size": 6823, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "e3e8d6400ab855020d53c6c1a8accfe3a503c5f82924b7b06b25178a05529651", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "files_used: List[Dict[str, Any]] = []\n\n    # === 1. Project Summary ===\n    project_summary = load_summary()\n    if \"not available\" not in project_summary:\n        files_used.append({\"type\": \"summary\", \"source\": \"docs/PROJECT_SUMMARY.md\"})\n\n    # === 2. Semantic Retrieval (LlamaIndex) ===\n    semantic_context = get_semantic_context(query, top_k=top_k_semantic)\n    semantic_context = safe_truncate(semantic_context, MAX_SEMANTIC_CONTEXT_CHARS)\n    files_used.append({\"type\": \"semantic\", \"desc\": f\"LlamaIndex top-{top_k_semantic} semantic retrieval\"})\n\n    # === 3. External Topic Context ===\n    external_context = load_context(topics)\n    if external_context.strip() and external_context != \"No external context available.\":\n        for topic in topics:\n            files_used.append({\"type\": \"external\", \"source\": f\"context/{topic}.md\"})\n\n    # === 4. Global Project Context ===\n    global_context = load_global_context()\n    if \"not available\" not in global_context:\n        files_used.append({\"type\": \"global\", \"source\": \"docs/generated/global_context.md\"})\n\n    # === 5. Graph Memory Context (summarized) ===\n    try:\n        graph_context = await summarize_recent_context(query)\n        graph_context = safe_truncate(graph_context, MAX_GRAPH_MEMORY_CHARS)\n        if graph_context.strip() and \"No graph memory matches\" not in graph_context:\n            files_used.append({\"type\": \"graph\", \"source\": \"neo4j\"})\n    except Exception as ex:\n        graph_context = f\"[Graph memory error: {str(ex)}]\"\n\n    # === 6. Recent Memory Summaries (optional) ===\n    memory_summaries = \"\"\n    if memory_entries:\n        try:\n            memory_summaries = await build_recent_memory_summaries(memory_entries)\n        except Exception as ex:\n            memory_summaries = f\"[Memory summary error: {str(ex)}]\"\n\n    # === Assemble final context block ===\n    full_context = f\"\"\"\n## \ud83e\udde0 Project Summary:\n{project_summary}\n\n## \ud83e\udd99 Semantic Retrieval (Top Matches):\n{semantic_context}\n\n## \ud83c\udf0d External Project Context:\n{external_context}\n\n## \ud83c\udf10 Global Project Context:\n{global_context}\n\n## \ud83e\udde0 Graph Memory Summary:\n{graph_context}\n\n## \ud83d\udcdd Recent Memory Summaries:\n{memory_summaries}\n\"\"\".strip()\n\n    # === Logging for debugging ===\n    print(f\"[CTX] Length: {len(full_context)} chars | Files used: {files_used}\")\n    if len(full_context) > 12000:\n        print(\"[CTX] WARNING: Full context exceeds 12k chars, consider increasing truncation/aggressive filtering.\")\n\n    if debug:\n        return {\n            \"context\": full_context,\n            \"files_used\": files_used,\n            \"sections\": {\n                \"summary\": project_summary,\n                \"semantic\": semantic_context,\n                \"external\": external_context,\n                \"global\": global_context,\n                \"graph\": graph_context,\n                \"memory_summaries\": memory_summaries\n            }\n        }\n\n    return full_context", "mimetype": "text/plain", "start_char_idx": 3910, "end_char_idx": 6804, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "f4340a8c-f585-4252-a04e-30b77b4291c4": {"__data__": {"id_": "f4340a8c-f585-4252-a04e-30b77b4291c4", "embedding": null, "metadata": {"file_path": "/app/services/delete_embeddings.py", "file_name": "delete_embeddings.py", "file_type": "text/x-python", "file_size": 2361, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "76c4eec5-d3af-4318-afba-f3509593d9ec", "node_type": "4", "metadata": {"file_path": "/app/services/delete_embeddings.py", "file_name": "delete_embeddings.py", "file_type": "text/x-python", "file_size": 2361, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "13197fc12fb909e4a7bc1051f2aa5f322305ef74dfe2c36743892371e657b05d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/embeddings.py\n\n\"\"\"\nRelay Embeddings Service\n-----------------------------------\n- Indexes project docs and code with OpenAI embeddings.\n- Supports semantic search for agent context, docs, and Q&A.\n- Simple CLI: build index, search index.\n\"\"\"\n\nimport os\nimport openai\nimport numpy as np\nimport pickle\n\n# Config (tweak paths/extensions as needed for your codebase)\nSEARCH_DIRS = [\"./docs\", \"./core\", \"./agents\", \"./services\"]\nEXTS = [\".md\", \".py\", \".ts\", \".tsx\"]\nEMBED_MODEL = \"text-embedding-3-small\"\nEMBED_INDEX = \"file_embeddings.pkl\"\n\nopenai.api_key = os.environ.get(\"OPENAI_API_KEY\")\n\ndef iter_files():\n    for root in SEARCH_DIRS:\n        for dirpath, _, filenames in os.walk(root):\n            for fname in filenames:\n                if any(fname.endswith(ext) for ext in EXTS):\n                    yield os.path.join(dirpath, fname)\n\ndef embed_text(text):\n    \"\"\"Get OpenAI embedding for input text.\"\"\"\n    resp = openai.embeddings.create(input=text, model=EMBED_MODEL)\n    return np.array(resp.data[0].embedding)\n\ndef build_index():\n    \"\"\"Build and save the file embedding index.\"\"\"\n    index = []\n    for fpath in iter_files():\n        with open(fpath, encoding=\"utf-8\", errors=\"ignore\") as f:\n            text = f.read()[:8000]  # Truncate for OpenAI limit\n        emb = embed_text(text)\n        index.append({\n            \"file\": fpath,\n            \"embedding\": emb,\n            \"snippet\": text[:400]  # Preview for UI/context\n        })\n        print(f\"Indexed: {fpath}\")\n    with open(EMBED_INDEX, \"wb\") as out:\n        pickle.dump(index, out)\n    print(f\"Embedding index saved to {EMBED_INDEX}\")\n\ndef search_index(query, top_k=5):\n    \"\"\"Return top_k most relevant files/snippets for a query.\"\"\"\n    with open(EMBED_INDEX, \"rb\") as f:\n        index = pickle.load(f)\n    q_emb = embed_text(query)\n    scores = []\n    for doc in index:\n        sim = np.dot(q_emb, doc[\"embedding\"])\n        scores.append((sim, doc))\n    scores.sort(reverse=True, key=lambda x: x[0])\n    return [doc for _, doc in scores[:top_k]]\n\nif __name__ == \"__main__\":\n    import sys\n    if len(sys.argv) > 1 and sys.argv[1] == \"search\":\n        query = \" \".join(sys.argv[2:]) or \"relay agent context\"\n        results = search_index(query)\n        for doc in results:\n            print(f\"{doc['file']}\\n---\\n{doc['snippet'][:200]}\\n\")\n    else:\n        build_index()", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2360, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5d20c69a-bdf8-4335-a07f-39b7eb14ec64": {"__data__": {"id_": "5d20c69a-bdf8-4335-a07f-39b7eb14ec64", "embedding": null, "metadata": {"file_path": "/app/services/docs_utils.py", "file_name": "docs_utils.py", "file_type": "text/x-python", "file_size": 4321, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "ffad7c87-206a-4b06-8aac-b38ef5776aee", "node_type": "4", "metadata": {"file_path": "/app/services/docs_utils.py", "file_name": "docs_utils.py", "file_type": "text/x-python", "file_size": 4321, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8fdd4eb55bff78d190ce92677f1fb3819535aa8cb9ef6ac4eb1b85288162ce24", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# File: docs_utils.py\n# Directory: services/\n# Purpose : Support utilities for Relay doc tiering\n#           \u2022 Extract doc_id from file\n#           \u2022 Build registry of all docs grouped by ID\n#           \u2022 Determine which file version is canonical\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nimport re\nfrom collections import defaultdict\nfrom pathlib import Path\nfrom typing import Dict, List\n\n# \u2500\u2500\u2500 Constants \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPROJECT_ROOT = Path(__file__).resolve().parents[1]\nBASE_DIR = PROJECT_ROOT / \"docs\"\nDOC_FOLDERS = [\"\", \"imported\", \"generated\"]  # relative to /docs/\n\n# \u2500\u2500\u2500 Extract doc_id from YAML frontmatter or filename \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ndef extract_doc_id(path: Path) -> str:\n    \"\"\"\n    Extract doc_id from a file's frontmatter or fallback to filename stem.\n    Assumes optional comment-style frontmatter: `doc_id: foo`\n    \"\"\"\n    try:\n        lines = path.read_text(encoding=\"utf-8\").splitlines()\n        for line in lines[:10]:\n            if \"doc_id:\" in line:\n                match = re.search(r\"doc_id:\\s*(\\S+)\", line)\n                if match:\n                    return match.group(1).strip()\n    except Exception:\n        pass\n\n    return path.stem  # fallback to filename without extension\n\n\n# \u2500\u2500\u2500 Build registry of doc_id \u2192 [all versions] \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ndef build_doc_registry() -> Dict[str, List[Path]]:\n    \"\"\"\n    Scans /docs folders and groups files by doc_id.\n    Returns dict of doc_id -> list of Path objects.\n    \"\"\"\n    registry: Dict[str, List[Path]] = defaultdict(list)\n\n    for folder in DOC_FOLDERS:\n        base = BASE_DIR / folder if folder else BASE_DIR\n        if not base.exists():\n            continue\n        for f in base.rglob(\"*.md\"):\n            try:\n                doc_id = extract_doc_id(f)\n                registry[doc_id].append(f)\n            except Exception:\n                continue\n\n    return registry\n\n\n# \u2500\u2500\u2500 Choose best version of a doc \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ndef choose_canonical_path(paths: List[Path]) -> Path:\n    \"\"\"\n    Select the canonical version of a doc from multiple paths.\n    Prefers root-level /docs/ files, else chooses most recently modified.\n    \"\"\"\n    for p in paths:\n        if p.parent == BASE_DIR:  # root /docs/\n            return p\n    return max(paths, key=lambda p: p.stat().st_mtime)\n\ndef write_doc_metadata(path: Path, updates: dict):\n    \"\"\"\n    Updates or inserts a metadata block (as comment) at the top of the markdown file.\n\n    Example block:\n    <!--\n    doc_id: foo\n    tier: global\n    pinned: true\n    -->\n    \"\"\"\n    if not path.exists():\n        raise FileNotFoundError(f\"{path} does not exist\")\n\n    lines = path.read_text(encoding=\"utf-8\").splitlines()\n    start, end = None, None\n\n    # Detect existing block\n    for i, line in enumerate(lines[:20]):\n        if line.strip() == \"<!--\":\n            start = i\n        elif line.strip() == \"-->\":\n            end = i\n            break\n\n    # Build updated block\n    metadata = {**updates}\n    if \"doc_id\" not in metadata:\n        metadata[\"doc_id\"] = extract_doc_id(path)\n\n    block = [\"<!--\"]\n    for key, val in metadata.items():\n        if val is not None:\n            block.append(f\"{key}: {str(val).lower() if isinstance(val, bool) else val}\")\n    block.append(\"-->\")\n\n    # Inject or replace block\n    if start is not None and end is not None:\n        new_lines = lines[:start] + block + lines[end + 1:]\n    else:\n        new_lines = block + [\"\"] + lines\n\n    path.write_text(\"\\n\".join(new_lines), encoding=\"utf-8\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3676, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "93a4c2c4-ce1f-480f-85a5-b7b76a033568": {"__data__": {"id_": "93a4c2c4-ce1f-480f-85a5-b7b76a033568", "embedding": null, "metadata": {"file_path": "/app/services/env_checker.py", "file_name": "env_checker.py", "file_type": "text/x-python", "file_size": 1231, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f66b532c-3be9-4c19-b7d0-fea80573db7f", "node_type": "4", "metadata": {"file_path": "/app/services/env_checker.py", "file_name": "env_checker.py", "file_type": "text/x-python", "file_size": 1231, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "09c86e0485d423abbc6b99fd5e1997f7ee716581c226e8194bd973cc2f36a5bf", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/env_checker.py\nimport os\nimport re\nfrom pathlib import Path\nfrom dotenv import dotenv_values\n\nSERVICES_DIR = Path(__file__).resolve().parents[1] / \"services\"\nENV_FILE = Path(__file__).resolve().parents[1] / \".env\"\n\nGETENV_REGEX = re.compile(r\"os\\.getenv\\([\"'](.+?)[\"']\")\n\ndef find_env_keys_in_code(path: Path):\n    found = {}\n    for file in path.rglob(\"*.py\"):\n        matches = GETENV_REGEX.findall(file.read_text(encoding=\"utf-8\"))\n        if matches:\n            found[file.name] = list(set(matches))\n    return found\n\ndef check_env_keys():\n    code_env_usage = find_env_keys_in_code(SERVICES_DIR)\n    used_keys = sorted({k for keys in code_env_usage.values() for k in keys})\n    \n    # Load .env if available\n    env_file_values = dotenv_values(dotenv_path=ENV_FILE)\n    env_file_keys = set(env_file_values.keys())\n    runtime_env_keys = set(os.environ.keys())\n\n    # Compare\n    missing_keys = [k for k in used_keys if k not in env_file_keys and k not in runtime_env_keys]\n    unused_env_keys = sorted(env_file_keys - set(used_keys))\n\n    return {\n        \"used_keys\": used_keys,\n        \"missing_in_env\": missing_keys,\n        \"defined_but_unused\": unused_env_keys,\n        \"used_in_files\": code_env_usage,\n    }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1230, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "1f29d13a-3ed7-4fa3-baeb-1cf6dbcf0037": {"__data__": {"id_": "1f29d13a-3ed7-4fa3-baeb-1cf6dbcf0037", "embedding": null, "metadata": {"file_path": "/app/services/gmail.py", "file_name": "gmail.py", "file_type": "text/x-python", "file_size": 2867, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "44fa8941-2814-4a01-aba5-3bb729e24ba4", "node_type": "4", "metadata": {"file_path": "/app/services/gmail.py", "file_name": "gmail.py", "file_type": "text/x-python", "file_size": 2867, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1b309d6e65d92dafca5eb591468558db4a55a24e00fb7b25388dbb4dc1a777cc", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/gmail.py\n# Directory: services/\n# Purpose: Gmail read/write utility using Google OAuth creds (Relay control/email ops)\n\nimport os\nfrom googleapiclient.discovery import build\nfrom email.mime.text import MIMEText\nimport base64\nfrom pathlib import Path\nfrom google.oauth2.service_account import Credentials\n\nGMAIL_SCOPES = ['https://www.googleapis.com/auth/gmail.send', 'https://www.googleapis.com/auth/gmail.readonly']\nGOOGLE_CREDS_JSON = os.getenv(\"GOOGLE_CREDS_JSON\")  # Path to service account JSON\n\ndef get_gmail_service():\n    \"\"\"Build a Gmail API client using service account credentials.\"\"\"\n    creds = Credentials.from_service_account_file(\n        GOOGLE_CREDS_JSON,\n        scopes=GMAIL_SCOPES,\n    )\n    delegated_email = os.getenv(\"NOTIFY_FROM_EMAIL\")\n    if delegated_email:\n        creds = creds.with_subject(delegated_email)\n    return build('gmail', 'v1', credentials=creds)\n\ndef send_email(to_email, subject, body):\n    \"\"\"Send an email via Gmail API.\"\"\"\n    service = get_gmail_service()\n    message = MIMEText(body)\n    message['to'] = to_email\n    message['from'] = os.getenv(\"NOTIFY_FROM_EMAIL\")\n    message['subject'] = subject\n    raw = base64.urlsafe_b64encode(message.as_bytes()).decode()\n    return service.users().messages().send(userId=\"me\", body={'raw': raw}).execute()\n\ndef list_emails(query=\"\", max_results=10):\n    \"\"\"List email messages in the inbox (by search query).\"\"\"\n    service = get_gmail_service()\n    results = service.users().messages().list(userId='me', q=query, maxResults=max_results).execute()\n    messages = results.get('messages', [])\n    emails = []\n    for m in messages:\n        msg = service.users().messages().get(userId='me', id=m['id'], format='metadata').execute()\n        headers = {h['name']: h['value'] for h in msg['payload']['headers']}\n        snippet = msg.get('snippet', '')\n        emails.append({\n            \"id\": m['id'],\n            \"snippet\": snippet,\n            \"from\": headers.get(\"From\"),\n            \"subject\": headers.get(\"Subject\"),\n            \"date\": headers.get(\"Date\"),\n        })\n    return emails\n\ndef get_email(email_id):\n    \"\"\"Fetch full content of a given email by ID.\"\"\"\n    service = get_gmail_service()\n    msg = service.users().messages().get(userId='me', id=email_id, format='full').execute()\n    headers = {h['name']: h['value'] for h in msg['payload']['headers']}\n    body = \"\"\n    if 'parts' in msg['payload']:\n        for part in msg['payload']['parts']:\n            if part['mimeType'] == 'text/plain':\n                body = base64.urlsafe_b64decode(part['body']['data']).decode()\n    else:\n        body = base64.urlsafe_b64decode(msg['payload']['body']['data']).decode()\n    return {\n        \"id\": email_id,\n        \"from\": headers.get(\"From\"),\n        \"subject\": headers.get(\"Subject\"),\n        \"date\": headers.get(\"Date\"),\n        \"body\": body\n    }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2866, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "927ffb71-8f64-4366-9524-c95a688463b0": {"__data__": {"id_": "927ffb71-8f64-4366-9524-c95a688463b0", "embedding": null, "metadata": {"file_path": "/app/services/google.py", "file_name": "google.py", "file_type": "text/x-python", "file_size": 1139, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "e48d94ae-698a-442a-b50c-b5629a72998b", "node_type": "4", "metadata": {"file_path": "/app/services/google.py", "file_name": "google.py", "file_type": "text/x-python", "file_size": 1139, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "550cf421ca22121e8050ec00065016ea4631d07fe652b67cfdb76bf6e122891e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/google.py\n\"\"\"Utility helpers for fetching Google Docs content.\"\"\"\n\nfrom typing import List, Tuple\nfrom markdownify import markdownify as md\n\nfrom .google_docs_sync import (\n    get_google_service,\n    find_folder_id,\n    get_docs_in_folder,\n    COMMAND_CENTER_FOLDER_NAME,\n)\n\n\ndef fetch_drive_docs() -> List[Tuple[str, str]]:\n    \"\"\"Return (title, markdown) for docs in the COMMAND_CENTER folder.\"\"\"\n    drive_service, docs_service = get_google_service()\n    folder_id = find_folder_id(\n        drive_service, COMMAND_CENTER_FOLDER_NAME\n    )\n    files = get_docs_in_folder(drive_service, folder_id)\n\n    docs = []\n    for file in files:\n        doc = docs_service.documents().get(documentId=file[\"id\"]).execute()\n        elements = doc.get(\"body\", {}).get(\"content\", [])\n        html = \"\"\n        for element in elements:\n            if \"paragraph\" in element:\n                for part in element[\"paragraph\"].get(\"elements\", []):\n                    html += part.get(\"textRun\", {}).get(\"content\", \"\")\n                html += \"\\n\"\n        markdown = md(html)\n        docs.append((file[\"name\"], markdown))\n    return docs", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1138, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7037f45c-377d-4478-b512-1fcc489785bb": {"__data__": {"id_": "7037f45c-377d-4478-b512-1fcc489785bb", "embedding": null, "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "2e37c06f-f4ac-4626-932c-f52902861a1b", "node_type": "4", "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8b4d2e577916b9ec66e395dda9eccce42b1486c0caea72741fcc451f830b2245", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "7c59b589-e944-4422-8273-95c823a2d419", "node_type": "1", "metadata": {}, "hash": "f1bf46cf8f7cf5da4901d553e89532e645c9f0379a159d677420a5d6c7187a1b", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/google_docs_sync.py\n# Directory: /services\n# Purpose: Synchronize Google Docs from the COMMAND_CENTER Drive folder into local Markdown files\n# Usage:\n#   1. Set env var GOOGLE_CREDS_JSON to a base64-encoded Google client secret JSON\n#   2. (Optional) Set env var GOOGLE_TOKEN_JSON to a base64-encoded OAuth token JSON for bootstrapping\n#   3. For local development, set ENV=local to allow interactive OAuth login\n#   4. Call sync_google_docs() to fetch and convert all docs into docs/imported/\n\nimport os\nimport base64\nfrom pathlib import Path\n\nfrom google.oauth2.credentials import Credentials\nfrom google_auth_oauthlib.flow import InstalledAppFlow\nfrom google.auth.transport.requests import Request\nfrom googleapiclient.discovery import build\nfrom markdownify import markdownify as md\n\n# === Configuration Constants ===\nSCOPES = [\n    \"https://www.googleapis.com/auth/drive.readonly\",\n    \"https://www.googleapis.com/auth/documents.readonly\",\n]\nCREDENTIALS_PATH = Path(\"/tmp/credentials.json\")\nTOKEN_PATH = Path(\"frontend/sync/token.json\")\nIMPORT_PATH = Path(\"docs/imported\")\nIMPORT_PATH.mkdir(parents=True, exist_ok=True)\nCOMMAND_CENTER_FOLDER_NAME = \"COMMAND_CENTER\"\n\n# === Authentication and Service Setup ===\ndef get_google_service():\n    \"\"\"\n    Ensure we have valid Google API credentials, then build Drive and Docs services.\n    - Writes out credentials.json from GOOGLE_CREDS_JSON if missing\n    - Bootstraps token.json from GOOGLE_TOKEN_JSON env var or runs interactive OAuth\n    \"\"\"\n    creds = None\n\n    # Write out credentials.json if not already present\n    if not CREDENTIALS_PATH.exists():\n        raw = os.getenv(\"GOOGLE_CREDS_JSON\")\n        if not raw:\n            raise FileNotFoundError(\"Missing GOOGLE_CREDS_JSON environment variable.\")\n        decoded = base64.b64decode(raw.encode()).decode()\n        CREDENTIALS_PATH.write_text(decoded)\n        print(f\"\u2705 Wrote client secrets to {CREDENTIALS_PATH}\")\n\n    # Bootstrap token.json from env, if provided\n    if not TOKEN_PATH.exists() and os.getenv(\"GOOGLE_TOKEN_JSON\"):\n        token_raw = os.getenv(\"GOOGLE_TOKEN_JSON\")\n        try:\n            TOKEN_PATH.write_text(base64.b64decode(token_raw).decode())\n            print(f\"\u2705 Bootstrapped token.json to {TOKEN_PATH}\")\n        except Exception as e:\n            print(f\"\u274c Failed to decode GOOGLE_TOKEN_JSON: {e}\")\n\n    # Load existing credentials\n    if TOKEN_PATH.exists():\n        creds = Credentials.from_authorized_user_file(str(TOKEN_PATH), SCOPES)\n\n    # Refresh or start OAuth flow\n    if not creds or not creds.valid:\n        if creds and creds.expired and creds.refresh_token:\n            creds.refresh(Request())\n        else:\n            # Interactive login only allowed in local dev\n            if os.getenv(\"ENV\") == \"local\":\n                flow = InstalledAppFlow.from_client_secrets_file(str(CREDENTIALS_PATH), SCOPES)\n                creds = flow.run_local_server(port=0)\n                TOKEN_PATH.parent.mkdir(parents=True, exist_ok=True)\n                TOKEN_PATH.write_text(creds.to_json())\n                print(f\"\u2705 Saved new token.json to {TOKEN_PATH}\")\n            else:\n                raise RuntimeError(\n                    \"Missing valid credentials and interactive login is disabled in production.\"\n                )\n\n    # Build and return API clients\n    drive_service = build(\"drive\", \"v3\", credentials=creds)\n    docs_service = build(\"docs\", \"v1\", credentials=creds)\n    return drive_service, docs_service\n\n# === Google Docs Fetching Utilities ===\ndef find_folder_id(drive_service, folder_name: str) -> str:\n    \"\"\"\n    Find the Drive folder ID by name.\n    Returns folder ID or raises if not found.\n    \"\"\"\n    query = f\"mimeType='application/vnd.google-apps.folder' and name='{folder_name}'\"\n    result = (\n        drive_service.files()\n        .list(q=query, spaces=\"drive\", fields=\"files(id, name)\")\n        .execute()\n    )\n    files = result.get(\"files\", [])\n    if not files:\n        raise RuntimeError(f\"Folder '{folder_name}' not found in Drive.\")\n    return files[0][\"id\"]\n\n\ndef get_docs_in_folder(drive_service, folder_id: str) -> list:\n    \"\"\"\n    List all Google Docs files within the given folder ID.\n    \"\"\"\n    query = f\"'{folder_id}' in parents and mimeType='application/vnd.google-apps.document'\"\n    result = (\n        drive_service.files()\n        .list(q=query, fields=\"files(id, name)\")\n        .execute()\n    )\n    return result.get(\"files\", [])", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4442, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7c59b589-e944-4422-8273-95c823a2d419": {"__data__": {"id_": "7c59b589-e944-4422-8273-95c823a2d419", "embedding": null, "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "2e37c06f-f4ac-4626-932c-f52902861a1b", "node_type": "4", "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8b4d2e577916b9ec66e395dda9eccce42b1486c0caea72741fcc451f830b2245", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "7037f45c-377d-4478-b512-1fcc489785bb", "node_type": "1", "metadata": {"file_path": "/app/services/google_docs_sync.py", "file_name": "google_docs_sync.py", "file_type": "text/x-python", "file_size": 6032, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "b564de4b3b7e0d86f533984d89d2bde9f7c2e9cfbb93c8995c3862dc832a1337", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "def get_docs_in_folder(drive_service, folder_id: str) -> list:\n    \"\"\"\n    List all Google Docs files within the given folder ID.\n    \"\"\"\n    query = f\"'{folder_id}' in parents and mimeType='application/vnd.google-apps.document'\"\n    result = (\n        drive_service.files()\n        .list(q=query, fields=\"files(id, name)\")\n        .execute()\n    )\n    return result.get(\"files\", [])\n\n\ndef fetch_and_save_doc(docs_service, file: dict) -> str:\n    \"\"\"\n    Fetch a Google Doc by ID, convert its content to Markdown, and save locally.\n    Returns the filename of the saved Markdown file.\n    \"\"\"\n    doc = docs_service.documents().get(documentId=file[\"id\"]).execute()\n    # Build plain-text HTML-like content\n    elements = doc.get(\"body\", {}).get(\"content\", [])\n    html = \"\"\n    for element in elements:\n        if \"paragraph\" in element:\n            for part in element[\"paragraph\"].get(\"elements\", []):\n                html += part.get(\"textRun\", {}).get(\"content\", \"\")\n            html += \"\\n\"\n    # Convert to Markdown\n    markdown = md(html)\n    # Prepare output filename\n    title_slug = file[\"name\"].replace(\" \", \"_\").lower()\n    out_path = IMPORT_PATH / f\"{title_slug}.md\"\n    out_path.write_text(markdown, encoding=\"utf-8\")\n    return out_path.name\n\n# === Main Entry Point ===\ndef sync_google_docs() -> list:\n    \"\"\"\n    Main sync function.\n    - Authenticates\n    - Finds the COMMAND_CENTER folder\n    - Fetches and saves each doc to docs/imported/\n    Returns a list of saved filenames.\n    \"\"\"\n    drive_service, docs_service = get_google_service()\n    folder_id = find_folder_id(drive_service, COMMAND_CENTER_FOLDER_NAME)\n    files = get_docs_in_folder(drive_service, folder_id)\n    saved_files = [fetch_and_save_doc(docs_service, f) for f in files]\n    print(f\"\u2705 Synced {len(saved_files)} files:\", saved_files)\n    return saved_files\n\n# If run as a script, perform sync immediately\nenabled = __name__ == \"__main__\"\nif enabled:\n    sync_google_docs()", "mimetype": "text/plain", "start_char_idx": 4059, "end_char_idx": 6021, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "330a5aca-6fab-45db-8e96-fe08ffb54ad4": {"__data__": {"id_": "330a5aca-6fab-45db-8e96-fe08ffb54ad4", "embedding": null, "metadata": {"file_path": "/app/services/graph.py", "file_name": "graph.py", "file_type": "text/x-python", "file_size": 3089, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "1406e348-9f7f-494f-b2fc-35b495af11c8", "node_type": "4", "metadata": {"file_path": "/app/services/graph.py", "file_name": "graph.py", "file_type": "text/x-python", "file_size": 3089, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "913d3b9ac4a14418df742642ec651d02b764dbe2d199fbeb3ccbb3da06e6a0f9", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/graph.py\n# Purpose: Graph query helpers for MetaPlanner (e.g. similar query lookup)\n\nfrom services.neo4j_driver import neo4j_driver  # assumes driver is initialized separately\nfrom core.logging import log_event\n\n# === Fulltext similarity query using Neo4j index ===\nasync def query_similar_routes(query: str, top_k: int = 5) -> list[dict]:\n    \"\"\"\n    Returns top K similar past queries and their associated routes and critic scores.\n    Requires a fulltext index on :Query(text) and proper ROUTED_TO links.\n    \"\"\"\n    try:\n        cypher = \"\"\"\n        CALL db.index.fulltext.queryNodes('queryTextIndex', $q) YIELD node, score\n        MATCH (node)-[:PLANNED_WITH]->(plan:Plan)-[:RAN_ON]->(agent:Agent)\n        OPTIONAL MATCH (plan)-[:VALIDATED_BY]->(c:Critic)\n        WITH plan, agent, score, COUNT(c) AS total, SUM(CASE WHEN c.passes THEN 1 ELSE 0 END) AS passed\n        RETURN agent.name AS route,\n               score,\n               passed * 1.0 / CASE WHEN total = 0 THEN 1 ELSE total END AS confidence\n        ORDER BY confidence DESC, score DESC\n        LIMIT $top_k\n        \"\"\"\n\n        records = await neo4j_driver.execute_read(\n            cypher,\n            parameters={\"q\": query, \"top_k\": top_k}\n        )\n\n        return [\n            {\n                \"route\": record[\"route\"],\n                \"confidence\": float(record[\"confidence\"]),\n                \"score\": float(record[\"score\"])\n            }\n            for record in records\n            if record[\"route\"]\n        ]\n\n    except Exception as e:\n        log_event(\"graph_query_fail\", {\"error\": str(e)})\n        return []\n# === Generate text summary of relevant prior routes ===\nasync def summarize_recent_context(query: str, top_k: int = 5) -> str:\n    \"\"\"\n    Returns a markdown-style summary of recent graph memory relevant to the query.\n    Used for injecting graph-derived intelligence into planner context.\n    \"\"\"\n    try:\n        cypher = \"\"\"\n        CALL db.index.fulltext.queryNodes('queryTextIndex', $q) YIELD node, score\n        MATCH (node)-[:PLANNED_WITH]->(plan:Plan)-[:RAN_ON]->(agent:Agent)\n        OPTIONAL MATCH (plan)-[:VALIDATED_BY]->(c:Critic)\n        WITH plan, agent, score,\n             COUNT(c) AS total,\n             SUM(CASE WHEN c.passes THEN 1 ELSE 0 END) AS passed\n        RETURN plan.route AS route,\n               agent.name AS agent,\n               passed * 1.0 / CASE WHEN total = 0 THEN 1 ELSE total END AS confidence,\n               score\n        ORDER BY confidence DESC, score DESC\n        LIMIT $top_k\n        \"\"\"\n\n        records = await neo4j_driver.execute_read(cypher, {\"q\": query, \"top_k\": top_k})\n        if not records:\n            return \"\"\n\n        summary = [\"### \ud83d\udd0e Graph Memory Summary\"]\n        for r in records:\n            summary.append(\n                f\"- `{r['route']}` via `{r['agent']}` \u2192 \"\n                f\"Confidence: {r['confidence']:.0%} \u00b7 Relevance Score: {r['score']:.2f}\"\n            )\n\n        return \"\\n\".join(summary)\n\n    except Exception as e:\n        log_event(\"graph_summary_fail\", {\"error\": str(e)})\n        return \"\"", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3082, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5075e2d5-0f28-4c8b-ba4d-eaf4337dee20": {"__data__": {"id_": "5075e2d5-0f28-4c8b-ba4d-eaf4337dee20", "embedding": null, "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "98cbaf46-e65d-4ded-9dbe-e7ba4cfaea2a", "node_type": "4", "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "6382c9dcda7c04eea1f5dc60586ab099e5953548634ba3004f5bcabe7117bfba", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "3c8951e1-6c13-4ca2-b999-00a335659b69", "node_type": "1", "metadata": {}, "hash": "652a1e9478115dd6b8536fafaf73bed82c2716f0ce81f1da2798786ca78c1fd9", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/indexer.py\n# Purpose: Recursively index code and docs with tier metadata for prioritized semantic search.\n# Stack: LlamaIndex, OpenAI, Python 3.12+\n# Usage:\n#   - For dev, run: WIPE_INDEX=true python services/indexer.py\n#   - For prod, run WITHOUT WIPE_INDEX, and only if you intend to update the index.\n\nimport os\nimport glob\nimport sys\nfrom pathlib import Path\nfrom llama_index.core import SimpleDirectoryReader, VectorStoreIndex, Document\nfrom llama_index.embeddings.openai import OpenAIEmbedding\nfrom llama_index.core.node_parser import CodeSplitter, SentenceSplitter\nfrom services.config import INDEX_DIR\n\nimport shutil\n\n# --- Guard: WIPE_INDEX only deletes if explicitly set ---\nWIPE_INDEX = os.getenv(\"WIPE_INDEX\", \"false\").lower() == \"true\"\nif WIPE_INDEX:\n    if os.path.exists(INDEX_DIR):\n        print(\"WARNING: WIPE_INDEX is set\u2014deleting and recreating index directory.\")\n        shutil.rmtree(INDEX_DIR)\n    os.makedirs(INDEX_DIR, exist_ok=True)\nelse:\n    print(\"WIPE_INDEX not set\u2014existing index will be updated or extended if run.\")\n\n# ---- 1. Define priority tiers and associated paths ----\nPRIORITY_INDEX_PATHS = [\n    (\"global\", [\"./docs/generated/global_context.md\", \"./docs/generated/global_context.auto.md\"]),\n    (\"context\", [\"./context/\"]),  # Cross-project overlays\n    (\"project_summary\", [\"./docs/PROJECT_SUMMARY.md\", \"./docs/RELAY_CODE_UPDATE.md\", \"./docs/context-commandcenter.md\"]),\n    (\"project_docs\", [\"./docs/imported/\", \"./docs/kb/\", \"./docs/*.md\"]),\n    (\"code\", [\"./services/\", \"./routes/\", \"./frontend/\", \"./src/\", \"./backend/\"]),\n]\n\n# ---- 2. Exclude Rules for Files, Extensions, and Folders ----\nIGNORED_FILENAMES = {\n    \"package-lock.json\", \"yarn.lock\", \".env\", \".DS_Store\", \".gitignore\",\n}\nIGNORED_EXTENSIONS = {\n    \".lock\", \".log\", \".exe\", \".bin\", \".jpg\", \".jpeg\", \".png\", \".gif\", \".pdf\", \".ico\",\n}\nIGNORED_FOLDERS = {\n    \"node_modules\", \".git\", \"__pycache__\", \"dist\", \"build\", \".venv\", \"env\",\n}\nMAX_FILE_SIZE_MB = 2  # Optional: skip files over 2 MB (adjust as needed)\n\ndef should_index_file(filepath: str, tier: str) -> bool:\n    \"\"\"Returns True if a file should be indexed, otherwise False.\"\"\"\n    filename = os.path.basename(filepath)\n    ext = os.path.splitext(filename)[1].lower()\n    if filename in IGNORED_FILENAMES or ext in IGNORED_EXTENSIONS:\n        return False\n    # Ignore by folder in path\n    parts = filepath.replace(\"\\\\\", \"/\").split(\"/\")\n    if any(folder in parts for folder in IGNORED_FOLDERS):\n        return False\n    # Ignore big files\n    if os.path.isfile(filepath):\n        if os.path.getsize(filepath) > MAX_FILE_SIZE_MB * 1024 * 1024:\n            return False\n    # For code tier, allow a broad set of code/doc files for review\n    if tier == \"code\":\n        return ext in {\".py\", \".js\", \".ts\", \".tsx\", \".java\", \".go\", \".cpp\", \".json\", \".md\"}\n    return True\n\n# ---- 3. Embedding Model ----\nmodel_name = (\n    os.getenv(\"KB_EMBED_MODEL\")\n    or os.getenv(\"OPENAI_EMBED_MODEL\")\n    or \"text-embedding-3-large\"\n)\nembed_model = OpenAIEmbedding(\n    model=model_name,\n    dimensions=3072 if model_name == \"text-embedding-3-large\" else None\n)\n\n# ---- 4. Language detection for code files ----\ndef get_language_from_path(file_path: str) -> str:\n    \"\"\"Returns the code language for a given file path by extension.\"\"\"\n    file_path = file_path.lower()\n    if file_path.endswith(\".py\"):\n        return \"python\"\n    elif file_path.endswith((\".js\", \".jsx\")):\n        return \"javascript\"\n    elif file_path.endswith((\".ts\", \".tsx\")):\n        return \"typescript\"\n    elif file_path.endswith(\".java\"):\n        return \"java\"\n    elif file_path.endswith(\".go\"):\n        return \"go\"\n    elif file_path.endswith(\".cpp\"):\n        return \"cpp\"\n    return \"python\"  # fallback\n\ndef collect_code_context(files: list[str], base_dir: str = \"./\") -> str:\n    \"\"\"Read and join contents of files for prompt context.\"\"\"", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3882, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3c8951e1-6c13-4ca2-b999-00a335659b69": {"__data__": {"id_": "3c8951e1-6c13-4ca2-b999-00a335659b69", "embedding": null, "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "98cbaf46-e65d-4ded-9dbe-e7ba4cfaea2a", "node_type": "4", "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "6382c9dcda7c04eea1f5dc60586ab099e5953548634ba3004f5bcabe7117bfba", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "5075e2d5-0f28-4c8b-ba4d-eaf4337dee20", "node_type": "1", "metadata": {"file_path": "/app/services/indexer.py", "file_name": "indexer.py", "file_type": "text/x-python", "file_size": 6973, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "5de00256eb95bd51d6de652db761a622823140bf4c5c223158aa510765637b54", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Language detection for code files ----\ndef get_language_from_path(file_path: str) -> str:\n    \"\"\"Returns the code language for a given file path by extension.\"\"\"\n    file_path = file_path.lower()\n    if file_path.endswith(\".py\"):\n        return \"python\"\n    elif file_path.endswith((\".js\", \".jsx\")):\n        return \"javascript\"\n    elif file_path.endswith((\".ts\", \".tsx\")):\n        return \"typescript\"\n    elif file_path.endswith(\".java\"):\n        return \"java\"\n    elif file_path.endswith(\".go\"):\n        return \"go\"\n    elif file_path.endswith(\".cpp\"):\n        return \"cpp\"\n    return \"python\"  # fallback\n\ndef collect_code_context(files: list[str], base_dir: str = \"./\") -> str:\n    \"\"\"Read and join contents of files for prompt context.\"\"\"\n    contents: list[str] = []\n    for f in files:\n        path = Path(base_dir) / f\n        if path.exists() and path.is_file():\n            try:\n                contents.append(f\"### {f}\\n\" + path.read_text())\n            except Exception:\n                continue\n    return \"\\n\\n\".join(contents)\n\ndef index_directories():\n    \"\"\"Scans all PRIORITY_INDEX_PATHS, splits, tags with tier, and embeds for semantic search.\"\"\"\n    documents = []\n    print(f\"[Indexer] Starting directory scan for priority tiers...\")\n    for tier, paths in PRIORITY_INDEX_PATHS:\n        for path in paths:\n            if path.endswith(\"/\"):\n                if os.path.exists(path):\n                    docs = SimpleDirectoryReader(path, recursive=True).load_data()\n                    filtered_docs = []\n                    for d in docs:\n                        file_path = d.metadata.get(\"file_path\") or d.metadata.get(\"filename\") or \"\"\n                        if should_index_file(file_path, tier):\n                            d.metadata = d.metadata or {}\n                            d.metadata[\"tier\"] = tier\n                            filtered_docs.append(d)\n                    documents.extend(filtered_docs)\n            elif \"*\" in path or path.endswith(\".md\"):\n                for f in glob.glob(path):\n                    if os.path.isfile(f) and should_index_file(f, tier):\n                        with open(f, \"r\", encoding=\"utf-8\") as file:\n                            text = file.read()\n                        doc = Document(\n                            text=text,\n                            metadata={\"tier\": tier, \"file_path\": f}\n                        )\n                        documents.append(doc)\n    print(f\"[Indexer] Total documents collected: {len(documents)}\")\n\n    # --- 5. Chunking: Get nodes (split text/code), flatten for indexing ---\n    all_chunked_nodes = []\n    text_splitter = SentenceSplitter(chunk_size=1024)\n    for doc in documents:\n        file_path = doc.metadata.get('file_path', '')\n        if file_path.endswith(('.py', '.js', '.ts', '.tsx', '.java', '.go', '.cpp')):\n            language = get_language_from_path(file_path)\n            code_splitter = CodeSplitter(language=language, max_chars=1024, chunk_lines=30)\n            nodes = code_splitter.get_nodes_from_documents([doc])\n            all_chunked_nodes.extend(nodes)\n        else:\n            nodes = text_splitter.get_nodes_from_documents([doc])\n            all_chunked_nodes.extend(nodes)\n    print(f\"[Indexer] Total nodes to index: {len(all_chunked_nodes)}\")\n\n    if not all_chunked_nodes:\n        print(\"[ERROR] No nodes to index! Aborting persist step.\")\n        sys.exit(1)\n\n    # --- 6. Index & Persist ---\n    index = VectorStoreIndex(\n        nodes=all_chunked_nodes,\n        embed_model=embed_model,\n        show_progress=True\n    )\n    index.storage_context.persist(persist_dir=\"./data/index\")\n    index.storage_context.persist(persist_dir=str(INDEX_DIR))\n    print(\"[Indexer] Indexing complete! Prioritized tiers saved to ./data/index.\")\n\nif __name__ == \"__main__\":\n    index_directories()", "mimetype": "text/plain", "start_char_idx": 3139, "end_char_idx": 6968, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "03920661-e957-49c6-ac0f-075c782f6fc9": {"__data__": {"id_": "03920661-e957-49c6-ac0f-075c782f6fc9", "embedding": null, "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f341f9d2-cccc-4418-be3e-715ce653f572", "node_type": "4", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d01c588f466c4ec36d6cc6e33159e38ec41482d16fe52ff681c0a47332e42511", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "40baac40-67bf-4c4c-af08-77684fd07ebf", "node_type": "1", "metadata": {}, "hash": "5b55ab877e244d33065640387c87e5c3ae1ffe6159eaabbcb1d048b14ee8d6a6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# File: services/kb.py\n# Purpose: Full-featured semantic KB for LlamaIndex (robust chunking, tiering, filtering, search)\n#           - Aggressive junk filtering & deduplication\n#           - Tier-aware, content-boosted ranking\n#           - Context-rich node metadata for intelligent agent answers\n#           - CLI & debug\n# Updated: 2025-06-30 (Debug hardening for startup hangs)\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nimport os\nimport json\nimport shutil\nimport logging\nfrom pathlib import Path\nfrom typing import List, Optional, Dict, Any\n\nfrom services.config import INDEX_DIR, INDEX_ROOT\n\nfrom llama_index.core import (\n    SimpleDirectoryReader,\n    StorageContext,\n    VectorStoreIndex,\n    load_index_from_storage,\n)\nfrom llama_index.core.extractors import TitleExtractor\nfrom llama_index.core.ingestion import IngestionPipeline\nfrom llama_index.core.node_parser import SentenceSplitter\nfrom llama_index.embeddings.openai import OpenAIEmbedding\n\n# \u2500\u2500\u2500 Logging \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s %(levelname)-7s %(name)s  %(message)s\",\n    datefmt=\"%Y-%m-%d %H:%M:%S\",\n)\nlogger = logging.getLogger(__name__)\nlogger.info(\"\ud83d\udd25 Robust KB loaded (Echo edition)\")\n\n# \u2500\u2500\u2500 Model configuration \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nMODEL_NAME = (\n    os.getenv(\"KB_EMBED_MODEL\")\n    or os.getenv(\"OPENAI_EMBED_MODEL\")\n    or \"text-embedding-3-large\"\n)\nif MODEL_NAME == \"text-embedding-3-large\":\n    EMBED_MODEL = OpenAIEmbedding(model=MODEL_NAME, dimensions=3072)\nelse:\n    EMBED_MODEL = OpenAIEmbedding(model=MODEL_NAME)\n\n# \u2500\u2500\u2500 Aggressive filtering \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nIGNORED_FILENAMES = {\n    \"package-lock.json\", \"yarn.lock\", \"pnpm-lock.yaml\", \".env\", \".DS_Store\", \".gitignore\",\n    \"poetry.lock\", \"Pipfile.lock\", \"requirements.txt\", \".dockerignore\",\n    \"Dockerfile\", \"Makefile\", \"tsconfig.json\", \"jsconfig.json\", \"node_modules\",\n    \"README.md\", \"LICENSE\", \"Thumbs.db\", \"desktop.ini\", \"mypy.ini\", \"pyrightconfig.json\",\n}\nIGNORED_EXTENSIONS = {\n    \".lock\", \".log\", \".exe\", \".bin\", \".jpg\", \".jpeg\", \".png\", \".gif\", \".pdf\", \".ico\",\n    \".tgz\", \".zip\", \".tar\", \".gz\", \".mp4\", \".mov\", \".wav\", \".pyc\", \".so\", \".dll\",\n}\nIGNORED_FOLDERS = {\n    \"node_modules\", \".git\", \"__pycache__\", \"dist\", \"build\", \".venv\", \"env\", \".mypy_cache\", \".pytest_cache\",\n}\nMAX_FILE_SIZE_MB = 2\n\ndef should_index_file(filepath: str, tier: str) -> bool:\n    filename = os.path.basename(filepath)\n    ext = os.path.splitext(filename)[1].lower()\n    if filename in IGNORED_FILENAMES or ext in IGNORED_EXTENSIONS:\n        return False\n    parts = filepath.replace(\"\\\\\", \"/\").split(\"/\")\n    if any(folder in parts for folder in IGNORED_FOLDERS):\n        return False\n    if os.path.isfile(filepath):\n        if os.path.getsize(filepath) > MAX_FILE_SIZE_MB * 1024 * 1024:\n            return False\n    if tier == \"code\":\n        return ext in {\".py\", \".js\", \".ts\", \".tsx\", \".java\", \".go\", \".cpp\", \".json\", \".md\"}\n    return True\n\n# \u2500\u2500\u2500 Index cache \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n_INDEX_CACHE: Optional[VectorStoreIndex] = None\n\n# \u2500\u2500\u2500 Scrub any stale model folders \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfor path in INDEX_ROOT.iterdir():\n    if path.is_dir() and path.name != MODEL_NAME:\n        logger.warning(\"Removing stale index folder %s\", path)\n        shutil.rmtree(path,", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3540, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "40baac40-67bf-4c4c-af08-77684fd07ebf": {"__data__": {"id_": "40baac40-67bf-4c4c-af08-77684fd07ebf", "embedding": null, "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f341f9d2-cccc-4418-be3e-715ce653f572", "node_type": "4", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d01c588f466c4ec36d6cc6e33159e38ec41482d16fe52ff681c0a47332e42511", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "03920661-e957-49c6-ac0f-075c782f6fc9", "node_type": "1", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c08db8a86f275ce50d0d47162807bf839546dc0285d8b82f25ed83da9c79864b", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "42c018dd-b14a-4e90-9136-6f4f6762f4f3", "node_type": "1", "metadata": {}, "hash": "264bb1647f268118e27506e61c4cfb5a4abe08d7118481beb9f2467861521bce", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "replace(\"\\\\\", \"/\").split(\"/\")\n    if any(folder in parts for folder in IGNORED_FOLDERS):\n        return False\n    if os.path.isfile(filepath):\n        if os.path.getsize(filepath) > MAX_FILE_SIZE_MB * 1024 * 1024:\n            return False\n    if tier == \"code\":\n        return ext in {\".py\", \".js\", \".ts\", \".tsx\", \".java\", \".go\", \".cpp\", \".json\", \".md\"}\n    return True\n\n# \u2500\u2500\u2500 Index cache \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n_INDEX_CACHE: Optional[VectorStoreIndex] = None\n\n# \u2500\u2500\u2500 Scrub any stale model folders \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nfor path in INDEX_ROOT.iterdir():\n    if path.is_dir() and path.name != MODEL_NAME:\n        logger.warning(\"Removing stale index folder %s\", path)\n        shutil.rmtree(path, ignore_errors=True)\n\n# \u2500\u2500\u2500 Ingestion pipeline \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nROOT = Path(__file__).resolve().parent\nCODE_DIRS = [ROOT.parent / p for p in (\"src\", \"backend\", \"frontend\", \"services\", \"routes\")]\nDOCS_DIR = ROOT.parent / \"docs\"\nCHUNK_SIZE, CHUNK_OVERLAP = 1024, 200\n\nINGEST_PIPELINE = IngestionPipeline(\n    transformations=[\n        TitleExtractor(llm=None),\n        SentenceSplitter(chunk_size=CHUNK_SIZE, chunk_overlap=CHUNK_OVERLAP),\n        EMBED_MODEL,\n    ]\n)\n\n# \u2500\u2500\u2500 Dimension helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef _vector_dim_current() -> int:\n    return len(EMBED_MODEL.get_text_embedding(\"dim_check\"))\n\ndef _vector_dim_stored() -> int:\n    vs_file = INDEX_DIR / \"vector_store.json\"\n    if not vs_file.exists():\n        return -1\n    store = json.loads(vs_file.read_text())\n    for rec in store.values():\n        if isinstance(rec, dict) and isinstance(rec.get(\"embedding\"), list):\n            return len(rec[\"embedding\"])\n    return -1\n\nEXPECTED_DIM = None  # placeholder\n\ndef ensure_vector_dim_initialized():\n    global EXPECTED_DIM\n    if EXPECTED_DIM is None:\n        EXPECTED_DIM = _vector_dim_current()\n\n# \u2500\u2500\u2500 Public helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef index_is_valid() -> bool:\n    stored = _vector_dim_stored()\n    valid = stored == EXPECTED_DIM and stored > 0\n    logger.info(\"[index_is_valid] stored=%s current=%d \u2192 %s\", stored, EXPECTED_DIM, valid)\n    return valid\n\ndef embed_all(verbose: bool = False) -> None:\n    \"\"\"Rebuild the full semantic index, applying file exclusion and content deduplication.\"\"\"", "mimetype": "text/plain", "start_char_idx": 2790, "end_char_idx": 5162, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "42c018dd-b14a-4e90-9136-6f4f6762f4f3": {"__data__": {"id_": "42c018dd-b14a-4e90-9136-6f4f6762f4f3", "embedding": null, "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f341f9d2-cccc-4418-be3e-715ce653f572", "node_type": "4", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d01c588f466c4ec36d6cc6e33159e38ec41482d16fe52ff681c0a47332e42511", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "40baac40-67bf-4c4c-af08-77684fd07ebf", "node_type": "1", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "23ecd64df94e9866ecf891e61af8c685fbe77f97d6f6601b767b52576b47092e", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b441a16c-472b-4a38-beb4-27f4fa05c267", "node_type": "1", "metadata": {}, "hash": "e9c72ffec81e059aca58d62c0042e6ddc78d884a854025b0a540c7ea98e0eee5", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "loads(vs_file.read_text())\n    for rec in store.values():\n        if isinstance(rec, dict) and isinstance(rec.get(\"embedding\"), list):\n            return len(rec[\"embedding\"])\n    return -1\n\nEXPECTED_DIM = None  # placeholder\n\ndef ensure_vector_dim_initialized():\n    global EXPECTED_DIM\n    if EXPECTED_DIM is None:\n        EXPECTED_DIM = _vector_dim_current()\n\n# \u2500\u2500\u2500 Public helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef index_is_valid() -> bool:\n    stored = _vector_dim_stored()\n    valid = stored == EXPECTED_DIM and stored > 0\n    logger.info(\"[index_is_valid] stored=%s current=%d \u2192 %s\", stored, EXPECTED_DIM, valid)\n    return valid\n\ndef embed_all(verbose: bool = False) -> None:\n    \"\"\"Rebuild the full semantic index, applying file exclusion and content deduplication.\"\"\"\n    logger.info(\"\ud83d\udcda Re-indexing KB with model %s\", MODEL_NAME)\n\n    docs: List = []\n    tier_paths = [\n        (\"global\", [DOCS_DIR / \"generated/global_context.md\", DOCS_DIR / \"generated/global_context.auto.md\"]),\n        (\"context\", [ROOT.parent / \"context/\"]),\n        (\"project_summary\", [\n            DOCS_DIR / \"PROJECT_SUMMARY.md\",\n            DOCS_DIR / \"RELAY_CODE_UPDATE.md\",\n            DOCS_DIR / \"context-commandcenter.md\"\n        ]),\n        (\"project_docs\", [DOCS_DIR / \"imported/\", DOCS_DIR / \"kb/\", DOCS_DIR.glob(\"*.md\")]),\n        (\"code\", CODE_DIRS),\n    ]\n\n    # Aggressively filter and tag all docs with tier/metadata\n    for tier, paths in tier_paths:\n        for path in paths:\n            # Folder: Use LlamaIndex reader (recursively)\n            if isinstance(path, Path) and path.is_dir():\n                docs_ = SimpleDirectoryReader(str(path), recursive=True).load_data() if path.exists() else []\n                docs_ = [d for d in docs_ if should_index_file(\n                    d.metadata.get(\"file_path\") or d.metadata.get(\"filename\") or \"\", tier)]\n                for d in docs_:\n                    d.metadata = d.metadata or {}\n                    d.metadata[\"tier\"] = tier\n                docs.extend(docs_)\n            # Glob or single file\n            elif hasattr(path, \"__iter__\") and not isinstance(path, str):\n                for f in path:\n                    if f and os.path.isfile(f) and should_index_file(str(f), tier):\n                        with open(f, \"r\", encoding=\"utf-8\") as file:\n                            text = file.read()\n                        from llama_index.core import Document\n                        doc = Document(text=text, metadata={\"tier\": tier, \"file_path\": str(f)})\n                        docs.append(doc)\n            elif isinstance(path, Path) and path.is_file():\n                if should_index_file(str(path), tier):\n                    with open(path, \"r\", encoding=\"utf-8\") as file:\n                        text = file.read()\n                    from llama_index.core import Document\n                    doc = Document(text=text, metadata={\"tier\": tier, \"file_path\": str(path)})\n                    docs.append(doc)\n\n    # Deduplicate by file_path and text hash\n    seen = set()\n    deduped_docs = []\n    import hashlib\n    for d in docs:\n        fp = d.metadata.get(\"file_path\", \"NOFILE\")\n        content_hash = hashlib.md5(d.text.encode(\"utf-8\")).hexdigest()\n        key = (fp, content_hash)\n        if key not in seen:\n            seen.add(key)\n            deduped_docs.append(d)\n    docs = deduped_docs\n\n    # \u2500\u2500\u2500 NEW: Debug output for document loading \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    logger.info(f\"[KB] Docs loaded for indexing: {len(docs)}\")\n    for d in docs[:5]:\n        logger.info(f\"[KB] Sample doc: {d.metadata.get('file_path')} ({len(d.text)} chars)\")\n    if len(docs) == 0:\n        logger.error(\"[KB] No valid docs to index! Aborting index build to avoid hang.\")\n        raise RuntimeError(\"No valid docs for KB index. Please check your docs/code directory population.\")", "mimetype": "text/plain", "start_char_idx": 4359, "end_char_idx": 8215, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b441a16c-472b-4a38-beb4-27f4fa05c267": {"__data__": {"id_": "b441a16c-472b-4a38-beb4-27f4fa05c267", "embedding": null, "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f341f9d2-cccc-4418-be3e-715ce653f572", "node_type": "4", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d01c588f466c4ec36d6cc6e33159e38ec41482d16fe52ff681c0a47332e42511", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "42c018dd-b14a-4e90-9136-6f4f6762f4f3", "node_type": "1", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "a93be07011494f97f89dc1652ad63635e138ded6cd68a7f39c70c4d69b6ebf01", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "3f349fe1-d202-467d-99f8-9ad0c0268c7a", "node_type": "1", "metadata": {}, "hash": "96bbcd534f2aaaf92696c272a4eef887bc511e26d27bbe2a9322328a1bdc7a69", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Aborting index build to avoid hang.\")\n        raise RuntimeError(\"No valid docs for KB index. Please check your docs/code directory population.\")\n\n    # \u2500\u2500\u2500 NEW: Wrap embedding in try/except for logging \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    try:\n        nodes = INGEST_PIPELINE.run(documents=docs)\n    except Exception as e:\n        logger.exception(\"[KB] Failed in INGEST_PIPELINE.run\")\n        raise\n\n    logger.info(\"Generated %d vector nodes\", len(nodes))\n    index = VectorStoreIndex(nodes=nodes, embed_model=EMBED_MODEL)\n    index.storage_context.persist(persist_dir=str(INDEX_DIR))\n    logger.info(\"\u2705 Index persisted \u2192 %s\", INDEX_DIR)\n\ndef get_index() -> VectorStoreIndex:\n    \"\"\"Return a cached or loaded index, rebuilding if missing or mismatched.\"\"\"\n    global _INDEX_CACHE\n    if _INDEX_CACHE is not None and index_is_valid():\n        return _INDEX_CACHE\n    if not index_is_valid():\n        embed_all()\n    ctx = StorageContext.from_defaults(persist_dir=str(INDEX_DIR))\n    _INDEX_CACHE = load_index_from_storage(ctx, embed_model=EMBED_MODEL)\n    return _INDEX_CACHE\n\n# \u2500\u2500\u2500 Core search used by routes \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef search(\n    query: str,\n    k: int = 8,\n    search_type: str = \"all\",\n    score_threshold: Optional[float] = None,\n    user_id: Optional[str] = None,\n    explain: bool = False,\n    min_global: int = 1,\n) -> List[dict]:\n    \"\"\"\n    Tier-priority semantic search: returns top results ordered by tier.\n    - Always tries to surface global/context/project summary results first.\n    - Still returns code/project_docs if more space is available.\n    - Junk/unknown tier results are de-prioritized unless nothing else is found.\n    \"\"\"\n    PRIORITY_TIERS = [\n        \"global\", \"context\", \"project_summary\", \"project_docs\", \"code\",\n    ]\n\n    qe = get_index().as_query_engine(similarity_top_k=k * 3)\n    raw = qe.query(query)\n    tiered: Dict[str, List[Any]] = {tier: [] for tier in PRIORITY_TIERS}\n    unknown = []\n    for n in getattr(raw, \"source_nodes\", []):\n        if score_threshold is not None and n.score < score_threshold:\n            continue\n        tier = n.node.metadata.get(\"tier\", \"unknown\")\n        hit = {\n            \"id\": n.node.node_id,\n            \"snippet\": n.node.text,\n            \"similarity\": n.score,\n            \"tier\": tier,\n            \"path\": n.node.metadata.get(\"file_path\"),\n            \"title\": n.node.metadata.get(\"title\", n.node.metadata.get(\"file_path\") or \"Untitled\"),\n            \"meta\": n.node.metadata,\n        }\n        if tier in PRIORITY_TIERS:\n            tiered[tier].append(hit)\n        else:\n            unknown.append(hit)\n\n    # 1. First, fill with all global/context/summary docs, up to at least min_global if available\n    prioritized = []\n    for tier in [\"global\", \"context\", \"project_summary\"]:\n        prioritized.extend(tiered[tier][:k])\n    if len(prioritized) < min_global:\n        for tier in [\"project_docs\"]:\n            prioritized.extend(tiered[tier][:k - len(prioritized)])\n    if len(prioritized) < k:\n        prioritized.extend(tiered[\"code\"][:k - len(prioritized)])\n    if len(prioritized) < k:\n        prioritized.extend(unknown[:(k - len(prioritized))])\n\n    # Remove exact duplicates (by snippet or file path)\n    seen = set()\n    out = []\n    for h in prioritized:\n        key = (h[\"snippet\"], h[\"path\"])\n        if key not in seen:\n            seen.add(key)\n            out.append(h)\n\n    # If explain, add debug info\n    if explain:\n        print(\"[KB Search Debug]\")\n        for idx, h in enumerate(out):\n            print(f\"{idx+1:2d}.", "mimetype": "text/plain", "start_char_idx": 8070, "end_char_idx": 11612, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3f349fe1-d202-467d-99f8-9ad0c0268c7a": {"__data__": {"id_": "3f349fe1-d202-467d-99f8-9ad0c0268c7a", "embedding": null, "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f341f9d2-cccc-4418-be3e-715ce653f572", "node_type": "4", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d01c588f466c4ec36d6cc6e33159e38ec41482d16fe52ff681c0a47332e42511", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "b441a16c-472b-4a38-beb4-27f4fa05c267", "node_type": "1", "metadata": {"file_path": "/app/services/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 14796, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "f0779355218ebfcf24367ffad39fa8fbf0f446519659e1c34257702573cfb7b6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "{h['tier']}: {h['title']} (score={h['similarity']:.3f})\")\n            print(f\"    Path: {h['path']}\")\n            print(f\"    Snippet: {h['snippet'][:200].replace(chr(10),' ')}\")\n        print(f\"\\nReturned {len(out)} results (out of {len(prioritized)})\")\n\n    return out[:k]\n\ndef api_search(query: str, k: int = 4, search_type: str = \"all\") -> List[dict]:\n    return search(query=query, k=k, search_type=search_type)\n\ndef query_index(query: str, k: int = 4) -> str:\n    \"\"\"Return formatted search snippets for a query.\"\"\"\n    results = search(query, k=k)\n    return \"\\n\\n\".join(f\"{r['title']}:\\n{r['snippet']}\" for r in results)\n\ndef api_reindex(verbose: bool = False) -> dict:\n    global _INDEX_CACHE\n    embed_all(verbose=verbose)\n    _INDEX_CACHE = None\n    return {\n        \"status\": \"ok\",\n        \"message\": \"Re-index complete\",\n        \"index_dir\": str(INDEX_DIR),\n        \"model\": MODEL_NAME,\n    }\n\ndef get_recent_summaries(user_id: str) -> list[str]:\n    return [\"No summary implemented yet.\"]\n\n# \u2500\u2500\u2500 CLI tools & debugging \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef _kb_cli():\n    import sys\n    import time\n    if len(sys.argv) > 1 and sys.argv[1] == \"search\":\n        q = \" \".join(sys.argv[2:]) or \"test\"\n        print(f\"\\n[KB CLI] Query: {q}\\n\")\n        t0 = time.time()\n        hits = search(q, k=10, explain=True)\n        print(f\"\u23f1\ufe0f  Search time: {time.time() - t0:.2f}s\\n\")\n        for h in hits:\n            print(f\"{h['title']} (score={h['similarity']:.2f}): {h['snippet'][:120].replace(chr(10),' ')}\u2026\")\n    else:\n        print(\"[KB CLI] Rebuilding index...\")\n        embed_all(verbose=True)\n        print(\"Index rebuild complete.\")\n\nif __name__ == \"__main__\":\n    _kb_cli()", "mimetype": "text/plain", "start_char_idx": 11613, "end_char_idx": 13315, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3ab9e8c4-ea50-4f43-a874-c4a8bb7a506d": {"__data__": {"id_": "3ab9e8c4-ea50-4f43-a874-c4a8bb7a506d", "embedding": null, "metadata": {"file_path": "/app/services/logger.py", "file_name": "logger.py", "file_type": "text/x-python", "file_size": 546, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "12bdd9f2-588a-4e21-a184-65acc4d47f3f", "node_type": "4", "metadata": {"file_path": "/app/services/logger.py", "file_name": "logger.py", "file_type": "text/x-python", "file_size": 546, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "db99f7759c1e0468028a169ef08bc2902c17e9dab08eb027bf1018df9b4c186f", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/logger.py\r\n\r\nimport logging\r\nfrom datetime import datetime\r\n\r\n# Basic logging config\r\nlogging.basicConfig(\r\n    level=logging.INFO,\r\n    format=\"%(asctime)s - %(levelname)s - %(message)s\",\r\n)\r\n\r\ndef log_info(message: str):\r\n    logging.info(message)\r\n\r\ndef log_warning(message: str):\r\n    logging.warning(message)\r\n\r\ndef log_error(message: str):\r\n    logging.error(message)\r\n\r\ndef log_event(event: str, data: dict = {}):\r\n    timestamp = datetime.utcnow().isoformat()\r\n    logging.info(f\"{timestamp} - EVENT: {event} | DATA: {data}\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 544, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "86514c3d-113e-45ff-b4f6-30687d292e69": {"__data__": {"id_": "86514c3d-113e-45ff-b4f6-30687d292e69", "embedding": null, "metadata": {"file_path": "/app/services/logs.py", "file_name": "logs.py", "file_type": "text/x-python", "file_size": 1046, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "c9baed79-0f26-4092-8771-51d378c03cb8", "node_type": "4", "metadata": {"file_path": "/app/services/logs.py", "file_name": "logs.py", "file_type": "text/x-python", "file_size": 1046, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c5a97002c30ceffec8b4eb02c62237f827740aac28faf331aaade10ab0701821", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/logs.py\nfrom datetime import datetime\nimport json\nimport pathlib\nimport requests\n\nLOG_PATH = pathlib.Path(\"logs/session_log.jsonl\")\nLOG_PATH.parent.mkdir(parents=True, exist_ok=True)\n\n# === Basic logging ===\ndef log_entry(source: str, message: str):\n    \"\"\"\n    Write a new line to the session log.\n    \"\"\"\n    entry = {\n        \"time\": datetime.utcnow().isoformat(),\n        \"source\": source,\n        \"message\": message,\n    }\n    with LOG_PATH.open(\"a\", encoding=\"utf-8\") as f:\n        f.write(json.dumps(entry) + \"\\n\")\n\n# === Retrieve recent logs ===\ndef get_recent_logs(n=100):\n    if not LOG_PATH.exists():\n        return []\n    lines = LOG_PATH.read_text(encoding=\"utf-8\").splitlines()\n    return [json.loads(line) for line in lines[-n:]]\n\n# === Smart logger: log and auto-update context ===\ndef log_and_refresh(source: str, message: str):\n    log_entry(source, message)\n    try:\n        requests.post(\"http://localhost:8000/context/update\", timeout=2)\n    except Exception:\n        pass  # fail silently if context update fails", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1045, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "61baf95e-c397-484e-9f0c-455884354f16": {"__data__": {"id_": "61baf95e-c397-484e-9f0c-455884354f16", "embedding": null, "metadata": {"file_path": "/app/services/memory.py", "file_name": "memory.py", "file_type": "text/x-python", "file_size": 2117, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "33bc1432-895e-4b38-8ff5-ee973f054d87", "node_type": "4", "metadata": {"file_path": "/app/services/memory.py", "file_name": "memory.py", "file_type": "text/x-python", "file_size": 2117, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "96cf313d8b24e535cfc2987282df81fb1cb4c64013b7ae32eeb544d8e83587dd", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/memory.py\n# Directory: services/\n# Purpose: Persist detailed session memory logs for /ask endpoint with deep context/usage auditing.\n# Features:\n#   - Logs timestamp, user, query, topics, files, and summary\n#   - Adds context_files, context_length, prompt_length, response_length, global_context_used, fallback flag\n#   - Used for MemoryPanel deep analysis and context diagnostics\n\nimport os\nimport json\nimport datetime\n\nSESSION_DIR = \"./logs/sessions\"\n\ndef summarize_memory_entry(\n    prompt: str,\n    response: str,\n    context: str = \"\",\n    actions: list = None,\n    user_id: str = \"anonymous\",\n    topics: list = None,\n    files: list = None,\n    context_files: list = None,\n    used_global_context: bool = False,\n    fallback: bool = False,\n    prompt_length: int = None,\n    response_length: int = None\n):\n    \"\"\"\n    Build a detailed memory entry for each session event.\n    Includes advanced context diagnostics for frontend insight.\n    \"\"\"\n    return {\n        \"timestamp\": datetime.datetime.utcnow().isoformat(),\n        \"user\": user_id,\n        \"query\": prompt,\n        \"topics\": topics or [],\n        \"files\": files or [],\n        \"context_files\": context_files or [],\n        \"context_length\": len(context or \"\"),\n        \"prompt_length\": prompt_length or (len(prompt) + len(context or \"\")),\n        \"response_length\": response_length or len(response or \"\"),\n        \"used_global_context\": used_global_context,\n        \"fallback\": fallback,\n        \"actions\": actions or [],\n        \"summary\": response  # Optionally replace with GPT summary if you want\n    }\n\ndef save_memory_entry(user_id: str, summary: dict):\n    \"\"\"\n    Write a single memory entry to the per-user log file as JSONL.\n    \"\"\"\n    os.makedirs(SESSION_DIR, exist_ok=True)\n    path = os.path.join(SESSION_DIR, f\"{user_id}.jsonl\")\n    with open(path, \"a\") as f:\n        f.write(json.dumps(summary) + \"\\n\")\n\n# === Utility: For debugging/logging what gets stored ===\ndef debug_log_entry(entry: dict):\n    print(\"[Memory] Log Entry Debug:\")\n    print(json.dumps(entry, indent=2)[:1200], \"...\\n\")  # Print first 1200 chars", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2116, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "20495967-655f-44e6-9788-37b9d2b0fbd4": {"__data__": {"id_": "20495967-655f-44e6-9788-37b9d2b0fbd4", "embedding": null, "metadata": {"file_path": "/app/services/mqtt_client.py", "file_name": "mqtt_client.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bae58ad2-2880-4d67-9488-d76274bad464", "node_type": "4", "metadata": {"file_path": "/app/services/mqtt_client.py", "file_name": "mqtt_client.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "72a82dd119fac02c867ade541a49eebaac688c40438130dfb08f7b64da6fe49c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 0, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7dd24142-5da5-4484-a631-4d3e99c62030": {"__data__": {"id_": "7dd24142-5da5-4484-a631-4d3e99c62030", "embedding": null, "metadata": {"file_path": "/app/services/neo4j_driver.py", "file_name": "neo4j_driver.py", "file_type": "text/x-python", "file_size": 1645, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "7d280a23-188c-412d-b437-ac1b5d09ccd8", "node_type": "4", "metadata": {"file_path": "/app/services/neo4j_driver.py", "file_name": "neo4j_driver.py", "file_type": "text/x-python", "file_size": 1645, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "721a982725f2b2f3de1901482d09ebe572e2a1421dbc80f5eaf93c1e0587b2bd", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/neo4j_driver.py\n# Purpose: Shared async Neo4j driver for query and ingestion\n\nimport os\nfrom neo4j import AsyncGraphDatabase, AsyncDriver\nfrom contextlib import asynccontextmanager\nfrom core.logging import log_event\n\n# === Config from ENV ===\nNEO4J_URI = os.getenv(\"NEO4J_URI\", \"neo4j+s://localhost:7687\")\nNEO4J_USER = os.getenv(\"NEO4J_USER\", \"neo4j\")\nNEO4J_PASSWORD = os.getenv(\"NEO4J_PASSWORD\", \"password\")\n\n# === Initialize internal driver (hidden) ===\n_driver: AsyncDriver = AsyncGraphDatabase.driver(\n    NEO4J_URI, auth=(NEO4J_USER, NEO4J_PASSWORD)\n)\n\n# \u2705 Exported handle for direct import\nneo4j_driver = _driver\n\n# === Async context manager to open sessions ===\n@asynccontextmanager\nasync def get_session():\n    # \u2705 Removed explicit `database=\"neo4j\"` \u2014 required for Neo4j Aura to work\n    async with _driver.session() as session:\n        yield session\n\n# === Execute a read-only query ===\nasync def execute_read(query: str, parameters: dict = {}) -> list[dict]:\n    try:\n        async with get_session() as session:\n            result = await session.execute_read(lambda tx: tx.run(query, parameters))\n            return [record.data() async for record in result]\n    except Exception as e:\n        log_event(\"neo4j_read_fail\", {\"error\": str(e), \"query\": query})\n        return []\n\n# === Execute a write query ===\nasync def execute_write(query: str, parameters: dict = {}) -> None:\n    try:\n        async with get_session() as session:\n            await session.execute_write(lambda tx: tx.run(query, parameters))\n    except Exception as e:\n        log_event(\"neo4j_write_fail\", {\"error\": str(e), \"query\": query})", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1638, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "fba52ff1-4be3-44ea-882d-815672630141": {"__data__": {"id_": "fba52ff1-4be3-44ea-882d-815672630141", "embedding": null, "metadata": {"file_path": "/app/services/queue.py", "file_name": "queue.py", "file_type": "text/x-python", "file_size": 169, "creation_date": "2025-07-03", "last_modified_date": "2025-07-03", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "88bc859b-b1d1-4b68-878b-ccb01526aec6", "node_type": "4", "metadata": {"file_path": "/app/services/queue.py", "file_name": "queue.py", "file_type": "text/x-python", "file_size": 169, "creation_date": "2025-07-03", "last_modified_date": "2025-07-03", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "3299d81839b53ba7380f8165930e96bed6238ab818cd52f09740d8a93795e4ce", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/queue.py\n\ndef queue_action(*args, **kwargs):\n    # TODO: Replace with actual queue logic\n    print(\"queue_action called with:\", args, kwargs)\n    return None", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 168, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "0b044b21-2c48-49ac-8aef-17658e597613": {"__data__": {"id_": "0b044b21-2c48-49ac-8aef-17658e597613", "embedding": null, "metadata": {"file_path": "/app/services/semantic_retriever.py", "file_name": "semantic_retriever.py", "file_type": "text/x-python", "file_size": 1407, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "17c0e145-b5de-4dbf-a8ee-50aeb558d73b", "node_type": "4", "metadata": {"file_path": "/app/services/semantic_retriever.py", "file_name": "semantic_retriever.py", "file_type": "text/x-python", "file_size": 1407, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "eea2e535c4df943f3e396177dc1cf83041aa517ade95cbde5e8ac8a633297bb6", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/semantic_retriever.py\n# Purpose: Provide top-K semantic context for agent prompts using LlamaIndex vector store.\n\nfrom llama_index.core import load_index_from_storage, StorageContext\nfrom llama_index.embeddings.openai import OpenAIEmbedding\nimport sys\nimport traceback\n\n# === Configuration ===\nINDEX_DIR = \"./data/index\"\nEMBED_MODEL_NAME = \"text-embedding-3-large\"\n\n# === Embedding Model and Storage Context ===\n_embed_model = OpenAIEmbedding(model=EMBED_MODEL_NAME)\ntry:\n    storage_context = StorageContext.from_defaults(persist_dir=INDEX_DIR)\n    _index = load_index_from_storage(storage_context=storage_context, embed_model=_embed_model)\nexcept Exception as e:\n    print(\"LlamaIndex load_index_from_storage FAILED:\")\n    traceback.print_exc()\n    sys.exit(1)\n\n# === Main Retrieval Function ===\ndef get_semantic_context(query: str, top_k: int = 5) -> str:\n    \"\"\"\n    Retrieves the top_k most semantically relevant code/docs chunks for the query.\n    Returns concatenated context string (with file path/title if possible).\n    \"\"\"\n    results = _index.query(query, top_k=top_k)\n    if not results:\n        return \"No semantically relevant context found.\"\n    lines = []\n    for r in results:\n        meta = r.metadata or {}\n        title = meta.get(\"file_path\") or meta.get(\"tier\") or \"Unknown Source\"\n        lines.append(f\"### {title}\\n{r.text.strip()}\")\n    return \"\\n\\n\".join(lines)", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1406, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "90a434ee-5092-4034-8e70-cb137ee8bc62": {"__data__": {"id_": "90a434ee-5092-4034-8e70-cb137ee8bc62", "embedding": null, "metadata": {"file_path": "/app/services/settings.py", "file_name": "settings.py", "file_type": "text/x-python", "file_size": 793, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "af68bc4c-397f-4d64-ab7d-753d5849ae64", "node_type": "4", "metadata": {"file_path": "/app/services/settings.py", "file_name": "settings.py", "file_type": "text/x-python", "file_size": 793, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "abec7aafa242d679b600a7103a5c4a882c093d17fbf65f7019edb7694e2dee36", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# services/settings.py\nimport os\nfrom dotenv import load_dotenv\nfrom pathlib import Path\n\n# === Load .env file automatically at app startup ===\nload_dotenv(dotenv_path=Path(__file__).resolve().parents[1] / \".env\")\n\n# === Centralized environment variables ===\nOPENAI_API_KEY = os.getenv(\"OPENAI_API_KEY\")\nGOOGLE_CLIENT_ID = os.getenv(\"GOOGLE_CLIENT_ID\")\nGOOGLE_CLIENT_SECRET = os.getenv(\"GOOGLE_CLIENT_SECRET\")\nGOOGLE_REDIRECT_URI = os.getenv(\"GOOGLE_REDIRECT_URI\", \"http://localhost:3000/auth/callback\")\n\n# === Validation helper ===\ndef assert_env(var, hint=\"\"):\n    value = os.getenv(var)\n    if not value:\n        raise RuntimeError(f\"Missing required env var: {var}. {hint}\")\n    return value\n\n# Example usage:\n# assert_env(\"OPENAI_API_KEY\", \"Set in .env or as system environment variable\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 793, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "a540590d-9d02-4cd2-a88e-8b337e7b63f3": {"__data__": {"id_": "a540590d-9d02-4cd2-a88e-8b337e7b63f3", "embedding": null, "metadata": {"file_path": "/app/services/summarize_memory.py", "file_name": "summarize_memory.py", "file_type": "text/x-python", "file_size": 818, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "08b0e869-a678-49a1-b282-20fe1ddedcec", "node_type": "4", "metadata": {"file_path": "/app/services/summarize_memory.py", "file_name": "summarize_memory.py", "file_type": "text/x-python", "file_size": 818, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "4a82ba3aa4f5651c02c25e6a733e3fbbd69bc54a1fc4dd57c9a144e71013c290", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: services/summarize_memory.py\n# Directory: services/\n# Purpose: Use OpenAI to generate concise summary of a user-agent memory exchange\n\nimport os\nfrom openai import AsyncOpenAI\nfrom utils.openai_client import create_openai_client\n\nclient = create_openai_client()\n\nasync def summarize_memory_entry(question: str, response: str, context: str = \"\") -> str:\n    prompt = f\"\"\"\nYou are a concise summarizer of agent interactions.\n\nSummarize this user query and response in 1\u20132 sentences for memory recall:\n\nQ: {question}\n\nAgent response: {response}\n\nContext (if needed):\n{context[:500]}\n\nSummary:\n\"\"\"\n    result = await client.chat.completions.create(\n        model=\"gpt-4o\",\n        messages=[{\"role\": \"user\", \"content\": prompt}],\n        temperature=0.2\n    )\n    return result.choices[0].message.content.strip()", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 815, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "92e45e3b-d9fd-4289-b577-599725645e33": {"__data__": {"id_": "92e45e3b-d9fd-4289-b577-599725645e33", "embedding": null, "metadata": {"file_path": "/app/routes/__init__.py", "file_name": "__init__.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d96b136e-e43f-4fff-8e5c-6bba157490f5", "node_type": "4", "metadata": {"file_path": "/app/routes/__init__.py", "file_name": "__init__.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9e26b6afa3588ab526e82920d5393fdaf197bdd92f7a8f4f82253597f1b4a642", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 0, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ecd2b3a5-f09c-4cf3-a9ed-3541f0174271": {"__data__": {"id_": "ecd2b3a5-f09c-4cf3-a9ed-3541f0174271", "embedding": null, "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f2742e92-9158-4420-a66b-2c08750cfba1", "node_type": "4", "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "4559a766e6f7f3ddd552ec70b8726733dd699bf81dcf3f0c18b6aa692b0f9204", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "f0a4b430-aa27-4a38-9b3e-ba516b92fa8b", "node_type": "1", "metadata": {}, "hash": "e1e7741e7b331a32664b3f5c1b118e348d4194b4f2ac17e2b867144f75a6029e", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# routes/admin.py\n# ------------------------------------------------------------------------\n# Admin and Ops Endpoints for Relay Command Center\n# Secure, auditable, and environment-driven maintenance tools.\n# ALL endpoints require a valid API key (X-API-Key header, matches API_KEY env var).\n# Review and update environment variables in Railway/Vercel/Codespaces as needed.\n# ------------------------------------------------------------------------\n\nimport os\nimport shutil\nimport psutil\nimport platform\nimport zipfile\nfrom fastapi import APIRouter, HTTPException, Request, status, Header, Depends\nfrom fastapi.responses import FileResponse\nfrom pathlib import Path\nfrom datetime import datetime\n\nfrom services.config import INDEX_DIR\n\n# ------------------------------------------------------------------------\n# ENV/CONFIG SETUP\n# ------------------------------------------------------------------------\nrouter = APIRouter(prefix=\"/admin\", tags=[\"admin-ops\"])\n\nDATA_DIR = INDEX_DIR.parent\nADMIN_LOG = DATA_DIR / \"admin_events.log\"\n\n# ------------------------------------------------------------------------\n# SECURITY: Require valid API Key (X-API-Key header) for all admin ops\n# ------------------------------------------------------------------------\ndef require_api_key(x_api_key: str = Header(..., alias=\"X-API-Key\")):\n    api_key = os.environ.get(\"API_KEY\")\n    if not api_key or x_api_key != api_key:\n        raise HTTPException(status_code=403, detail=\"Invalid or missing API key.\")\n\n# ------------------------------------------------------------------------\n# UTIL: Audit logging\u2014append all events and errors\n# ------------------------------------------------------------------------\ndef log_admin_event(msg: str):\n    timestamp = datetime.utcnow().isoformat()\n    log_entry = f\"{timestamp} | {msg}\\n\"\n    with ADMIN_LOG.open(\"a\", encoding=\"utf-8\") as f:\n        f.write(log_entry)\n\n# ------------------------------------------------------------------------\n# ENDPOINT: Clean LlamaIndex index and SQLite DBs\n# ------------------------------------------------------------------------\n@router.post(\"/clean_index\")\nasync def clean_index(\n    request: Request,\n    user: str = \"\",\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Deletes all files in the index directory and SQLite DBs.\n    Requires valid X-API-Key header.\n    \"\"\"\n    deleted_files = []\n    # --- Index directory wipe ---\n    if INDEX_DIR.exists():\n        for f in INDEX_DIR.glob(\"*\"):\n            try:\n                if f.is_file():\n                    f.unlink()\n                    deleted_files.append(str(f))\n                elif f.is_dir():\n                    shutil.rmtree(f)\n                    deleted_files.append(str(f))\n            except Exception as e:\n                log_admin_event(f\"[ERROR] Failed to delete {f}: {e}\")\n    # --- SQLite DBs wipe ---\n    for sfile in DATA_DIR.glob(\"*.sqlite*\"):\n        try:\n            sfile.unlink()\n            deleted_files.append(str(sfile))\n        except Exception as e:\n            log_admin_event(f\"[ERROR] Failed to delete {sfile}: {e}\")\n\n    # --- Audit log ---\n    client_ip = request.client.host if request.client else \"unknown\"\n    now = datetime.utcnow().isoformat()\n    log_admin_event(f\"[CLEAN_INDEX] {now} by {user or 'unknown'} from {client_ip}: Deleted {len(deleted_files)} files\")\n\n    return {\n        \"status\": \"ok\",\n        \"message\": \"Index and SQLite files cleaned.\",\n        \"deleted_files\": deleted_files,\n        \"timestamp\": now,\n        \"user\": user,\n        \"ip\": client_ip\n    }\n\n# ------------------------------------------------------------------------\n# ENDPOINT: Trigger Index Rebuild (now fully implemented)\n# ------------------------------------------------------------------------\nfrom services.indexer import index_directories  # <-- add this import at the top if missing\n\n@router.post(\"/trigger_reindex\")\nasync def trigger_reindex(\n    request: Request,\n    user: str = \"\",\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Triggers a rebuild of the LlamaIndex (semantic KB).\n    Returns status/result.\n    \"\"\"\n    try:\n        index_directories()  # This will run synchronously (blocking until finished)\n        log_admin_event(f\"[REINDEX_TRIGGER] SUCCESS by {user or 'unknown'} from {request.client.host}\")\n        return {\"status\": \"ok\", \"message\": \"Reindex complete.\"}\n    except Exception as exc:\n        log_admin_event(f\"[REINDEX_TRIGGER] ERROR by {user or 'unknown'} from {request.client.host}: {exc}\")\n        raise HTTPException(status_code=500, detail=f\"Reindex failed: {exc}\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4575, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "f0a4b430-aa27-4a38-9b3e-ba516b92fa8b": {"__data__": {"id_": "f0a4b430-aa27-4a38-9b3e-ba516b92fa8b", "embedding": null, "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "f2742e92-9158-4420-a66b-2c08750cfba1", "node_type": "4", "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "4559a766e6f7f3ddd552ec70b8726733dd699bf81dcf3f0c18b6aa692b0f9204", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "ecd2b3a5-f09c-4cf3-a9ed-3541f0174271", "node_type": "1", "metadata": {"file_path": "/app/routes/admin.py", "file_name": "admin.py", "file_type": "text/x-python", "file_size": 7292, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "156a15f01aa5601ae60cff4a0506705e25fe038add1e0c291bdd8b4f84ba3740", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# ------------------------------------------------------------------------\n# ENDPOINT: Health Check (disk, CPU, memory, config summary)\n# ------------------------------------------------------------------------\n@router.get(\"/health_check\")\nasync def health_check(\n    request: Request,\n    user: str = \"\",\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Returns backend, disk, memory, and config health for diagnostics.\n    Requires valid X-API-Key header.\n    \"\"\"\n    health = {\n        \"system\": platform.system(),\n        \"release\": platform.release(),\n        \"cpu_percent\": psutil.cpu_percent(),\n        \"memory\": dict(psutil.virtual_memory()._asdict()),\n        \"disk\": dict(psutil.disk_usage('/')._asdict()),\n        \"python_version\": platform.python_version(),\n        \"env\": {\n            \"index_dir\": str(INDEX_DIR),\n            \"data_dir\": str(DATA_DIR),\n        }\n    }\n    log_admin_event(f\"[HEALTH_CHECK] by {user or 'unknown'} from {request.client.host}\")\n    return health\n\n# ------------------------------------------------------------------------\n# ENDPOINT: Download Audit Log\n# ------------------------------------------------------------------------\n@router.get(\"/download_log\")\nasync def download_log(\n    request: Request,\n    user: str = \"\",\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Allows secure download of admin event log.\n    Requires valid X-API-Key header.\n    \"\"\"\n    if not ADMIN_LOG.exists():\n        raise HTTPException(status_code=404, detail=\"No log file found.\")\n    log_admin_event(f\"[DOWNLOAD_LOG] by {user or 'unknown'} from {request.client.host}\")\n    return FileResponse(str(ADMIN_LOG), media_type=\"text/plain\", filename=\"admin_events.log\")\n\n# ------------------------------------------------------------------------\n# ENDPOINT: Backup Index Directory (zip)\n# ------------------------------------------------------------------------\n@router.post(\"/backup_index\")\nasync def backup_index(\n    request: Request,\n    user: str = \"\",\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Zips the index directory for backup/offline restore.\n    Requires valid X-API-Key header.\n    \"\"\"\n    backup_path = DATA_DIR / f\"index_backup_{datetime.utcnow().strftime('%Y%m%d%H%M%S')}.zip\"\n    with zipfile.ZipFile(backup_path, \"w\") as zipf:\n        if INDEX_DIR.exists():\n            for f in INDEX_DIR.rglob(\"*\"):\n                if f.is_file():\n                    zipf.write(f, f.relative_to(DATA_DIR))\n    log_admin_event(f\"[BACKUP_INDEX] by {user or 'unknown'} from {request.client.host}\")\n    return {\n        \"status\": \"ok\",\n        \"message\": f\"Index directory backed up to {backup_path.name}\",\n        \"backup_file\": str(backup_path)\n    }", "mimetype": "text/plain", "start_char_idx": 4578, "end_char_idx": 7288, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "062dc2a4-0e0a-4290-80e0-dfe373f2a8c6": {"__data__": {"id_": "062dc2a4-0e0a-4290-80e0-dfe373f2a8c6", "embedding": null, "metadata": {"file_path": "/app/routes/admin_routes.py", "file_name": "admin_routes.py", "file_type": "text/x-python", "file_size": 750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "fa52c786-85e6-4bb6-b7d1-5498ae83d1a9", "node_type": "4", "metadata": {"file_path": "/app/routes/admin_routes.py", "file_name": "admin_routes.py", "file_type": "text/x-python", "file_size": 750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "938d2052030c302127f97e42fffc71bf9c9f6d650560085f73605b6968c03b34", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/admin_routes.py\n# Purpose: Add manual trigger to generate auto global context from /context/*.md\n\nfrom fastapi import APIRouter, Depends\nfrom fastapi.responses import JSONResponse\nimport subprocess\nimport os\n\nrouter = APIRouter(prefix=\"/admin\", tags=[\"admin\"])\n\n@router.post(\"/generate_auto_context\")\ndef generate_auto_context():\n    try:\n        result = subprocess.run(\n            [\"python\", \"scripts/generate_global_context.auto.py\"],\n            capture_output=True, text=True, check=True\n        )\n        return JSONResponse({\"status\": \"success\", \"output\": result.stdout})\n    except subprocess.CalledProcessError as e:\n        return JSONResponse(\n            {\"status\": \"error\", \"detail\": e.stderr}, status_code=500\n        )", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 749, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "c2e899a1-0bc9-49ec-9c9d-398353902c66": {"__data__": {"id_": "c2e899a1-0bc9-49ec-9c9d-398353902c66", "embedding": null, "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "4a83839a-9059-492f-8c60-ccfb1ae9299b", "node_type": "4", "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8a193b98d3d424f3d8eda7fad1421facdaf1b2ac08729398668868c1afbab30b", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b302a712-c712-450d-8cd6-8405470eaa34", "node_type": "1", "metadata": {}, "hash": "f42b406bb8f9056957d8e25e2f6e2f3ebbb898c8e31bd3089b0eaaf35550d42a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/ask.py\r\n# Directory: routes/\r\n# Purpose: Unified API routes for /ask endpoints \u2014 user entry point to Relay agents\r\n#          Delegates all query logic to MCP (run_mcp), handling agent/critic orchestration.\r\n#          Handles streaming for both Codex and Echo (primary/fallback) agents.\r\n# Updated: 2025-07-02\r\n\r\nimport traceback\r\nfrom fastapi import APIRouter, Query, Request, Header, HTTPException\r\nfrom fastapi.responses import StreamingResponse\r\nfrom typing import Optional\r\n\r\nfrom agents.mcp_agent import run_mcp\r\nfrom agents.codex_agent import stream as codex_stream\r\nfrom agents.echo_agent import stream as echo_stream\r\nfrom utils.openai_client import create_openai_client\r\nfrom openai import OpenAIError\r\n\r\nrouter = APIRouter(prefix=\"/ask\", tags=[\"ask\"])\r\n\r\n# Streaming map for roles that support it\r\nSTREAM_ROUTING_TABLE = {\r\n    \"codex\": codex_stream,\r\n    \"echo\": echo_stream,\r\n    # Add more streaming agents here as needed in the future\r\n}\r\n\r\n# === GET /ask ==================================================================\r\n@router.get(\"\")\r\nasync def ask_get(\r\n    request: Request,\r\n    question: str = Query(..., description=\"User's natural language question\"),\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\"),\r\n    debug: Optional[bool] = Query(False, description=\"Return debug/context info\"),\r\n    role: Optional[str] = Query(\"planner\", description=\"Which agent role to use (planner, echo, codex, etc)\"),\r\n    files: Optional[str] = Query(None, description=\"Comma-separated file list for context\"),\r\n    topics: Optional[str] = Query(None, description=\"Comma-separated topics for context\")\r\n):\r\n    \"\"\"\r\n    GET version of /ask, mostly for quick dev/testing.\r\n    Routes to MCP with appropriate agent role.\r\n    Echo is always available as both primary and fallback agent.\r\n    \"\"\"\r\n    user_id = x_user_id or \"anonymous\"\r\n    file_list = [f.strip() for f in files.split(\",\")] if files else []\r\n    topic_list = [t.strip() for t in topics.split(\",\")] if topics else []\r\n\r\n    if not question:\r\n        raise HTTPException(status_code=422, detail=\"Missing 'question' parameter.\")\r\n\r\n    try:\r\n        return await run_mcp(\r\n            query=question,\r\n            files=file_list,\r\n            topics=topic_list,\r\n            role=role,\r\n            user_id=user_id,\r\n            debug=debug\r\n        )\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n# === POST /ask =================================================================\r\n@router.post(\"\")\r\nasync def ask_post(\r\n    request: Request,\r\n    payload: dict,\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\"),\r\n    debug: Optional[bool] = Query(False),\r\n):\r\n    \"\"\"\r\n    Main POST endpoint for /ask \u2014 entrypoint for planner, codex, echo, or other agents.\r\n    Routes all queries to MCP for context injection, agent routing, and critics.\r\n    Echo is always available as both primary and fallback agent.\r\n    \"\"\"\r\n    user_id = x_user_id or \"anonymous\"\r\n    question = payload.get(\"question\", \"\")\r\n    context = payload.get(\"context\", \"\")\r\n    files = payload.get(\"files\", [])\r\n    topics = payload.get(\"topics\", [])\r\n    role = payload.get(\"role\", \"planner\")\r\n\r\n    if not question:\r\n        raise HTTPException(status_code=422, detail=\"Missing 'question' in request payload.\")\r\n\r\n    try:\r\n        result = await run_mcp(\r\n            query=question,\r\n            files=files,\r\n            topics=topics,\r\n            role=role,\r\n            user_id=user_id,\r\n            debug=debug\r\n        )\r\n        return result\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n\r\n# === POST /ask/stream ==========================================================\r\n@router.post(\"/stream\")\r\nasync def ask_stream(\r\n    request: Request,\r\n    payload: dict,\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\"),\r\n):\r\n    \"\"\"\r\n    Streaming endpoint for planner/meta/explicit agent roles via MCP routing.\r\n    If the routed agent supports streaming, streams the response.\r\n    Fallbacks to Echo stream if the routed agent doesn't support streaming.\r\n    \"\"\"", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4222, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b302a712-c712-450d-8cd6-8405470eaa34": {"__data__": {"id_": "b302a712-c712-450d-8cd6-8405470eaa34", "embedding": null, "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "4a83839a-9059-492f-8c60-ccfb1ae9299b", "node_type": "4", "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "8a193b98d3d424f3d8eda7fad1421facdaf1b2ac08729398668868c1afbab30b", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "c2e899a1-0bc9-49ec-9c9d-398353902c66", "node_type": "1", "metadata": {"file_path": "/app/routes/ask.py", "file_name": "ask.py", "file_type": "text/x-python", "file_size": 7881, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c1b3b547c7247a7f1b5ea706b78ba728d932b73d954b70fb7555d79141686f6f", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "try:\r\n        result = await run_mcp(\r\n            query=question,\r\n            files=files,\r\n            topics=topics,\r\n            role=role,\r\n            user_id=user_id,\r\n            debug=debug\r\n        )\r\n        return result\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n\r\n# === POST /ask/stream ==========================================================\r\n@router.post(\"/stream\")\r\nasync def ask_stream(\r\n    request: Request,\r\n    payload: dict,\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\"),\r\n):\r\n    \"\"\"\r\n    Streaming endpoint for planner/meta/explicit agent roles via MCP routing.\r\n    If the routed agent supports streaming, streams the response.\r\n    Fallbacks to Echo stream if the routed agent doesn't support streaming.\r\n    \"\"\"\r\n    user_id = x_user_id or \"anonymous\"\r\n    question = payload.get(\"question\", \"\")\r\n    context = payload.get(\"context\", \"\")\r\n    files = payload.get(\"files\", [])\r\n    topics = payload.get(\"topics\", [])\r\n    role = payload.get(\"role\", \"planner\")\r\n\r\n    if not question:\r\n        raise HTTPException(status_code=422, detail=\"Missing 'question' in request payload.\")\r\n\r\n    try:\r\n        # Get plan and route via MCP (to know the agent/role to stream)\r\n        mcp_result = await run_mcp(\r\n            query=question,\r\n            files=files,\r\n            topics=topics,\r\n            role=role,\r\n            user_id=user_id,\r\n            debug=False\r\n        )\r\n        plan = mcp_result.get(\"plan\", {})\r\n        used_route = plan.get(\"meta_override\") or plan.get(\"route\") or role\r\n\r\n        stream_fn = STREAM_ROUTING_TABLE.get(used_route, echo_stream)\r\n        return StreamingResponse(\r\n            stream_fn(question, context, user_id),\r\n            media_type=\"text/plain\"\r\n        )\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n\r\n# === POST /ask/codex_stream ===================================================\r\n@router.post(\"/codex_stream\")\r\nasync def ask_codex_stream(\r\n    request: Request,\r\n    payload: dict,\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\")\r\n):\r\n    \"\"\"\r\n    Streaming endpoint for Codex/code edits. Streams text output directly.\r\n    \"\"\"\r\n    user_id = x_user_id or \"anonymous\"\r\n    question = payload.get(\"question\", \"\")\r\n    context = payload.get(\"context\", \"\")\r\n\r\n    if not question or not context:\r\n        raise HTTPException(status_code=422, detail=\"Missing 'question' or 'context' in request.\")\r\n\r\n    try:\r\n        return StreamingResponse(codex_stream(question, context, user_id), media_type=\"text/plain\")\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n\r\n# === POST /ask/echo_stream ====================================================\r\n@router.post(\"/echo_stream\")\r\nasync def ask_echo_stream(\r\n    request: Request,\r\n    payload: dict,\r\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\"),\r\n):\r\n    \"\"\"\r\n    Streaming endpoint for Echo (LLM chat) responses.\r\n    \"\"\"\r\n    user_id = x_user_id or \"anonymous\"\r\n    question = payload.get(\"question\", \"\")\r\n    context = payload.get(\"context\", \"\")\r\n\r\n    if not question:\r\n        raise HTTPException(status_code=422, detail=\"Missing 'question' in request.\")\r\n\r\n    try:\r\n        return StreamingResponse(\r\n            echo_stream(question, context, user_id),\r\n            media_type=\"text/plain\"\r\n        )\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=str(e))\r\n\r\n\r\n# === GET /ask/test_openai ======================================================\r\n@router.get(\"/test_openai\")\r\nasync def test_openai():\r\n    \"\"\"\r\n    Quick endpoint to verify OpenAI API connectivity and model health.\r\n    \"\"\"\r\n    try:\r\n        client = create_openai_client()\r\n        response = await client.chat.completions.create(\r\n            model=\"gpt-4o\",\r\n            messages=[\r\n                {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\r\n                {\"role\": \"user\", \"content\": \"Ping test\"}\r\n            ]\r\n        )\r\n        return { \"response\": response.choices[0].message.content }\r\n    except OpenAIError as e:\r\n        raise HTTPException(status_code=502, detail=str(e))\r\n    except Exception as e:\r\n        traceback.print_exc()\r\n        raise HTTPException(status_code=500, detail=f\"Unexpected error: {str(e)}\")", "mimetype": "text/plain", "start_char_idx": 3381, "end_char_idx": 7875, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "9327dfbd-06ea-4b6e-aba7-aff8be456ffa": {"__data__": {"id_": "9327dfbd-06ea-4b6e-aba7-aff8be456ffa", "embedding": null, "metadata": {"file_path": "/app/routes/codex.py", "file_name": "codex.py", "file_type": "text/x-python", "file_size": 1956, "creation_date": "2025-06-28", "last_modified_date": "2025-06-28", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "40432b16-fe92-46c1-a567-cb1db71c4d14", "node_type": "4", "metadata": {"file_path": "/app/routes/codex.py", "file_name": "codex.py", "file_type": "text/x-python", "file_size": 1956, "creation_date": "2025-06-28", "last_modified_date": "2025-06-28", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "354524ecc1e1da285cad11527dd6652a960ebba8a2e460ee33b909f8847b0a94", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/codex.py\n# Purpose: CodexAgent backend endpoints (e.g., patch application, preview)\n\nimport os\nfrom fastapi import APIRouter, HTTPException, Request\nfrom fastapi.responses import JSONResponse\nfrom pydantic import BaseModel\nfrom utils.patch_utils import validate_patch_format\nfrom core.logging import log_event\n\nrouter = APIRouter(prefix=\"/codex\", tags=[\"codex\"])\n\nclass PatchRequest(BaseModel):\n    target_file: str\n    patch: str\n    reason: str\n\n@router.post(\"/apply_patch\")\nasync def apply_patch(payload: PatchRequest, request: Request):\n    \"\"\"\n    Apply a code patch directly to the specified file on disk.\n    \"\"\"\n    if not validate_patch_format({\"type\": \"patch\", **payload.dict()}):\n        raise HTTPException(status_code=422, detail=\"Invalid patch format.\")\n\n    try:\n        file_path = os.path.abspath(payload.target_file)\n\n        # Optional: Prevent writing outside project root\n        project_root = os.path.abspath(os.getcwd())\n        if not file_path.startswith(project_root):\n            raise HTTPException(status_code=400, detail=\"Refused to write outside project scope.\")\n\n        # Optional: Ensure file exists (comment out if you want to allow creation)\n        if not os.path.exists(file_path):\n            raise HTTPException(status_code=404, detail=f\"Target file not found: {payload.target_file}\")\n\n        with open(file_path, \"w\", encoding=\"utf-8\") as f:\n            f.write(payload.patch)\n\n    except Exception as e:\n        log_event(\"codex_patch_error\", {\n            \"file\": payload.target_file,\n            \"error\": str(e)\n        })\n        raise HTTPException(status_code=500, detail=f\"Failed to apply patch: {e}\")\n\n    log_event(\"codex_patch_applied\", {\n        \"file\": payload.target_file,\n        \"user\": request.headers.get(\"X-User-Id\", \"anon\")\n    })\n    return JSONResponse({\n        \"status\": \"success\",\n        \"file\": payload.target_file,\n        \"message\": \"Patch written successfully.\"\n    })", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1955, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "724d6454-0836-4f11-ab8f-a96b2d1034dc": {"__data__": {"id_": "724d6454-0836-4f11-ab8f-a96b2d1034dc", "embedding": null, "metadata": {"file_path": "/app/routes/context.py", "file_name": "context.py", "file_type": "text/x-python", "file_size": 2115, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "280aae5f-b5cc-40a6-b9c8-bbe5f7509270", "node_type": "4", "metadata": {"file_path": "/app/routes/context.py", "file_name": "context.py", "file_type": "text/x-python", "file_size": 2115, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d5901408abf902584a4c98bfd3f571499e132df727b9c4520d07d248e74fd44c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# routes/context.py\nfrom fastapi import APIRouter, HTTPException\nfrom services.logs import get_recent_logs, log_and_refresh\nfrom services.google_docs_sync import sync_google_docs\nfrom openai import OpenAI\nfrom pathlib import Path\nimport os\n\nrouter = APIRouter(prefix=\"/context\", tags=[\"context\"])\n\n# Path to the context file generated from session logs\ndoc_path = Path(\"docs/generated/relay_context.md\")\ndoc_path.parent.mkdir(parents=True, exist_ok=True)\n\n@router.post(\"/update\")\ndef update_context_summary():\n    try:\n        logs = get_recent_logs(100)\n        if not logs:\n            return {\"status\": \"no logs to summarize\"}\n\n        # Prepare the text block from log entries\n        text = \"\\n\".join(f\"[{l['source']}] {l['message']}\" for l in logs)\n\n        # Use OpenAI API to summarize log content\n        client = OpenAI(api_key=os.getenv(\"OPENAI_API_KEY\"))\n        response = client.chat.completions.create(\n            model=\"gpt-4o\",\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are a system summarizer for a command center log.\"},\n                {\"role\": \"user\", \"content\": f\"Summarize the following session log:\\n\\n{text}\"}\n            ]\n        )\n\n        summary = response.choices[0].message.content.strip()\n\n        # Write summary to markdown file\n        doc_path.write_text(f\"# Relay Context (auto-generated)\\n\\n{summary}\", encoding=\"utf-8\")\n        log_and_refresh(\"system\", \"Updated relay_context.md from session logs.\")\n\n        return {\"status\": \"ok\", \"summary\": summary}\n\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n# Deprecated sync route for compatibility with /docs/sync_google\n@router.post(\"/sync_google\")\ndef legacy_sync_google():\n    return sync_docs_and_update()\n\n@router.post(\"/sync_docs\")\ndef sync_docs_and_update():\n    try:\n        synced = sync_google_docs()\n        log_and_refresh(\"system\", f\"Synced {len(synced)} docs from Google Drive into /docs/imported\")\n        return {\"status\": \"ok\", \"synced_docs\": synced}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2114, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "62c55c5d-a9fa-456f-b2f7-b715d137a63d": {"__data__": {"id_": "62c55c5d-a9fa-456f-b2f7-b715d137a63d", "embedding": null, "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5", "node_type": "4", "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d160c6841d6992ae1964ca8631588ccfe50bd79920814623848794b2d5c68284", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "7c782813-3d9c-4df0-8ba9-1eec36b8269c", "node_type": "1", "metadata": {}, "hash": "2d789e3fdd3f7b8df1cf8ff1dd6fb7b046f0869925c96d1094475f9ec9f779ee", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/control.py\r\n# Directory: routes/\r\n# Purpose: Relay Action Queue & Audit API\r\n# - Queue, approve, deny, and execute agent-proposed actions\r\n# - Maintains audit log and Gmail notifications\r\n# - CORS-safe, with strong error handling and API key auth\r\n\r\nimport os, json\r\nfrom uuid import uuid4\r\nfrom pathlib import Path\r\nfrom datetime import datetime\r\nfrom fastapi import APIRouter, Depends, Header, HTTPException, Body, Request\r\n\r\nfrom services import gmail\r\nfrom agents import codex_agent, docs_agent, echo_agent\r\nfrom agents.control_agent import control_agent\r\n\r\nrouter = APIRouter(prefix=\"/control\", tags=[\"control\"])\r\n\r\n# === Auth Middleware ===\r\ndef auth(key: str = Header(None, alias=\"X-API-Key\")):\r\n    expected = os.getenv(\"API_KEY\")\r\n    if not key or key != expected:\r\n        raise HTTPException(status_code=401, detail=\"Invalid API key\")\r\n    return \"admin\"\r\n\r\n# === File paths ===\r\nACTIONS_PATH = Path(__file__).resolve().parents[1] / \"data\" / \"pending_actions.json\"\r\nLOG_PATH = Path(__file__).resolve().parents[1] / \"logs\" / \"actions.log\"\r\nACTIONS_PATH.parent.mkdir(parents=True, exist_ok=True)\r\nLOG_PATH.parent.mkdir(parents=True, exist_ok=True)\r\nif not ACTIONS_PATH.exists():\r\n    ACTIONS_PATH.write_text(\"[]\")\r\n\r\n# === Utils ===\r\ndef load_actions():\r\n    return json.loads(ACTIONS_PATH.read_text())\r\n\r\ndef save_actions(actions):\r\n    ACTIONS_PATH.write_text(json.dumps(actions, indent=2))\r\n\r\ndef append_log(entry: dict):\r\n    with LOG_PATH.open(\"a\", encoding=\"utf-8\") as f:\r\n        f.write(json.dumps(entry) + \"\\n\")\r\n\r\ndef update_action_history(action, status, user, comment=\"\"):\r\n    action.setdefault(\"history\", []).append({\r\n        \"timestamp\": datetime.utcnow().isoformat(),\r\n        \"status\": status,\r\n        \"user\": user,\r\n        \"comment\": comment\r\n    })\r\n\r\n# === Agent Dispatch Map ===\r\nAGENT_DISPATCH = {\r\n    \"codex\": codex_agent.handle,\r\n    \"control\": control_agent.run,\r\n    \"docs\": docs_agent.analyze,\r\n    \"echo\": echo_agent.run,\r\n}\r\n\r\n# === /queue_action ===\r\n@router.post(\"/queue_action\")\r\ndef queue_action(data: dict = Body(...), user=Depends(auth)):\r\n    action_id = str(uuid4())\r\n    queued = {\r\n        \"id\": action_id,\r\n        \"timestamp\": datetime.utcnow().isoformat(),\r\n        \"status\": \"pending\",\r\n        \"action\": data,\r\n        \"history\": [{\r\n            \"timestamp\": datetime.utcnow().isoformat(),\r\n            \"status\": \"pending\",\r\n            \"user\": user,\r\n            \"comment\": data.get(\"rationale\", \"\")\r\n        }]\r\n    }\r\n    actions = load_actions()\r\n    actions.append(queued)\r\n    save_actions(actions)\r\n    return {\"status\": \"queued\", \"id\": action_id}\r\n\r\n# === /list_queue ===\r\n@router.get(\"/list_queue\")\r\ndef list_queue(user=Depends(auth)):\r\n    try:\r\n        return {\"actions\": load_actions()}\r\n    except Exception as e:\r\n        raise HTTPException(500, f\"Failed to load queue: {e}\")\r\n\r\n# === /approve_action ===\r\n@router.post(\"/approve_action\")\r\nasync def approve_action(data: dict = Body(...), user=Depends(auth)):\r\n    action_id = data.get(\"id\")\r\n    comment = data.get(\"comment\", \"\")\r\n    if not action_id:\r\n        raise HTTPException(400, \"Missing action ID\")\r\n\r\n    actions = load_actions()\r\n    updated = []\r\n    approved = None\r\n\r\n    for a in actions:\r\n        if a[\"id\"] == action_id and a[\"status\"] == \"pending\":\r\n            approved = a\r\n            a[\"status\"] = \"approved\"\r\n            a[\"approved_at\"] = datetime.utcnow().isoformat()\r\n            update_action_history(a, \"approved\", user, comment)\r\n        updated.append(a)\r\n\r\n    if not approved:\r\n        raise HTTPException(404, \"No matching pending action found\")\r\n\r\n    save_actions(updated)\r\n    action_data = approved[\"action\"]\r\n\r\n    route = action_data.get(\"type\")\r\n    handler = AGENT_DISPATCH.get(route)\r\n\r\n    if handler:\r\n        result = await handler(\n            query=action_data.get(\"query\", \"\"),\n            context=action_data.get(\"context\", {}),\n            user_id=user\n        )\n        append_log({\r\n            \"id\": action_id,\r\n            \"type\": route,", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4029, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "7c782813-3d9c-4df0-8ba9-1eec36b8269c": {"__data__": {"id_": "7c782813-3d9c-4df0-8ba9-1eec36b8269c", "embedding": null, "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5", "node_type": "4", "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d160c6841d6992ae1964ca8631588ccfe50bd79920814623848794b2d5c68284", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "62c55c5d-a9fa-456f-b2f7-b715d137a63d", "node_type": "1", "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "fe8632a957a8acfade701ea51f4f537e80c162fd97418d991a6d2eb91feeab96", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "a853f26b-c78c-40c2-91c5-0e8f6c8d1e33", "node_type": "1", "metadata": {}, "hash": "9365b7d77ca1d1a54b1d55114c227a292045c902b7658151932f4c4835548499", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "utcnow().isoformat()\r\n            update_action_history(a, \"approved\", user, comment)\r\n        updated.append(a)\r\n\r\n    if not approved:\r\n        raise HTTPException(404, \"No matching pending action found\")\r\n\r\n    save_actions(updated)\r\n    action_data = approved[\"action\"]\r\n\r\n    route = action_data.get(\"type\")\r\n    handler = AGENT_DISPATCH.get(route)\r\n\r\n    if handler:\r\n        result = await handler(\n            query=action_data.get(\"query\", \"\"),\n            context=action_data.get(\"context\", {}),\n            user_id=user\n        )\n        append_log({\r\n            \"id\": action_id,\r\n            \"type\": route,\r\n            \"timestamp\": datetime.utcnow().isoformat(),\r\n            \"status\": \"executed\",\r\n            \"result\": result,\r\n            \"user\": user,\r\n            \"comment\": comment\r\n        })\r\n        return result\r\n\r\n    # Optional: file write fallback\r\n    if action_data.get(\"type\") == \"write_file\":\r\n        result = write_file(action_data, user=user)\r\n        append_log({\r\n            \"id\": action_id,\r\n            \"type\": \"write_file\",\r\n            \"path\": action_data.get(\"path\"),\r\n            \"timestamp\": datetime.utcnow().isoformat(),\r\n            \"status\": \"executed\",\r\n            \"result\": result,\r\n            \"user\": user,\r\n            \"comment\": comment\r\n        })\r\n        return result\r\n\r\n    append_log({\r\n        \"id\": action_id,\r\n        \"type\": action_data.get(\"type\"),\r\n        \"timestamp\": datetime.utcnow().isoformat(),\r\n        \"status\": \"approved\",\r\n        \"user\": user,\r\n        \"comment\": comment\r\n    })\r\n\r\n    return {\"status\": \"approved\"}\r\n\r\n# === /deny_action ===\r\n@router.post(\"/deny_action\")\r\ndef deny_action(data: dict = Body(...), user=Depends(auth)):\r\n    action_id = data.get(\"id\")\r\n    comment = data.get(\"comment\", \"\")\r\n    if not action_id:\r\n        raise HTTPException(400, \"Missing action ID\")\r\n\r\n    actions = load_actions()\r\n    updated = []\r\n    denied = None\r\n\r\n    for a in actions:\r\n        if a[\"id\"] == action_id and a[\"status\"] == \"pending\":\r\n            denied = a\r\n            a[\"status\"] = \"denied\"\r\n            a[\"denied_at\"] = datetime.utcnow().isoformat()\r\n            update_action_history(a, \"denied\", user, comment)\r\n        updated.append(a)\r\n\r\n    if not denied:\r\n        raise HTTPException(404, \"No matching pending action found\")\r\n\r\n    save_actions(updated)\r\n    append_log({\r\n        \"id\": action_id,\r\n        \"type\": denied[\"action\"].get(\"type\"),\r\n        \"timestamp\": datetime.utcnow().isoformat(),\r\n        \"status\": \"denied\",\r\n        \"user\": user,\r\n        \"comment\": comment\r\n    })\r\n    return {\"status\": \"denied\"}\r\n\r\n# === /list_log ===\r\n@router.get(\"/list_log\")\r\ndef list_log(user=Depends(auth)):\r\n    try:\r\n        if not LOG_PATH.exists():\r\n            return {\"log\": []}\r\n        with LOG_PATH.open(\"r\", encoding=\"utf-8\") as f:\r\n            lines = f.readlines()\r\n        return {\"log\": [json.loads(line) for line in lines if line.strip()]}\r\n    except Exception as e:\r\n        raise HTTPException(500, f\"Failed to read log: {e}\")\r\n\r\n# === /write_file ===\r\n@router.post(\"/write_file\")\r\ndef write_file(data: dict = Body(...), user=Depends(auth)):\r\n    path = data.get(\"path\")\r\n    content = data.get(\"content\")\r\n    if not path or not content:\r\n        raise HTTPException(400, \"Missing path or content\")\r\n    base = Path(__file__).resolve().parents[1]\r\n    full_path = base / path\r\n    full_path.parent.mkdir(parents=True, exist_ok=True)\r\n    try:\r\n        full_path.write_text(content)\r\n        return {\r\n            \"status\": \"success\",\r\n            \"path\": str(full_path.relative_to(base)),\r\n            \"size\": len(content)\r\n        }\r\n    except Exception as e:\r\n        raise HTTPException(500, f\"Failed to write file: {e}\")\r\n\r\n# === /test (ControlAgent direct test) ===\r\n@router.post(\"/test\")\r\nasync def control_test(request: Request, user=Depends(auth)):\r\n    payload = await request.json()\r\n    query = payload.get(\"query\", \"\")\r\n    context = payload.get(\"context\", {})\r\n\r\n    result = await control_agent.run(query=query, context=context,", "mimetype": "text/plain", "start_char_idx": 3410, "end_char_idx": 7464, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "a853f26b-c78c-40c2-91c5-0e8f6c8d1e33": {"__data__": {"id_": "a853f26b-c78c-40c2-91c5-0e8f6c8d1e33", "embedding": null, "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5", "node_type": "4", "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "d160c6841d6992ae1964ca8631588ccfe50bd79920814623848794b2d5c68284", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "7c782813-3d9c-4df0-8ba9-1eec36b8269c", "node_type": "1", "metadata": {"file_path": "/app/routes/control.py", "file_name": "control.py", "file_type": "text/x-python", "file_size": 7803, "creation_date": "2025-07-02", "last_modified_date": "2025-07-02", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7364f3e0848e232f5319806bae1795b1499f72cbd571e2091f0e079b55422b4c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "\"Missing path or content\")\r\n    base = Path(__file__).resolve().parents[1]\r\n    full_path = base / path\r\n    full_path.parent.mkdir(parents=True, exist_ok=True)\r\n    try:\r\n        full_path.write_text(content)\r\n        return {\r\n            \"status\": \"success\",\r\n            \"path\": str(full_path.relative_to(base)),\r\n            \"size\": len(content)\r\n        }\r\n    except Exception as e:\r\n        raise HTTPException(500, f\"Failed to write file: {e}\")\r\n\r\n# === /test (ControlAgent direct test) ===\r\n@router.post(\"/test\")\r\nasync def control_test(request: Request, user=Depends(auth)):\r\n    payload = await request.json()\r\n    query = payload.get(\"query\", \"\")\r\n    context = payload.get(\"context\", {})\r\n\r\n    result = await control_agent.run(query=query, context=context, user_id=user)\r\n    append_log({\r\n        \"id\": f\"manual-{datetime.utcnow().isoformat()}\",\r\n        \"type\": \"control_test\",\r\n        \"timestamp\": datetime.utcnow().isoformat(),\r\n        \"status\": \"executed\",\r\n        \"user\": user,\r\n        \"query\": query,\r\n        \"context\": context,\r\n        \"result\": result\r\n    })\r\n    return result", "mimetype": "text/plain", "start_char_idx": 6693, "end_char_idx": 7801, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "8573d8a2-b198-4cd8-bdcb-b1ec44259c0f": {"__data__": {"id_": "8573d8a2-b198-4cd8-bdcb-b1ec44259c0f", "embedding": null, "metadata": {"file_path": "/app/routes/debug.py", "file_name": "debug.py", "file_type": "text/x-python", "file_size": 342, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "20b4382e-d50c-4f54-977c-dde0ee629bae", "node_type": "4", "metadata": {"file_path": "/app/routes/debug.py", "file_name": "debug.py", "file_type": "text/x-python", "file_size": 342, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c99b0b053ecbb0d23b0b64c27bc5954e49381b95241436b078537ea2c7b5a9ea", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/debug.py\nfrom fastapi import APIRouter\nimport os\n\nrouter = APIRouter()\n\n@router.get(\"/debug/env\")\ndef debug_env():\n    val = os.getenv(\"GOOGLE_CREDS_JSON\")\n    return {\n        \"GOOGLE_CREDS_JSON present\": bool(val),\n        \"length\": len(val) if val else 0,\n        \"starts_with\": val[:30] + \"...\" if val else \"MISSING\"\n    }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 341, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "8804bd55-fae3-44da-b336-f1f0684ffbec": {"__data__": {"id_": "8804bd55-fae3-44da-b336-f1f0684ffbec", "embedding": null, "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "531abf6c-f685-4f51-8c28-a48630083160", "node_type": "4", "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "000bee5b16cc38aa63c1be8c917feaba5c6e9b43d75e9c11f5ce36e44db7787a", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "051ca004-6c72-410c-94bb-a8502e257461", "node_type": "1", "metadata": {}, "hash": "04170c25233bea69a272243d4bdc426d56d8f61ec6eae028a9e3021fd664b012", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# File: docs.py\n# Directory: routes/\n# Purpose : Secure API routes for listing, viewing, syncing, promoting,\n#           pruning, and prioritizing tiered Markdown documentation.\n# Notes   :\n#   \u2022 API\u2011key (or future SSO) required for every endpoint.\n#   \u2022 Path\u2011traversal safe: requested file must resolve inside project_root/docs.\n#   \u2022 Adds /mark_priority to manually set doc tier or pin for context.\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfrom __future__ import annotations\n\nimport os\nimport shutil\nfrom pathlib import Path\nfrom typing import List\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\nfrom fastapi.responses import JSONResponse\n\nfrom services.google_docs_sync import sync_google_docs\nfrom services import kb\nfrom services.context_engine import ContextEngine\nfrom services.docs_utils import (\n    extract_doc_id,\n    build_doc_registry,\n    choose_canonical_path,\n    write_doc_metadata,\n)\n\n# \u2500\u2500\u2500 Router Setup \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nrouter = APIRouter(prefix=\"/docs\", tags=[\"docs\"])\n\n# \u2500\u2500\u2500 Auth Stub (replace with real auth) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\ndef require_api_key():\n    return True  # TODO: Replace with real API key or OAuth validation\n\n# \u2500\u2500\u2500 Constants \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPROJECT_ROOT = Path(__file__).resolve().parents[1]\nBASE_DIR: Path = PROJECT_ROOT / \"docs\"\nCATEGORIES = (\"imported\", \"generated\")\n\ndef _safe_resolve(path: Path) -> Path:\n    resolved = path.resolve()\n    resolved.relative_to(BASE_DIR)\n    return resolved\n\n# \u2500\u2500\u2500 List docs with metadata \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.get(\"/list\", dependencies=[Depends(require_api_key)])\nasync def list_docs(\n    category: str = Query(\"all\", pattern=\"^(all|imported|generated)$\"),\n    limit: int = Query(100, ge=1, le=500),\n):\n    cats = CATEGORIES if category == \"all\" else (category,)\n    results: List[dict] = []\n\n    for sub in cats:\n        for f in (BASE_DIR / sub).rglob(\"*.md\"):\n            if len(results) >= limit:\n                break\n            try:\n                doc_id = extract_doc_id(f)\n                results.append({\n                    \"path\": str(f.relative_to(BASE_DIR)),\n                    \"doc_id\": doc_id,\n                    \"tier\": sub,\n                    \"source\": \"google\" if \"imported\" in str(f) else \"local\",\n                    \"last_modified\": f.stat().st_mtime,\n                })\n            except Exception:\n                continue\n\n    return {\"files\": results}\n\n# \u2500\u2500\u2500 View raw markdown \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.get(\"/view\", dependencies=[Depends(require_api_key)])\nasync def view_doc(path: str):\n    try:\n        doc_path = _safe_resolve(BASE_DIR / path)\n        if not doc_path.exists():\n            raise HTTPException(status_code=404, detail=\"Doc not found\")\n        return {\"content\": doc_path.read_text()}\n    except ValueError:\n        raise HTTPException(status_code=400, detail=\"Invalid path\")\n    except Exception:\n        raise HTTPException(status_code=500, detail=\"Internal error\")\n\n# \u2500\u2500\u2500 Google Docs Sync \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/sync\", dependencies=[Depends(require_api_key)])\nasync def sync_docs():\n    try:\n        saved_files = sync_google_docs()\n        kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"synced_docs\": saved_files}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n# \u2500\u2500\u2500 Manual Reindex \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/refresh_kb\", dependencies=[Depends(require_api_key)])\nasync def refresh_kb():\n    try:\n        result = kb.api_reindex()\n        ContextEngine.clear_cache()\n        return result\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n@router.post(\"/full_sync\", dependencies=[Depends(require_api_key)])\nasync def full_sync():\n    try:\n        files = sync_google_docs()\n        index_info = kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"synced_docs\": files, \"kb\": index_info}\n    except Exception as e:\n        raise HTTPException(status_code=500,", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4312, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "051ca004-6c72-410c-94bb-a8502e257461": {"__data__": {"id_": "051ca004-6c72-410c-94bb-a8502e257461", "embedding": null, "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "531abf6c-f685-4f51-8c28-a48630083160", "node_type": "4", "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "000bee5b16cc38aa63c1be8c917feaba5c6e9b43d75e9c11f5ce36e44db7787a", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "8804bd55-fae3-44da-b336-f1f0684ffbec", "node_type": "1", "metadata": {"file_path": "/app/routes/docs.py", "file_name": "docs.py", "file_type": "text/x-python", "file_size": 8487, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "0bc46229475aa7addc80ad73af2a8d5dc878818c416a927485f6fb100af952d2", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "api_reindex()\n        ContextEngine.clear_cache()\n        return {\"synced_docs\": saved_files}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n# \u2500\u2500\u2500 Manual Reindex \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/refresh_kb\", dependencies=[Depends(require_api_key)])\nasync def refresh_kb():\n    try:\n        result = kb.api_reindex()\n        ContextEngine.clear_cache()\n        return result\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n@router.post(\"/full_sync\", dependencies=[Depends(require_api_key)])\nasync def full_sync():\n    try:\n        files = sync_google_docs()\n        index_info = kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"synced_docs\": files, \"kb\": index_info}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\n# \u2500\u2500\u2500 Promote to canonical \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/promote\", dependencies=[Depends(require_api_key)])\nasync def promote_doc(request: Request):\n    data = await request.json()\n    path = data.get(\"path\")\n    if not path:\n        raise HTTPException(status_code=400, detail=\"Missing path\")\n\n    full_path = _safe_resolve(BASE_DIR / path)\n    if not full_path.exists():\n        raise HTTPException(status_code=404, detail=\"File not found\")\n\n    doc_id = extract_doc_id(full_path)\n    target_path = BASE_DIR / f\"{doc_id}.md\"\n\n    try:\n        shutil.copy(full_path, target_path)\n        kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"promoted\": str(target_path.relative_to(BASE_DIR))}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Promote failed: {e}\")\n\n# \u2500\u2500\u2500 Prune Duplicates \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/prune_duplicates\", dependencies=[Depends(require_api_key)])\nasync def prune_duplicates():\n    removed = []\n    try:\n        registry = build_doc_registry()\n        for doc_id, versions in registry.items():\n            if len(versions) <= 1:\n                continue\n            keep = choose_canonical_path(versions)\n            for path in versions:\n                if path != keep:\n                    try:\n                        os.remove(path)\n                        removed.append(str(path.relative_to(BASE_DIR)))\n                    except Exception as e:\n                        print(f\"\u26a0\ufe0f Failed to remove {path}: {e}\")\n        kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"removed\": removed}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Prune failed: {e}\")\n\n# \u2500\u2500\u2500 Mark Priority / Tier \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n@router.post(\"/mark_priority\", dependencies=[Depends(require_api_key)])\nasync def mark_priority(request: Request):\n    \"\"\"\n    Set or update a doc's metadata: tier, pinned flag, or doc_id.\n    \"\"\"\n    data = await request.json()\n    path = data.get(\"path\")\n    tier = data.get(\"tier\")\n    pinned = data.get(\"pinned\")\n\n    if not path:\n        raise HTTPException(status_code=400, detail=\"Missing path\")\n\n    full_path = _safe_resolve(BASE_DIR / path)\n    if not full_path.exists():\n        raise HTTPException(status_code=404, detail=\"File not found\")\n\n    try:\n        write_doc_metadata(full_path, {\"tier\": tier, \"pinned\": pinned})\n        kb.api_reindex()\n        ContextEngine.clear_cache()\n        return {\"updated\": str(full_path.relative_to(BASE_DIR)), \"tier\": tier, \"pinned\": pinned}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"Metadata update failed: {e}\")", "mimetype": "text/plain", "start_char_idx": 3435, "end_char_idx": 7078, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "2761fa9c-b7d5-4502-8021-d1886618163b": {"__data__": {"id_": "2761fa9c-b7d5-4502-8021-d1886618163b", "embedding": null, "metadata": {"file_path": "/app/routes/embeddings.py", "file_name": "embeddings.py", "file_type": "text/x-python", "file_size": 1611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "beec6e45-03d9-422a-b9e8-591664a84ef6", "node_type": "4", "metadata": {"file_path": "/app/routes/embeddings.py", "file_name": "embeddings.py", "file_type": "text/x-python", "file_size": 1611, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "c901ac0403f8d0a587dd49fd4ff80efcc4ad6b04e7dfa8662ee3b30e6f0ea058", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# routes/embeddings.py\n\n\"\"\"\nEmbeddings Debug & Maintenance API for Relay\n---------------------------------------------\n- /embeddings/status : Check if embedding index exists, get stats\n- /embeddings/rebuild : (POST) Trigger rebuild of the embedding index\n\"\"\"\n\nfrom fastapi import APIRouter, Response, status\nfrom fastapi.responses import JSONResponse\nfrom services import embeddings\nimport os\nfrom pathlib import Path\nimport time\n\nrouter = APIRouter()\n\nEMBED_INDEX = embeddings.EMBED_INDEX\n\n@router.get(\"/embeddings/status\")\ndef embeddings_status():\n    \"\"\"\n    Returns basic info about the current embedding index.\n    \"\"\"\n    info = {\n        \"exists\": False,\n        \"num_files\": None,\n        \"last_modified\": None\n    }\n    if os.path.exists(EMBED_INDEX):\n        stat = os.stat(EMBED_INDEX)\n        info[\"exists\"] = True\n        info[\"last_modified\"] = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(stat.st_mtime))\n        try:\n            # Try to get number of files in index\n            import pickle\n            with open(EMBED_INDEX, \"rb\") as f:\n                idx = pickle.load(f)\n            info[\"num_files\"] = len(idx)\n        except Exception as e:\n            info[\"num_files\"] = f\"Error: {e}\"\n    return JSONResponse(info)\n\n@router.post(\"/embeddings/rebuild\")\ndef embeddings_rebuild():\n    \"\"\"\n    Triggers a rebuild of the embedding index.\n    \"\"\"\n    try:\n        embeddings.build_index()\n        return JSONResponse({\"status\": \"ok\", \"message\": \"Embedding index rebuilt.\"})\n    except Exception as e:\n        return JSONResponse({\"status\": \"error\", \"message\": str(e)}, status_code=500)", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1610, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "85c434e3-68f8-4378-b119-ed19417d8b5a": {"__data__": {"id_": "85c434e3-68f8-4378-b119-ed19417d8b5a", "embedding": null, "metadata": {"file_path": "/app/routes/index.py", "file_name": "index.py", "file_type": "text/x-python", "file_size": 1283, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "62080a23-55e5-4007-8ba3-804b5febe82a", "node_type": "4", "metadata": {"file_path": "/app/routes/index.py", "file_name": "index.py", "file_type": "text/x-python", "file_size": 1283, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "2c2d98ca8e5924b4b26773065009e4dbb70250938d1f381112605622df4febe5", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/index.py\n# Directory: routes/\n# Purpose: FastAPI endpoint to trigger code/doc indexing\u2014secured with API Key, dev/staging only.\n\nfrom fastapi import APIRouter, Depends, HTTPException, Header\nimport os\nfrom services.indexer import index_directories\nfrom datetime import datetime\nfrom pathlib import Path\n\nrouter = APIRouter(prefix=\"/ops\", tags=[\"ops\"])\n\n# -- Security: Require X-API-Key header for indexing --\ndef require_api_key(x_api_key: str = Header(..., alias=\"X-API-Key\")):\n    api_key = os.environ.get(\"API_KEY\")\n    if not api_key or x_api_key != api_key:\n        raise HTTPException(status_code=403, detail=\"Invalid or missing API key.\")\n\n# -- Optional: Simple audit log to /data/ops_events.log --\nAUDIT_LOG = Path(os.environ.get(\"AUDIT_LOG\", \"/app/data/ops_events.log\"))\n\ndef log_event(msg: str):\n    now = datetime.utcnow().isoformat()\n    with AUDIT_LOG.open(\"a\", encoding=\"utf-8\") as f:\n        f.write(f\"{now} | {msg}\\n\")\n\n@router.post(\"/index\")\nasync def trigger_index(api_key: str = Depends(require_api_key), user: str = \"ops\"):\n    \"\"\"\n    Secured endpoint to start indexing codebase and docs (requires X-API-Key).\n    \"\"\"\n    log_event(f\"[TRIGGER_INDEX] by {user}\")\n    index_directories()\n    return {\"status\": \"ok\", \"message\": \"Indexing started!\"}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1280, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "3c435b54-0749-4fef-abed-61500319042a": {"__data__": {"id_": "3c435b54-0749-4fef-abed-61500319042a", "embedding": null, "metadata": {"file_path": "/app/routes/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 3005, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "ef86fc01-fc73-49f7-9b28-d0d8fa54f118", "node_type": "4", "metadata": {"file_path": "/app/routes/kb.py", "file_name": "kb.py", "file_type": "text/x-python", "file_size": 3005, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "1603c9fda582ea5d5fd4855463228b0aa62558997461c44062d3abe816b55b4d", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# routes/kb.py\n# Directory: routes/\n# Purpose: API routes for knowledge base (KB) semantic search, summary, and admin endpoints.\n# Security: All admin/debug endpoints require X-API-Key header, which must match API_KEY in environment.\n# Stack: FastAPI, LlamaIndex/OpenAI (via services.kb), User-aware\n\nfrom fastapi import APIRouter, HTTPException, Header, Depends, Query\nfrom pydantic import BaseModel\nfrom typing import Optional\nfrom services import kb\nimport os\n\n# === Security Dependency: Require X-API-Key header for all admin ops ===\ndef require_api_key(x_api_key: str = Header(..., alias=\"X-API-Key\")):\n    api_key = os.environ.get(\"API_KEY\")\n    if not api_key or x_api_key != api_key:\n        raise HTTPException(status_code=403, detail=\"Invalid or missing API key.\")\n\nrouter = APIRouter(prefix=\"/kb\", tags=[\"knowledge-base\"])\n\nclass SearchQuery(BaseModel):\n    query: str\n    k: int = 4\n    search_type: Optional[str] = \"all\"  # \"code\", \"doc\", or \"all\"\n\n@router.post(\"/search\")\nasync def search_kb(\n    q: SearchQuery,\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\")\n):\n    \"\"\"\n    Search the knowledge base (semantic vector index) for relevant snippets.\n    Optional X-User-Id header for user-aware results.\n    `search_type`: 'code', 'doc', or 'all'.\n    \"\"\"\n    user_id = x_user_id or \"anonymous\"\n    try:\n        results = kb.api_search(\n            query=q.query,\n            k=q.k,\n            search_type=q.search_type or \"all\"\n        )\n        return {\"results\": results}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"KB search failed: {e}\")\n\n@router.get(\"/search\")\nasync def search_kb_get(\n    query: str,\n    k: int = 4,\n    search_type: Optional[str] = \"all\",\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\")\n):\n    \"\"\"\n    GET variant of KB search for easy testing.\n    \"\"\"\n    user_id = x_user_id or \"anonymous\"\n    try:\n        results = kb.api_search(\n            query=query,\n            k=k,\n            search_type=search_type or \"all\"\n        )\n        return {\"results\": results}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"KB search failed: {e}\")\n\n@router.get(\"/summary\")\nasync def get_summary(\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\")\n):\n    \"\"\"\n    Fetch recent context summary for a given user, or fallback to generic summary.\n    \"\"\"\n    user_id = x_user_id or \"anonymous\"\n    try:\n        summary = kb.get_recent_summaries(user_id)\n        return {\"summary\": summary}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"KB summary fetch failed: {e}\")\n\n@router.post(\"/reindex\")\nasync def reindex_kb(\n    api_key: str = Depends(require_api_key)\n):\n    \"\"\"\n    Trigger a rebuild of the KB index (admin/debug only).\n    Requires X-API-Key header.\n    \"\"\"\n    try:\n        resp = kb.api_reindex()\n        return resp\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f\"KB reindex failed: {e}\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3004, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "6c1ce8b0-9fee-42ad-abb9-b97c6199620b": {"__data__": {"id_": "6c1ce8b0-9fee-42ad-abb9-b97c6199620b", "embedding": null, "metadata": {"file_path": "/app/routes/logs_sessions.py", "file_name": "logs_sessions.py", "file_type": "text/x-python", "file_size": 774, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "ebc8cc62-aef3-4460-beeb-7875f0919dfd", "node_type": "4", "metadata": {"file_path": "/app/routes/logs_sessions.py", "file_name": "logs_sessions.py", "file_type": "text/x-python", "file_size": 774, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "7ca446463ead370cbe65a379d2d5db44c8e63f1a4af71cf8d6e9a3e229e9f709", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/logs_sessions.py\n# Directory: routes/\n# Purpose: API route for listing user session memory logs from /logs/sessions/*.jsonl\n\nfrom fastapi import APIRouter, Request\nfrom pathlib import Path\nimport json\n\nrouter = APIRouter(prefix=\"/logs/sessions\", tags=[\"logs\", \"memory\"])\n\nSESSION_LOG_DIR = Path(\"./logs/sessions\")\n\n@router.get(\"/all\")\ndef list_all_sessions():\n    entries = []\n    for path in SESSION_LOG_DIR.glob(\"*.jsonl\"):\n        with open(path) as f:\n            for line in f:\n                try:\n                    parsed = json.loads(line)\n                    entries.append(parsed)\n                except json.JSONDecodeError:\n                    continue\n    return {\"entries\": sorted(entries, key=lambda x: x.get(\"timestamp\", \"\"), reverse=True)}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 773, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "9d82735c-b851-46ec-b40c-b7028fe7a17e": {"__data__": {"id_": "9d82735c-b851-46ec-b40c-b7028fe7a17e", "embedding": null, "metadata": {"file_path": "/app/routes/mcp.py", "file_name": "mcp.py", "file_type": "text/x-python", "file_size": 2007, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "8fa949b2-11de-46a4-bc82-bbd32324b15b", "node_type": "4", "metadata": {"file_path": "/app/routes/mcp.py", "file_name": "mcp.py", "file_type": "text/x-python", "file_size": 2007, "creation_date": "2025-06-30", "last_modified_date": "2025-06-30", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9a6aa057dfc164cada7465c148f09fc9fc0923cfd359ee9c5b3eead876857ff2", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# File: routes/mcp.py\n# Directory: routes/\n# Purpose: API route for direct access to MCP handler (run_mcp) for testing, automation, or admin use\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfrom fastapi import APIRouter, HTTPException, Request, Header\nfrom typing import Optional\nfrom agents.mcp_agent import run_mcp\n\nrouter = APIRouter(prefix=\"/mcp\", tags=[\"mcp\"])\n\n@router.post(\"/run\")\nasync def mcp_run(\n    request: Request,\n    x_user_id: Optional[str] = Header(None, alias=\"X-User-Id\")\n):\n    \"\"\"\n    Direct endpoint for invoking the MCP agent orchestrator (run_mcp).\n    Accepts flexible input for query/prompt, plus optional files, topics, role, debug.\n    \"\"\"\n    data = await request.json()\n    # Accept a variety of possible input keys for maximum compatibility.\n    query = data.get(\"query\") or data.get(\"question\") or data.get(\"prompt\")\n    if not query:\n        raise HTTPException(status_code=422, detail=\"Missing 'query' in payload\")\n\n    # Use .get() with default empty list to prevent passing None if omitted.\n    files = data.get(\"files\", [])\n    topics = data.get(\"topics\", [])\n    role = data.get(\"role\", \"planner\")\n    debug = data.get(\"debug\", False)\n    user_id = x_user_id or \"anonymous\"\n\n    try:\n        return await run_mcp(\n            query=query,\n            files=files,\n            topics=topics,\n            role=role,\n            user_id=user_id,\n            debug=debug,\n        )\n    except Exception as e:\n        # Optionally add traceback.print_exc() for debug\n        raise HTTPException(status_code=500, detail=f\"MCP error: {str(e)}\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1694, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "882d5fdc-a69a-45b1-a7f4-8056cefd0550": {"__data__": {"id_": "882d5fdc-a69a-45b1-a7f4-8056cefd0550", "embedding": null, "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3f4d1ab6-983e-4683-9a76-18330c0342d4", "node_type": "4", "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "aca46150503b717fe0c6c848615cc3bc9f4524cf39fe543e2d175e33bd7b7188", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b780e410-efe2-4ae3-8468-bc2299406311", "node_type": "1", "metadata": {}, "hash": "e4287cf2a1d5980944d5eac49002e55bb2ed99441820b1eb409710ccf2da811a", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/oauth.py\n# Directory: /routes\n# Purpose: Provide Google OAuth endpoints for both development (Codespaces) and production.\n# Supports dynamic and environment-overridden redirect URIs, robust logging, and token persistence.\n\nimport os\nimport base64\nfrom pathlib import Path\nfrom fastapi import APIRouter, Request, HTTPException\nfrom fastapi.responses import RedirectResponse\nfrom google_auth_oauthlib.flow import Flow, InstalledAppFlow\n\nrouter = APIRouter()\n\n# === OAuth Configuration ===\nSCOPES = [\n    \"https://www.googleapis.com/auth/drive.readonly\",\n    \"https://www.googleapis.com/auth/documents.readonly\",\n]\nCREDENTIALS_PATH = Path(\"/tmp/credentials.json\")\nTOKEN_PATH = Path(\"frontend/sync/token.json\")\n# Default post-auth landing page (relative path)\nDEFAULT_POST_REDIRECT = \"/status/summary\"\n# Optional overrides (full URIs)\nOVERRIDE_REDIRECT_URI = os.getenv(\"OAUTH_REDIRECT_URI\")\nOVERRIDE_POST_REDIRECT = os.getenv(\"POST_AUTH_REDIRECT_URI\")\n\n@router.get(\"/google/auth\")\nasync def start_oauth(request: Request):\n    \"\"\"\n    Initiates the OAuth flow:\n    1. Ensure client secrets in /tmp/credentials.json from GOOGLE_CREDS_JSON.\n    2. Determine redirect URI (override or based on request.base_url).\n    3. Redirect browser to Google consent screen.\n    \"\"\"\n    # 1. Write client secrets if missing\n    if not CREDENTIALS_PATH.exists():\n        raw = os.getenv(\"GOOGLE_CREDS_JSON\")\n        if not raw:\n            raise HTTPException(500, detail=\"Missing GOOGLE_CREDS_JSON environment variable.\")\n        try:\n            creds_json = base64.b64decode(raw).decode()\n            CREDENTIALS_PATH.write_text(creds_json)\n            print(f\"\u2705 Wrote client secrets to {CREDENTIALS_PATH}\")\n        except Exception as e:\n            raise HTTPException(500, detail=f\"Error decoding GOOGLE_CREDS_JSON: {e}\")\n\n    # 2. Determine redirect URI\n    if OVERRIDE_REDIRECT_URI:\n        redirect_uri = OVERRIDE_REDIRECT_URI\n        print(f\"\ud83d\udd27 Using override redirect URI: {redirect_uri}\")\n    else:\n        base = str(request.base_url).rstrip(\"/\")\n        redirect_uri = f\"{base}/google/callback\"\n        print(f\"\ud83d\udd27 Using dynamic redirect URI: {redirect_uri}\")\n\n    # 3. Create flow and authorization URL\n    flow = Flow.from_client_secrets_file(\n        str(CREDENTIALS_PATH),\n        scopes=SCOPES,\n        redirect_uri=redirect_uri,\n    )\n    auth_url, state = flow.authorization_url(\n        access_type=\"offline\",\n        include_granted_scopes=\"true\",\n        prompt=\"consent\"\n    )\n    print(f\"\ud83c\udf10 Redirecting to Google consent: {auth_url}\")\n    return RedirectResponse(auth_url)\n\n@router.get(\"/google/callback\")\nasync def oauth_callback(request: Request, code: str = None, state: str = None):\n    \"\"\"\n    Handles the OAuth callback:\n    1. Validate 'code'.\n    2. Exchange code for credentials using redirect URI.\n    3. Persist token.json.\n    4. Redirect to post-auth landing (relative path).\n    \"\"\"\n    if not code:\n        raise HTTPException(400, detail=\"Missing authorization code in callback.\")\n\n    if not CREDENTIALS_PATH.exists():\n        raise HTTPException(500, detail=\"Client secrets not found.\")", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3120, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b780e410-efe2-4ae3-8468-bc2299406311": {"__data__": {"id_": "b780e410-efe2-4ae3-8468-bc2299406311", "embedding": null, "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3f4d1ab6-983e-4683-9a76-18330c0342d4", "node_type": "4", "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "aca46150503b717fe0c6c848615cc3bc9f4524cf39fe543e2d175e33bd7b7188", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "882d5fdc-a69a-45b1-a7f4-8056cefd0550", "node_type": "1", "metadata": {"file_path": "/app/routes/oauth.py", "file_name": "oauth.py", "file_type": "text/x-python", "file_size": 4788, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "063fb8b5b444a044fde1cc1e32d618d9c424c25aade3fb36d12b01be9c5e1910", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Validate 'code'.\n    2. Exchange code for credentials using redirect URI.\n    3. Persist token.json.\n    4. Redirect to post-auth landing (relative path).\n    \"\"\"\n    if not code:\n        raise HTTPException(400, detail=\"Missing authorization code in callback.\")\n\n    if not CREDENTIALS_PATH.exists():\n        raise HTTPException(500, detail=\"Client secrets not found.\")\n\n    # Determine redirect URI for token exchange\n    if OVERRIDE_REDIRECT_URI:\n        redirect_uri = OVERRIDE_REDIRECT_URI\n        print(f\"\ud83d\udd27 Exchanging token with override redirect URI: {redirect_uri}\")\n    else:\n        base = str(request.base_url).rstrip(\"/\")\n        redirect_uri = f\"{base}/google/callback\"\n        print(f\"\ud83d\udd27 Exchanging token with dynamic redirect URI: {redirect_uri}\")\n\n    # Exchange code for credentials\n    try:\n        flow = InstalledAppFlow.from_client_secrets_file(\n            str(CREDENTIALS_PATH),\n            scopes=SCOPES,\n            redirect_uri=redirect_uri,\n        )\n        flow.fetch_token(code=code)\n        creds = flow.credentials\n        print(f\"\u2705 Obtained credentials (expires: {creds.expiry})\")\n    except Exception as e:\n        print(f\"\u274c Token exchange failed: {e}\")\n        raise HTTPException(500, detail=f\"Token exchange failed: {e}\")\n\n    # Persist token.json\n    try:\n        TOKEN_PATH.parent.mkdir(parents=True, exist_ok=True)\n        TOKEN_PATH.write_text(creds.to_json())\n        print(f\"\u2705 Saved token.json to {TOKEN_PATH}\")\n    except Exception as e:\n        print(f\"\u274c Could not save token.json: {e}\")\n        raise HTTPException(500, detail=f\"Could not write token.json: {e}\")\n\n    # Redirect to post-auth page (use relative path to avoid port issues)\n    if OVERRIDE_POST_REDIRECT:\n        post_redirect = OVERRIDE_POST_REDIRECT\n        print(f\"\ud83d\udd04 Redirecting to override post-auth: {post_redirect}\")\n    else:\n        post_redirect = DEFAULT_POST_REDIRECT\n        print(f\"\ud83d\udd04 Redirecting to relative post-auth path: {post_redirect}\")\n    return RedirectResponse(post_redirect)", "mimetype": "text/plain", "start_char_idx": 2750, "end_char_idx": 4756, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "427813df-0929-4f66-9bae-0fb44434dbc5": {"__data__": {"id_": "427813df-0929-4f66-9bae-0fb44434dbc5", "embedding": null, "metadata": {"file_path": "/app/routes/search.py", "file_name": "search.py", "file_type": "text/x-python", "file_size": 2750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "d060b8aa-6d77-49d2-bc97-176d87213302", "node_type": "4", "metadata": {"file_path": "/app/routes/search.py", "file_name": "search.py", "file_type": "text/x-python", "file_size": 2750, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "6d827ac8a7015563fcbb58024fa4e9ba21c858378af4732f82afc79f43cb3ac8", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: search.py\n# Directory: routes/\n# Purpose: Secure semantic KB search endpoint (GET /kb/search)\n# Notes:\n#   \u2022 Accepts canonical `query` param (alias `q` for legacy clients).\n#   \u2022 CORS\u2011safe: OPTIONS pre\u2011flight bypasses API\u2011key auth.\n#   \u2022 Casts similarity to `float` so FastAPI JSON serialisation never 500s.\n#   \u2022 Returns plain list consumed by SearchPanel.\n# Last Updated: 2025\u201106\u201113\n\nfrom __future__ import annotations\n\nimport os\nimport logging\nfrom typing import List, Optional\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\n\nfrom services import kb\n\nlogger = logging.getLogger(__name__)\nrouter = APIRouter(prefix=\"/kb\", tags=[\"kb-search\"])\n\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# Auth helper\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\ndef require_api_key(request: Request) -> None:\n    \"\"\"Simple header check. OPTIONS (CORS pre-flight) bypasses auth.\"\"\"\n    if request.method == \"OPTIONS\":\n        return  # allow browser pre-flight\n\n    if request.headers.get(\"x-api-key\") != os.getenv(\"API_KEY\"):\n        raise HTTPException(status_code=401, detail=\"Invalid API key\")\n\n\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# Routes\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n\n@router.get(\n    \"/search\",\n    dependencies=[Depends(require_api_key)],\n    summary=\"Semantic KB search\",\n)\ndef search(\n    query: Optional[str] = Query(None, alias=\"query\", description=\"Search string\"),\n    q: Optional[str] = Query(None, description=\"Legacy alias for query\"),\n    k: int = Query(5, ge=1, le=20, description=\"Top\u2011K results\"),\n) -> List[dict]:\n    \"\"\"Proxy to `services.kb.api_search`. Returns a JSON\u2011serialisable list.\"\"\"\n    term = (query or q or \"\").strip()\n    if not term:\n        raise HTTPException(status_code=400, detail=\"Missing query parameter\")\n\n    try:\n        raw = kb.api_search(term, k=k)\n        safe = [\n            {\n                \"path\": r[\"path\"],\n                \"title\": r[\"title\"],\n                \"snippet\": r[\"snippet\"],\n                \"updated\": r[\"updated\"],\n                \"similarity\": float(r[\"similarity\"]),\n            }\n            for r in raw\n        ]\n        return safe\n    except Exception as exc:\n        logger.exception(\"KB search failed for %r\", term)\n        raise HTTPException(status_code=500, detail=\"KB backend error\") from exc", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2343, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "32f98581-7c8b-46af-9380-c6265d6f9ec1": {"__data__": {"id_": "32f98581-7c8b-46af-9380-c6265d6f9ec1", "embedding": null, "metadata": {"file_path": "/app/routes/status.py", "file_name": "status.py", "file_type": "text/x-python", "file_size": 3986, "creation_date": "2025-06-29", "last_modified_date": "2025-06-29", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "1be88766-e23e-4620-b5e3-ef4059bfba74", "node_type": "4", "metadata": {"file_path": "/app/routes/status.py", "file_name": "status.py", "file_type": "text/x-python", "file_size": 3986, "creation_date": "2025-06-29", "last_modified_date": "2025-06-29", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "af9ba891333ef787576bf7068315c3c9cde1f192705cd9ea03c3cebd6f828860", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/status.py\r\n# Directory: routes/\r\n# Purpose: Health, environment, version, and context awareness endpoints for Relay service.\r\n# Security: Public (no auth; consider protecting `/env` or `/summary` in production).\r\n\r\nfrom fastapi import APIRouter\r\nfrom pathlib import Path\r\nimport os\r\nfrom subprocess import check_output, CalledProcessError\r\nfrom datetime import datetime\r\n\r\nrouter = APIRouter(prefix=\"/status\", tags=[\"status\"])\r\n\r\n@router.get(\"/paths\")\r\ndef get_status_paths():\r\n    \"\"\"\r\n    Returns existence of major source code/data directories for debugging.\r\n    \"\"\"\r\n    env_root = os.getenv(\"RELAY_PROJECT_ROOT\")\r\n    base = Path(env_root).resolve() if env_root else Path.cwd()\r\n\r\n    roots = [\r\n        \"services\",\r\n        \"frontend/src/app\",\r\n        \"frontend/src/components\",\r\n        \"routes\",\r\n        \".\"\r\n    ]\r\n\r\n    visible = {}\r\n    for r in roots:\r\n        path = base / r\r\n        visible[r] = path.exists()\r\n\r\n    return {\r\n        \"base_path\": str(base),\r\n        \"resolved_paths\": visible\r\n    }\r\n\r\n@router.get(\"/env\")\r\ndef get_env_status():\r\n    \"\"\"\r\n    Returns selected environment variable statuses (partially masked for safety).\r\n    \"\"\"\r\n    keys = [\"OPENAI_API_KEY\", \"API_KEY\", \"RELAY_PROJECT_ROOT\", \"RAILWAY_URL\"]\r\n    values = {\r\n        k: os.getenv(k)[:5] + \"...\" if os.getenv(k) else None\r\n        for k in keys\r\n    }\r\n    return values\r\n\r\n@router.get(\"/version\")\r\ndef get_version():\r\n    \"\"\"\r\n    Returns current Git commit short hash.\r\n    \"\"\"\r\nfrom subprocess import check_output, CalledProcessError, DEVNULL\r\n\r\n@router.get(\"/version\")\r\ndef get_version():\r\n    \"\"\"\r\n    Returns current Git commit short hash.\r\n    \"\"\"\r\n    try:\r\n        commit = check_output([\"git\", \"rev-parse\", \"--short\", \"HEAD\"], stderr=DEVNULL).decode().strip()\r\n    except Exception:\r\n        commit = \"unknown\"\r\n    return {\"git_commit\": commit}\r\n\r\n\r\n@router.get(\"/summary\")\r\ndef get_summary():\r\n    \"\"\"\r\n    Returns a bundle of status: paths, env, and version.\r\n    \"\"\"\r\n    return {\r\n        \"paths\": get_status_paths(),\r\n        \"env\": get_env_status(),\r\n        \"version\": get_version()\r\n    }\r\n\r\ndef list_context_inventory(\r\n    base: Path, \r\n    roots = [\"docs\", \"context\"], \r\n    exts = [\".md\", \".txt\"]\r\n):\r\n    \"\"\"\r\n    Helper: Returns a list of context file metadata from all roots.\r\n    \"\"\"\r\n    inventory = []\r\n    for root in roots:\r\n        folder = base / root\r\n        if not folder.exists():\r\n            continue\r\n        for f in folder.rglob(\"*\"):\r\n            if f.is_file() and f.suffix in exts:\r\n                inventory.append({\r\n                    \"path\": str(f.relative_to(base)),\r\n                    \"size_bytes\": f.stat().st_size,\r\n                    \"last_modified\": datetime.utcfromtimestamp(f.stat().st_mtime).isoformat() + \"Z\"\r\n                })\r\n    return inventory\r\n\r\n@router.get(\"/context\")\r\ndef get_context_status():\r\n    \"\"\"\r\n    Returns details about all global context and overlays:\r\n    - All context files with metadata (from /docs, /context)\r\n    - Which global_context (manual or auto) is active\r\n    - Last updated timestamps\r\n    \"\"\"\r\n    env_root = os.getenv(\"RELAY_PROJECT_ROOT\")\r\n    base = Path(env_root).resolve() if env_root else Path.cwd()\r\n    global_manual = base / \"docs/generated/global_context.md\"\r\n    global_auto = base / \"docs/generated/global_context.auto.md\"\r\n\r\n    def fmt_time(path):\r\n        return datetime.utcfromtimestamp(path.stat().st_mtime).isoformat() + \"Z\" if path.exists() else \"missing\"\r\n\r\n    files = list_context_inventory(base)\r\n    files_sorted = sorted(files, key=lambda x: x[\"path\"])\r\n\r\n    return {\r\n        \"context_files\": files_sorted,\r\n        \"global_context_used\": \"manual\" if global_manual.exists() else \"auto\" if global_auto.exists() else \"none\",\r\n        \"global_context_manual_last_updated\": fmt_time(global_manual),\r\n        \"global_context_auto_last_updated\": fmt_time(global_auto),\r\n        \"file_count\": len(files_sorted),\r\n        \"root\": str(base)\r\n    }", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3984, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "ea91a378-acd2-4f5f-af14-658b92f375bb": {"__data__": {"id_": "ea91a378-acd2-4f5f-af14-658b92f375bb", "embedding": null, "metadata": {"file_path": "/app/routes/status_code.py", "file_name": "status_code.py", "file_type": "text/x-python", "file_size": 1548, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "fe2de9a6-ce0f-4a48-88d5-7795f2454971", "node_type": "4", "metadata": {"file_path": "/app/routes/status_code.py", "file_name": "status_code.py", "file_type": "text/x-python", "file_size": 1548, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "9495f5b6e8e25a90dd97cebd8175cfbf35140633c39c8da3e5a2181709def90c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "# File: routes/status_code.py\n# Purpose: Provide detailed insights into Relay source files, functions, usage, and freshness.\n\nfrom fastapi import APIRouter\nfrom pathlib import Path\nimport os, ast\nfrom datetime import datetime\n\nrouter = APIRouter(prefix=\"/status\", tags=[\"status\"])\n\nCODE_PATHS = [\n    (\"services/context_injector.py\", \"core\"),\n    (\"services/indexer.py\", \"core\"),\n    (\"routes/ask.py\", \"core\"),\n    (\"routes/admin_routes.py\", \"core\"),\n    (\"routes/status.py\", \"support\"),\n    (\"scripts/sync_context_docs.py\", \"support\"),\n    (\"scripts/generate_global_context.auto.py\", \"support\"),\n    (\"main.py\", \"entrypoint\")\n]\n\n# Extract function names from a file using AST\ndef extract_functions(path: Path) -> list:\n    try:\n        tree = ast.parse(path.read_text())\n        return [node.name for node in ast.walk(tree) if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef))]\n    except Exception:\n        return []\n\n@router.get(\"/code\")\ndef get_code_status():\n    results = []\n    for rel_path, tag in CODE_PATHS:\n        path = Path(rel_path)\n        if not path.exists():\n            results.append({\"file\": rel_path, \"status\": \"\u274c Missing\", \"tag\": tag})\n            continue\n\n        functions = extract_functions(path)\n        modified = datetime.utcfromtimestamp(path.stat().st_mtime).isoformat() + \"Z\"\n        results.append({\n            \"file\": rel_path,\n            \"status\": \"\u2705 OK\",\n            \"tag\": tag,\n            \"functions\": functions,\n            \"last_modified\": modified\n        })\n\n    return {\"files\": results}", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1543, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "5a7d4598-6e9d-4dc9-a0d0-2538bfe16670": {"__data__": {"id_": "5a7d4598-6e9d-4dc9-a0d0-2538bfe16670", "embedding": null, "metadata": {"file_path": "/app/routes/webhook.py", "file_name": "webhook.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "24b63639-e6e3-47b2-8072-905605638093", "node_type": "4", "metadata": {"file_path": "/app/routes/webhook.py", "file_name": "webhook.py", "file_type": "text/x-python", "file_size": 0, "creation_date": "2025-06-27", "last_modified_date": "2025-06-27", "tier": "code", "document_title": "Revolutionizing Data Management: A Global Project Overview and Future Plans"}, "hash": "98bface7a3d495e784666012462ee261aebcf9edd01b38a314b44fb042fafa64", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 0, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}}, "docstore/metadata": {"0cb073d0-fdea-4c59-9897-7f0cfe9f51f1": {"doc_hash": "b14f73ad3f828aca9438fde83ed248aa03dd96d9a0664b03957dfa949a328c4d", "ref_doc_id": "598b72d9-f264-4f02-b3aa-24d1fd9b6031"}, "ba922478-c464-4307-aa48-1fe7f5d2c549": {"doc_hash": "20d52f1c2fc553f4337a6e63490e2b83d6eef9fad1eddc8a2a14b8062702c426", "ref_doc_id": "98404db9-bd1e-487b-997f-76ad3ddfaa79"}, "14070395-325e-44fb-8933-66ff70588334": {"doc_hash": "6f9c1ed3877bdf8810b368b0b4cc8b1a42c4730d0e609d8e6ecf4cdf758a7819", "ref_doc_id": "27fb9909-0534-4a06-9558-391d92cabdf4"}, "5c56f360-d61e-49c7-92c9-4622f0f5bfa4": {"doc_hash": "0cedf2172317f74cac62a9ce065bca8954f0c9da9b1aec96f834eb525ab1efaa", "ref_doc_id": "2a6f569b-cf6d-4556-8078-89439c8cb782"}, "0069d529-d62a-4dd8-aaec-7abed1829aa7": {"doc_hash": "62bb2b989e467c3c7520f32f6eeaabfc74117ebc8f590680db51fe84df786bc3", "ref_doc_id": "42211b25-e433-45b8-b5b2-73af3be71490"}, "b967d457-ed28-42c7-b94a-eac1e32e9737": {"doc_hash": "cf9c12dcd881267d120f3a587389f5ca6fa6c75de55b6b9695f91c94e3c98943", "ref_doc_id": "42211b25-e433-45b8-b5b2-73af3be71490"}, "7210335d-9a6e-4181-8a2f-cd69dbb63e1f": {"doc_hash": "6104ee5a71649c7633122446fc44fd2c879b74be5c4e9b16c628f2a8be84deae", "ref_doc_id": "9e37187c-d69a-4bca-a449-548cf6e83d3e"}, "e871829b-bcba-4c02-9188-e46291b288b9": {"doc_hash": "84c1662e795142316e244c5621cd5a618464c70d10d684da4e39cf5c5bb7acaa", "ref_doc_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f"}, "c90754db-5a0a-4d75-8d77-ae82273366a2": {"doc_hash": "830d39fdabb1327f4e9f7533f49df8e02212eb865df37a1d5322eeb63246c427", "ref_doc_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f"}, "5f0a2ae5-0ccc-4c7a-afce-12e5914fc335": {"doc_hash": "80e831f3c66275f38b7e6b32a914bc6257065de4ddb0cca748e2d01c723cd9c7", "ref_doc_id": "d18a01a0-f2b0-443b-b6eb-a8fb4b716e7f"}, "7856fb89-25df-48da-8fe4-d97b626d9f2e": {"doc_hash": "bdf44f1ffb381a0617d660e785e4efc3d727c1cabbab6a3679aaee59d1e5e23f", "ref_doc_id": "90cc8f9d-7428-4c64-81a1-bc88127c8368"}, "fcab0e2e-81d6-4891-bdfe-f34ecc541fca": {"doc_hash": "3c545995934020a63e406ae80fb2b9062a756fcc684b9b4fda533e7f9eab1557", "ref_doc_id": "e47a7785-15d1-4a22-a322-d14f914d3493"}, "ddb3ba24-c6e2-420b-be3b-7d30105f8c67": {"doc_hash": "763da82a10b3766c3d9d2f1d213fa6f2a54663cfbee319ff1da08acc491a56ba", "ref_doc_id": "97b8c10f-445b-4001-88d0-1a1fab952df3"}, "d19a0639-dfcd-4344-ae89-e324fd89eff3": {"doc_hash": "908081fcd78a14433e2813c65277c9558b796af32226546893559db6da963b79", "ref_doc_id": "70a8dd68-ec93-4f0b-9e10-aa2122a427d5"}, "163c3a83-d4cb-4187-adaf-e6e31be16a3c": {"doc_hash": "1393cbce4e9f1e2f119e53b6cf724e5218467b1fd68da1826ffe9580d863f507", "ref_doc_id": "60f448fc-35d2-4935-aa32-5130b542cb5b"}, "0bd14bab-5ff9-4792-92da-3d1e1f937de3": {"doc_hash": "a0fb1b7192d1382592e106b24f2ebd89ebb0e75db45773484bf90d00cbce638a", "ref_doc_id": "d6d313a3-ec38-44a5-9b1a-e9d43a123c4b"}, "f11a1b5a-76a1-40c7-9a6d-165c3c7c820b": {"doc_hash": "3c07fff0ed71164ad5d0d0b6a4b17cbd2511b7ca2efa9b8125ec4904838fcfbb", "ref_doc_id": "937ffef8-60ba-48b8-9fd7-429f1022bbe5"}, "6369ba28-de16-4386-8878-597c9112b4f3": {"doc_hash": "3928fdcdbcda2571509b10431946af28c409c653836829f17459414a20752927", "ref_doc_id": "eb40f0e7-43e1-43aa-bc2f-b5a41c66240b"}, "ac735090-6a24-45fb-8477-31a1039dab1d": {"doc_hash": "8e82b12803bb79b01139dcd24b672dab7f539cf72316b3643f7d717ff72de3c8", "ref_doc_id": "c7e5b0eb-86bf-46b4-ac54-8a9f440cc091"}, "aa6d2780-cf2f-4738-8f4d-70478b4b571d": {"doc_hash": "44c6abc4498a8329484aa55ad4ee2067a6569b4b3e0e6277ede1b4e74b4b0c1e", "ref_doc_id": "23132ac7-ea1d-4493-ab31-0cdb5fa28563"}, "c4904cf7-4873-49f1-99e4-da29bfdb7429": {"doc_hash": "fbd994e3184cc0823e302c83478af4c335586d63d33877091d0806725d061c53", "ref_doc_id": "c2708967-07ae-496d-a96a-73d352fec2e9"}, "0333c725-2e3f-455a-975f-c9c902194c33": {"doc_hash": "6356f8380f16f9f193f6680dd9f13c24ffc226b720cfa398f1d85e8cd35b8df8", "ref_doc_id": "006c4a7e-3fa4-4e51-9a35-2884e55838f7"}, "dd7ef435-c30f-4e6e-ae35-51a74b34bbf5": {"doc_hash": "d9d527304d67d9c4678f4bd4ef0cf4d07e7078560195cf24efded7876ae5c4d6", "ref_doc_id": "bd95f59a-e4d6-4a80-aad5-a4fe8768719b"}, "2ef8ab26-9154-4815-b552-4aea9b4827a1": {"doc_hash": "aa97f250d11c2c634517f939f757642e35811dcc917a049317c3671f5990d961", "ref_doc_id": "bd95f59a-e4d6-4a80-aad5-a4fe8768719b"}, "911cb623-9812-4dce-9024-495c6f8a96e0": {"doc_hash": "34989d5c32c955323d0ba9d35c49039e3c5533cbee3ed11f270aff3fa0a1527b", "ref_doc_id": "f4890c21-6889-4d02-ad81-221656141a06"}, "68690144-0e7f-4b23-b0e4-58344b44af4f": {"doc_hash": "56e5b5522dd096d995be8e021034bd2d67151ff8194fee56a18396d718e19947", "ref_doc_id": "22c1b0ba-50d9-4cd2-822e-b6b51cb1b027"}, "d7048ed1-c644-4631-a2d8-def233197f93": {"doc_hash": "c0ea6565cec746302a41abfb9dde2c73fca5e2cd06eac556fcee57211a3ee973", "ref_doc_id": "cf2e2983-2991-4e70-8968-818b2b7db5f8"}, "247a961f-811c-4041-a97e-02beb3c92e03": {"doc_hash": "312231939d0a12527aea4b7924f925399d30fed164a7ef14d414174334da92af", "ref_doc_id": "1f1c0190-06ff-4179-8088-93423ec99c1e"}, "01dc55cd-14b6-48fe-8957-ea14e721a848": {"doc_hash": "d52ab5c636c71fc27045c8ccccc3f247ea230f4ffa138c457af6fb23b544debf", "ref_doc_id": "c3f5b707-7db2-4066-91f9-7256de024454"}, "7fa12f32-a7ca-4792-84d4-daecd4981c0b": {"doc_hash": "bbe4cb3b2a0b4d48dcbf9d191319d8b23e7a630807d7f7eed4d95211842c9bce", "ref_doc_id": "deee53c9-0121-4eff-b211-b0d93c663a27"}, "1b9fdb91-aa77-408e-9f1e-47311812df7a": {"doc_hash": "b6d8ca9dba7737d46912127fc1af1be7a7a7973af32f1c93e3e22007aa7744bf", "ref_doc_id": "f30acca8-76ed-4963-9fae-4562da85adc5"}, "abe5ee4a-581d-449b-b904-5aee59ab1aeb": {"doc_hash": "26ce08aa266f4ea4e0b6a2af96cc24e650c5ca09b31ecb72712f5812e1a821b6", "ref_doc_id": "789fe320-777b-4984-ba88-323eb0987f69"}, "dee2e32a-bdc4-4059-88ce-18b1073c3cd0": {"doc_hash": "08955a8d2b59917ee40042a49e118ab218079952d03f89cf7b93cc00b53a5c10", "ref_doc_id": "2aa6c552-d907-41a0-a876-3a4a92fd6b82"}, "d929e17a-a853-49b5-b2c8-236abc0c95de": {"doc_hash": "2bff1e2bf53cf227bff135cf50d7961683b6aee6a922a9841e6e29224968ce9e", "ref_doc_id": "59a30dbe-fe0d-464c-addc-e9401c67f211"}, "a9ca2aad-c06c-4a31-9e18-72494c78fcf0": {"doc_hash": "fd854ea1ce13393acfa2ac56ca6bfd1e6fca38a1cac589fb2b04881c179d013c", "ref_doc_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5"}, "7d6bc3c9-e73a-4cc2-b2a3-17918dcc6f0c": {"doc_hash": "a6a45bfd62a136ebca83eb6766d56c39b0b4d2415e45651a10552adc47e23d9e", "ref_doc_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5"}, "d851725f-3a9f-43d4-bbc8-67011b3d65b4": {"doc_hash": "43f6a6b2b2152267ea476ce4731bb675a18d515787b8ec7d1142da61b92dcdce", "ref_doc_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5"}, "27c6955e-1add-4106-95a3-6d73f0be21c1": {"doc_hash": "3bb00fefce23e2fc568926b1f1661e82acaed66d6d7f58904ff4de438c3929ca", "ref_doc_id": "cbd3e275-dec4-4c69-b2bd-947dbaae36e5"}, "169475b9-b84b-4b71-976d-0e4f25764e27": {"doc_hash": "6c4de1d874d91400da12d7c73eda81bd21f0af32352cd034567c7e0ddad01a60", "ref_doc_id": "76f9d856-249d-4bf9-a8be-88ccda517381"}, "a88a66b7-6eef-42e4-b783-fd5630ce17f2": {"doc_hash": "7e71b0a90de788ca42f98783d0bae465b9f5437b1dcd9554768d131fa1d3080f", "ref_doc_id": "b2e6dd37-609b-4514-8801-6ad9e3c464fd"}, "7371b9b0-bfa0-43f2-889e-fc011e961fd6": {"doc_hash": "db76f1ab594ea062ae34a6d66724fbdb7511fee2d925d29a77aa689293c4f863", "ref_doc_id": "ed45e49e-84c9-4e0a-9334-42494eaa49b4"}, "366f6908-45ef-493a-9783-e31fab422f30": {"doc_hash": "9b7834d850b181e30e65e36e74e056de763b334b8075c9ce6af89c2173b02b54", "ref_doc_id": "a29717d4-ebdc-4761-8ada-6a7dedf5cad1"}, "2d6fd3c5-60a6-4f3e-b33f-845d9b9e08c1": {"doc_hash": "99c4f647e9d8cdd6ec5ed6f977c0be9bfdd6ad775fec73f2cfe5a4ccc5259bb1", "ref_doc_id": "dcc942cc-2105-4a05-921d-75e91c655b86"}, "ea4f0b75-0bca-48bd-9825-95627eb6d4a5": {"doc_hash": "23841cabe2e221cb199f5624f14fb082fdfc3ac7d812dee066d26b93476e344c", "ref_doc_id": "dcc942cc-2105-4a05-921d-75e91c655b86"}, "ef605c2c-fba0-4103-aa29-dbf5cac0673a": {"doc_hash": "1beee190792631d3e1dfa81c6017f4520a5173cb9d761b601945912aeacaba44", "ref_doc_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143"}, "d2784268-cae6-404f-bc18-0e971589b590": {"doc_hash": "cb95432170d6a5f58b03a437e4429c36757a86b4e0950fdda49bdb96418414ac", "ref_doc_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143"}, "22ed50f8-bfac-447a-8a55-1ecf47f1451e": {"doc_hash": "b31e2138b6414f4c6e9b9b8a54865adcc7f73377a6af868e794d3d5c79d82ad3", "ref_doc_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143"}, "c078f711-8fa0-4bc4-a942-f73a125586ac": {"doc_hash": "fa174d57ca4ce1b135c32fb8855eb0a5725dfb523f9344b21fc7d304c357740b", "ref_doc_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143"}, "b7abab8e-bcf6-4615-b3cc-4da8a84472d5": {"doc_hash": "7afd104f1d87473b7430072f1bccce5164024032ca9526e86dc5593651c28286", "ref_doc_id": "c5f7e75c-55f5-4277-98aa-74eb69b3a143"}, "f497744a-84cd-4c7a-a381-f2115eb122bf": {"doc_hash": "79d4d70cb3ae217650de442409bc880329fb9009ecaa841a254e6ba489b0b96f", "ref_doc_id": "42752c63-cbe8-4f2c-b3e9-dc47a71c9cbe"}, "16644408-df7b-4ca2-8c56-5a31ee5a60cb": {"doc_hash": "33c652a2c55c0dc1bb4ed2e330f3c8084889715ffd9c31789ee1e0eae76990e1", "ref_doc_id": "fbde4216-4dc6-418c-ad99-bfdd2a9e4306"}, "bc089606-c7b0-4cf8-bbfe-b33584138e17": {"doc_hash": "f068ad5cb44b85d2545ff82e1a3acc2af3610d9e5907f403019be435785b37e0", "ref_doc_id": "fd39eef8-3bbe-410d-a4aa-b462b6185f01"}, "d6b5ac67-7e22-499c-abec-6d6426fa0ce0": {"doc_hash": "9689420982f92a07dad28b1b697ef8ebc7c9958e5d0f1eb2a3055b0f50d68af5", "ref_doc_id": "03097629-6de1-41d7-80b3-8f63ec4b85ee"}, "08443eb7-dbcf-4482-80fd-ca80b3b3c6b6": {"doc_hash": "4f095ae8798c259f4b552f3b804463349c848ce8d3569273c3bc8677480b62b1", "ref_doc_id": "7677e1cc-8bfb-4841-9763-b65dc677f4ca"}, "c28e4624-a0d4-4df7-ad73-72caeccc21b0": {"doc_hash": "6c7a9c09e50a3ec0cac90df9df7fce70e44b03b8fea32e4c0475e098a882aafc", "ref_doc_id": "1ce7d98c-a264-4e79-978e-255958397231"}, "702b1cb1-a863-4164-84ca-42fa7abffe4f": {"doc_hash": "7a6490a4ffb5bebc304b20a42e7b9be46f5a19eaa1aaf3425ac119b0302eb22e", "ref_doc_id": "1ce7d98c-a264-4e79-978e-255958397231"}, "016288e2-5e2d-4d41-80bd-35972a6e3067": {"doc_hash": "a33e44dd33ad5060b91ff716cb74b4e70a1ff933ab90545fb19b67c1d883da45", "ref_doc_id": "d11682ae-4b7e-4449-93fa-15f00d301caa"}, "1442fb0d-f021-4e20-a455-cd4e7bc50330": {"doc_hash": "b7431c71986367787c0f3c945ca43fa5b5f24a331860091849444850dfb1a085", "ref_doc_id": "d11682ae-4b7e-4449-93fa-15f00d301caa"}, "0033a319-25c1-4402-aec8-0307db0e55e7": {"doc_hash": "bfa87dcc84fa30c2fece3fcb3aa001a4becc7fba0bf1b89c689032b837c70935", "ref_doc_id": "d11682ae-4b7e-4449-93fa-15f00d301caa"}, "47ceb626-b1ca-4aa0-b952-07b4e65d35fb": {"doc_hash": "0cfe4bd4a1e6ff45722d6d88093271fb07b48bd951720930f57c6b79de651422", "ref_doc_id": "39673939-c4bd-45c9-9db3-a4e30dcaef1b"}, "30cdd1db-99f2-4bed-ad09-de9f121ba7fc": {"doc_hash": "34cdaedad5cda829d7abe9e2f83d682a846b3e9b3dd02ce56d8a08039e75f6bb", "ref_doc_id": "a2d88b64-bca7-4247-874d-b49196eead01"}, "47ed4b8d-0954-4137-9093-33783865cfb7": {"doc_hash": "102336d22f9da4c0d98c89665723b1cf2b7b88de98f07374779edb5ca007dca0", "ref_doc_id": "a2d88b64-bca7-4247-874d-b49196eead01"}, "043eed59-c993-4088-a488-0861516b2ba9": {"doc_hash": "7d87d5651640fbd6d1e6c383fbb515ecfa0748655aac5ed963a5fc62e1abe7a6", "ref_doc_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e"}, "8d9f48a3-c889-447c-b779-58bf3b62be44": {"doc_hash": "9fac35914165bca76c0153b6b701d9611224a4beafd8d81d05bd97ad0c8c6c82", "ref_doc_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e"}, "0889d79a-915c-4865-81c9-47919a84d274": {"doc_hash": "e5e5d2fae5ccf541b958fe1304a227aeed7ac19fa5b1978d13a0f5a1cc45ca74", "ref_doc_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e"}, "ea561eb4-412b-4f79-a7b2-f51a36be09cd": {"doc_hash": "080a37222f2d4abe20ffb1e4147036738351f32e3e47ce14429b74a37d362b14", "ref_doc_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e"}, "86a9e1ea-d77e-4c82-9b18-c481c054d9ed": {"doc_hash": "000da8791bcee09f9667db0860b9a86cdb5ce324bbcde9f3d8704394ce642c05", "ref_doc_id": "d577dd3c-0a2d-4cfa-bff0-d25056942f2e"}, "54ec9ec9-841e-4f44-b6d4-e8dd93db7159": {"doc_hash": "9ea4a90695c1d5e70456fd07f83d3f395cab30fb301ee69a92952030a8fbe4c0", "ref_doc_id": "9fd3af2e-409f-4652-be63-c1eca91f9475"}, "c7e21dbe-ccf3-410c-a581-8afa3159981d": {"doc_hash": "aeecf753e3bde48ee7459c29e7f63f4be2d961eb28a40c8d5d7944232638140e", "ref_doc_id": "2780754d-6ad3-4e5d-8796-460cdc823e17"}, "6006a86d-2ea2-4838-8727-4b864a0751c2": {"doc_hash": "24c42b302ce84d2b69ebc7ee203761c8b0fe8426b3264e982fc66fc8bbdd4d5e", "ref_doc_id": "706c8232-7cde-492c-9bfa-07e3825ea4cc"}, "a16c8553-54fd-440b-8215-4ade186ac58e": {"doc_hash": "1ea6d50eef6a268b4653933f368bf576710de49378ee1243b1f959853b825182", "ref_doc_id": "706c8232-7cde-492c-9bfa-07e3825ea4cc"}, "76d2aefc-f4a8-478f-b1db-ec8c91d2f67d": {"doc_hash": "65bbae68145fc5cfa4a387b11b6dace8a793fea3e0524c4dc2bbed1a98f9d054", "ref_doc_id": "ebafa638-7ade-4f19-8960-d96a77b14225"}, "8374feda-2359-40a5-9a75-37cfb09c2f01": {"doc_hash": "42c941da8f73adf306ce72fe4a854982bd5d72f1e9a74889b83db251854dde0e", "ref_doc_id": "8435d31e-cf88-4fad-9ca6-c1e674f99069"}, "1070213f-b90e-4096-9acd-19b578926990": {"doc_hash": "aca63d93a919c537861198c4cee3f157844ed251eab991a3c0b6c9e7ba3d2bdb", "ref_doc_id": "e887bd1b-a075-4c4d-bf43-ebe4fe0694c6"}, "6848a3fa-c8e6-4d01-96c6-6005c28d53a1": {"doc_hash": "8638f7e5aafc52c0b2eefe89f2f40f2a7802679a2cc47573df5240b07a66ce49", "ref_doc_id": "b1f589d5-03a2-4e7a-9a72-5874ed82e3f3"}, "3eb78614-bd95-4d18-a308-aa1aa1a0a736": {"doc_hash": "9faebf963d277f2394d7965466cab00afc235b52edc23f8d519b60f23238d679", "ref_doc_id": "c4a0e9c0-195f-4783-a7f9-538a0e8b86c5"}, "b1dedcc3-0dd2-4028-a633-57aba9b33ebb": {"doc_hash": "dbe95085216c4e5d1cc97756f5ccf59f987911130cf630a838741052cb5caf2b", "ref_doc_id": "282b49cc-8e64-4ca9-a9f7-f03c7cc8ee8c"}, "343d1e2e-43f4-4063-9c82-13ea47238a27": {"doc_hash": "70b9298cf0b6dfabdcbbbf923901c3897a0827511495216fe873639610fd86f2", "ref_doc_id": "95a26b24-98f2-4312-b4bf-509f6561834c"}, "99648ab2-897a-48c0-838f-65b84df95cf4": {"doc_hash": "6b87b6d7df1b6970eb10b8b5421479f8ef0fc801f0e276f908dc394f7b8b5ba3", "ref_doc_id": "816ee76c-ad91-461d-8e8e-f7844e8705a0"}, "47791dcf-be74-4f5d-8b82-6427624f3479": {"doc_hash": "09c549511a8840ebc90e206ab8c507eed6408ec052c837870b00bec6a4625075", "ref_doc_id": "01faa84c-5693-40ef-93d9-9137f833d3d5"}, "1dffc1eb-2c93-4993-8eb7-c080c71d3cdb": {"doc_hash": "cbf3110707fd5d2ede2ec133e759001228f32e85953d0a2aef69afebc9938dd5", "ref_doc_id": "70dcc4b7-3f74-495d-afc2-8d6970803b30"}, "c1db7728-6a92-4e13-a65c-212183b63c27": {"doc_hash": "6c4061c13328814dddb030604bf4a7defbef809d69360a77ed95322cb641be86", "ref_doc_id": "9b5d1a87-8cfa-4eac-9f34-6b99835b9dbd"}, "26c470e5-4630-4347-a307-e73151db2567": {"doc_hash": "4b56970dfd2b9c57b8b8a731a06c29efa61aa5f4fbf53395313a550447ba9597", "ref_doc_id": "5cedd8b6-185c-4504-b9b8-0c5b4022e187"}, "49a8370e-030f-4b8f-a4fe-a891f0a0a6f2": {"doc_hash": "3474b21c0e4ccee0eac494fc067c17f1067a8fc8e7cad0b9d2027720e8051bac", "ref_doc_id": "f7bc13d9-48d0-45df-99b3-34123a4ff3fc"}, "fe1bff42-bc46-4842-8124-165bdb5fc5d2": {"doc_hash": "92c2d746b522c681b17080c8b0cbc9bcfdbcfdaf95a9095d830849f624344950", "ref_doc_id": "c28fc02a-c386-43ff-ae78-208479f8d59b"}, "45f2b7f7-5051-4cdf-ae64-edbdb255b495": {"doc_hash": "965550ccdce51b8905ed63b6c1734038ec0c406756cbfeb73c575c6caabe4166", "ref_doc_id": "d86e90a0-519a-4c83-ad34-c383fe0cd8c1"}, "cdbca185-3e63-467e-9afb-cb751799e1ed": {"doc_hash": "56711bfefda20fdfdfa085c1df468cf0059f3a0058d54864d0b31e9f66f13bd5", "ref_doc_id": "a9a12e36-3853-41ee-af61-d7f8ded4d8c7"}, "f3e66473-5f6f-40d5-ae68-9e2b8a16e5a0": {"doc_hash": "d55432a31fb4cb517f349ce3166494228780c59a2a34db9c8a8a4cbbc5cce033", "ref_doc_id": "c8e052b5-fdf0-461b-8a65-04c2ae17e8a5"}, "2233adf4-5aa9-480a-81e0-860d3653bf8f": {"doc_hash": "f43038bde8ab31a99e37644ed2a320483bfc4ac50c42f9a19426c2b704c4d5fe", "ref_doc_id": "08fe0554-6ffc-47ac-baa9-4eda73e97263"}, "8679f336-dea5-4980-b9f2-90a7e9e983c5": {"doc_hash": "e8952a26a9e176f79cbcf4e208b265b8f21b85805611f1ebd84a66fd423afecd", "ref_doc_id": "08fe0554-6ffc-47ac-baa9-4eda73e97263"}, "0d538ff8-c6e7-480e-9689-eebbba7c2f1d": {"doc_hash": "14afcdb71877331065a3d57bd9618200f011120e35563eb017d22f86212e4b14", "ref_doc_id": "51fafe6d-a61a-40d4-a98f-95663f297bf6"}, "13dd44bb-9093-490b-ab64-4d3c8c12b40b": {"doc_hash": "2fe03526123c959ec6fca87cc39a1d3153c90bc5ab1759c75a783b203d1956a3", "ref_doc_id": "12511bcf-39c2-4e3f-9798-0568e655fbf8"}, "2ed4aecd-565e-4d45-ba58-79cc375aafac": {"doc_hash": "f325414142efbd841d56d5aa9756a1267f402c39dd49122d19ab0067302a0096", "ref_doc_id": "cdaf2771-af13-4881-8a3e-2014ae513861"}, "de9a04e2-1561-422f-9e60-4f455e266d96": {"doc_hash": "09fc73b575e3571f6d7339e1bd1e4248c8647ac545cd5e2f7b894a59f6c75f0d", "ref_doc_id": "e1d74f3f-6392-4355-b807-6098794b2315"}, "3cb4d07d-ad2b-498a-beac-574df3aa995c": {"doc_hash": "a37130a4a932d29341dfeb514bf6bf04d7e11042a06778ddde721531616d4c70", "ref_doc_id": "3b3698f9-b0f5-45cd-a16e-fb6d250fc55b"}, "497f4876-c00f-4eec-b5bf-49e785f4d2f2": {"doc_hash": "7045744999a81024ee0f74c2d34e0f53bb2a84eed88a459be87b715f4562a1c0", "ref_doc_id": "40156584-b6be-4f30-a2b0-174c90060f04"}, "b2026e8b-b2b9-4bfa-bc7d-1d9256315e82": {"doc_hash": "60e87eaa98e0a931935ecc8b68d3f1570f401c36c03cec41f1ad39bc6d80a345", "ref_doc_id": "106921ef-d4ba-44ab-84dc-21ffb73e752e"}, "5a26d495-b97a-435d-8033-4e1fb2d0a652": {"doc_hash": "2b1fe0a45b1debae0e509cb909ed9d8f12830215be8e37ea31dfd061f58dfd37", "ref_doc_id": "666a03f5-2130-4735-8080-4c155855da2f"}, "6634f4e1-fb37-4d67-8f1b-0d87aa54fa09": {"doc_hash": "fbc055ede759add1a34aa0a0585ca5be18530ce81fbd37329bb33993bcc9d942", "ref_doc_id": "666a03f5-2130-4735-8080-4c155855da2f"}, "d43a0fec-8ce9-4587-9ecd-c91857aa48ee": {"doc_hash": "d1817e35d5a0b7824024b3219a60fb2b9096051ccb745e2ace755b7e658a2f70", "ref_doc_id": "666a03f5-2130-4735-8080-4c155855da2f"}, "c9eb9976-af7a-4846-bf66-e69db7692479": {"doc_hash": "1119b94fbecde8e6a2c7294d7051d9f33faaef8c953950ef0a729a42e5d98175", "ref_doc_id": "d7fc6d5b-aa0c-4da9-be5c-ca32e33e67b5"}, "653f46ce-a9c2-4580-b2dd-662c5038d3ba": {"doc_hash": "841e2e59c474dc4200451228094b0e60a7b3f11f0232d56f95caac14ea1b2275", "ref_doc_id": "6abb1d86-2fdc-4a53-bcdf-690d30cf3a89"}, "7ceb3846-0fd3-4af9-a1f4-491b26ecf33c": {"doc_hash": "e3e8d6400ab855020d53c6c1a8accfe3a503c5f82924b7b06b25178a05529651", "ref_doc_id": "cc24b8c4-4e5f-40b9-8718-08d2a4e6a915"}, "20507cc0-ee01-4a70-99ae-c8a438a646d6": {"doc_hash": "8a9220bb6da102f1cb97b4e4d436abf7b1e08e89fb810b19894e108db81450e5", "ref_doc_id": "cc24b8c4-4e5f-40b9-8718-08d2a4e6a915"}, "f4340a8c-f585-4252-a04e-30b77b4291c4": {"doc_hash": "ce569a73061d7ef5658cad1ac05dfb6e928c6d1aa49e5757993f1b3381250882", "ref_doc_id": "76c4eec5-d3af-4318-afba-f3509593d9ec"}, "5d20c69a-bdf8-4335-a07f-39b7eb14ec64": {"doc_hash": "dc1fb6c7100f5275b4871d8262afda11ebf857291e16f10e34955a2937392ca8", "ref_doc_id": "ffad7c87-206a-4b06-8aac-b38ef5776aee"}, "93a4c2c4-ce1f-480f-85a5-b7b76a033568": {"doc_hash": "f0fbf736ba8a571ab52fdd1602900f1fe33a4eafa7ad380ebcf55a132077ac66", "ref_doc_id": "f66b532c-3be9-4c19-b7d0-fea80573db7f"}, "1f29d13a-3ed7-4fa3-baeb-1cf6dbcf0037": {"doc_hash": "7976079f4e93a4e94693d139d7e0ba30a747c60f17580f4a5c21ae166f088f95", "ref_doc_id": "44fa8941-2814-4a01-aba5-3bb729e24ba4"}, "927ffb71-8f64-4366-9524-c95a688463b0": {"doc_hash": "175bb1e87c4f8ba126975a9b174d9011002e852096895b801d1238de5f48cf10", "ref_doc_id": "e48d94ae-698a-442a-b50c-b5629a72998b"}, "7037f45c-377d-4478-b512-1fcc489785bb": {"doc_hash": "b564de4b3b7e0d86f533984d89d2bde9f7c2e9cfbb93c8995c3862dc832a1337", "ref_doc_id": "2e37c06f-f4ac-4626-932c-f52902861a1b"}, "7c59b589-e944-4422-8273-95c823a2d419": {"doc_hash": "82db7f9238fc9e0d973d4bfe09f337e2ef4dcef830fd2838bcb2252f6781b979", "ref_doc_id": "2e37c06f-f4ac-4626-932c-f52902861a1b"}, "330a5aca-6fab-45db-8e96-fe08ffb54ad4": {"doc_hash": "51ce42eb467fde985a440cf2cf85240a367719d9c2fb12606df9c52a5625ccbf", "ref_doc_id": "1406e348-9f7f-494f-b2fc-35b495af11c8"}, "5075e2d5-0f28-4c8b-ba4d-eaf4337dee20": {"doc_hash": "5de00256eb95bd51d6de652db761a622823140bf4c5c223158aa510765637b54", "ref_doc_id": "98cbaf46-e65d-4ded-9dbe-e7ba4cfaea2a"}, "3c8951e1-6c13-4ca2-b999-00a335659b69": {"doc_hash": "9a8f3c5a6c9f14379555ac6bc76e4c8de344346642e48a587e587020b920af1b", "ref_doc_id": "98cbaf46-e65d-4ded-9dbe-e7ba4cfaea2a"}, "03920661-e957-49c6-ac0f-075c782f6fc9": {"doc_hash": "c08db8a86f275ce50d0d47162807bf839546dc0285d8b82f25ed83da9c79864b", "ref_doc_id": "f341f9d2-cccc-4418-be3e-715ce653f572"}, "40baac40-67bf-4c4c-af08-77684fd07ebf": {"doc_hash": "23ecd64df94e9866ecf891e61af8c685fbe77f97d6f6601b767b52576b47092e", "ref_doc_id": "f341f9d2-cccc-4418-be3e-715ce653f572"}, "42c018dd-b14a-4e90-9136-6f4f6762f4f3": {"doc_hash": "a93be07011494f97f89dc1652ad63635e138ded6cd68a7f39c70c4d69b6ebf01", "ref_doc_id": "f341f9d2-cccc-4418-be3e-715ce653f572"}, "b441a16c-472b-4a38-beb4-27f4fa05c267": {"doc_hash": "f0779355218ebfcf24367ffad39fa8fbf0f446519659e1c34257702573cfb7b6", "ref_doc_id": "f341f9d2-cccc-4418-be3e-715ce653f572"}, "3f349fe1-d202-467d-99f8-9ad0c0268c7a": {"doc_hash": "17154a7d8dadf8a776a684373fcf483cbd78995bb04cd47d9781a60d9e2da48f", "ref_doc_id": "f341f9d2-cccc-4418-be3e-715ce653f572"}, "3ab9e8c4-ea50-4f43-a874-c4a8bb7a506d": {"doc_hash": "0c84a615486ef602c357ddec1fb5f1eb437a6daf5fca9ade679d3cec79b48229", "ref_doc_id": "12bdd9f2-588a-4e21-a184-65acc4d47f3f"}, "86514c3d-113e-45ff-b4f6-30687d292e69": {"doc_hash": "5665b1fbab31595082ff5b45aa124e4fcf69efa00ebab48096183da1d4c4c427", "ref_doc_id": "c9baed79-0f26-4092-8771-51d378c03cb8"}, "61baf95e-c397-484e-9f0c-455884354f16": {"doc_hash": "6e93dd20e715d2be9050eb334536f11e08120538e3b54ce3702faedda7cd225c", "ref_doc_id": "33bc1432-895e-4b38-8ff5-ee973f054d87"}, "20495967-655f-44e6-9788-37b9d2b0fbd4": {"doc_hash": "5a5880712ff853cebc7d97e26a3c92ca0fdc0542911c76821807dc367a59508b", "ref_doc_id": "bae58ad2-2880-4d67-9488-d76274bad464"}, "7dd24142-5da5-4484-a631-4d3e99c62030": {"doc_hash": "93a9f89264d0b7539df085155a9e113bac03b6563d12bc2cb95fdb767bfc4437", "ref_doc_id": "7d280a23-188c-412d-b437-ac1b5d09ccd8"}, "fba52ff1-4be3-44ea-882d-815672630141": {"doc_hash": "1d9b72ada4169f6507d4151c90547dd58b7b41dcb65a65347ccb7396c2d2a6ac", "ref_doc_id": "88bc859b-b1d1-4b68-878b-ccb01526aec6"}, "0b044b21-2c48-49ac-8aef-17658e597613": {"doc_hash": "e67347dca52c599895e46fc376bbbac203a6f4b57e421d324a6f9ea84441b8ec", "ref_doc_id": "17c0e145-b5de-4dbf-a8ee-50aeb558d73b"}, "90a434ee-5092-4034-8e70-cb137ee8bc62": {"doc_hash": "d3d54ef7e2cfd730e347418a107af42023f0405802e01b8cdf31610013880e29", "ref_doc_id": "af68bc4c-397f-4d64-ab7d-753d5849ae64"}, "a540590d-9d02-4cd2-a88e-8b337e7b63f3": {"doc_hash": "74db9797c349293ce98f10e03fa429d9fb7fc6c2b61f0166fc9b240be8a92a6d", "ref_doc_id": "08b0e869-a678-49a1-b282-20fe1ddedcec"}, "92e45e3b-d9fd-4289-b577-599725645e33": {"doc_hash": "915c412970bcdfe3b9b2e04b0a56596cc05ec7ae7eddfdae3c340fe59248ddf0", "ref_doc_id": "d96b136e-e43f-4fff-8e5c-6bba157490f5"}, "ecd2b3a5-f09c-4cf3-a9ed-3541f0174271": {"doc_hash": "156a15f01aa5601ae60cff4a0506705e25fe038add1e0c291bdd8b4f84ba3740", "ref_doc_id": "f2742e92-9158-4420-a66b-2c08750cfba1"}, "f0a4b430-aa27-4a38-9b3e-ba516b92fa8b": {"doc_hash": "886e4e39ea485f6f18b3636f1eee7692a93bf69749b84958bc10dc31a7cf02eb", "ref_doc_id": "f2742e92-9158-4420-a66b-2c08750cfba1"}, "062dc2a4-0e0a-4290-80e0-dfe373f2a8c6": {"doc_hash": "ac10d43f05008805b081452fd4e03b06ff553930c411771a341c515e242d1dce", "ref_doc_id": "fa52c786-85e6-4bb6-b7d1-5498ae83d1a9"}, "c2e899a1-0bc9-49ec-9c9d-398353902c66": {"doc_hash": "c1b3b547c7247a7f1b5ea706b78ba728d932b73d954b70fb7555d79141686f6f", "ref_doc_id": "4a83839a-9059-492f-8c60-ccfb1ae9299b"}, "b302a712-c712-450d-8cd6-8405470eaa34": {"doc_hash": "fc749e0916bb4e3f8513f7aafb1967b78b867a509c0b7bdba00b4bdbd59d1b4c", "ref_doc_id": "4a83839a-9059-492f-8c60-ccfb1ae9299b"}, "9327dfbd-06ea-4b6e-aba7-aff8be456ffa": {"doc_hash": "a7bd85f3852bac9f4cdbbfd29513d13b049fe5581cc8117462bf768f9b9f960a", "ref_doc_id": "40432b16-fe92-46c1-a567-cb1db71c4d14"}, "724d6454-0836-4f11-ab8f-a96b2d1034dc": {"doc_hash": "be9bf09dd176069c4f6fd8c1949b8b0d6848985125e0d1b7c6f27d470a73a030", "ref_doc_id": "280aae5f-b5cc-40a6-b9c8-bbe5f7509270"}, "62c55c5d-a9fa-456f-b2f7-b715d137a63d": {"doc_hash": "fe8632a957a8acfade701ea51f4f537e80c162fd97418d991a6d2eb91feeab96", "ref_doc_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5"}, "7c782813-3d9c-4df0-8ba9-1eec36b8269c": {"doc_hash": "7364f3e0848e232f5319806bae1795b1499f72cbd571e2091f0e079b55422b4c", "ref_doc_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5"}, "a853f26b-c78c-40c2-91c5-0e8f6c8d1e33": {"doc_hash": "4c097bdf1c030dcfd87b095170cadf6f14a69a26410251f874d35adb1c05c744", "ref_doc_id": "bcb67366-2d90-47cc-bd80-403b935eb6b5"}, "8573d8a2-b198-4cd8-bdcb-b1ec44259c0f": {"doc_hash": "987f338ebeb8207f3c26a7c043c7bb106c60489530fccae44d04359dff508454", "ref_doc_id": "20b4382e-d50c-4f54-977c-dde0ee629bae"}, "8804bd55-fae3-44da-b336-f1f0684ffbec": {"doc_hash": "0bc46229475aa7addc80ad73af2a8d5dc878818c416a927485f6fb100af952d2", "ref_doc_id": "531abf6c-f685-4f51-8c28-a48630083160"}, "051ca004-6c72-410c-94bb-a8502e257461": {"doc_hash": "2509e3a32234347d7dcdfd2817873fe818423868a1c8b70d14d7df8fd861b43d", "ref_doc_id": "531abf6c-f685-4f51-8c28-a48630083160"}, "2761fa9c-b7d5-4502-8021-d1886618163b": {"doc_hash": "c1ff276726cacbc60c05ea09573dcac20e226bd30258612890cd99ec440dcd02", "ref_doc_id": "beec6e45-03d9-422a-b9e8-591664a84ef6"}, "85c434e3-68f8-4378-b119-ed19417d8b5a": {"doc_hash": "105f7cd2c9f86237401683de0220f124fae2f85eae61a469821a157e26b58470", "ref_doc_id": "62080a23-55e5-4007-8ba3-804b5febe82a"}, "3c435b54-0749-4fef-abed-61500319042a": {"doc_hash": "ce7245e491643632d33bd6923170f354d897fa5fb18a1ed368770eccaf8ae130", "ref_doc_id": "ef86fc01-fc73-49f7-9b28-d0d8fa54f118"}, "6c1ce8b0-9fee-42ad-abb9-b97c6199620b": {"doc_hash": "406069462f1fc81ab315258de9cc81826779c904507b012a5b4c75c55078a003", "ref_doc_id": "ebc8cc62-aef3-4460-beeb-7875f0919dfd"}, "9d82735c-b851-46ec-b40c-b7028fe7a17e": {"doc_hash": "c13ed9c6eddeba3ceb8e0d92f3e8ab802603957b0d02a00bd4579be2b9f82f7d", "ref_doc_id": "8fa949b2-11de-46a4-bc82-bbd32324b15b"}, "882d5fdc-a69a-45b1-a7f4-8056cefd0550": {"doc_hash": "063fb8b5b444a044fde1cc1e32d618d9c424c25aade3fb36d12b01be9c5e1910", "ref_doc_id": "3f4d1ab6-983e-4683-9a76-18330c0342d4"}, "b780e410-efe2-4ae3-8468-bc2299406311": {"doc_hash": "ebea7aba198ce1c34171460924e62d560bef208cb820cfe51d0b30e1b11b37ba", "ref_doc_id": "3f4d1ab6-983e-4683-9a76-18330c0342d4"}, "427813df-0929-4f66-9bae-0fb44434dbc5": {"doc_hash": "d2142cd19ce11c4df45baaab58ebfe394a51644ef5f202bfdf64a140b38bf4d8", "ref_doc_id": "d060b8aa-6d77-49d2-bc97-176d87213302"}, "32f98581-7c8b-46af-9380-c6265d6f9ec1": {"doc_hash": "5780403738d8735ef50d3779e605e0b752eba5180712f4637c15b07f0ce0450d", "ref_doc_id": "1be88766-e23e-4620-b5e3-ef4059bfba74"}, "ea91a378-acd2-4f5f-af14-658b92f375bb": {"doc_hash": "19c1990fba7f10f07f429ed7f3d892fd4300136d928dc88ee70c1d84459ee733", "ref_doc_id": "fe2de9a6-ce0f-4a48-88d5-7795f2454971"}, "5a7d4598-6e9d-4dc9-a0d0-2538bfe16670": {"doc_hash": "da02e5f17951347637b1ef2057a4ae149940baeab31e65af5791b72ed2cc516b", "ref_doc_id": "24b63639-e6e3-47b2-8072-905605638093"}}}